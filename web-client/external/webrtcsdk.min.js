require.config({baseUrl:"./",paths:{WebRTC_SDK:"src",backbone:"bower_components/backbone/backbone",nodeuuid:"bower_components/node-uuid/uuid",q:"bower_components/q/q","state-machine":"bower_components/state-machine/lib/state-machine","socket.io-client":"bower_components/socket.io-client/socket.io",clientSDK:"bower_components/client-sdk",sockjs:"bower_components/sockjs/sockjs.min",bluebird:"bower_components/bluebird/js/browser/bluebird",underscore:"thirdparty/underscore",jquery:"thirdparty/jquery-1.8.2","my.Class":"thirdparty/my.class.min",getscreenmedia:"thirdparty/getscreenmedia.bundle",getusermedia:"thirdparty/getusermedia.bundle",hark:"thirdparty/hark.bundle",attachmediastream:"thirdparty/attachmediastream.bundle",mockconsole:"thirdparty/mockconsole.umd",util:"thirdparty/index",adapter:"thirdparty/adapter","mediastream-gain":"thirdparty/mediastream-gain.bundle",state_machine:"thirdparty/state-machine",Logger:"thirdparty/logger",browserDetector:"thirdparty/browserDetector",localmedia:"thirdparty/amd-wrappers/localmedia",webrtcsupport:"thirdparty/amd-wrappers/index-browser",wildemitter:"thirdparty/amd-wrappers/wildemitter",sdpUtils:"thirdparty/amd-wrappers/sdpUtils","sdp-interop":"thirdparty/sdp-interop","sdp-transform":"thirdparty/sdp-transform"},map:{"*":{my:"my.Class",lodash:"underscore","state-machine":"state_machine"}},shim:{backbone:{deps:["underscore","jquery"],exports:"Backbone"}},bundles:{"webrtc-sdk":["my.Class","underscore","jquery","backbone","q","browserDetector","Logger","WebRTC_SDK/utilities/RTCBlueJay","WebRTC_SDK/utilities/RTCUtils","socket.io-client","WebRTC_SDK/utilities/RTCErrors","WebRTC_SDK/utilities/RTCMessageParser","WebRTC_SDK/RTCStates","WebRTC_SDK/manager/RTCSignallingManager","WebRTC_SDK/models/RTCTransactionModel","state_machine","WebRTC_SDK/manager/RTCStateManager","WebRTC_SDK/manager/RTCTransactionManager","util","hark","webrtcsupport","getusermedia","getscreenmedia","wildemitter","mediastream-gain","mockconsole","localmedia","attachmediastream","WebRTC_SDK/manager/RTCLocalMediaManager","adapter","WebRTC_SDK/models/RTCCallStatsModel","WebRTC_SDK/RTCCallStats","WebRTC_SDK/models/RTCPeerModel","sdpUtils","sdp-transform/grammar","sdp-transform/parser","sdp-transform/writer","sdp-transform/index","sdp-interop/transform","sdp-interop/array-equals","sdp-interop/interop","sdp-interop/index","WebRTC_SDK/RTCPeer","WebRTC_SDK/models/RTCScreenSharingModel","WebRTC_SDK/manager/RTCScreenSharingManager","WebRTC_SDK/manager/RTCPeerConnectionManager","nodeuuid","WebRTC_SDK/manager/RTCCapabilitiesManager","WebRTC_SDK/RTCController","config","clientSDK/src/clients/RestClient","clientSDK/src/clients/SecurePerimeterClient","clientSDK/src/models/Connection","clientSDK/src/models/Participant","clientSDK/src/models/ParticipantsCollection","clientSDK/src/Roster","bluebird","sockjs","clientSDK/src/clients/WebSocketClient","clientSDK/src/clients/EventServiceClient","clientSDK/src/clients/SchedulingClient","WebRTC_SDK/RTCManager"]}}),function(){var a={};"undefined"!=typeof define?define("my.Class",[],function(){return a}):"undefined"!=typeof window?window.my=a:module.exports=a,a.Class=function(){var a,d,e=arguments.length,f=arguments[e-1],g=e>1?arguments[0]:null,h=e>2;if(f.constructor===Object?a=function(){}:(a=f.constructor,delete f.constructor),g&&(d=function(){},d.prototype=g.prototype,a.prototype=new d,a.prototype.constructor=a,a.Super=g,c(a,g,!1)),h)for(var i=1;e-1>i;i++)c(a.prototype,arguments[i].prototype,!1);return b(a,f),a};var b=a.extendClass=function(a,b,d){b.STATIC&&(c(a,b.STATIC,d),delete b.STATIC),c(a.prototype,b,d)},c=function(a,b,c){var d;if(c===!1)for(d in b)d in a||(a[d]=b[d]);else{for(d in b)a[d]=b[d];b.toString!==Object.prototype.toString&&(a.toString=b.toString)}}}(),function(a,b){function c(a){return a&&"object"==typeof a&&a.__wrapped__?a:this instanceof c?void(this.__wrapped__=a):new c(a)}function d(a,b,c){b||(b=0);var d=a.length,e=d-b>=(c||eb);if(e)for(var f={},g=b-1;++g<d;){var h=a[g]+"";(wb.call(f,h)?f[h]:f[h]=[]).push(a[g])}return function(c){if(e){var d=c+"";return wb.call(f,d)&&la(f[d],c)>-1}return la(a,c,b)>-1}}function e(a){return a.charCodeAt(0)}function f(a,b){var c=a.index,d=b.index;if(a=a.criteria,b=b.criteria,a!==b){if(a>b||"undefined"==typeof a)return 1;if(b>a||"undefined"==typeof b)return-1}return d>c?-1:1}function g(a,b,c,d){function e(){var i=arguments,j=g?this:b;if(f||(a=b[h]),c.length&&(i=i.length?(i=m(i),d?i.concat(c):c.concat(i)):c),this instanceof e){l.prototype=a.prototype,j=new l,l.prototype=null;var k=a.apply(j,i);return D(k)?k:j}return a.apply(j,i)}var f=C(a),g=!c,h=b;return g&&(c=b),f||(b=a),e}function h(a,b,c){if(null==a)return Na;var d=typeof a;if("function"!=d){if("object"!=d)return function(b){return b[a]};var e=ec(a);return function(b){for(var c=e.length,d=!1;c--&&(d=A(b[e[c]],a[e[c]],db)););return d}}return"undefined"!=typeof b?1===c?function(c){return a.call(b,c)}:2===c?function(c,d){return a.call(b,c,d)}:4===c?function(c,d,e,f){return a.call(b,c,d,e,f)}:function(c,d,e){return a.call(b,c,d,e)}:a}function i(){for(var a,b={isKeysFast:Tb,arrays:"isArray(iterable)",bottom:"",loop:"",top:"",useHas:!0},c=0;a=arguments[c];c++)for(var d in a)b[d]=a[d];var e=b.args;b.firstArg=/^[^,]+/.exec(e)[0];var f=Function("createCallback, hasOwnProperty, isArguments, isArray, isString, objectTypes, nativeKeys","return function("+e+") {\n"+Yb(b)+"\n}");return f(h,wb,o,dc,I,Wb,Db)}function j(a){return"\\"+Xb[a]}function k(a){return fc[a]}function l(){}function m(a,b,c){b||(b=0),"undefined"==typeof c&&(c=a?a.length:0);for(var d=-1,e=c-b||0,f=Array(0>e?0:e);++d<e;)f[d]=a[b+d];return f}function n(a){return gc[a]}function o(a){return yb.call(a)==Hb}function p(a){var b=!1;if(!a||"object"!=typeof a||o(a))return b;var c=a.constructor;return!C(c)||c instanceof c?(bc(a,function(a,c){b=c}),b===!1||wb.call(a,b)):b}function q(a){var b=[];return cc(a,function(a,c){b.push(c)}),b}function r(a,c,d,e,f,g){var i=a;if("function"==typeof c&&(e=d,d=c,c=!1),"function"==typeof d){d="undefined"==typeof e?d:h(d,e,1),i=d(i);var j="undefined"!=typeof i;j||(i=a)}var k=D(i);if(k){var l=yb.call(i);if(!Ub[l])return i;var n=dc(i)}if(!k||!c)return k&&!j?n?m(i):hc({},i):i;var o=Vb[l];switch(l){case Jb:case Kb:return j?i:new o(+i);case Mb:case Pb:return j?i:new o(i);case Ob:return j?i:o(i.source,kb.exec(i))}f||(f=[]),g||(g=[]);for(var p=f.length;p--;)if(f[p]==a)return g[p];return j||(i=n?o(i.length):{},n&&(wb.call(a,"index")&&(i.index=a.index),wb.call(a,"input")&&(i.input=a.input))),f.push(a),g.push(i),(n?V:cc)(j?i:a,function(a,e){i[e]=r(a,c,d,b,f,g)}),i}function s(a,b,c){return r(a,!0,b,c)}function t(a){var b=[];return bc(a,function(a,c){C(a)&&b.push(c)}),b.sort()}function u(a,b){return a?wb.call(a,b):!1}function v(a){for(var b=-1,c=ec(a),d=c.length,e={};++b<d;){var f=c[b];e[a[f]]=f}return e}function w(a){return a===!0||a===!1||yb.call(a)==Jb}function x(a){return a instanceof Date||yb.call(a)==Kb}function y(a){return a?1===a.nodeType:!1}function z(a){var b=!0;if(!a)return b;var c=yb.call(a),d=a.length;return c==Ib||c==Pb||c==Hb||c==Nb&&"number"==typeof d&&C(a.splice)?!d:(cc(a,function(){return b=!1}),b)}function A(a,b,c,d,e,f){var g=c===db;if(c&&!g){c="undefined"==typeof d?c:h(c,d,2);var i=c(a,b);if("undefined"!=typeof i)return!!i}if(a===b)return 0!==a||1/a==1/b;var j=typeof a,k=typeof b;if(a===a&&(!a||"function"!=j&&"object"!=j)&&(!b||"function"!=k&&"object"!=k))return!1;if(null==a||null==b)return a===b;var l=yb.call(a),m=yb.call(b);if(l==Hb&&(l=Nb),m==Hb&&(m=Nb),l!=m)return!1;switch(l){case Jb:case Kb:return+a==+b;case Mb:return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case Ob:case Pb:return a==b+""}var n=l==Ib;if(!n){if(a.__wrapped__||b.__wrapped__)return A(a.__wrapped__||a,b.__wrapped__||b,c,d,e,f);if(l!=Nb)return!1;var o=a.constructor,p=b.constructor;if(o!=p&&!(C(o)&&o instanceof o&&C(p)&&p instanceof p))return!1}e||(e=[]),f||(f=[]);for(var q=e.length;q--;)if(e[q]==a)return f[q]==b;var r=0;if(i=!0,e.push(a),f.push(b),n){if(q=a.length,r=b.length,i=r==a.length,!i&&!g)return i;for(;r--;){var s=q,t=b[r];if(g)for(;s--&&!(i=A(a[s],t,c,d,e,f)););else if(!(i=A(a[r],t,c,d,e,f)))break}return i}return bc(b,function(b,g,h){return wb.call(h,g)?(r++,i=wb.call(a,g)&&A(a[g],b,c,d,e,f)):void 0}),i&&!g&&bc(a,function(a,b,c){return wb.call(c,b)?i=--r>-1:void 0}),i}function B(a){return Bb(a)&&!Cb(parseFloat(a))}function C(a){return"function"==typeof a||!1}function D(a){return a?Wb[typeof a]:!1}function E(a){return G(a)&&a!=+a}function F(a){return null===a}function G(a){return"number"==typeof a||yb.call(a)==Mb}function H(a){return a instanceof RegExp||yb.call(a)==Ob}function I(a){return"string"==typeof a||yb.call(a)==Pb}function J(a){return"undefined"==typeof a}function K(a,b,c){var d=arguments,e=0,f=2;if(!D(a))return a;if(c===db)var g=d[3],i=d[4],j=d[5];else i=[],j=[],"number"!=typeof c&&(f=d.length),f>3&&"function"==typeof d[f-2]?g=h(d[--f-1],d[f--],2):f>2&&"function"==typeof d[f-1]&&(g=d[--f]);for(;++e<f;)(dc(d[e])?V:cc)(d[e],function(b,c){var d,e,f=b,h=a[c];if(b&&((e=dc(b))||jc(b))){for(var k=i.length;k--;)if(d=i[k]==b){h=j[k];break}d||(h=e?dc(h)?h:[]:jc(h)?h:{},g&&(f=g(h,b),"undefined"!=typeof f&&(h=f)),i.push(b),j.push(h),g||(h=K(h,b,db,g,i,j)))}else g&&(f=g(h,b),"undefined"==typeof f&&(f=b)),"undefined"!=typeof f&&(h=f);a[c]=h});return a}function L(a,b,c){var d="function"==typeof b,e={};if(d)b=h(b,c);else var f=tb.apply(ab,arguments);return bc(a,function(a,c,g){(d?!b(a,c,g):la(f,c,1)<0)&&(e[c]=a)}),e}function M(a){for(var b=-1,c=ec(a),d=c.length,e=Array(d);++b<d;){var f=c[b];e[b]=[f,a[f]]}return e}function N(a,b,c){var d={};if("function"!=typeof b)for(var e=0,f=tb.apply(ab,arguments),g=D(a)?f.length:0;++e<g;){var i=f[e];i in a&&(d[i]=a[i])}else b=h(b,c),bc(a,function(a,c,e){b(a,c,e)&&(d[c]=a)});return d}function O(a){for(var b=-1,c=ec(a),d=c.length,e=Array(d);++b<d;)e[b]=a[c[b]];return e}function P(a){for(var b=-1,c=tb.apply(ab,m(arguments,1)),d=c.length,e=Array(d);++b<d;)e[b]=a[c[b]];return e}function Q(a,b,c){var d=-1,e=a?a.length:0,f=!1;return c=(0>c?Eb(0,e+c):c)||0,"number"==typeof e?f=(I(a)?a.indexOf(b,c):la(a,b,c))>-1:ac(a,function(a){return++d>=c?!(f=a===b):void 0}),f}function R(a,b,c){var d={};return b=h(b,c),V(a,function(a,c,e){c=b(a,c,e)+"",wb.call(d,c)?d[c]++:d[c]=1}),d}function S(a,b,c){var d=!0;if(b=h(b,c),dc(a))for(var e=-1,f=a.length;++e<f&&(d=!!b(a[e],e,a)););else ac(a,function(a,c,e){return d=!!b(a,c,e)});return d}function T(a,b,c){var d=[];if(b=h(b,c),dc(a))for(var e=-1,f=a.length;++e<f;){var g=a[e];b(g,e,a)&&d.push(g)}else ac(a,function(a,c,e){b(a,c,e)&&d.push(a)});return d}function U(a,b,c){var d;return b=h(b,c),V(a,function(a,c,e){return b(a,c,e)?(d=a,!1):void 0}),d}function V(a,b,c){if(b&&"undefined"==typeof c&&dc(a))for(var d=-1,e=a.length;++d<e&&b(a[d],d,a)!==!1;);else ac(a,b,c);return a}function W(a,b,c){var d={};return b=h(b,c),V(a,function(a,c,e){c=b(a,c,e)+"",(wb.call(d,c)?d[c]:d[c]=[]).push(a)}),d}function X(a,b){var c=m(arguments,2),d=-1,e="function"==typeof b,f=a?a.length:0,g=Array("number"==typeof f?f:0);return V(a,function(a){g[++d]=(e?b:a[b]).apply(a,c)}),g}function Y(a,b,c){var d=-1,e=a?a.length:0,f=Array("number"==typeof e?e:0);if(b=h(b,c),dc(a))for(;++d<e;)f[d]=b(a[d],d,a);else ac(a,function(a,c,e){f[++d]=b(a,c,e)});return f}function Z(a,b,c){var d=-(1/0),f=d;if(!b&&dc(a))for(var g=-1,i=a.length;++g<i;){var j=a[g];j>f&&(f=j)}else b=!b&&I(a)?e:h(b,c),ac(a,function(a,c,e){var g=b(a,c,e);g>d&&(d=g,f=a)});return f}function $(a,b,c){var d=1/0,f=d;if(!b&&dc(a))for(var g=-1,i=a.length;++g<i;){var j=a[g];f>j&&(f=j)}else b=!b&&I(a)?e:h(b,c),ac(a,function(a,c,e){var g=b(a,c,e);d>g&&(d=g,f=a)});return f}function _(a,b,c,d){var e=arguments.length<3;if(b=h(b,d,4),dc(a)){var f=-1,g=a.length;for(e&&(c=a[++f]);++f<g;)c=b(c,a[f],f,a)}else ac(a,function(a,d,f){c=e?(e=!1,a):b(c,a,d,f)});return c}function aa(a,b,c,d){var e=a,f=a?a.length:0,g=arguments.length<3;if("number"!=typeof f){var i=ec(a);f=i.length}return b=h(b,d,4),V(a,function(a,d,h){d=i?i[--f]:--f,c=g?(g=!1,e[d]):b(c,e[d],d,h)}),c}function ba(a,b,c){return b=h(b,c),T(a,function(a,c,d){return!b(a,c,d)})}function ca(a){var b=-1,c=a?a.length:0,d=Array("number"==typeof c?c:0);return V(a,function(a){var c=ub(Gb()*(++b+1));d[b]=d[c],d[c]=a}),d}function da(a){var b=a?a.length:0;return"number"==typeof b?b:ec(a).length}function ea(a,b,c){var d;if(b=h(b,c),dc(a))for(var e=-1,f=a.length;++e<f&&!(d=b(a[e],e,a)););else ac(a,function(a,c,e){return!(d=b(a,c,e))});return!!d}function fa(a,b,c){var d=-1,e=a?a.length:0,g=Array("number"==typeof e?e:0);for(b=h(b,c),V(a,function(a,c,e){g[++d]={criteria:b(a,c,e),index:d,value:a}}),e=g.length,g.sort(f);e--;)g[e]=g[e].value;return g}function ga(a){return a&&"number"==typeof a.length?m(a):O(a)}function ha(a){for(var b=-1,c=a?a.length:0,d=[];++b<c;){var e=a[b];e&&d.push(e)}return d}function ia(a){for(var b=-1,c=a?a.length:0,e=tb.apply(ab,arguments),f=d(e,c),g=[];++b<c;){var h=a[b];f(h)||g.push(h)}return g}function ja(a,b,c){if(a){var d=0,e=a.length;if("number"!=typeof b&&null!=b){var f=-1;for(b=h(b,c);++f<e&&b(a[f],f,a);)d++}else if(d=b,null==d||c)return a[0];return m(a,0,Fb(Eb(0,d),e))}}function ka(a,b){for(var c=-1,d=a?a.length:0,e=[];++c<d;){var f=a[c];dc(f)?xb.apply(e,b?f:ka(f)):e.push(f)}return e}function la(a,b,c){var d=-1,e=a?a.length:0;if("number"==typeof c)d=(0>c?Eb(0,e+c):c||0)-1;else if(c)return d=ta(a,b),a[d]===b?d:-1;for(;++d<e;)if(a[d]===b)return d;return-1}function ma(a,b,c){if(!a)return[];var d=0,e=a.length;if("number"!=typeof b&&null!=b){var f=e;for(b=h(b,c);f--&&b(a[f],f,a);)d++}else d=null==b||c?1:b||d;return m(a,0,Fb(Eb(0,e-d),e))}function na(a){var b=arguments,c=b.length,e={0:{}},f=-1,g=a?a.length:0,h=g>=100,i=[],j=i;a:for(;++f<g;){var k=a[f];if(h)var l=k+"",m=wb.call(e[0],l)?!(j=e[0][l]):j=e[0][l]=[];if(m||la(j,k)<0){h&&j.push(k);for(var n=c;--n;)if(!(e[n]||(e[n]=d(b[n],0,100)))(k))continue a;i.push(k)}}return i}function oa(a,b,c){if(a){var d=0,e=a.length;if("number"!=typeof b&&null!=b){var f=e;for(b=h(b,c);f--&&b(a[f],f,a);)d++}else if(d=b,null==d||c)return a[e-1];return m(a,Eb(0,e-d))}}function pa(a,b,c){var d=a?a.length:0;for("number"==typeof c&&(d=(0>c?Eb(0,d+c):Fb(c,d-1))+1);d--;)if(a[d]===b)return d;return-1}function qa(a,b){for(var c=-1,d=a?a.length:0,e={};++c<d;){var f=a[c];b?e[f]=b[c]:e[f[0]]=f[1]}return e}function ra(a,b,c){a=+a||0,c=+c||1,null==b&&(b=a,a=0);for(var d=-1,e=Eb(0,sb((b-a)/c)),f=Array(e);++d<e;)f[d]=a,a+=c;return f}function sa(a,b,c){if("number"!=typeof b&&null!=b){var d=0,e=-1,f=a?a.length:0;for(b=h(b,c);++e<f&&b(a[e],e,a);)d++}else d=null==b||c?1:Eb(0,b);return m(a,d)}function ta(a,b,c,d){var e=0,f=a?a.length:e;for(c=c?h(c,d,1):Na,b=c(b);f>e;){var g=e+f>>>1;c(a[g])<b?e=g+1:f=g}return e}function ua(){return va(tb.apply(ab,arguments))}function va(a,b,c,d){var e=-1,f=a?a.length:0,g=[],i=g;"function"==typeof b&&(d=c,c=b,b=!1);var j=!b&&f>=75;if(j)var k={};for(c&&(i=[],c=h(c,d));++e<f;){var l=a[e],m=c?c(l,e,a):l;if(j)var n=m+"",o=wb.call(k,n)?!(i=k[n]):i=k[n]=[];(b?!e||i[i.length-1]!==m:o||la(i,m)<0)&&((c||j)&&i.push(m),g.push(l))}return g}function wa(a){for(var b=-1,c=a?a.length:0,e=d(arguments,1),f=[];++b<c;){var g=a[b];e(g)||f.push(g)}return f}function xa(a){for(var b=-1,c=a?Z(kc(arguments,"length")):0,d=Array(c);++b<c;)d[b]=kc(arguments,b);return d}function ya(a,b){return 1>a?b():function(){return--a<1?b.apply(this,arguments):void 0}}function za(a,b){return Sb||zb&&arguments.length>2?zb.call.apply(zb,arguments):g(a,b,m(arguments,2))}function Aa(a){for(var b=tb.apply(ab,arguments),c=b.length>1?0:(b=t(a),-1),d=b.length;++c<d;){var e=b[c];a[e]=za(a[e],a)}return a}function Ba(a,b){return g(a,b,m(arguments,2))}function Ca(){var a=arguments;return function(){for(var b=arguments,c=a.length;c--;)b=[a[c].apply(this,b)];return b[0]}}function Da(a,b,c){function d(){h=null,c||(f=a.apply(g,e))}var e,f,g,h;return function(){var i=c&&!h;return e=arguments,g=this,clearTimeout(h),h=setTimeout(d,b),i&&(f=a.apply(g,e)),f}}function Ea(a,c){var d=m(arguments,2);return setTimeout(function(){a.apply(b,d)},c)}function Fa(a){var c=m(arguments,1);return setTimeout(function(){a.apply(b,c)},1)}function Ga(a,b){var c={};return function(){var d=(b?b.apply(this,arguments):arguments[0])+"";return wb.call(c,d)?c[d]:c[d]=a.apply(this,arguments)}}function Ha(a){var b,c;return function(){return b?c:(b=!0,c=a.apply(this,arguments),a=null,c)}}function Ia(a){return g(a,m(arguments,1))}function Ja(a){return g(a,m(arguments,1),null,db)}function Ka(a,b){function c(){h=new Date,g=null,e=a.apply(f,d)}var d,e,f,g,h=0;return function(){var i=new Date,j=b-(i-h);return d=arguments,f=this,0>=j?(clearTimeout(g),g=null,h=i,e=a.apply(f,d)):g||(g=setTimeout(c,j)),e}}function La(a,b){return function(){var c=[a];return xb.apply(c,arguments),b.apply(this,c)}}function Ma(a){return null==a?"":(a+"").replace(pb,k)}function Na(a){return a}function Oa(a){V(t(a),function(b){var d=c[b]=a[b];c.prototype[b]=function(){var a=[this.__wrapped__];return xb.apply(a,arguments),new c(d.apply(c,a))}})}function Pa(){return a._=fb,this}function Qa(a,b){return null==a&&null==b&&(b=1),a=+a||0,null==b&&(b=a,a=0),a+ub(Gb()*((+b||0)-a+1))}function Ra(a,c){var d=a?a[c]:b;return C(d)?a[c]():d}function Sa(a,d,e){var f=c.templateSettings;a||(a=""),e=ic({},e,f);var g,h=ic({},e.imports,f.imports),i=ec(h),k=O(h),l=0,m=e.interpolate||ob,n="__p += '",o=RegExp((e.escape||ob).source+"|"+m.source+"|"+(m===nb?mb:ob).source+"|"+(e.evaluate||ob).source+"|$","g");a.replace(o,function(b,c,d,e,f,h){return d||(d=e),n+=a.slice(l,h).replace(qb,j),c&&(n+="' +\n__e("+c+") +\n'"),f&&(g=!0,n+="';\n"+f+";\n__p += '"),d&&(n+="' +\n((__t = ("+d+")) == null ? '' : __t) +\n'"),l=h+b.length,b}),n+="';\n";var p=e.variable,q=p;q||(p="obj",n="with ("+p+") {\n"+n+"\n}\n"),n=(g?n.replace(hb,""):n).replace(ib,"$1").replace(jb,"$1;"),n="function("+p+") {\n"+(q?"":p+" || ("+p+" = {});\n")+"var __t, __p = '', __e = _.escape"+(g?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+n+"return __p\n}";var r="\n/*\n//@ sourceURL="+(e.sourceURL||"/lodash/template/source["+rb++ +"]")+"\n*/";try{var s=Function(i,"return "+n+r).apply(b,k)}catch(t){throw t.source=n,t}return d?s(d):(s.source=n,s)}function Ta(a,b,c){a=+a||0;for(var d=-1,e=Array(a);++d<a;)e[d]=b.call(c,d);return e}function Ua(a){return null==a?"":(a+"").replace(gb,n)}function Va(a){var b=++cb;return(null==a?"":a+"")+b}function Wa(a,b){return b(a),a}function Xa(){return this.__wrapped__+""}function Ya(){return this.__wrapped__}var Za="object"==typeof exports&&exports,$a="object"==typeof module&&module&&module.exports==Za&&module,_a="object"==typeof global&&global;_a.global===_a;var ab=[],bb={},cb=0,db=bb,eb=30,fb=a._,gb=/&(?:amp|lt|gt|quot|#39);/g,hb=/\b__p \+= '';/g,ib=/\b(__p \+=) '' \+/g,jb=/(__e\(.*?\)|\b__t\)) \+\n'';/g,kb=/\w*$/,lb=RegExp("^"+(bb.valueOf+"").replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),mb=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,nb=/<%=([\s\S]+?)%>/g,ob=/($^)/,pb=/[&<>"']/g,qb=/['\n\r\t\u2028\u2029\\]/g,rb=0,sb=Math.ceil,tb=ab.concat,ub=Math.floor,vb=lb.test(vb=Object.getPrototypeOf)&&vb,wb=bb.hasOwnProperty,xb=ab.push,yb=bb.toString,zb=lb.test(zb=m.bind)&&zb,Ab=lb.test(Ab=Array.isArray)&&Ab,Bb=a.isFinite,Cb=a.isNaN,Db=lb.test(Db=Object.keys)&&Db,Eb=Math.max,Fb=Math.min,Gb=Math.random,Hb="[object Arguments]",Ib="[object Array]",Jb="[object Boolean]",Kb="[object Date]",Lb="[object Function]",Mb="[object Number]",Nb="[object Object]",Ob="[object RegExp]",Pb="[object String]",Qb=!!a.attachEvent,Rb=zb&&!/\n|true/.test(zb+Qb),Sb=zb&&!Rb,Tb=Db&&(Qb||Rb),Ub={};Ub[Lb]=!1,Ub[Hb]=Ub[Ib]=Ub[Jb]=Ub[Kb]=Ub[Mb]=Ub[Nb]=Ub[Ob]=Ub[Pb]=!0;var Vb={};Vb[Ib]=Array,Vb[Jb]=Boolean,Vb[Kb]=Date,Vb[Nb]=Object,Vb[Mb]=Number,Vb[Ob]=RegExp,Vb[Pb]=String;var Wb={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},Xb={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"};c.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:nb,variable:"",imports:{_:c}};var Yb=function(a){var b="var index, iterable = "+a.firstArg+", result = iterable;\nif (!iterable) return result;\n"+a.top+";\n";return a.arrays&&(b+="var length = iterable.length; index = -1;\nif ("+a.arrays+") {\n  while (++index < length) {\n    "+a.loop+"\n  }\n}\nelse {  "),a.isKeysFast&&a.useHas?b+="\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] ? nativeKeys(iterable) : [],\n      length = ownProps.length;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n    "+a.loop+"\n  }  ":(b+="\n  for (index in iterable) {",a.useHas&&(b+="\n    if (",a.useHas&&(b+="hasOwnProperty.call(iterable, index)"),b+=") {    "),b+=a.loop+";    ",a.useHas&&(b+="\n    }"),b+="\n  }  "),a.arrays&&(b+="\n}"),b+=a.bottom+";\nreturn result"},Zb={args:"object, source, guard",top:"var args = arguments,\n    argsIndex = 0,\n    argsLength = typeof guard == 'number' ? 2 : args.length;\nwhile (++argsIndex < argsLength) {\n  iterable = args[argsIndex];\n  if (iterable && objectTypes[typeof iterable]) {",loop:"if (typeof result[index] == 'undefined') result[index] = iterable[index]",bottom:"  }\n}"},$b={args:"collection, callback, thisArg",top:"callback = callback && typeof thisArg == 'undefined' ? callback : createCallback(callback, thisArg)",arrays:"typeof length == 'number'",loop:"if (callback(iterable[index], index, collection) === false) return result"},_b={top:"if (!objectTypes[typeof iterable]) return result;\n"+$b.top,arrays:!1},ac=i($b),bc=i($b,_b,{useHas:!1}),cc=i($b,_b),dc=Ab||function(a){return a instanceof Array||yb.call(a)==Ib},ec=Db?function(a){return D(a)?Db(a):[]}:q,fc={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},gc=v(fc),hc=i(Zb,{top:Zb.top.replace(";",";\nif (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n  var callback = createCallback(args[--argsLength - 1], args[argsLength--], 2);\n} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n  callback = args[--argsLength];\n}"),loop:"result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]"}),ic=i(Zb);C(/x/)&&(C=function(a){return a instanceof Function||yb.call(a)==Lb});var jc=function(a){if(!a||"object"!=typeof a)return!1;var b=a.valueOf,c="function"==typeof b&&(c=vb(b))&&vb(c);return c?a==c||vb(a)==c&&!o(a):p(a)},kc=Y,lc=T;Rb&&$a&&"function"==typeof setImmediate&&(Fa=za(setImmediate,a)),c.after=ya,c.assign=hc,c.at=P,c.bind=za,c.bindAll=Aa,c.bindKey=Ba,c.compact=ha,c.compose=Ca,c.countBy=R,c.debounce=Da,c.defaults=ic,c.defer=Fa,c.delay=Ea,c.difference=ia,c.filter=T,c.flatten=ka,c.forEach=V,c.forIn=bc,c.forOwn=cc,c.functions=t,c.groupBy=W,c.initial=ma,c.intersection=na,c.invert=v,c.invoke=X,c.keys=ec,c.map=Y,c.max=Z,c.memoize=Ga,c.merge=K,c.min=$,c.object=qa,c.omit=L,c.once=Ha,c.pairs=M,c.partial=Ia,c.partialRight=Ja,c.pick=N,c.pluck=kc,c.range=ra,c.reject=ba,c.rest=sa,c.shuffle=ca,c.sortBy=fa,c.tap=Wa,c.throttle=Ka,c.times=Ta,c.toArray=ga,c.union=ua,c.uniq=va,c.values=O,c.where=lc,c.without=wa,c.wrap=La,c.zip=xa,c.collect=Y,c.drop=sa,c.each=V,c.extend=hc,c.methods=t,c.select=T,c.tail=sa,c.unique=va,Oa(c),c.clone=r,c.cloneDeep=s,c.contains=Q,c.escape=Ma,c.every=S,c.find=U,c.has=u,c.identity=Na,c.indexOf=la,c.isArguments=o,c.isArray=dc,c.isBoolean=w,c.isDate=x,c.isElement=y,c.isEmpty=z,c.isEqual=A,c.isFinite=B,c.isFunction=C,c.isNaN=E,c.isNull=F,c.isNumber=G,c.isObject=D,c.isPlainObject=jc,c.isRegExp=H,c.isString=I,c.isUndefined=J,c.lastIndexOf=pa,c.mixin=Oa,c.noConflict=Pa,c.random=Qa,c.reduce=_,c.reduceRight=aa,c.result=Ra,c.size=da,c.some=ea,c.sortedIndex=ta,c.template=Sa,c.unescape=Ua,c.uniqueId=Va,c.all=S,c.any=ea,c.detect=U,c.foldl=_,c.foldr=aa,c.include=Q,c.inject=_,cc(c,function(a,b){c.prototype[b]||(c.prototype[b]=function(){var b=[this.__wrapped__];return xb.apply(b,arguments),a.apply(c,b)})}),c.first=ja,c.last=oa,c.take=ja,c.head=ja,cc(c,function(a,b){c.prototype[b]||(c.prototype[b]=function(b,d){var e=a(this.__wrapped__,b,d);return null==b||d&&"function"!=typeof b?e:new c(e)})}),c.VERSION="1.0.1",c.prototype.toString=Xa,c.prototype.value=Ya,c.prototype.valueOf=Ya,ac(["join","pop","shift"],function(a){var b=ab[a];c.prototype[a]=function(){return b.apply(this.__wrapped__,arguments)}}),ac(["push","reverse","sort","unshift"],function(a){var b=ab[a];c.prototype[a]=function(){return b.apply(this.__wrapped__,arguments),this}}),ac(["concat","slice","splice"],function(a){var b=ab[a];c.prototype[a]=function(){return new c(b.apply(this.__wrapped__,arguments))}}),"function"==typeof define&&"object"==typeof define.amd&&define.amd?(a._=c,define("underscore",[],function(){return c})):Za?$a?($a.exports=c)._=c:Za._=c:a._=c}(this),function(a,b){function c(a){var b=oa[a]={};return $.each(a.split(ba),function(a,c){b[c]=!0}),b}function d(a,c,d){if(d===b&&1===a.nodeType){var e="data-"+c.replace(qa,"-$1").toLowerCase();if(d=a.getAttribute(e),"string"==typeof d){try{d="true"===d?!0:"false"===d?!1:"null"===d?null:+d+""===d?+d:pa.test(d)?$.parseJSON(d):d}catch(f){}$.data(a,c,d)}else d=b}return d}function e(a){var b;for(b in a)if(("data"!==b||!$.isEmptyObject(a[b]))&&"toJSON"!==b)return!1;return!0}function f(){return!1}function g(){return!0}function h(a){return!a||!a.parentNode||11===a.parentNode.nodeType}function i(a,b){do a=a[b];while(a&&1!==a.nodeType);return a}function j(a,b,c){if(b=b||0,$.isFunction(b))return $.grep(a,function(a,d){var e=!!b.call(a,d,a);return e===c});if(b.nodeType)return $.grep(a,function(a,d){return a===b===c});if("string"==typeof b){var d=$.grep(a,function(a){return 1===a.nodeType});if(Ka.test(b))return $.filter(b,d,!c);b=$.filter(b,d)}return $.grep(a,function(a,d){return $.inArray(a,b)>=0===c})}function k(a){var b=Na.split("|"),c=a.createDocumentFragment();if(c.createElement)for(;b.length;)c.createElement(b.pop());return c}function l(a,b){return a.getElementsByTagName(b)[0]||a.appendChild(a.ownerDocument.createElement(b))}function m(a,b){if(1===b.nodeType&&$.hasData(a)){var c,d,e,f=$._data(a),g=$._data(b,f),h=f.events;if(h){delete g.handle,g.events={};for(c in h)for(d=0,e=h[c].length;e>d;d++)$.event.add(b,c,h[c][d])}g.data&&(g.data=$.extend({},g.data))}}function n(a,b){var c;1===b.nodeType&&(b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase(),"object"===c?(b.parentNode&&(b.outerHTML=a.outerHTML),$.support.html5Clone&&a.innerHTML&&!$.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML)):"input"===c&&Xa.test(a.type)?(b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value)):"option"===c?b.selected=a.defaultSelected:"input"===c||"textarea"===c?b.defaultValue=a.defaultValue:"script"===c&&b.text!==a.text&&(b.text=a.text),b.removeAttribute($.expando))}function o(a){return"undefined"!=typeof a.getElementsByTagName?a.getElementsByTagName("*"):"undefined"!=typeof a.querySelectorAll?a.querySelectorAll("*"):[]}function p(a){Xa.test(a.type)&&(a.defaultChecked=a.checked)}function q(a,b){if(b in a)return b;for(var c=b.charAt(0).toUpperCase()+b.slice(1),d=b,e=rb.length;e--;)if(b=rb[e]+c,b in a)return b;return d}function r(a,b){return a=b||a,"none"===$.css(a,"display")||!$.contains(a.ownerDocument,a)}function s(a,b){for(var c,d,e=[],f=0,g=a.length;g>f;f++)c=a[f],c.style&&(e[f]=$._data(c,"olddisplay"),b?(e[f]||"none"!==c.style.display||(c.style.display=""),""===c.style.display&&r(c)&&(e[f]=$._data(c,"olddisplay",w(c.nodeName)))):(d=cb(c,"display"),e[f]||"none"===d||$._data(c,"olddisplay",d)));for(f=0;g>f;f++)c=a[f],c.style&&(b&&"none"!==c.style.display&&""!==c.style.display||(c.style.display=b?e[f]||"":"none"));return a}function t(a,b,c){var d=kb.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function u(a,b,c,d){for(var e=c===(d?"border":"content")?4:"width"===b?1:0,f=0;4>e;e+=2)"margin"===c&&(f+=$.css(a,c+qb[e],!0)),d?("content"===c&&(f-=parseFloat(cb(a,"padding"+qb[e]))||0),"margin"!==c&&(f-=parseFloat(cb(a,"border"+qb[e]+"Width"))||0)):(f+=parseFloat(cb(a,"padding"+qb[e]))||0,"padding"!==c&&(f+=parseFloat(cb(a,"border"+qb[e]+"Width"))||0));return f}function v(a,b,c){var d="width"===b?a.offsetWidth:a.offsetHeight,e=!0,f=$.support.boxSizing&&"border-box"===$.css(a,"boxSizing");if(0>=d||null==d){if(d=cb(a,b),(0>d||null==d)&&(d=a.style[b]),lb.test(d))return d;e=f&&($.support.boxSizingReliable||d===a.style[b]),d=parseFloat(d)||0}return d+u(a,b,c||(f?"border":"content"),e)+"px"}function w(a){if(nb[a])return nb[a];var b=$("<"+a+">").appendTo(P.body),c=b.css("display");return b.remove(),("none"===c||""===c)&&(db=P.body.appendChild(db||$.extend(P.createElement("iframe"),{frameBorder:0,width:0,height:0})),eb&&db.createElement||(eb=(db.contentWindow||db.contentDocument).document,eb.write("<!doctype html><html><body>"),eb.close()),b=eb.body.appendChild(eb.createElement(a)),c=cb(b,"display"),P.body.removeChild(db)),nb[a]=c,c}function x(a,b,c,d){var e;if($.isArray(b))$.each(b,function(b,e){c||ub.test(a)?d(a,e):x(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==$.type(b))d(a,b);else for(e in b)x(a+"["+e+"]",b[e],c,d)}function y(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e,f,g=b.toLowerCase().split(ba),h=0,i=g.length;if($.isFunction(c))for(;i>h;h++)d=g[h],f=/^\+/.test(d),f&&(d=d.substr(1)||"*"),e=a[d]=a[d]||[],e[f?"unshift":"push"](c)}}function z(a,c,d,e,f,g){f=f||c.dataTypes[0],g=g||{},g[f]=!0;for(var h,i=a[f],j=0,k=i?i.length:0,l=a===Kb;k>j&&(l||!h);j++)h=i[j](c,d,e),"string"==typeof h&&(!l||g[h]?h=b:(c.dataTypes.unshift(h),h=z(a,c,d,e,h,g)));return!l&&h||g["*"]||(h=z(a,c,d,e,"*",g)),h}function A(a,c){var d,e,f=$.ajaxSettings.flatOptions||{};for(d in c)c[d]!==b&&((f[d]?a:e||(e={}))[d]=c[d]);e&&$.extend(!0,a,e)}function B(a,c,d){var e,f,g,h,i=a.contents,j=a.dataTypes,k=a.responseFields;for(f in k)f in d&&(c[k[f]]=d[f]);for(;"*"===j[0];)j.shift(),e===b&&(e=a.mimeType||c.getResponseHeader("content-type"));if(e)for(f in i)if(i[f]&&i[f].test(e)){j.unshift(f);break}if(j[0]in d)g=j[0];else{for(f in d){if(!j[0]||a.converters[f+" "+j[0]]){g=f;break}h||(h=f)}g=g||h}return g?(g!==j[0]&&j.unshift(g),d[g]):void 0}function C(a,b){var c,d,e,f,g=a.dataTypes.slice(),h=g[0],i={},j=0;if(a.dataFilter&&(b=a.dataFilter(b,a.dataType)),g[1])for(c in a.converters)i[c.toLowerCase()]=a.converters[c];for(;e=g[++j];)if("*"!==e){if("*"!==h&&h!==e){if(c=i[h+" "+e]||i["* "+e],!c)for(d in i)if(f=d.split(" "),f[1]===e&&(c=i[h+" "+f[0]]||i["* "+f[0]])){c===!0?c=i[d]:i[d]!==!0&&(e=f[0],g.splice(j--,0,e));break}if(c!==!0)if(c&&a["throws"])b=c(b);else try{b=c(b)}catch(k){return{state:"parsererror",error:c?k:"No conversion from "+h+" to "+e}}}h=e}return{state:"success",data:b}}function D(){try{return new a.XMLHttpRequest}catch(b){}}function E(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function F(){return setTimeout(function(){Vb=b},0),Vb=$.now()}function G(a,b){$.each(b,function(b,c){for(var d=(_b[b]||[]).concat(_b["*"]),e=0,f=d.length;f>e;e++)if(d[e].call(a,b,c))return})}function H(a,b,c){var d,e=0,f=$b.length,g=$.Deferred().always(function(){delete h.elem}),h=function(){for(var b=Vb||F(),c=Math.max(0,i.startTime+i.duration-b),d=1-(c/i.duration||0),e=0,f=i.tweens.length;f>e;e++)i.tweens[e].run(d);return g.notifyWith(a,[i,d,c]),1>d&&f?c:(g.resolveWith(a,[i]),!1)},i=g.promise({elem:a,props:$.extend({},b),opts:$.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:Vb||F(),duration:c.duration,tweens:[],createTween:function(b,c,d){var e=$.Tween(a,i.opts,b,c,i.opts.specialEasing[b]||i.opts.easing);return i.tweens.push(e),e},stop:function(b){for(var c=0,d=b?i.tweens.length:0;d>c;c++)i.tweens[c].run(1);return b?g.resolveWith(a,[i,b]):g.rejectWith(a,[i,b]),this}}),j=i.props;for(I(j,i.opts.specialEasing);f>e;e++)if(d=$b[e].call(i,a,j,i.opts))return d;return G(i,j),$.isFunction(i.opts.start)&&i.opts.start.call(a,i),$.fx.timer($.extend(h,{anim:i,queue:i.opts.queue,elem:a})),i.progress(i.opts.progress).done(i.opts.done,i.opts.complete).fail(i.opts.fail).always(i.opts.always)}function I(a,b){
var c,d,e,f,g;for(c in a)if(d=$.camelCase(c),e=b[d],f=a[c],$.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=$.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function J(a,b,c){var d,e,f,g,h,i,j,k,l=this,m=a.style,n={},o=[],p=a.nodeType&&r(a);c.queue||(j=$._queueHooks(a,"fx"),null==j.unqueued&&(j.unqueued=0,k=j.empty.fire,j.empty.fire=function(){j.unqueued||k()}),j.unqueued++,l.always(function(){l.always(function(){j.unqueued--,$.queue(a,"fx").length||j.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[m.overflow,m.overflowX,m.overflowY],"inline"===$.css(a,"display")&&"none"===$.css(a,"float")&&($.support.inlineBlockNeedsLayout&&"inline"!==w(a.nodeName)?m.zoom=1:m.display="inline-block")),c.overflow&&(m.overflow="hidden",$.support.shrinkWrapBlocks||l.done(function(){m.overflow=c.overflow[0],m.overflowX=c.overflow[1],m.overflowY=c.overflow[2]}));for(d in b)if(f=b[d],Xb.exec(f)){if(delete b[d],f===(p?"hide":"show"))continue;o.push(d)}if(g=o.length)for(h=$._data(a,"fxshow")||$._data(a,"fxshow",{}),p?$(a).show():l.done(function(){$(a).hide()}),l.done(function(){var b;$.removeData(a,"fxshow",!0);for(b in n)$.style(a,b,n[b])}),d=0;g>d;d++)e=o[d],i=l.createTween(e,p?h[e]:0),n[e]=h[e]||$.style(a,e),e in h||(h[e]=i.start,p&&(i.end=i.start,i.start="width"===e||"height"===e?1:0))}function K(a,b,c,d,e){return new K.prototype.init(a,b,c,d,e)}function L(a,b){var c,d={height:a},e=0;for(b=b?1:0;4>e;e+=2-b)c=qb[e],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function M(a){return $.isWindow(a)?a:9===a.nodeType?a.defaultView||a.parentWindow:!1}var N,O,P=a.document,Q=a.location,R=a.navigator,S=a.jQuery,T=a.$,U=Array.prototype.push,V=Array.prototype.slice,W=Array.prototype.indexOf,X=Object.prototype.toString,Y=Object.prototype.hasOwnProperty,Z=String.prototype.trim,$=function(a,b){return new $.fn.init(a,b,N)},_=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,aa=/\S/,ba=/\s+/,ca=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,da=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,ea=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,fa=/^[\],:{}\s]*$/,ga=/(?:^|:|,)(?:\s*\[)+/g,ha=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,ia=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,ja=/^-ms-/,ka=/-([\da-z])/gi,la=function(a,b){return(b+"").toUpperCase()},ma=function(){P.addEventListener?(P.removeEventListener("DOMContentLoaded",ma,!1),$.ready()):"complete"===P.readyState&&(P.detachEvent("onreadystatechange",ma),$.ready())},na={};$.fn=$.prototype={constructor:$,init:function(a,c,d){var e,f,g;if(!a)return this;if(a.nodeType)return this.context=this[0]=a,this.length=1,this;if("string"==typeof a){if(e="<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&a.length>=3?[null,a,null]:da.exec(a),!e||!e[1]&&c)return!c||c.jquery?(c||d).find(a):this.constructor(c).find(a);if(e[1])return c=c instanceof $?c[0]:c,g=c&&c.nodeType?c.ownerDocument||c:P,a=$.parseHTML(e[1],g,!0),ea.test(e[1])&&$.isPlainObject(c)&&this.attr.call(a,c,!0),$.merge(this,a);if(f=P.getElementById(e[2]),f&&f.parentNode){if(f.id!==e[2])return d.find(a);this.length=1,this[0]=f}return this.context=P,this.selector=a,this}return $.isFunction(a)?d.ready(a):(a.selector!==b&&(this.selector=a.selector,this.context=a.context),$.makeArray(a,this))},selector:"",jquery:"1.8.2",length:0,size:function(){return this.length},toArray:function(){return V.call(this)},get:function(a){return null==a?this.toArray():0>a?this[this.length+a]:this[a]},pushStack:function(a,b,c){var d=$.merge(this.constructor(),a);return d.prevObject=this,d.context=this.context,"find"===b?d.selector=this.selector+(this.selector?" ":"")+c:b&&(d.selector=this.selector+"."+b+"("+c+")"),d},each:function(a,b){return $.each(this,a,b)},ready:function(a){return $.ready.promise().done(a),this},eq:function(a){return a=+a,-1===a?this.slice(a):this.slice(a,a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(V.apply(this,arguments),"slice",V.call(arguments).join(","))},map:function(a){return this.pushStack($.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:U,sort:[].sort,splice:[].splice},$.fn.init.prototype=$.fn,$.extend=$.fn.extend=function(){var a,c,d,e,f,g,h=arguments[0]||{},i=1,j=arguments.length,k=!1;for("boolean"==typeof h&&(k=h,h=arguments[1]||{},i=2),"object"==typeof h||$.isFunction(h)||(h={}),j===i&&(h=this,--i);j>i;i++)if(null!=(a=arguments[i]))for(c in a)d=h[c],e=a[c],h!==e&&(k&&e&&($.isPlainObject(e)||(f=$.isArray(e)))?(f?(f=!1,g=d&&$.isArray(d)?d:[]):g=d&&$.isPlainObject(d)?d:{},h[c]=$.extend(k,g,e)):e!==b&&(h[c]=e));return h},$.extend({noConflict:function(b){return a.$===$&&(a.$=T),b&&a.jQuery===$&&(a.jQuery=S),$},isReady:!1,readyWait:1,holdReady:function(a){a?$.readyWait++:$.ready(!0)},ready:function(a){if(a===!0?!--$.readyWait:!$.isReady){if(!P.body)return setTimeout($.ready,1);$.isReady=!0,a!==!0&&--$.readyWait>0||(O.resolveWith(P,[$]),$.fn.trigger&&$(P).trigger("ready").off("ready"))}},isFunction:function(a){return"function"===$.type(a)},isArray:Array.isArray||function(a){return"array"===$.type(a)},isWindow:function(a){return null!=a&&a==a.window},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return null==a?String(a):na[X.call(a)]||"object"},isPlainObject:function(a){if(!a||"object"!==$.type(a)||a.nodeType||$.isWindow(a))return!1;try{if(a.constructor&&!Y.call(a,"constructor")&&!Y.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}var d;for(d in a);return d===b||Y.call(a,d)},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},error:function(a){throw new Error(a)},parseHTML:function(a,b,c){var d;return a&&"string"==typeof a?("boolean"==typeof b&&(c=b,b=0),b=b||P,(d=ea.exec(a))?[b.createElement(d[1])]:(d=$.buildFragment([a],b,c?null:[]),$.merge([],(d.cacheable?$.clone(d.fragment):d.fragment).childNodes))):null},parseJSON:function(b){return b&&"string"==typeof b?(b=$.trim(b),a.JSON&&a.JSON.parse?a.JSON.parse(b):fa.test(b.replace(ha,"@").replace(ia,"]").replace(ga,""))?new Function("return "+b)():void $.error("Invalid JSON: "+b)):null},parseXML:function(c){var d,e;if(!c||"string"!=typeof c)return null;try{a.DOMParser?(e=new DOMParser,d=e.parseFromString(c,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c))}catch(f){d=b}return d&&d.documentElement&&!d.getElementsByTagName("parsererror").length||$.error("Invalid XML: "+c),d},noop:function(){},globalEval:function(b){b&&aa.test(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(ja,"ms-").replace(ka,la)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,c,d){var e,f=0,g=a.length,h=g===b||$.isFunction(a);if(d)if(h){for(e in a)if(c.apply(a[e],d)===!1)break}else for(;g>f&&c.apply(a[f++],d)!==!1;);else if(h){for(e in a)if(c.call(a[e],e,a[e])===!1)break}else for(;g>f&&c.call(a[f],f,a[f++])!==!1;);return a},trim:Z&&!Z.call("\ufeffÂ ")?function(a){return null==a?"":Z.call(a)}:function(a){return null==a?"":(a+"").replace(ca,"")},makeArray:function(a,b){var c,d=b||[];return null!=a&&(c=$.type(a),null==a.length||"string"===c||"function"===c||"regexp"===c||$.isWindow(a)?U.call(d,a):$.merge(d,a)),d},inArray:function(a,b,c){var d;if(b){if(W)return W.call(b,a,c);for(d=b.length,c=c?0>c?Math.max(0,d+c):c:0;d>c;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,c){var d=c.length,e=a.length,f=0;if("number"==typeof d)for(;d>f;f++)a[e++]=c[f];else for(;c[f]!==b;)a[e++]=c[f++];return a.length=e,a},grep:function(a,b,c){var d,e=[],f=0,g=a.length;for(c=!!c;g>f;f++)d=!!b(a[f],f),c!==d&&e.push(a[f]);return e},map:function(a,c,d){var e,f,g=[],h=0,i=a.length,j=a instanceof $||i!==b&&"number"==typeof i&&(i>0&&a[0]&&a[i-1]||0===i||$.isArray(a));if(j)for(;i>h;h++)e=c(a[h],h,d),null!=e&&(g[g.length]=e);else for(f in a)e=c(a[f],f,d),null!=e&&(g[g.length]=e);return g.concat.apply([],g)},guid:1,proxy:function(a,c){var d,e,f;return"string"==typeof c&&(d=a[c],c=a,a=d),$.isFunction(a)?(e=V.call(arguments,2),f=function(){return a.apply(c,e.concat(V.call(arguments)))},f.guid=a.guid=a.guid||$.guid++,f):b},access:function(a,c,d,e,f,g,h){var i,j=null==d,k=0,l=a.length;if(d&&"object"==typeof d){for(k in d)$.access(a,c,k,d[k],1,g,e);f=1}else if(e!==b){if(i=h===b&&$.isFunction(e),j&&(i?(i=c,c=function(a,b,c){return i.call($(a),c)}):(c.call(a,e),c=null)),c)for(;l>k;k++)c(a[k],d,i?e.call(a[k],k,c(a[k],d)):e,h);f=1}return f?a:j?c.call(a):l?c(a[0],d):g},now:function(){return(new Date).getTime()}}),$.ready.promise=function(b){if(!O)if(O=$.Deferred(),"complete"===P.readyState)setTimeout($.ready,1);else if(P.addEventListener)P.addEventListener("DOMContentLoaded",ma,!1),a.addEventListener("load",$.ready,!1);else{P.attachEvent("onreadystatechange",ma),a.attachEvent("onload",$.ready);var c=!1;try{c=null==a.frameElement&&P.documentElement}catch(d){}c&&c.doScroll&&!function e(){if(!$.isReady){try{c.doScroll("left")}catch(a){return setTimeout(e,50)}$.ready()}}()}return O.promise(b)},$.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){na["[object "+b+"]"]=b.toLowerCase()}),N=$(P);var oa={};$.Callbacks=function(a){a="string"==typeof a?oa[a]||c(a):$.extend({},a);var d,e,f,g,h,i,j=[],k=!a.once&&[],l=function(b){for(d=a.memory&&b,e=!0,i=g||0,g=0,h=j.length,f=!0;j&&h>i;i++)if(j[i].apply(b[0],b[1])===!1&&a.stopOnFalse){d=!1;break}f=!1,j&&(k?k.length&&l(k.shift()):d?j=[]:m.disable())},m={add:function(){if(j){var b=j.length;!function c(b){$.each(b,function(b,d){var e=$.type(d);"function"!==e||a.unique&&m.has(d)?d&&d.length&&"string"!==e&&c(d):j.push(d)})}(arguments),f?h=j.length:d&&(g=b,l(d))}return this},remove:function(){return j&&$.each(arguments,function(a,b){for(var c;(c=$.inArray(b,j,c))>-1;)j.splice(c,1),f&&(h>=c&&h--,i>=c&&i--)}),this},has:function(a){return $.inArray(a,j)>-1},empty:function(){return j=[],this},disable:function(){return j=k=d=b,this},disabled:function(){return!j},lock:function(){return k=b,d||m.disable(),this},locked:function(){return!k},fireWith:function(a,b){return b=b||[],b=[a,b.slice?b.slice():b],!j||e&&!k||(f?k.push(b):l(b)),this},fire:function(){return m.fireWith(this,arguments),this},fired:function(){return!!e}};return m},$.extend({Deferred:function(a){var b=[["resolve","done",$.Callbacks("once memory"),"resolved"],["reject","fail",$.Callbacks("once memory"),"rejected"],["notify","progress",$.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return $.Deferred(function(c){$.each(b,function(b,d){var f=d[0],g=a[b];e[d[1]]($.isFunction(g)?function(){var a=g.apply(this,arguments);a&&$.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f+"With"](this===e?c:this,[a])}:c[f])}),a=null}).promise()},promise:function(a){return null!=a?$.extend(a,d):d}},e={};return d.pipe=d.then,$.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=g.fire,e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b,c,d,e=0,f=V.call(arguments),g=f.length,h=1!==g||a&&$.isFunction(a.promise)?g:0,i=1===h?a:$.Deferred(),j=function(a,c,d){return function(e){c[a]=this,d[a]=arguments.length>1?V.call(arguments):e,d===b?i.notifyWith(c,d):--h||i.resolveWith(c,d)}};if(g>1)for(b=new Array(g),c=new Array(g),d=new Array(g);g>e;e++)f[e]&&$.isFunction(f[e].promise)?f[e].promise().done(j(e,d,f)).fail(i.reject).progress(j(e,c,b)):--h;return h||i.resolveWith(d,f),i.promise()}}),$.support=function(){var b,c,d,e,f,g,h,i,j,k,l,m=P.createElement("div");if(m.setAttribute("className","t"),m.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",c=m.getElementsByTagName("*"),d=m.getElementsByTagName("a")[0],d.style.cssText="top:1px;float:left;opacity:.5",!c||!c.length)return{};e=P.createElement("select"),f=e.appendChild(P.createElement("option")),g=m.getElementsByTagName("input")[0],b={leadingWhitespace:3===m.firstChild.nodeType,tbody:!m.getElementsByTagName("tbody").length,htmlSerialize:!!m.getElementsByTagName("link").length,style:/top/.test(d.getAttribute("style")),hrefNormalized:"/a"===d.getAttribute("href"),opacity:/^0.5/.test(d.style.opacity),cssFloat:!!d.style.cssFloat,checkOn:"on"===g.value,optSelected:f.selected,getSetAttribute:"t"!==m.className,enctype:!!P.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==P.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===P.compatMode,submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},g.checked=!0,b.noCloneChecked=g.cloneNode(!0).checked,e.disabled=!0,b.optDisabled=!f.disabled;try{delete m.test}catch(n){b.deleteExpando=!1}if(!m.addEventListener&&m.attachEvent&&m.fireEvent&&(m.attachEvent("onclick",l=function(){b.noCloneEvent=!1}),m.cloneNode(!0).fireEvent("onclick"),m.detachEvent("onclick",l)),g=P.createElement("input"),g.value="t",g.setAttribute("type","radio"),b.radioValue="t"===g.value,g.setAttribute("checked","checked"),g.setAttribute("name","t"),m.appendChild(g),h=P.createDocumentFragment(),h.appendChild(m.lastChild),b.checkClone=h.cloneNode(!0).cloneNode(!0).lastChild.checked,b.appendChecked=g.checked,h.removeChild(g),h.appendChild(m),m.attachEvent)for(j in{submit:!0,change:!0,focusin:!0})i="on"+j,k=i in m,k||(m.setAttribute(i,"return;"),k="function"==typeof m[i]),b[j+"Bubbles"]=k;return $(function(){var c,d,e,f,g="padding:0;margin:0;border:0;display:block;overflow:hidden;",h=P.getElementsByTagName("body")[0];h&&(c=P.createElement("div"),c.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",h.insertBefore(c,h.firstChild),d=P.createElement("div"),c.appendChild(d),d.innerHTML="<table><tr><td></td><td>t</td></tr></table>",e=d.getElementsByTagName("td"),e[0].style.cssText="padding:0;margin:0;border:0;display:none",k=0===e[0].offsetHeight,e[0].style.display="",e[1].style.display="none",b.reliableHiddenOffsets=k&&0===e[0].offsetHeight,d.innerHTML="",d.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",b.boxSizing=4===d.offsetWidth,b.doesNotIncludeMarginInBodyOffset=1!==h.offsetTop,a.getComputedStyle&&(b.pixelPosition="1%"!==(a.getComputedStyle(d,null)||{}).top,b.boxSizingReliable="4px"===(a.getComputedStyle(d,null)||{width:"4px"}).width,f=P.createElement("div"),f.style.cssText=d.style.cssText=g,f.style.marginRight=f.style.width="0",d.style.width="1px",d.appendChild(f),b.reliableMarginRight=!parseFloat((a.getComputedStyle(f,null)||{}).marginRight)),"undefined"!=typeof d.style.zoom&&(d.innerHTML="",d.style.cssText=g+"width:1px;padding:1px;display:inline;zoom:1",b.inlineBlockNeedsLayout=3===d.offsetWidth,d.style.display="block",d.style.overflow="visible",d.innerHTML="<div></div>",d.firstChild.style.width="5px",b.shrinkWrapBlocks=3!==d.offsetWidth,c.style.zoom=1),h.removeChild(c),c=d=e=f=null)}),h.removeChild(m),c=d=e=f=g=h=m=null,b}();var pa=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,qa=/([A-Z])/g;$.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+($.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){return a=a.nodeType?$.cache[a[$.expando]]:a[$.expando],!!a&&!e(a)},data:function(a,c,d,e){if($.acceptData(a)){var f,g,h=$.expando,i="string"==typeof c,j=a.nodeType,k=j?$.cache:a,l=j?a[h]:a[h]&&h;if(l&&k[l]&&(e||k[l].data)||!i||d!==b)return l||(j?a[h]=l=$.deletedIds.pop()||$.guid++:l=h),k[l]||(k[l]={},j||(k[l].toJSON=$.noop)),("object"==typeof c||"function"==typeof c)&&(e?k[l]=$.extend(k[l],c):k[l].data=$.extend(k[l].data,c)),f=k[l],e||(f.data||(f.data={}),f=f.data),d!==b&&(f[$.camelCase(c)]=d),i?(g=f[c],null==g&&(g=f[$.camelCase(c)])):g=f,g}},removeData:function(a,b,c){if($.acceptData(a)){var d,f,g,h=a.nodeType,i=h?$.cache:a,j=h?a[$.expando]:$.expando;if(i[j]){if(b&&(d=c?i[j]:i[j].data)){$.isArray(b)||(b in d?b=[b]:(b=$.camelCase(b),b=b in d?[b]:b.split(" ")));for(f=0,g=b.length;g>f;f++)delete d[b[f]];if(!(c?e:$.isEmptyObject)(d))return}(c||(delete i[j].data,e(i[j])))&&(h?$.cleanData([a],!0):$.support.deleteExpando||i!=i.window?delete i[j]:i[j]=null)}}},_data:function(a,b,c){return $.data(a,b,c,!0)},acceptData:function(a){var b=a.nodeName&&$.noData[a.nodeName.toLowerCase()];return!b||b!==!0&&a.getAttribute("classid")===b}}),$.fn.extend({data:function(a,c){var e,f,g,h,i,j=this[0],k=0,l=null;if(a===b){if(this.length&&(l=$.data(j),1===j.nodeType&&!$._data(j,"parsedAttrs"))){for(g=j.attributes,i=g.length;i>k;k++)h=g[k].name,h.indexOf("data-")||(h=$.camelCase(h.substring(5)),d(j,h,l[h]));$._data(j,"parsedAttrs",!0)}return l}return"object"==typeof a?this.each(function(){$.data(this,a)}):(e=a.split(".",2),e[1]=e[1]?"."+e[1]:"",f=e[1]+"!",$.access(this,function(c){return c===b?(l=this.triggerHandler("getData"+f,[e[0]]),l===b&&j&&(l=$.data(j,a),l=d(j,a,l)),l===b&&e[1]?this.data(e[0]):l):(e[1]=c,void this.each(function(){var b=$(this);b.triggerHandler("setData"+f,e),$.data(this,a,c),b.triggerHandler("changeData"+f,e)}))},null,c,arguments.length>1,null,!1))},removeData:function(a){return this.each(function(){$.removeData(this,a)})}}),$.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=$._data(a,b),c&&(!d||$.isArray(c)?d=$._data(a,b,$.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=$.queue(a,b),d=c.length,e=c.shift(),f=$._queueHooks(a,b),g=function(){$.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return $._data(a,c)||$._data(a,c,{empty:$.Callbacks("once memory").add(function(){$.removeData(a,b+"queue",!0),$.removeData(a,c,!0)})})}}),$.fn.extend({queue:function(a,c){var d=2;return"string"!=typeof a&&(c=a,a="fx",d--),arguments.length<d?$.queue(this[0],a):c===b?this:this.each(function(){var b=$.queue(this,a,c);$._queueHooks(this,a),"fx"===a&&"inprogress"!==b[0]&&$.dequeue(this,a)})},dequeue:function(a){return this.each(function(){$.dequeue(this,a)})},delay:function(a,b){return a=$.fx?$.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){var d,e=1,f=$.Deferred(),g=this,h=this.length,i=function(){--e||f.resolveWith(g,[g])};for("string"!=typeof a&&(c=a,a=b),a=a||"fx";h--;)d=$._data(g[h],a+"queueHooks"),d&&d.empty&&(e++,d.empty.add(i));return i(),f.promise(c)}});var ra,sa,ta,ua=/[\t\r\n]/g,va=/\r/g,wa=/^(?:button|input)$/i,xa=/^(?:button|input|object|select|textarea)$/i,ya=/^a(?:rea|)$/i,za=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,Aa=$.support.getSetAttribute;$.fn.extend({attr:function(a,b){return $.access(this,$.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){$.removeAttr(this,a)})},prop:function(a,b){return $.access(this,$.prop,a,b,arguments.length>1)},removeProp:function(a){return a=$.propFix[a]||a,this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,f,g,h;if($.isFunction(a))return this.each(function(b){$(this).addClass(a.call(this,b,this.className))});if(a&&"string"==typeof a)for(b=a.split(ba),c=0,d=this.length;d>c;c++)if(e=this[c],1===e.nodeType)if(e.className||1!==b.length){for(f=" "+e.className+" ",g=0,h=b.length;h>g;g++)f.indexOf(" "+b[g]+" ")<0&&(f+=b[g]+" ");e.className=$.trim(f)}else e.className=a;return this},removeClass:function(a){var c,d,e,f,g,h,i;if($.isFunction(a))return this.each(function(b){$(this).removeClass(a.call(this,b,this.className))});if(a&&"string"==typeof a||a===b)for(c=(a||"").split(ba),h=0,i=this.length;i>h;h++)if(e=this[h],1===e.nodeType&&e.className){for(d=(" "+e.className+" ").replace(ua," "),f=0,g=c.length;g>f;f++)for(;d.indexOf(" "+c[f]+" ")>=0;)d=d.replace(" "+c[f]+" "," ");e.className=a?$.trim(d):""}return this},toggleClass:function(a,b){var c=typeof a,d="boolean"==typeof b;return $.isFunction(a)?this.each(function(c){$(this).toggleClass(a.call(this,c,this.className,b),b)}):this.each(function(){if("string"===c)for(var e,f=0,g=$(this),h=b,i=a.split(ba);e=i[f++];)h=d?h:!g.hasClass(e),g[h?"addClass":"removeClass"](e);else("undefined"===c||"boolean"===c)&&(this.className&&$._data(this,"__className__",this.className),this.className=this.className||a===!1?"":$._data(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(ua," ").indexOf(b)>=0)return!0;return!1},val:function(a){var c,d,e,f=this[0];{if(arguments.length)return e=$.isFunction(a),this.each(function(d){var f,g=$(this);1===this.nodeType&&(f=e?a.call(this,d,g.val()):a,null==f?f="":"number"==typeof f?f+="":$.isArray(f)&&(f=$.map(f,function(a){return null==a?"":a+""})),c=$.valHooks[this.type]||$.valHooks[this.nodeName.toLowerCase()],c&&"set"in c&&c.set(this,f,"value")!==b||(this.value=f))});if(f)return c=$.valHooks[f.type]||$.valHooks[f.nodeName.toLowerCase()],c&&"get"in c&&(d=c.get(f,"value"))!==b?d:(d=f.value,"string"==typeof d?d.replace(va,""):null==d?"":d)}}}),$.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){var b,c,d,e,f=a.selectedIndex,g=[],h=a.options,i="select-one"===a.type;if(0>f)return null;for(c=i?f:0,d=i?f+1:h.length;d>c;c++)if(e=h[c],e.selected&&($.support.optDisabled?!e.disabled:null===e.getAttribute("disabled"))&&(!e.parentNode.disabled||!$.nodeName(e.parentNode,"optgroup"))){if(b=$(e).val(),i)return b;g.push(b)}return i&&!g.length&&h.length?$(h[f]).val():g},set:function(a,b){var c=$.makeArray(b);return $(a).find("option").each(function(){this.selected=$.inArray($(this).val(),c)>=0}),c.length||(a.selectedIndex=-1),c}}},attrFn:{},attr:function(a,c,d,e){var f,g,h,i=a.nodeType;if(a&&3!==i&&8!==i&&2!==i)return e&&$.isFunction($.fn[c])?$(a)[c](d):"undefined"==typeof a.getAttribute?$.prop(a,c,d):(h=1!==i||!$.isXMLDoc(a),h&&(c=c.toLowerCase(),g=$.attrHooks[c]||(za.test(c)?sa:ra)),d!==b?null===d?void $.removeAttr(a,c):g&&"set"in g&&h&&(f=g.set(a,d,c))!==b?f:(a.setAttribute(c,d+""),d):g&&"get"in g&&h&&null!==(f=g.get(a,c))?f:(f=a.getAttribute(c),null===f?b:f))},removeAttr:function(a,b){var c,d,e,f,g=0;if(b&&1===a.nodeType)for(d=b.split(ba);g<d.length;g++)e=d[g],e&&(c=$.propFix[e]||e,f=za.test(e),f||$.attr(a,e,""),a.removeAttribute(Aa?e:c),f&&c in a&&(a[c]=!1))},attrHooks:{type:{set:function(a,b){if(wa.test(a.nodeName)&&a.parentNode)$.error("type property can't be changed");else if(!$.support.radioValue&&"radio"===b&&$.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}},value:{get:function(a,b){return ra&&$.nodeName(a,"button")?ra.get(a,b):b in a?a.value:null},set:function(a,b,c){return ra&&$.nodeName(a,"button")?ra.set(a,b,c):void(a.value=b)}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,c,d){var e,f,g,h=a.nodeType;if(a&&3!==h&&8!==h&&2!==h)return g=1!==h||!$.isXMLDoc(a),g&&(c=$.propFix[c]||c,f=$.propHooks[c]),d!==b?f&&"set"in f&&(e=f.set(a,d,c))!==b?e:a[c]=d:f&&"get"in f&&null!==(e=f.get(a,c))?e:a[c]},propHooks:{tabIndex:{get:function(a){var c=a.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):xa.test(a.nodeName)||ya.test(a.nodeName)&&a.href?0:b}}}}),sa={get:function(a,c){var d,e=$.prop(a,c);return e===!0||"boolean"!=typeof e&&(d=a.getAttributeNode(c))&&d.nodeValue!==!1?c.toLowerCase():b},set:function(a,b,c){var d;return b===!1?$.removeAttr(a,c):(d=$.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase())),c}},Aa||(ta={name:!0,id:!0,coords:!0},ra=$.valHooks.button={get:function(a,c){var d;return d=a.getAttributeNode(c),d&&(ta[c]?""!==d.value:d.specified)?d.value:b},set:function(a,b,c){var d=a.getAttributeNode(c);return d||(d=P.createAttribute(c),a.setAttributeNode(d)),d.value=b+""}},$.each(["width","height"],function(a,b){$.attrHooks[b]=$.extend($.attrHooks[b],{set:function(a,c){return""===c?(a.setAttribute(b,"auto"),c):void 0}})}),$.attrHooks.contenteditable={get:ra.get,set:function(a,b,c){""===b&&(b="false"),ra.set(a,b,c)}}),$.support.hrefNormalized||$.each(["href","src","width","height"],function(a,c){$.attrHooks[c]=$.extend($.attrHooks[c],{get:function(a){var d=a.getAttribute(c,2);return null===d?b:d}})}),$.support.style||($.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||b},set:function(a,b){return a.style.cssText=b+""}}),$.support.optSelected||($.propHooks.selected=$.extend($.propHooks.selected,{get:function(a){var b=a.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null}})),$.support.enctype||($.propFix.enctype="encoding"),$.support.checkOn||$.each(["radio","checkbox"],function(){$.valHooks[this]={get:function(a){return null===a.getAttribute("value")?"on":a.value}}}),$.each(["radio","checkbox"],function(){$.valHooks[this]=$.extend($.valHooks[this],{set:function(a,b){return $.isArray(b)?a.checked=$.inArray($(a).val(),b)>=0:void 0}})});var Ba=/^(?:textarea|input|select)$/i,Ca=/^([^\.]*|)(?:\.(.+)|)$/,Da=/(?:^|\s)hover(\.\S+|)\b/,Ea=/^key/,Fa=/^(?:mouse|contextmenu)|click/,Ga=/^(?:focusinfocus|focusoutblur)$/,Ha=function(a){return $.event.special.hover?a:a.replace(Da,"mouseenter$1 mouseleave$1")};$.event={add:function(a,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q;if(3!==a.nodeType&&8!==a.nodeType&&c&&d&&(g=$._data(a))){for(d.handler&&(o=d,d=o.handler,f=o.selector),d.guid||(d.guid=$.guid++),i=g.events,i||(g.events=i={}),h=g.handle,h||(g.handle=h=function(a){return"undefined"==typeof $||a&&$.event.triggered===a.type?b:$.event.dispatch.apply(h.elem,arguments)},h.elem=a),c=$.trim(Ha(c)).split(" "),j=0;j<c.length;j++)k=Ca.exec(c[j])||[],l=k[1],m=(k[2]||"").split(".").sort(),q=$.event.special[l]||{},l=(f?q.delegateType:q.bindType)||l,q=$.event.special[l]||{},n=$.extend({type:l,origType:k[1],data:e,handler:d,guid:d.guid,selector:f,needsContext:f&&$.expr.match.needsContext.test(f),namespace:m.join(".")},o),p=i[l],p||(p=i[l]=[],p.delegateCount=0,q.setup&&q.setup.call(a,e,m,h)!==!1||(a.addEventListener?a.addEventListener(l,h,!1):a.attachEvent&&a.attachEvent("on"+l,h))),q.add&&(q.add.call(a,n),n.handler.guid||(n.handler.guid=d.guid)),f?p.splice(p.delegateCount++,0,n):p.push(n),$.event.global[l]=!0;a=null}},global:{},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=$.hasData(a)&&$._data(a);if(q&&(m=q.events)){for(b=$.trim(Ha(b||"")).split(" "),f=0;f<b.length;f++)if(g=Ca.exec(b[f])||[],h=i=g[1],j=g[2],h){for(n=$.event.special[h]||{},h=(d?n.delegateType:n.bindType)||h,o=m[h]||[],k=o.length,j=j?new RegExp("(^|\\.)"+j.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null,l=0;l<o.length;l++)p=o[l],!e&&i!==p.origType||c&&c.guid!==p.guid||j&&!j.test(p.namespace)||d&&d!==p.selector&&("**"!==d||!p.selector)||(o.splice(l--,1),p.selector&&o.delegateCount--,n.remove&&n.remove.call(a,p));0===o.length&&k!==o.length&&(n.teardown&&n.teardown.call(a,j,q.handle)!==!1||$.removeEvent(a,h,q.handle),delete m[h])}else for(h in m)$.event.remove(a,h+b[f],c,d,!0);$.isEmptyObject(m)&&(delete q.handle,$.removeData(a,"events",!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,e,f){if(!e||3!==e.nodeType&&8!==e.nodeType){var g,h,i,j,k,l,m,n,o,p,q=c.type||c,r=[];if(!Ga.test(q+$.event.triggered)&&(q.indexOf("!")>=0&&(q=q.slice(0,-1),h=!0),q.indexOf(".")>=0&&(r=q.split("."),q=r.shift(),r.sort()),e&&!$.event.customEvent[q]||$.event.global[q]))if(c="object"==typeof c?c[$.expando]?c:new $.Event(q,c):new $.Event(q),c.type=q,c.isTrigger=!0,c.exclusive=h,c.namespace=r.join("."),c.namespace_re=c.namespace?new RegExp("(^|\\.)"+r.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,l=q.indexOf(":")<0?"on"+q:"",e){if(c.result=b,c.target||(c.target=e),d=null!=d?$.makeArray(d):[],d.unshift(c),m=$.event.special[q]||{},!m.trigger||m.trigger.apply(e,d)!==!1){if(o=[[e,m.bindType||q]],!f&&!m.noBubble&&!$.isWindow(e)){for(p=m.delegateType||q,j=Ga.test(p+q)?e:e.parentNode,k=e;j;j=j.parentNode)o.push([j,p]),k=j;k===(e.ownerDocument||P)&&o.push([k.defaultView||k.parentWindow||a,p])}for(i=0;i<o.length&&!c.isPropagationStopped();i++)j=o[i][0],c.type=o[i][1],n=($._data(j,"events")||{})[c.type]&&$._data(j,"handle"),n&&n.apply(j,d),n=l&&j[l],n&&$.acceptData(j)&&n.apply&&n.apply(j,d)===!1&&c.preventDefault();return c.type=q,f||c.isDefaultPrevented()||m._default&&m._default.apply(e.ownerDocument,d)!==!1||"click"===q&&$.nodeName(e,"a")||!$.acceptData(e)||l&&e[q]&&("focus"!==q&&"blur"!==q||0!==c.target.offsetWidth)&&!$.isWindow(e)&&(k=e[l],k&&(e[l]=null),$.event.triggered=q,e[q](),$.event.triggered=b,k&&(e[l]=k)),c.result}}else{g=$.cache;for(i in g)g[i].events&&g[i].events[q]&&$.event.trigger(c,d,g[i].handle.elem,!0)}}},dispatch:function(c){c=$.event.fix(c||a.event);var d,e,f,g,h,i,j,k,l,m=($._data(this,"events")||{})[c.type]||[],n=m.delegateCount,o=V.call(arguments),p=!c.exclusive&&!c.namespace,q=$.event.special[c.type]||{},r=[];if(o[0]=c,c.delegateTarget=this,!q.preDispatch||q.preDispatch.call(this,c)!==!1){if(n&&(!c.button||"click"!==c.type))for(f=c.target;f!=this;f=f.parentNode||this)if(f.disabled!==!0||"click"!==c.type){for(h={},j=[],d=0;n>d;d++)k=m[d],l=k.selector,h[l]===b&&(h[l]=k.needsContext?$(l,this).index(f)>=0:$.find(l,this,null,[f]).length),h[l]&&j.push(k);j.length&&r.push({elem:f,matches:j})}for(m.length>n&&r.push({elem:this,matches:m.slice(n)}),d=0;d<r.length&&!c.isPropagationStopped();d++)for(i=r[d],c.currentTarget=i.elem,e=0;e<i.matches.length&&!c.isImmediatePropagationStopped();e++)k=i.matches[e],(p||!c.namespace&&!k.namespace||c.namespace_re&&c.namespace_re.test(k.namespace))&&(c.data=k.data,c.handleObj=k,g=(($.event.special[k.origType]||{}).handle||k.handler).apply(i.elem,o),g!==b&&(c.result=g,g===!1&&(c.preventDefault(),c.stopPropagation())));return q.postDispatch&&q.postDispatch.call(this,c),c.result}},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,c){var d,e,f,g=c.button,h=c.fromElement;return null==a.pageX&&null!=c.clientX&&(d=a.target.ownerDocument||P,e=d.documentElement,f=d.body,a.pageX=c.clientX+(e&&e.scrollLeft||f&&f.scrollLeft||0)-(e&&e.clientLeft||f&&f.clientLeft||0),a.pageY=c.clientY+(e&&e.scrollTop||f&&f.scrollTop||0)-(e&&e.clientTop||f&&f.clientTop||0)),!a.relatedTarget&&h&&(a.relatedTarget=h===a.target?c.toElement:h),a.which||g===b||(a.which=1&g?1:2&g?3:4&g?2:0),a}},fix:function(a){if(a[$.expando])return a;var b,c,d=a,e=$.event.fixHooks[a.type]||{},f=e.props?this.props.concat(e.props):this.props;for(a=$.Event(d),b=f.length;b;)c=f[--b],a[c]=d[c];return a.target||(a.target=d.srcElement||P),3===a.target.nodeType&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,e.filter?e.filter(a,d):a},special:{load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(a,b,c){$.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null);
}}},simulate:function(a,b,c,d){var e=$.extend(new $.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?$.event.trigger(e,null,b):$.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},$.event.handle=$.event.dispatch,$.removeEvent=P.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){var d="on"+b;a.detachEvent&&("undefined"==typeof a[d]&&(a[d]=null),a.detachEvent(d,c))},$.Event=function(a,b){return this instanceof $.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?g:f):this.type=a,b&&$.extend(this,b),this.timeStamp=a&&a.timeStamp||$.now(),void(this[$.expando]=!0)):new $.Event(a,b)},$.Event.prototype={preventDefault:function(){this.isDefaultPrevented=g;var a=this.originalEvent;a&&(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=g;var a=this.originalEvent;a&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=g,this.stopPropagation()},isDefaultPrevented:f,isPropagationStopped:f,isImmediatePropagationStopped:f},$.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){$.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;f.selector;return(!e||e!==d&&!$.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),$.support.submitBubbles||($.event.special.submit={setup:function(){return $.nodeName(this,"form")?!1:void $.event.add(this,"click._submit keypress._submit",function(a){var c=a.target,d=$.nodeName(c,"input")||$.nodeName(c,"button")?c.form:b;d&&!$._data(d,"_submit_attached")&&($.event.add(d,"submit._submit",function(a){a._submit_bubble=!0}),$._data(d,"_submit_attached",!0))})},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&$.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){return $.nodeName(this,"form")?!1:void $.event.remove(this,"._submit")}}),$.support.changeBubbles||($.event.special.change={setup:function(){return Ba.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&($.event.add(this,"propertychange._change",function(a){"checked"===a.originalEvent.propertyName&&(this._just_changed=!0)}),$.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1),$.event.simulate("change",this,a,!0)})),!1):void $.event.add(this,"beforeactivate._change",function(a){var b=a.target;Ba.test(b.nodeName)&&!$._data(b,"_change_attached")&&($.event.add(b,"change._change",function(a){!this.parentNode||a.isSimulated||a.isTrigger||$.event.simulate("change",this.parentNode,a,!0)}),$._data(b,"_change_attached",!0))})},handle:function(a){var b=a.target;return this!==b||a.isSimulated||a.isTrigger||"radio"!==b.type&&"checkbox"!==b.type?a.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return $.event.remove(this,"._change"),!Ba.test(this.nodeName)}}),$.support.focusinBubbles||$.each({focus:"focusin",blur:"focusout"},function(a,b){var c=0,d=function(a){$.event.simulate(b,a.target,$.event.fix(a),!0)};$.event.special[b]={setup:function(){0===c++&&P.addEventListener(a,d,!0)},teardown:function(){0===--c&&P.removeEventListener(a,d,!0)}}}),$.fn.extend({on:function(a,c,d,e,g){var h,i;if("object"==typeof a){"string"!=typeof c&&(d=d||c,c=b);for(i in a)this.on(i,c,d,a[i],g);return this}if(null==d&&null==e?(e=c,d=c=b):null==e&&("string"==typeof c?(e=d,d=b):(e=d,d=c,c=b)),e===!1)e=f;else if(!e)return this;return 1===g&&(h=e,e=function(a){return $().off(a),h.apply(this,arguments)},e.guid=h.guid||(h.guid=$.guid++)),this.each(function(){$.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,c,d){var e,g;if(a&&a.preventDefault&&a.handleObj)return e=a.handleObj,$(a.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler),this;if("object"==typeof a){for(g in a)this.off(g,c,a[g]);return this}return(c===!1||"function"==typeof c)&&(d=c,c=b),d===!1&&(d=f),this.each(function(){$.event.remove(this,a,d,c)})},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},live:function(a,b,c){return $(this.context).on(a,this.selector,b,c),this},die:function(a,b){return $(this.context).off(a,this.selector||"**",b),this},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)},trigger:function(a,b){return this.each(function(){$.event.trigger(a,b,this)})},triggerHandler:function(a,b){return this[0]?$.event.trigger(a,b,this[0],!0):void 0},toggle:function(a){var b=arguments,c=a.guid||$.guid++,d=0,e=function(c){var e=($._data(this,"lastToggle"+a.guid)||0)%d;return $._data(this,"lastToggle"+a.guid,e+1),c.preventDefault(),b[e].apply(this,arguments)||!1};for(e.guid=c;d<b.length;)b[d++].guid=c;return this.click(e)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),$.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){$.fn[b]=function(a,c){return null==c&&(c=a,a=null),arguments.length>0?this.on(b,null,a,c):this.trigger(b)},Ea.test(b)&&($.event.fixHooks[b]=$.event.keyHooks),Fa.test(b)&&($.event.fixHooks[b]=$.event.mouseHooks)}),function(a,b){function c(a,b,c,d){c=c||[],b=b||F;var e,f,g,h,i=b.nodeType;if(!a||"string"!=typeof a)return c;if(1!==i&&9!==i)return[];if(g=v(b),!g&&!d&&(e=ca.exec(a)))if(h=e[1]){if(9===i){if(f=b.getElementById(h),!f||!f.parentNode)return c;if(f.id===h)return c.push(f),c}else if(b.ownerDocument&&(f=b.ownerDocument.getElementById(h))&&w(b,f)&&f.id===h)return c.push(f),c}else{if(e[2])return K.apply(c,L.call(b.getElementsByTagName(a),0)),c;if((h=e[3])&&ma&&b.getElementsByClassName)return K.apply(c,L.call(b.getElementsByClassName(h),0)),c}return p(a.replace(Z,"$1"),b,c,d,g)}function d(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function e(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function f(a){return N(function(b){return b=+b,N(function(c,d){for(var e,f=a([],c.length,b),g=f.length;g--;)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function g(a,b,c){if(a===b)return c;for(var d=a.nextSibling;d;){if(d===b)return-1;d=d.nextSibling}return 1}function h(a,b){var d,e,f,g,h,i,j,k=Q[D][a];if(k)return b?0:k.slice(0);for(h=a,i=[],j=t.preFilter;h;){(!d||(e=_.exec(h)))&&(e&&(h=h.slice(e[0].length)),i.push(f=[])),d=!1,(e=aa.exec(h))&&(f.push(d=new E(e.shift())),h=h.slice(d.length),d.type=e[0].replace(Z," "));for(g in t.filter)!(e=ha[g].exec(h))||j[g]&&!(e=j[g](e,F,!0))||(f.push(d=new E(e.shift())),h=h.slice(d.length),d.type=g,d.matches=e);if(!d)break}return b?h.length:h?c.error(a):Q(a,i).slice(0)}function i(a,b,c){var d=b.dir,e=c&&"parentNode"===b.dir,f=I++;return b.first?function(b,c,f){for(;b=b[d];)if(e||1===b.nodeType)return a(b,c,f)}:function(b,c,g){if(g){for(;b=b[d];)if((e||1===b.nodeType)&&a(b,c,g))return b}else for(var h,i=H+" "+f+" ",j=i+r;b=b[d];)if(e||1===b.nodeType){if((h=b[D])===j)return b.sizset;if("string"==typeof h&&0===h.indexOf(i)){if(b.sizset)return b}else{if(b[D]=j,a(b,c,g))return b.sizset=!0,b;b.sizset=!1}}}}function j(a){return a.length>1?function(b,c,d){for(var e=a.length;e--;)if(!a[e](b,c,d))return!1;return!0}:a[0]}function k(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function l(a,b,c,d,e,f){return d&&!d[D]&&(d=l(d)),e&&!e[D]&&(e=l(e,f)),N(function(f,g,h,i){if(!f||!e){var j,l,m,n=[],p=[],q=g.length,r=f||o(b||"*",h.nodeType?[h]:h,[],f),s=!a||!f&&b?r:k(r,n,a,h,i),t=c?e||(f?a:q||d)?[]:g:s;if(c&&c(s,t,h,i),d)for(m=k(t,p),d(m,[],h,i),j=m.length;j--;)(l=m[j])&&(t[p[j]]=!(s[p[j]]=l));if(f)for(j=a&&t.length;j--;)(l=t[j])&&(f[n[j]]=!(g[n[j]]=l));else t=k(t===g?t.splice(q,t.length):t),e?e(null,g,t,i):K.apply(g,t)}})}function m(a){for(var b,c,d,e=a.length,f=t.relative[a[0].type],g=f||t.relative[" "],h=f?1:0,k=i(function(a){return a===b},g,!0),n=i(function(a){return M.call(b,a)>-1},g,!0),o=[function(a,c,d){return!f&&(d||c!==A)||((b=c).nodeType?k(a,c,d):n(a,c,d))}];e>h;h++)if(c=t.relative[a[h].type])o=[i(j(o),c)];else{if(c=t.filter[a[h].type].apply(null,a[h].matches),c[D]){for(d=++h;e>d&&!t.relative[a[d].type];d++);return l(h>1&&j(o),h>1&&a.slice(0,h-1).join("").replace(Z,"$1"),c,d>h&&m(a.slice(h,d)),e>d&&m(a=a.slice(d)),e>d&&a.join(""))}o.push(c)}return j(o)}function n(a,b){var d=b.length>0,e=a.length>0,f=function(g,h,i,j,l){var m,n,o,p=[],q=0,s="0",u=g&&[],v=null!=l,w=A,x=g||e&&t.find.TAG("*",l&&h.parentNode||h),y=H+=null==w?1:Math.E;for(v&&(A=h!==F&&h,r=f.el);null!=(m=x[s]);s++){if(e&&m){for(n=0;o=a[n];n++)if(o(m,h,i)){j.push(m);break}v&&(H=y,r=++f.el)}d&&((m=!o&&m)&&q--,g&&u.push(m))}if(q+=s,d&&s!==q){for(n=0;o=b[n];n++)o(u,p,h,i);if(g){if(q>0)for(;s--;)u[s]||p[s]||(p[s]=J.call(j));p=k(p)}K.apply(j,p),v&&!g&&p.length>0&&q+b.length>1&&c.uniqueSort(j)}return v&&(H=y,A=w),u};return f.el=0,d?N(f):f}function o(a,b,d,e){for(var f=0,g=b.length;g>f;f++)c(a,b[f],d,e);return d}function p(a,b,c,d,e){var f,g,i,j,k,l=h(a);l.length;if(!d&&1===l.length){if(g=l[0]=l[0].slice(0),g.length>2&&"ID"===(i=g[0]).type&&9===b.nodeType&&!e&&t.relative[g[1].type]){if(b=t.find.ID(i.matches[0].replace(ga,""),b,e)[0],!b)return c;a=a.slice(g.shift().length)}for(f=ha.POS.test(a)?-1:g.length-1;f>=0&&(i=g[f],!t.relative[j=i.type]);f--)if((k=t.find[j])&&(d=k(i.matches[0].replace(ga,""),da.test(g[0].type)&&b.parentNode||b,e))){if(g.splice(f,1),a=d.length&&g.join(""),!a)return K.apply(c,L.call(d,0)),c;break}}return x(a,l)(d,b,e,c,da.test(a)),c}function q(){}var r,s,t,u,v,w,x,y,z,A,B=!0,C="undefined",D=("sizcache"+Math.random()).replace(".",""),E=String,F=a.document,G=F.documentElement,H=0,I=0,J=[].pop,K=[].push,L=[].slice,M=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]===a)return b;return-1},N=function(a,b){return a[D]=null==b||b,a},O=function(){var a={},b=[];return N(function(c,d){return b.push(c)>t.cacheLength&&delete a[b.shift()],a[c]=d},a)},P=O(),Q=O(),R=O(),S="[\\x20\\t\\r\\n\\f]",T="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",U=T.replace("w","w#"),V="([*^$|!~]?=)",W="\\["+S+"*("+T+")"+S+"*(?:"+V+S+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+U+")|)|)"+S+"*\\]",X=":("+T+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+W+")|[^:]|\\\\.)*|.*))\\)|)",Y=":(even|odd|eq|gt|lt|nth|first|last)(?:\\("+S+"*((?:-\\d)?\\d*)"+S+"*\\)|)(?=[^-]|$)",Z=new RegExp("^"+S+"+|((?:^|[^\\\\])(?:\\\\.)*)"+S+"+$","g"),_=new RegExp("^"+S+"*,"+S+"*"),aa=new RegExp("^"+S+"*([\\x20\\t\\r\\n\\f>+~])"+S+"*"),ba=new RegExp(X),ca=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,da=/[\x20\t\r\n\f]*[+~]/,ea=/h\d/i,fa=/input|select|textarea|button/i,ga=/\\(?!\\)/g,ha={ID:new RegExp("^#("+T+")"),CLASS:new RegExp("^\\.("+T+")"),NAME:new RegExp("^\\[name=['\"]?("+T+")['\"]?\\]"),TAG:new RegExp("^("+T.replace("w","w*")+")"),ATTR:new RegExp("^"+W),PSEUDO:new RegExp("^"+X),POS:new RegExp(Y,"i"),CHILD:new RegExp("^:(only|nth|first|last)-child(?:\\("+S+"*(even|odd|(([+-]|)(\\d*)n|)"+S+"*(?:([+-]|)"+S+"*(\\d+)|))"+S+"*\\)|)","i"),needsContext:new RegExp("^"+S+"*[>+~]|"+Y,"i")},ia=function(a){var b=F.createElement("div");try{return a(b)}catch(c){return!1}finally{b=null}},ja=ia(function(a){return a.appendChild(F.createComment("")),!a.getElementsByTagName("*").length}),ka=ia(function(a){return a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!==C&&"#"===a.firstChild.getAttribute("href")}),la=ia(function(a){a.innerHTML="<select></select>";var b=typeof a.lastChild.getAttribute("multiple");return"boolean"!==b&&"string"!==b}),ma=ia(function(a){return a.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",a.getElementsByClassName&&a.getElementsByClassName("e").length?(a.lastChild.className="e",2===a.getElementsByClassName("e").length):!1}),na=ia(function(a){a.id=D+0,a.innerHTML="<a name='"+D+"'></a><div name='"+D+"'></div>",G.insertBefore(a,G.firstChild);var b=F.getElementsByName&&F.getElementsByName(D).length===2+F.getElementsByName(D+0).length;return s=!F.getElementById(D),G.removeChild(a),b});try{L.call(G.childNodes,0)[0].nodeType}catch(oa){L=function(a){for(var b,c=[];b=this[a];a++)c.push(b);return c}}c.matches=function(a,b){return c(a,null,null,b)},c.matchesSelector=function(a,b){return c(b,null,null,[a]).length>0},u=c.getText=function(a){var b,c="",d=0,e=a.nodeType;if(e){if(1===e||9===e||11===e){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=u(a)}else if(3===e||4===e)return a.nodeValue}else for(;b=a[d];d++)c+=u(b);return c},v=c.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},w=c.contains=G.contains?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!!(d&&1===d.nodeType&&c.contains&&c.contains(d))}:G.compareDocumentPosition?function(a,b){return b&&!!(16&a.compareDocumentPosition(b))}:function(a,b){for(;b=b.parentNode;)if(b===a)return!0;return!1},c.attr=function(a,b){var c,d=v(a);return d||(b=b.toLowerCase()),(c=t.attrHandle[b])?c(a):d||la?a.getAttribute(b):(c=a.getAttributeNode(b),c?"boolean"==typeof a[b]?a[b]?b:null:c.specified?c.value:null:null)},t=c.selectors={cacheLength:50,createPseudo:N,match:ha,attrHandle:ka?{}:{href:function(a){return a.getAttribute("href",2)},type:function(a){return a.getAttribute("type")}},find:{ID:s?function(a,b,c){if(typeof b.getElementById!==C&&!c){var d=b.getElementById(a);return d&&d.parentNode?[d]:[]}}:function(a,c,d){if(typeof c.getElementById!==C&&!d){var e=c.getElementById(a);return e?e.id===a||typeof e.getAttributeNode!==C&&e.getAttributeNode("id").value===a?[e]:b:[]}},TAG:ja?function(a,b){return typeof b.getElementsByTagName!==C?b.getElementsByTagName(a):void 0}:function(a,b){var c=b.getElementsByTagName(a);if("*"===a){for(var d,e=[],f=0;d=c[f];f++)1===d.nodeType&&e.push(d);return e}return c},NAME:na&&function(a,b){return typeof b.getElementsByName!==C?b.getElementsByName(name):void 0},CLASS:ma&&function(a,b,c){return typeof b.getElementsByClassName===C||c?void 0:b.getElementsByClassName(a)}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(ga,""),a[3]=(a[4]||a[5]||"").replace(ga,""),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1]?(a[2]||c.error(a[0]),a[3]=+(a[3]?a[4]+(a[5]||1):2*("even"===a[2]||"odd"===a[2])),a[4]=+(a[6]+a[7]||"odd"===a[2])):a[2]&&c.error(a[0]),a},PSEUDO:function(a){var b,c;return ha.CHILD.test(a[0])?null:(a[3]?a[2]=a[3]:(b=a[4])&&(ba.test(b)&&(c=h(b,!0))&&(c=b.indexOf(")",b.length-c)-b.length)&&(b=b.slice(0,c),a[0]=a[0].slice(0,c)),a[2]=b),a.slice(0,3))}},filter:{ID:s?function(a){return a=a.replace(ga,""),function(b){return b.getAttribute("id")===a}}:function(a){return a=a.replace(ga,""),function(b){var c=typeof b.getAttributeNode!==C&&b.getAttributeNode("id");return c&&c.value===a}},TAG:function(a){return"*"===a?function(){return!0}:(a=a.replace(ga,"").toLowerCase(),function(b){return b.nodeName&&b.nodeName.toLowerCase()===a})},CLASS:function(a){var b=P[D][a];return b||(b=P(a,new RegExp("(^|"+S+")"+a+"("+S+"|$)"))),function(a){return b.test(a.className||typeof a.getAttribute!==C&&a.getAttribute("class")||"")}},ATTR:function(a,b,d){return function(e,f){var g=c.attr(e,a);return null==g?"!="===b:b?(g+="","="===b?g===d:"!="===b?g!==d:"^="===b?d&&0===g.indexOf(d):"*="===b?d&&g.indexOf(d)>-1:"$="===b?d&&g.substr(g.length-d.length)===d:"~="===b?(" "+g+" ").indexOf(d)>-1:"|="===b?g===d||g.substr(0,d.length+1)===d+"-":!1):!0}},CHILD:function(a,b,c,d){return"nth"===a?function(a){var b,e,f=a.parentNode;if(1===c&&0===d)return!0;if(f)for(e=0,b=f.firstChild;b&&(1!==b.nodeType||(e++,a!==b));b=b.nextSibling);return e-=d,e===c||e%c===0&&e/c>=0}:function(b){var c=b;switch(a){case"only":case"first":for(;c=c.previousSibling;)if(1===c.nodeType)return!1;if("first"===a)return!0;c=b;case"last":for(;c=c.nextSibling;)if(1===c.nodeType)return!1;return!0}}},PSEUDO:function(a,b){var d,e=t.pseudos[a]||t.setFilters[a.toLowerCase()]||c.error("unsupported pseudo: "+a);return e[D]?e(b):e.length>1?(d=[a,a,"",b],t.setFilters.hasOwnProperty(a.toLowerCase())?N(function(a,c){for(var d,f=e(a,b),g=f.length;g--;)d=M.call(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,d)}):e}},pseudos:{not:N(function(a){var b=[],c=[],d=x(a.replace(Z,"$1"));return d[D]?N(function(a,b,c,e){for(var f,g=d(a,null,e,[]),h=a.length;h--;)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),!c.pop()}}),has:N(function(a){return function(b){return c(a,b).length>0}}),contains:N(function(a){return function(b){return(b.textContent||b.innerText||u(b)).indexOf(a)>-1}}),enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},parent:function(a){return!t.pseudos.empty(a)},empty:function(a){var b;for(a=a.firstChild;a;){if(a.nodeName>"@"||3===(b=a.nodeType)||4===b)return!1;a=a.nextSibling}return!0},header:function(a){return ea.test(a.nodeName)},text:function(a){var b,c;return"input"===a.nodeName.toLowerCase()&&"text"===(b=a.type)&&(null==(c=a.getAttribute("type"))||c.toLowerCase()===b)},radio:d("radio"),checkbox:d("checkbox"),file:d("file"),password:d("password"),image:d("image"),submit:e("submit"),reset:e("reset"),button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},input:function(a){return fa.test(a.nodeName)},focus:function(a){var b=a.ownerDocument;return a===b.activeElement&&(!b.hasFocus||b.hasFocus())&&!(!a.type&&!a.href)},active:function(a){return a===a.ownerDocument.activeElement},first:f(function(a,b,c){return[0]}),last:f(function(a,b,c){return[b-1]}),eq:f(function(a,b,c){return[0>c?c+b:c]}),even:f(function(a,b,c){for(var d=0;b>d;d+=2)a.push(d);return a}),odd:f(function(a,b,c){for(var d=1;b>d;d+=2)a.push(d);return a}),lt:f(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:f(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},y=G.compareDocumentPosition?function(a,b){return a===b?(z=!0,0):(a.compareDocumentPosition&&b.compareDocumentPosition?4&a.compareDocumentPosition(b):a.compareDocumentPosition)?-1:1}:function(a,b){if(a===b)return z=!0,0;if(a.sourceIndex&&b.sourceIndex)return a.sourceIndex-b.sourceIndex;var c,d,e=[],f=[],h=a.parentNode,i=b.parentNode,j=h;if(h===i)return g(a,b);if(!h)return-1;if(!i)return 1;for(;j;)e.unshift(j),j=j.parentNode;for(j=i;j;)f.unshift(j),j=j.parentNode;c=e.length,d=f.length;for(var k=0;c>k&&d>k;k++)if(e[k]!==f[k])return g(e[k],f[k]);return k===c?g(a,f[k],-1):g(e[k],b,1)},[0,0].sort(y),B=!z,c.uniqueSort=function(a){var b,c=1;if(z=B,a.sort(y),z)for(;b=a[c];c++)b===a[c-1]&&a.splice(c--,1);return a},c.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},x=c.compile=function(a,b){var c,d=[],e=[],f=R[D][a];if(!f){for(b||(b=h(a)),c=b.length;c--;)f=m(b[c]),f[D]?d.push(f):e.push(f);f=R(a,n(e,d))}return f},F.querySelectorAll&&!function(){var a,b=p,d=/'|\\/g,e=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,f=[":focus"],g=[":active",":focus"],i=G.matchesSelector||G.mozMatchesSelector||G.webkitMatchesSelector||G.oMatchesSelector||G.msMatchesSelector;ia(function(a){a.innerHTML="<select><option selected=''></option></select>",a.querySelectorAll("[selected]").length||f.push("\\["+S+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),a.querySelectorAll(":checked").length||f.push(":checked")}),ia(function(a){a.innerHTML="<p test=''></p>",a.querySelectorAll("[test^='']").length&&f.push("[*^$]="+S+"*(?:\"\"|'')"),a.innerHTML="<input type='hidden'/>",a.querySelectorAll(":enabled").length||f.push(":enabled",":disabled")}),f=new RegExp(f.join("|")),p=function(a,c,e,g,i){if(!(g||i||f&&f.test(a))){var j,k,l=!0,m=D,n=c,o=9===c.nodeType&&a;if(1===c.nodeType&&"object"!==c.nodeName.toLowerCase()){for(j=h(a),(l=c.getAttribute("id"))?m=l.replace(d,"\\$&"):c.setAttribute("id",m),m="[id='"+m+"'] ",k=j.length;k--;)j[k]=m+j[k].join("");n=da.test(a)&&c.parentNode||c,o=j.join(",")}if(o)try{return K.apply(e,L.call(n.querySelectorAll(o),0)),e}catch(p){}finally{l||c.removeAttribute("id")}}return b(a,c,e,g,i)},i&&(ia(function(b){a=i.call(b,"div");try{i.call(b,"[test!='']:sizzle"),g.push("!=",X)}catch(c){}}),g=new RegExp(g.join("|")),c.matchesSelector=function(b,d){if(d=d.replace(e,"='$1']"),!(v(b)||g.test(d)||f&&f.test(d)))try{var h=i.call(b,d);if(h||a||b.document&&11!==b.document.nodeType)return h}catch(j){}return c(d,null,null,[b]).length>0})}(),t.pseudos.nth=t.pseudos.eq,t.filters=q.prototype=t.pseudos,t.setFilters=new q,c.attr=$.attr,$.find=c,$.expr=c.selectors,$.expr[":"]=$.expr.pseudos,$.unique=c.uniqueSort,$.text=c.getText,$.isXMLDoc=c.isXML,$.contains=c.contains}(a);var Ia=/Until$/,Ja=/^(?:parents|prev(?:Until|All))/,Ka=/^.[^:#\[\.,]*$/,La=$.expr.match.needsContext,Ma={children:!0,contents:!0,next:!0,prev:!0};$.fn.extend({find:function(a){var b,c,d,e,f,g,h=this;if("string"!=typeof a)return $(a).filter(function(){for(b=0,c=h.length;c>b;b++)if($.contains(h[b],this))return!0});for(g=this.pushStack("","find",a),b=0,c=this.length;c>b;b++)if(d=g.length,$.find(a,this[b],g),b>0)for(e=d;e<g.length;e++)for(f=0;d>f;f++)if(g[f]===g[e]){g.splice(e--,1);break}return g},has:function(a){var b,c=$(a,this),d=c.length;return this.filter(function(){for(b=0;d>b;b++)if($.contains(this,c[b]))return!0})},not:function(a){return this.pushStack(j(this,a,!1),"not",a)},filter:function(a){return this.pushStack(j(this,a,!0),"filter",a)},is:function(a){return!!a&&("string"==typeof a?La.test(a)?$(a,this.context).index(this[0])>=0:$.filter(a,this).length>0:this.filter(a).length>0)},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=La.test(a)||"string"!=typeof a?$(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c.ownerDocument&&c!==b&&11!==c.nodeType;){if(g?g.index(c)>-1:$.find.matchesSelector(c,a)){f.push(c);break}c=c.parentNode}return f=f.length>1?$.unique(f):f,this.pushStack(f,"closest",a)},index:function(a){return a?"string"==typeof a?$.inArray(this[0],$(a)):$.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(a,b){var c="string"==typeof a?$(a,b):$.makeArray(a&&a.nodeType?[a]:a),d=$.merge(this.get(),c);return this.pushStack(h(c[0])||h(d[0])?d:$.unique(d))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}}),$.fn.andSelf=$.fn.addBack,$.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return $.dir(a,"parentNode")},parentsUntil:function(a,b,c){return $.dir(a,"parentNode",c)},next:function(a){return i(a,"nextSibling")},prev:function(a){return i(a,"previousSibling")},nextAll:function(a){return $.dir(a,"nextSibling")},prevAll:function(a){return $.dir(a,"previousSibling")},nextUntil:function(a,b,c){return $.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return $.dir(a,"previousSibling",c)},siblings:function(a){return $.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return $.sibling(a.firstChild)},contents:function(a){return $.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:$.merge([],a.childNodes)}},function(a,b){$.fn[a]=function(c,d){var e=$.map(this,b,c);return Ia.test(a)||(d=c),d&&"string"==typeof d&&(e=$.filter(d,e)),e=this.length>1&&!Ma[a]?$.unique(e):e,this.length>1&&Ja.test(a)&&(e=e.reverse()),this.pushStack(e,a,V.call(arguments).join(","))}}),$.extend({filter:function(a,b,c){return c&&(a=":not("+a+")"),1===b.length?$.find.matchesSelector(b[0],a)?[b[0]]:[]:$.find.matches(a,b)},dir:function(a,c,d){for(var e=[],f=a[c];f&&9!==f.nodeType&&(d===b||1!==f.nodeType||!$(f).is(d));)1===f.nodeType&&e.push(f),f=f[c];return e},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}});var Na="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",Oa=/ jQuery\d+="(?:null|\d+)"/g,Pa=/^\s+/,Qa=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Ra=/<([\w:]+)/,Sa=/<tbody/i,Ta=/<|&#?\w+;/,Ua=/<(?:script|style|link)/i,Va=/<(?:script|object|embed|option|style)/i,Wa=new RegExp("<(?:"+Na+")[\\s/>]","i"),Xa=/^(?:checkbox|radio)$/,Ya=/checked\s*(?:[^=]|=\s*.checked.)/i,Za=/\/(java|ecma)script/i,$a=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,_a={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},ab=k(P),bb=ab.appendChild(P.createElement("div"));_a.optgroup=_a.option,_a.tbody=_a.tfoot=_a.colgroup=_a.caption=_a.thead,_a.th=_a.td,$.support.htmlSerialize||(_a._default=[1,"X<div>","</div>"]),$.fn.extend({text:function(a){return $.access(this,function(a){return a===b?$.text(this):this.empty().append((this[0]&&this[0].ownerDocument||P).createTextNode(a))},null,a,arguments.length)},wrapAll:function(a){if($.isFunction(a))return this.each(function(b){$(this).wrapAll(a.call(this,b))});if(this[0]){var b=$(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){for(var a=this;a.firstChild&&1===a.firstChild.nodeType;)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return $.isFunction(a)?this.each(function(b){$(this).wrapInner(a.call(this,b))}):this.each(function(){var b=$(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=$.isFunction(a);return this.each(function(c){$(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){$.nodeName(this,"body")||$(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){(1===this.nodeType||11===this.nodeType)&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,!0,function(a){(1===this.nodeType||11===this.nodeType)&&this.insertBefore(a,this.firstChild)})},before:function(){if(!h(this[0]))return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)});if(arguments.length){var a=$.clean(arguments);return this.pushStack($.merge(a,this),"before",this.selector)}},after:function(){if(!h(this[0]))return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)});if(arguments.length){var a=$.clean(arguments);return this.pushStack($.merge(this,a),"after",this.selector)}},remove:function(a,b){for(var c,d=0;null!=(c=this[d]);d++)(!a||$.filter(a,[c]).length)&&(b||1!==c.nodeType||($.cleanData(c.getElementsByTagName("*")),$.cleanData([c])),c.parentNode&&c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)for(1===a.nodeType&&$.cleanData(a.getElementsByTagName("*"));a.firstChild;)a.removeChild(a.firstChild);return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return $.clone(this,a,b)})},html:function(a){return $.access(this,function(a){var c=this[0]||{},d=0,e=this.length;if(a===b)return 1===c.nodeType?c.innerHTML.replace(Oa,""):b;if("string"==typeof a&&!Ua.test(a)&&($.support.htmlSerialize||!Wa.test(a))&&($.support.leadingWhitespace||!Pa.test(a))&&!_a[(Ra.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Qa,"<$1></$2>");try{for(;e>d;d++)c=this[d]||{},1===c.nodeType&&($.cleanData(c.getElementsByTagName("*")),c.innerHTML=a);c=0}catch(f){}}c&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(a){return h(this[0])?this.length?this.pushStack($($.isFunction(a)?a():a),"replaceWith",a):this:$.isFunction(a)?this.each(function(b){var c=$(this),d=c.html();c.replaceWith(a.call(this,b,d))}):("string"!=typeof a&&(a=$(a).detach()),this.each(function(){var b=this.nextSibling,c=this.parentNode;$(this).remove(),b?$(b).before(a):$(c).append(a)}))},detach:function(a){return this.remove(a,!0)},domManip:function(a,c,d){a=[].concat.apply([],a);var e,f,g,h,i=0,j=a[0],k=[],m=this.length;if(!$.support.checkClone&&m>1&&"string"==typeof j&&Ya.test(j))return this.each(function(){$(this).domManip(a,c,d)});if($.isFunction(j))return this.each(function(e){var f=$(this);a[0]=j.call(this,e,c?f.html():b),f.domManip(a,c,d)});if(this[0]){if(e=$.buildFragment(a,this,k),g=e.fragment,f=g.firstChild,1===g.childNodes.length&&(g=f),f)for(c=c&&$.nodeName(f,"tr"),h=e.cacheable||m-1;m>i;i++)d.call(c&&$.nodeName(this[i],"table")?l(this[i],"tbody"):this[i],i===h?g:$.clone(g,!0,!0));g=f=null,k.length&&$.each(k,function(a,b){b.src?$.ajax?$.ajax({url:b.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):$.error("no ajax"):$.globalEval((b.text||b.textContent||b.innerHTML||"").replace($a,"")),b.parentNode&&b.parentNode.removeChild(b)})}return this}}),$.buildFragment=function(a,c,d){var e,f,g,h=a[0];return c=c||P,c=!c.nodeType&&c[0]||c,c=c.ownerDocument||c,!(1===a.length&&"string"==typeof h&&h.length<512&&c===P&&"<"===h.charAt(0))||Va.test(h)||!$.support.checkClone&&Ya.test(h)||!$.support.html5Clone&&Wa.test(h)||(f=!0,e=$.fragments[h],g=e!==b),e||(e=c.createDocumentFragment(),$.clean(a,c,e,d),f&&($.fragments[h]=g&&e)),{fragment:e,cacheable:f}},$.fragments={},$.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){$.fn[a]=function(c){var d,e=0,f=[],g=$(c),h=g.length,i=1===this.length&&this[0].parentNode;if((null==i||i&&11===i.nodeType&&1===i.childNodes.length)&&1===h)return g[b](this[0]),this;for(;h>e;e++)d=(e>0?this.clone(!0):this).get(),$(g[e])[b](d),f=f.concat(d);return this.pushStack(f,a,g.selector)}}),$.extend({clone:function(a,b,c){var d,e,f,g;if($.support.html5Clone||$.isXMLDoc(a)||!Wa.test("<"+a.nodeName+">")?g=a.cloneNode(!0):(bb.innerHTML=a.outerHTML,bb.removeChild(g=bb.firstChild)),!($.support.noCloneEvent&&$.support.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||$.isXMLDoc(a)))for(n(a,g),d=o(a),e=o(g),f=0;d[f];++f)e[f]&&n(d[f],e[f]);if(b&&(m(a,g),c))for(d=o(a),e=o(g),f=0;d[f];++f)m(d[f],e[f]);return d=e=null,g},clean:function(a,b,c,d){var e,f,g,h,i,j,l,m,n,o,q,r=b===P&&ab,s=[];for(b&&"undefined"!=typeof b.createDocumentFragment||(b=P),e=0;null!=(g=a[e]);e++)if("number"==typeof g&&(g+=""),g){if("string"==typeof g)if(Ta.test(g)){for(r=r||k(b),l=b.createElement("div"),r.appendChild(l),g=g.replace(Qa,"<$1></$2>"),h=(Ra.exec(g)||["",""])[1].toLowerCase(),i=_a[h]||_a._default,j=i[0],l.innerHTML=i[1]+g+i[2];j--;)l=l.lastChild;if(!$.support.tbody)for(m=Sa.test(g),n="table"!==h||m?"<table>"!==i[1]||m?[]:l.childNodes:l.firstChild&&l.firstChild.childNodes,f=n.length-1;f>=0;--f)$.nodeName(n[f],"tbody")&&!n[f].childNodes.length&&n[f].parentNode.removeChild(n[f]);!$.support.leadingWhitespace&&Pa.test(g)&&l.insertBefore(b.createTextNode(Pa.exec(g)[0]),l.firstChild),g=l.childNodes,l.parentNode.removeChild(l)}else g=b.createTextNode(g);g.nodeType?s.push(g):$.merge(s,g)}if(l&&(g=l=r=null),!$.support.appendChecked)for(e=0;null!=(g=s[e]);e++)$.nodeName(g,"input")?p(g):"undefined"!=typeof g.getElementsByTagName&&$.grep(g.getElementsByTagName("input"),p);if(c)for(o=function(a){return!a.type||Za.test(a.type)?d?d.push(a.parentNode?a.parentNode.removeChild(a):a):c.appendChild(a):void 0},e=0;null!=(g=s[e]);e++)$.nodeName(g,"script")&&o(g)||(c.appendChild(g),"undefined"!=typeof g.getElementsByTagName&&(q=$.grep($.merge([],g.getElementsByTagName("script")),o),
s.splice.apply(s,[e+1,0].concat(q)),e+=q.length));return s},cleanData:function(a,b){for(var c,d,e,f,g=0,h=$.expando,i=$.cache,j=$.support.deleteExpando,k=$.event.special;null!=(e=a[g]);g++)if((b||$.acceptData(e))&&(d=e[h],c=d&&i[d])){if(c.events)for(f in c.events)k[f]?$.event.remove(e,f):$.removeEvent(e,f,c.handle);i[d]&&(delete i[d],j?delete e[h]:e.removeAttribute?e.removeAttribute(h):e[h]=null,$.deletedIds.push(d))}}}),function(){var a,b;$.uaMatch=function(a){a=a.toLowerCase();var b=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},a=$.uaMatch(R.userAgent),b={},a.browser&&(b[a.browser]=!0,b.version=a.version),b.chrome?b.webkit=!0:b.webkit&&(b.safari=!0),$.browser=b,$.sub=function(){function a(b,c){return new a.fn.init(b,c)}$.extend(!0,a,this),a.superclass=this,a.fn=a.prototype=this(),a.fn.constructor=a,a.sub=this.sub,a.fn.init=function(c,d){return d&&d instanceof $&&!(d instanceof a)&&(d=a(d)),$.fn.init.call(this,c,d,b)},a.fn.init.prototype=a.fn;var b=a(P);return a}}();var cb,db,eb,fb=/alpha\([^)]*\)/i,gb=/opacity=([^)]*)/,hb=/^(top|right|bottom|left)$/,ib=/^(none|table(?!-c[ea]).+)/,jb=/^margin/,kb=new RegExp("^("+_+")(.*)$","i"),lb=new RegExp("^("+_+")(?!px)[a-z%]+$","i"),mb=new RegExp("^([-+])=("+_+")","i"),nb={},ob={position:"absolute",visibility:"hidden",display:"block"},pb={letterSpacing:0,fontWeight:400},qb=["Top","Right","Bottom","Left"],rb=["Webkit","O","Moz","ms"],sb=$.fn.toggle;$.fn.extend({css:function(a,c){return $.access(this,function(a,c,d){return d!==b?$.style(a,c,d):$.css(a,c)},a,c,arguments.length>1)},show:function(){return s(this,!0)},hide:function(){return s(this)},toggle:function(a,b){var c="boolean"==typeof a;return $.isFunction(a)&&$.isFunction(b)?sb.apply(this,arguments):this.each(function(){(c?a:r(this))?$(this).show():$(this).hide()})}}),$.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=cb(a,"opacity");return""===c?"1":c}}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":$.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var f,g,h,i=$.camelCase(c),j=a.style;if(c=$.cssProps[i]||($.cssProps[i]=q(j,i)),h=$.cssHooks[c]||$.cssHooks[i],d===b)return h&&"get"in h&&(f=h.get(a,!1,e))!==b?f:j[c];if(g=typeof d,"string"===g&&(f=mb.exec(d))&&(d=(f[1]+1)*f[2]+parseFloat($.css(a,c)),g="number"),!(null==d||"number"===g&&isNaN(d)||("number"!==g||$.cssNumber[i]||(d+="px"),h&&"set"in h&&(d=h.set(a,d,e))===b)))try{j[c]=d}catch(k){}}},css:function(a,c,d,e){var f,g,h,i=$.camelCase(c);return c=$.cssProps[i]||($.cssProps[i]=q(a.style,i)),h=$.cssHooks[c]||$.cssHooks[i],h&&"get"in h&&(f=h.get(a,!0,e)),f===b&&(f=cb(a,c)),"normal"===f&&c in pb&&(f=pb[c]),d||e!==b?(g=parseFloat(f),d||$.isNumeric(g)?g||0:f):f},swap:function(a,b,c){var d,e,f={};for(e in b)f[e]=a.style[e],a.style[e]=b[e];d=c.call(a);for(e in b)a.style[e]=f[e];return d}}),a.getComputedStyle?cb=function(b,c){var d,e,f,g,h=a.getComputedStyle(b,null),i=b.style;return h&&(d=h[c],""!==d||$.contains(b.ownerDocument,b)||(d=$.style(b,c)),lb.test(d)&&jb.test(c)&&(e=i.width,f=i.minWidth,g=i.maxWidth,i.minWidth=i.maxWidth=i.width=d,d=h.width,i.width=e,i.minWidth=f,i.maxWidth=g)),d}:P.documentElement.currentStyle&&(cb=function(a,b){var c,d,e=a.currentStyle&&a.currentStyle[b],f=a.style;return null==e&&f&&f[b]&&(e=f[b]),lb.test(e)&&!hb.test(b)&&(c=f.left,d=a.runtimeStyle&&a.runtimeStyle.left,d&&(a.runtimeStyle.left=a.currentStyle.left),f.left="fontSize"===b?"1em":e,e=f.pixelLeft+"px",f.left=c,d&&(a.runtimeStyle.left=d)),""===e?"auto":e}),$.each(["height","width"],function(a,b){$.cssHooks[b]={get:function(a,c,d){return c?0===a.offsetWidth&&ib.test(cb(a,"display"))?$.swap(a,ob,function(){return v(a,b,d)}):v(a,b,d):void 0},set:function(a,c,d){return t(a,c,d?u(a,b,d,$.support.boxSizing&&"border-box"===$.css(a,"boxSizing")):0)}}}),$.support.opacity||($.cssHooks.opacity={get:function(a,b){return gb.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=$.isNumeric(b)?"alpha(opacity="+100*b+")":"",f=d&&d.filter||c.filter||"";c.zoom=1,b>=1&&""===$.trim(f.replace(fb,""))&&c.removeAttribute&&(c.removeAttribute("filter"),d&&!d.filter)||(c.filter=fb.test(f)?f.replace(fb,e):f+" "+e)}}),$(function(){$.support.reliableMarginRight||($.cssHooks.marginRight={get:function(a,b){return $.swap(a,{display:"inline-block"},function(){return b?cb(a,"marginRight"):void 0})}}),!$.support.pixelPosition&&$.fn.position&&$.each(["top","left"],function(a,b){$.cssHooks[b]={get:function(a,c){if(c){var d=cb(a,b);return lb.test(d)?$(a).position()[b]+"px":d}}}})}),$.expr&&$.expr.filters&&($.expr.filters.hidden=function(a){return 0===a.offsetWidth&&0===a.offsetHeight||!$.support.reliableHiddenOffsets&&"none"===(a.style&&a.style.display||cb(a,"display"))},$.expr.filters.visible=function(a){return!$.expr.filters.hidden(a)}),$.each({margin:"",padding:"",border:"Width"},function(a,b){$.cssHooks[a+b]={expand:function(c){var d,e="string"==typeof c?c.split(" "):[c],f={};for(d=0;4>d;d++)f[a+qb[d]+b]=e[d]||e[d-2]||e[0];return f}},jb.test(a)||($.cssHooks[a+b].set=t)});var tb=/%20/g,ub=/\[\]$/,vb=/\r?\n/g,wb=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,xb=/^(?:select|textarea)/i;$.fn.extend({serialize:function(){return $.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?$.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||xb.test(this.nodeName)||wb.test(this.type))}).map(function(a,b){var c=$(this).val();return null==c?null:$.isArray(c)?$.map(c,function(a,c){return{name:b.name,value:a.replace(vb,"\r\n")}}):{name:b.name,value:c.replace(vb,"\r\n")}}).get()}}),$.param=function(a,c){var d,e=[],f=function(a,b){b=$.isFunction(b)?b():null==b?"":b,e[e.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(c===b&&(c=$.ajaxSettings&&$.ajaxSettings.traditional),$.isArray(a)||a.jquery&&!$.isPlainObject(a))$.each(a,function(){f(this.name,this.value)});else for(d in a)x(d,a[d],c,f);return e.join("&").replace(tb,"+")};var yb,zb,Ab=/#.*$/,Bb=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Cb=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,Db=/^(?:GET|HEAD)$/,Eb=/^\/\//,Fb=/\?/,Gb=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,Hb=/([?&])_=[^&]*/,Ib=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Jb=$.fn.load,Kb={},Lb={},Mb=["*/"]+["*"];try{zb=Q.href}catch(Nb){zb=P.createElement("a"),zb.href="",zb=zb.href}yb=Ib.exec(zb.toLowerCase())||[],$.fn.load=function(a,c,d){if("string"!=typeof a&&Jb)return Jb.apply(this,arguments);if(!this.length)return this;var e,f,g,h=this,i=a.indexOf(" ");return i>=0&&(e=a.slice(i,a.length),a=a.slice(0,i)),$.isFunction(c)?(d=c,c=b):c&&"object"==typeof c&&(f="POST"),$.ajax({url:a,type:f,dataType:"html",data:c,complete:function(a,b){d&&h.each(d,g||[a.responseText,b,a])}}).done(function(a){g=arguments,h.html(e?$("<div>").append(a.replace(Gb,"")).find(e):a)}),this},$.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){$.fn[b]=function(a){return this.on(b,a)}}),$.each(["get","post"],function(a,c){$[c]=function(a,d,e,f){return $.isFunction(d)&&(f=f||e,e=d,d=b),$.ajax({type:c,url:a,data:d,success:e,dataType:f})}}),$.extend({getScript:function(a,c){return $.get(a,b,c,"script")},getJSON:function(a,b,c){return $.get(a,b,c,"json")},ajaxSetup:function(a,b){return b?A(a,$.ajaxSettings):(b=a,a=$.ajaxSettings),A(a,b),a},ajaxSettings:{url:zb,isLocal:Cb.test(yb[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":Mb},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":$.parseJSON,"text xml":$.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:y(Kb),ajaxTransport:y(Lb),ajax:function(a,c){function d(a,c,d,g){var j,l,s,t,v,x=c;2!==u&&(u=2,i&&clearTimeout(i),h=b,f=g||"",w.readyState=a>0?4:0,d&&(t=B(m,w,d)),a>=200&&300>a||304===a?(m.ifModified&&(v=w.getResponseHeader("Last-Modified"),v&&($.lastModified[e]=v),v=w.getResponseHeader("Etag"),v&&($.etag[e]=v)),304===a?(x="notmodified",j=!0):(j=C(m,t),x=j.state,l=j.data,s=j.error,j=!s)):(s=x,(!x||a)&&(x="error",0>a&&(a=0))),w.status=a,w.statusText=(c||x)+"",j?p.resolveWith(n,[l,x,w]):p.rejectWith(n,[w,x,s]),w.statusCode(r),r=b,k&&o.trigger("ajax"+(j?"Success":"Error"),[w,m,j?l:s]),q.fireWith(n,[w,x]),k&&(o.trigger("ajaxComplete",[w,m]),--$.active||$.event.trigger("ajaxStop")))}"object"==typeof a&&(c=a,a=b),c=c||{};var e,f,g,h,i,j,k,l,m=$.ajaxSetup({},c),n=m.context||m,o=n!==m&&(n.nodeType||n instanceof $)?$(n):$.event,p=$.Deferred(),q=$.Callbacks("once memory"),r=m.statusCode||{},s={},t={},u=0,v="canceled",w={readyState:0,setRequestHeader:function(a,b){if(!u){var c=a.toLowerCase();a=t[c]=t[c]||a,s[a]=b}return this},getAllResponseHeaders:function(){return 2===u?f:null},getResponseHeader:function(a){var c;if(2===u){if(!g)for(g={};c=Bb.exec(f);)g[c[1].toLowerCase()]=c[2];c=g[a.toLowerCase()]}return c===b?null:c},overrideMimeType:function(a){return u||(m.mimeType=a),this},abort:function(a){return a=a||v,h&&h.abort(a),d(0,a),this}};if(p.promise(w),w.success=w.done,w.error=w.fail,w.complete=q.add,w.statusCode=function(a){if(a){var b;if(2>u)for(b in a)r[b]=[r[b],a[b]];else b=a[w.status],w.always(b)}return this},m.url=((a||m.url)+"").replace(Ab,"").replace(Eb,yb[1]+"//"),m.dataTypes=$.trim(m.dataType||"*").toLowerCase().split(ba),null==m.crossDomain&&(j=Ib.exec(m.url.toLowerCase())||!1,m.crossDomain=j&&j.join(":")+(j[3]?"":"http:"===j[1]?80:443)!==yb.join(":")+(yb[3]?"":"http:"===yb[1]?80:443)),m.data&&m.processData&&"string"!=typeof m.data&&(m.data=$.param(m.data,m.traditional)),z(Kb,m,c,w),2===u)return w;if(k=m.global,m.type=m.type.toUpperCase(),m.hasContent=!Db.test(m.type),k&&0===$.active++&&$.event.trigger("ajaxStart"),!m.hasContent&&(m.data&&(m.url+=(Fb.test(m.url)?"&":"?")+m.data,delete m.data),e=m.url,m.cache===!1)){var x=$.now(),y=m.url.replace(Hb,"$1_="+x);m.url=y+(y===m.url?(Fb.test(m.url)?"&":"?")+"_="+x:"")}(m.data&&m.hasContent&&m.contentType!==!1||c.contentType)&&w.setRequestHeader("Content-Type",m.contentType),m.ifModified&&(e=e||m.url,$.lastModified[e]&&w.setRequestHeader("If-Modified-Since",$.lastModified[e]),$.etag[e]&&w.setRequestHeader("If-None-Match",$.etag[e])),w.setRequestHeader("Accept",m.dataTypes[0]&&m.accepts[m.dataTypes[0]]?m.accepts[m.dataTypes[0]]+("*"!==m.dataTypes[0]?", "+Mb+"; q=0.01":""):m.accepts["*"]);for(l in m.headers)w.setRequestHeader(l,m.headers[l]);if(m.beforeSend&&(m.beforeSend.call(n,w,m)===!1||2===u))return w.abort();v="abort";for(l in{success:1,error:1,complete:1})w[l](m[l]);if(h=z(Lb,m,c,w)){w.readyState=1,k&&o.trigger("ajaxSend",[w,m]),m.async&&m.timeout>0&&(i=setTimeout(function(){w.abort("timeout")},m.timeout));try{u=1,h.send(s,d)}catch(A){if(!(2>u))throw A;d(-1,A)}}else d(-1,"No Transport");return w},active:0,lastModified:{},etag:{}});var Ob=[],Pb=/\?/,Qb=/(=)\?(?=&|$)|\?\?/,Rb=$.now();$.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Ob.pop()||$.expando+"_"+Rb++;return this[a]=!0,a}}),$.ajaxPrefilter("json jsonp",function(c,d,e){var f,g,h,i=c.data,j=c.url,k=c.jsonp!==!1,l=k&&Qb.test(j),m=k&&!l&&"string"==typeof i&&!(c.contentType||"").indexOf("application/x-www-form-urlencoded")&&Qb.test(i);return"jsonp"===c.dataTypes[0]||l||m?(f=c.jsonpCallback=$.isFunction(c.jsonpCallback)?c.jsonpCallback():c.jsonpCallback,g=a[f],l?c.url=j.replace(Qb,"$1"+f):m?c.data=i.replace(Qb,"$1"+f):k&&(c.url+=(Pb.test(j)?"&":"?")+c.jsonp+"="+f),c.converters["script json"]=function(){return h||$.error(f+" was not called"),h[0]},c.dataTypes[0]="json",a[f]=function(){h=arguments},e.always(function(){a[f]=g,c[f]&&(c.jsonpCallback=d.jsonpCallback,Ob.push(f)),h&&$.isFunction(g)&&g(h[0]),h=g=b}),"script"):void 0}),$.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){return $.globalEval(a),a}}}),$.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),$.ajaxTransport("script",function(a){if(a.crossDomain){var c,d=P.head||P.getElementsByTagName("head")[0]||P.documentElement;return{send:function(e,f){c=P.createElement("script"),c.async="async",a.scriptCharset&&(c.charset=a.scriptCharset),c.src=a.url,c.onload=c.onreadystatechange=function(a,e){(e||!c.readyState||/loaded|complete/.test(c.readyState))&&(c.onload=c.onreadystatechange=null,d&&c.parentNode&&d.removeChild(c),c=b,e||f(200,"success"))},d.insertBefore(c,d.firstChild)},abort:function(){c&&c.onload(0,1)}}}});var Sb,Tb=a.ActiveXObject?function(){for(var a in Sb)Sb[a](0,1)}:!1,Ub=0;$.ajaxSettings.xhr=a.ActiveXObject?function(){return!this.isLocal&&D()||E()}:D,function(a){$.extend($.support,{ajax:!!a,cors:!!a&&"withCredentials"in a})}($.ajaxSettings.xhr()),$.support.ajax&&$.ajaxTransport(function(c){if(!c.crossDomain||$.support.cors){var d;return{send:function(e,f){var g,h,i=c.xhr();if(c.username?i.open(c.type,c.url,c.async,c.username,c.password):i.open(c.type,c.url,c.async),c.xhrFields)for(h in c.xhrFields)i[h]=c.xhrFields[h];c.mimeType&&i.overrideMimeType&&i.overrideMimeType(c.mimeType),c.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest");try{for(h in e)i.setRequestHeader(h,e[h])}catch(j){}i.send(c.hasContent&&c.data||null),d=function(a,e){var h,j,k,l,m;try{if(d&&(e||4===i.readyState))if(d=b,g&&(i.onreadystatechange=$.noop,Tb&&delete Sb[g]),e)4!==i.readyState&&i.abort();else{h=i.status,k=i.getAllResponseHeaders(),l={},m=i.responseXML,m&&m.documentElement&&(l.xml=m);try{l.text=i.responseText}catch(a){}try{j=i.statusText}catch(n){j=""}h||!c.isLocal||c.crossDomain?1223===h&&(h=204):h=l.text?200:404}}catch(o){e||f(-1,o)}l&&f(h,j,l,k)},c.async?4===i.readyState?setTimeout(d,0):(g=++Ub,Tb&&(Sb||(Sb={},$(a).unload(Tb)),Sb[g]=d),i.onreadystatechange=d):d()},abort:function(){d&&d(0,1)}}}});var Vb,Wb,Xb=/^(?:toggle|show|hide)$/,Yb=new RegExp("^(?:([-+])=|)("+_+")([a-z%]*)$","i"),Zb=/queueHooks$/,$b=[J],_b={"*":[function(a,b){var c,d,e=this.createTween(a,b),f=Yb.exec(b),g=e.cur(),h=+g||0,i=1,j=20;if(f){if(c=+f[2],d=f[3]||($.cssNumber[a]?"":"px"),"px"!==d&&h){h=$.css(e.elem,a,!0)||c||1;do i=i||".5",h/=i,$.style(e.elem,a,h+d);while(i!==(i=e.cur()/g)&&1!==i&&--j)}e.unit=d,e.start=h,e.end=f[1]?h+(f[1]+1)*c:c}return e}]};$.Animation=$.extend(H,{tweener:function(a,b){$.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++)c=a[d],_b[c]=_b[c]||[],_b[c].unshift(b)},prefilter:function(a,b){b?$b.unshift(a):$b.push(a)}}),$.Tween=K,K.prototype={constructor:K,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||($.cssNumber[c]?"":"px")},cur:function(){var a=K.propHooks[this.prop];return a&&a.get?a.get(this):K.propHooks._default.get(this)},run:function(a){var b,c=K.propHooks[this.prop];return this.options.duration?this.pos=b=$.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):K.propHooks._default.set(this),this}},K.prototype.init.prototype=K.prototype,K.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=$.css(a.elem,a.prop,!1,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){$.fx.step[a.prop]?$.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[$.cssProps[a.prop]]||$.cssHooks[a.prop])?$.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},K.propHooks.scrollTop=K.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},$.each(["toggle","show","hide"],function(a,b){var c=$.fn[b];$.fn[b]=function(d,e,f){return null==d||"boolean"==typeof d||!a&&$.isFunction(d)&&$.isFunction(e)?c.apply(this,arguments):this.animate(L(b,!0),d,e,f)}}),$.fn.extend({fadeTo:function(a,b,c,d){return this.filter(r).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=$.isEmptyObject(a),f=$.speed(b,c,d),g=function(){var b=H(this,$.extend({},a),f);e&&b.stop(!0)};return e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,c,d){var e=function(a){var b=a.stop;delete a.stop,b(d)};return"string"!=typeof a&&(d=c,c=a,a=b),c&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,c=null!=a&&a+"queueHooks",f=$.timers,g=$._data(this);if(c)g[c]&&g[c].stop&&e(g[c]);else for(c in g)g[c]&&g[c].stop&&Zb.test(c)&&e(g[c]);for(c=f.length;c--;)f[c].elem!==this||null!=a&&f[c].queue!==a||(f[c].anim.stop(d),b=!1,f.splice(c,1));(b||!d)&&$.dequeue(this,a)})}}),$.each({slideDown:L("show"),slideUp:L("hide"),slideToggle:L("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){$.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),$.speed=function(a,b,c){var d=a&&"object"==typeof a?$.extend({},a):{complete:c||!c&&b||$.isFunction(a)&&a,duration:a,easing:c&&b||b&&!$.isFunction(b)&&b};return d.duration=$.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in $.fx.speeds?$.fx.speeds[d.duration]:$.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){$.isFunction(d.old)&&d.old.call(this),d.queue&&$.dequeue(this,d.queue)},d},$.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},$.timers=[],$.fx=K.prototype.init,$.fx.tick=function(){for(var a,b=$.timers,c=0;c<b.length;c++)a=b[c],a()||b[c]!==a||b.splice(c--,1);b.length||$.fx.stop()},$.fx.timer=function(a){a()&&$.timers.push(a)&&!Wb&&(Wb=setInterval($.fx.tick,$.fx.interval))},$.fx.interval=13,$.fx.stop=function(){clearInterval(Wb),Wb=null},$.fx.speeds={slow:600,fast:200,_default:400},$.fx.step={},$.expr&&$.expr.filters&&($.expr.filters.animated=function(a){return $.grep($.timers,function(b){return a===b.elem}).length});var ac=/^(?:body|html)$/i;$.fn.offset=function(a){if(arguments.length)return a===b?this:this.each(function(b){$.offset.setOffset(this,a,b)});var c,d,e,f,g,h,i,j={top:0,left:0},k=this[0],l=k&&k.ownerDocument;if(l)return(d=l.body)===k?$.offset.bodyOffset(k):(c=l.documentElement,$.contains(c,k)?("undefined"!=typeof k.getBoundingClientRect&&(j=k.getBoundingClientRect()),e=M(l),f=c.clientTop||d.clientTop||0,g=c.clientLeft||d.clientLeft||0,h=e.pageYOffset||c.scrollTop,i=e.pageXOffset||c.scrollLeft,{top:j.top+h-f,left:j.left+i-g}):j)},$.offset={bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;return $.support.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat($.css(a,"marginTop"))||0,c+=parseFloat($.css(a,"marginLeft"))||0),{top:b,left:c}},setOffset:function(a,b,c){var d=$.css(a,"position");"static"===d&&(a.style.position="relative");var e,f,g=$(a),h=g.offset(),i=$.css(a,"top"),j=$.css(a,"left"),k=("absolute"===d||"fixed"===d)&&$.inArray("auto",[i,j])>-1,l={},m={};k?(m=g.position(),e=m.top,f=m.left):(e=parseFloat(i)||0,f=parseFloat(j)||0),$.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(l.top=b.top-h.top+e),null!=b.left&&(l.left=b.left-h.left+f),"using"in b?b.using.call(a,l):g.css(l)}},$.fn.extend({position:function(){if(this[0]){var a=this[0],b=this.offsetParent(),c=this.offset(),d=ac.test(b[0].nodeName)?{top:0,left:0}:b.offset();return c.top-=parseFloat($.css(a,"marginTop"))||0,c.left-=parseFloat($.css(a,"marginLeft"))||0,d.top+=parseFloat($.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat($.css(b[0],"borderLeftWidth"))||0,{top:c.top-d.top,left:c.left-d.left}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||P.body;a&&!ac.test(a.nodeName)&&"static"===$.css(a,"position");)a=a.offsetParent;return a||P.body})}}),$.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,c){var d=/Y/.test(c);$.fn[a]=function(e){return $.access(this,function(a,e,f){var g=M(a);return f===b?g?c in g?g[c]:g.document.documentElement[e]:a[e]:void(g?g.scrollTo(d?$(g).scrollLeft():f,d?f:$(g).scrollTop()):a[e]=f)},a,e,arguments.length,null)}}),$.each({Height:"height",Width:"width"},function(a,c){$.each({padding:"inner"+a,content:c,"":"outer"+a},function(d,e){$.fn[e]=function(e,f){var g=arguments.length&&(d||"boolean"!=typeof e),h=d||(e===!0||f===!0?"margin":"border");return $.access(this,function(c,d,e){var f;return $.isWindow(c)?c.document.documentElement["client"+a]:9===c.nodeType?(f=c.documentElement,Math.max(c.body["scroll"+a],f["scroll"+a],c.body["offset"+a],f["offset"+a],f["client"+a])):e===b?$.css(c,d,e,h):$.style(c,d,e,h)},c,g?e:b,g,null)}})}),a.jQuery=a.$=$,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return $})}(window),function(){var a,b=this,c=b.Backbone,d=[],e=(d.push,d.slice);d.splice;a="undefined"!=typeof exports?exports:b.Backbone={},a.VERSION="1.1.0";var f=b._;f||"undefined"==typeof require||(f=require("underscore")),a.$=b.jQuery||b.Zepto||b.ender||b.$,a.noConflict=function(){return b.Backbone=c,this},a.emulateHTTP=!1,a.emulateJSON=!1;var g=a.Events={on:function(a,b,c){if(!i(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,c){if(!i(this,"once",a,[b,c])||!b)return this;var d=this,e=f.once(function(){d.off(a,e),b.apply(this,arguments)});return e._callback=b,this.on(a,e,c)},off:function(a,b,c){var d,e,g,h,j,k,l,m;if(!this._events||!i(this,"off",a,[b,c]))return this;if(!a&&!b&&!c)return this._events={},this;for(h=a?[a]:f.keys(this._events),j=0,k=h.length;k>j;j++)if(a=h[j],g=this._events[a]){if(this._events[a]=d=[],b||c)for(l=0,m=g.length;m>l;l++)e=g[l],(b&&b!==e.callback&&b!==e.callback._callback||c&&c!==e.context)&&d.push(e);d.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var b=e.call(arguments,1);if(!i(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;return c&&j(c,b),d&&j(d,arguments),this},stopListening:function(a,b,c){var d=this._listeningTo;if(!d)return this;var e=!b&&!c;c||"object"!=typeof b||(c=this),a&&((d={})[a._listenId]=a);for(var g in d)a=d[g],a.off(b,c,this),(e||f.isEmpty(a._events))&&delete this._listeningTo[g];return this}},h=/\s+/,i=function(a,b,c,d){if(!c)return!0;if("object"==typeof c){for(var e in c)a[b].apply(a,[e,c[e]].concat(d));return!1}if(h.test(c)){for(var f=c.split(h),g=0,i=f.length;i>g;g++)a[b].apply(a,[f[g]].concat(d));return!1}return!0},j=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b)}},k={listenTo:"on",listenToOnce:"once"};f.each(k,function(a,b){g[b]=function(b,c,d){var e=this._listeningTo||(this._listeningTo={}),g=b._listenId||(b._listenId=f.uniqueId("l"));return e[g]=b,d||"object"!=typeof c||(d=this),b[a](c,d,this),this}}),g.bind=g.on,g.unbind=g.off,f.extend(a,g);var l=a.Model=function(a,b){var c=a||{};b||(b={}),this.cid=f.uniqueId("c"),this.attributes={},b.collection&&(this.collection=b.collection),b.parse&&(c=this.parse(c,b)||{}),c=f.defaults({},c,f.result(this,"defaults")),this.set(c,b),this.changed={},this.initialize.apply(this,arguments)};f.extend(l.prototype,g,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(a){return f.clone(this.attributes)},sync:function(){return a.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return f.escape(this.get(a))},has:function(a){return null!=this.get(a)},set:function(a,b,c){var d,e,g,h,i,j,k,l;if(null==a)return this;if("object"==typeof a?(e=a,c=b):(e={})[a]=b,c||(c={}),!this._validate(e,c))return!1;g=c.unset,i=c.silent,h=[],j=this._changing,this._changing=!0,j||(this._previousAttributes=f.clone(this.attributes),this.changed={}),l=this.attributes,k=this._previousAttributes,this.idAttribute in e&&(this.id=e[this.idAttribute]);for(d in e)b=e[d],f.isEqual(l[d],b)||h.push(d),f.isEqual(k[d],b)?delete this.changed[d]:this.changed[d]=b,g?delete l[d]:l[d]=b;if(!i){h.length&&(this._pending=!0);for(var m=0,n=h.length;n>m;m++)this.trigger("change:"+h[m],this,l[h[m]],c)}if(j)return this;if(!i)for(;this._pending;)this._pending=!1,this.trigger("change",this,c);return this._pending=!1,this._changing=!1,this},unset:function(a,b){return this.set(a,void 0,f.extend({},b,{unset:!0}))},clear:function(a){var b={};for(var c in this.attributes)b[c]=void 0;return this.set(b,f.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!f.isEmpty(this.changed):f.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?f.clone(this.changed):!1;var b,c=!1,d=this._changing?this._previousAttributes:this.attributes;for(var e in a)f.isEqual(d[e],b=a[e])||((c||(c={}))[e]=b);return c},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return f.clone(this._previousAttributes)},fetch:function(a){a=a?f.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=this,c=a.success;return a.success=function(d){return b.set(b.parse(d,a),a)?(c&&c(b,d,a),void b.trigger("sync",b,d,a)):!1},K(this,a),this.sync("read",this,a)},save:function(a,b,c){var d,e,g,h=this.attributes;if(null==a||"object"==typeof a?(d=a,c=b):(d={})[a]=b,c=f.extend({validate:!0},c),d&&!c.wait){if(!this.set(d,c))return!1}else if(!this._validate(d,c))return!1;d&&c.wait&&(this.attributes=f.extend({},h,d)),void 0===c.parse&&(c.parse=!0);var i=this,j=c.success;return c.success=function(a){i.attributes=h;var b=i.parse(a,c);return c.wait&&(b=f.extend(d||{},b)),f.isObject(b)&&!i.set(b,c)?!1:(j&&j(i,a,c),void i.trigger("sync",i,a,c))},K(this,c),e=this.isNew()?"create":c.patch?"patch":"update","patch"===e&&(c.attrs=d),g=this.sync(e,this,c),d&&c.wait&&(this.attributes=h),g},destroy:function(a){a=a?f.clone(a):{};var b=this,c=a.success,d=function(){b.trigger("destroy",b,b.collection,a)};if(a.success=function(e){(a.wait||b.isNew())&&d(),c&&c(b,e,a),b.isNew()||b.trigger("sync",b,e,a)},this.isNew())return a.success(),!1;K(this,a);var e=this.sync("delete",this,a);return a.wait||d(),e},url:function(){var a=f.result(this,"urlRoot")||f.result(this.collection,"url")||J();return this.isNew()?a:a+("/"===a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(a){return this._validate({},f.extend(a||{},{validate:!0}))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=f.extend({},this.attributes,a);var c=this.validationError=this.validate(a,b)||null;return c?(this.trigger("invalid",this,c,f.extend(b,{validationError:c})),!1):!0}});var m=["keys","values","pairs","invert","pick","omit"];f.each(m,function(a){l.prototype[a]=function(){var b=e.call(arguments);return b.unshift(this.attributes),f[a].apply(f,b)}});var n=a.Collection=function(a,b){b||(b={}),b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,f.extend({silent:!0},b))},o={add:!0,remove:!0,merge:!0},p={add:!0,remove:!1};f.extend(n.prototype,g,{model:l,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return a.sync.apply(this,arguments)},add:function(a,b){return this.set(a,f.extend({merge:!1},b,p))},remove:function(a,b){var c=!f.isArray(a);a=c?[a]:f.clone(a),b||(b={});var d,e,g,h;for(d=0,e=a.length;e>d;d++)h=a[d]=this.get(a[d]),h&&(delete this._byId[h.id],delete this._byId[h.cid],g=this.indexOf(h),this.models.splice(g,1),this.length--,b.silent||(b.index=g,h.trigger("remove",h,this,b)),this._removeReference(h));return c?a[0]:a},set:function(a,b){b=f.defaults({},b,o),b.parse&&(a=this.parse(a,b));var c=!f.isArray(a);a=c?a?[a]:[]:f.clone(a);var d,e,g,h,i,j,k,m=b.at,n=this.model,p=this.comparator&&null==m&&b.sort!==!1,q=f.isString(this.comparator)?this.comparator:null,r=[],s=[],t={},u=b.add,v=b.merge,w=b.remove,x=!p&&u&&w?[]:!1;for(d=0,e=a.length;e>d;d++){if(i=a[d],g=i instanceof l?h=i:i[n.prototype.idAttribute],j=this.get(g))w&&(t[j.cid]=!0),v&&(i=i===h?h.attributes:i,b.parse&&(i=j.parse(i,b)),j.set(i,b),p&&!k&&j.hasChanged(q)&&(k=!0)),a[d]=j;else if(u){if(h=a[d]=this._prepareModel(i,b),!h)continue;r.push(h),h.on("all",this._onModelEvent,this),this._byId[h.cid]=h,null!=h.id&&(this._byId[h.id]=h)}x&&x.push(j||h)}if(w){for(d=0,e=this.length;e>d;++d)t[(h=this.models[d]).cid]||s.push(h);s.length&&this.remove(s,b)}if(r.length||x&&x.length)if(p&&(k=!0),this.length+=r.length,null!=m)for(d=0,e=r.length;e>d;d++)this.models.splice(m+d,0,r[d]);else{x&&(this.models.length=0);var y=x||r;for(d=0,e=y.length;e>d;d++)this.models.push(y[d])}if(k&&this.sort({silent:!0}),!b.silent){for(d=0,e=r.length;e>d;d++)(h=r[d]).trigger("add",h,this,b);(k||x&&x.length)&&this.trigger("sort",this,b)}return c?a[0]:a},reset:function(a,b){b||(b={});for(var c=0,d=this.models.length;d>c;c++)this._removeReference(this.models[c]);return b.previousModels=this.models,this._reset(),a=this.add(a,f.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),a},push:function(a,b){return this.add(a,f.extend({at:this.length},b))},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a),b},unshift:function(a,b){return this.add(a,f.extend({at:0},b))},shift:function(a){var b=this.at(0);return this.remove(b,a),b},slice:function(){return e.apply(this.models,arguments)},get:function(a){return null==a?void 0:this._byId[a.id]||this._byId[a.cid]||this._byId[a]},at:function(a){return this.models[a]},where:function(a,b){return f.isEmpty(a)?b?void 0:[]:this[b?"find":"filter"](function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return a||(a={}),f.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(f.bind(this.comparator,this)),a.silent||this.trigger("sort",this,a),this},pluck:function(a){return f.invoke(this.models,"get",a)},fetch:function(a){a=a?f.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=a.success,c=this;return a.success=function(d){var e=a.reset?"reset":"set";c[e](d,a),b&&b(c,d,a),c.trigger("sync",c,d,a)},K(this,a),this.sync("read",this,a)},create:function(a,b){if(b=b?f.clone(b):{},!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var c=this,d=b.success;return b.success=function(a,b,e){e.wait&&c.add(a,e),d&&d(a,b,e)},a.save(null,b),a},parse:function(a,b){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(a,b){if(a instanceof l)return a.collection||(a.collection=this),a;b=b?f.clone(b):{},b.collection=this;var c=new this.model(a,b);return c.validationError?(this.trigger("invalid",this,c.validationError,b),!1):c},_removeReference:function(a){this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"!==a&&"remove"!==a||c===this)&&("destroy"===a&&this.remove(b,d),
b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments))}});var q=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain"];f.each(q,function(a){n.prototype[a]=function(){var b=e.call(arguments);return b.unshift(this.models),f[a].apply(f,b)}});var r=["groupBy","countBy","sortBy"];f.each(r,function(a){n.prototype[a]=function(b,c){var d=f.isFunction(b)?b:function(a){return a.get(b)};return f[a](this.models,d,c)}});var s=a.View=function(a){this.cid=f.uniqueId("view"),a||(a={}),f.extend(this,f.pick(a,u)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},t=/^(\S+)\s*(.*)$/,u=["model","collection","el","id","attributes","className","tagName","events"];f.extend(s.prototype,g,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(b,c){return this.$el&&this.undelegateEvents(),this.$el=b instanceof a.$?b:a.$(b),this.el=this.$el[0],c!==!1&&this.delegateEvents(),this},delegateEvents:function(a){if(!a&&!(a=f.result(this,"events")))return this;this.undelegateEvents();for(var b in a){var c=a[b];if(f.isFunction(c)||(c=this[a[b]]),c){var d=b.match(t),e=d[1],g=d[2];c=f.bind(c,this),e+=".delegateEvents"+this.cid,""===g?this.$el.on(e,c):this.$el.on(e,g,c)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(f.result(this,"el"),!1);else{var b=f.extend({},f.result(this,"attributes"));this.id&&(b.id=f.result(this,"id")),this.className&&(b["class"]=f.result(this,"className"));var c=a.$("<"+f.result(this,"tagName")+">").attr(b);this.setElement(c,!1)}}}),a.sync=function(b,c,d){var e=w[b];f.defaults(d||(d={}),{emulateHTTP:a.emulateHTTP,emulateJSON:a.emulateJSON});var g={type:e,dataType:"json"};if(d.url||(g.url=f.result(c,"url")||J()),null!=d.data||!c||"create"!==b&&"update"!==b&&"patch"!==b||(g.contentType="application/json",g.data=JSON.stringify(d.attrs||c.toJSON(d))),d.emulateJSON&&(g.contentType="application/x-www-form-urlencoded",g.data=g.data?{model:g.data}:{}),d.emulateHTTP&&("PUT"===e||"DELETE"===e||"PATCH"===e)){g.type="POST",d.emulateJSON&&(g.data._method=e);var h=d.beforeSend;d.beforeSend=function(a){return a.setRequestHeader("X-HTTP-Method-Override",e),h?h.apply(this,arguments):void 0}}"GET"===g.type||d.emulateJSON||(g.processData=!1),"PATCH"===g.type&&v&&(g.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var i=d.xhr=a.ajax(f.extend(g,d));return c.trigger("request",c,i,d),i};var v=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),w={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};a.ajax=function(){return a.$.ajax.apply(a.$,arguments)};var x=a.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},y=/\((.*?)\)/g,z=/(\(\?)?:\w+/g,A=/\*\w+/g,B=/[\-{}\[\]+?.,\\\^$|#\s]/g;f.extend(x.prototype,g,{initialize:function(){},route:function(b,c,d){f.isRegExp(b)||(b=this._routeToRegExp(b)),f.isFunction(c)&&(d=c,c=""),d||(d=this[c]);var e=this;return a.history.route(b,function(f){var g=e._extractParameters(b,f);d&&d.apply(e,g),e.trigger.apply(e,["route:"+c].concat(g)),e.trigger("route",c,g),a.history.trigger("route",e,c,g)}),this},navigate:function(b,c){return a.history.navigate(b,c),this},_bindRoutes:function(){if(this.routes){this.routes=f.result(this,"routes");for(var a,b=f.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){return a=a.replace(B,"\\$&").replace(y,"(?:$1)?").replace(z,function(a,b){return b?a:"([^/]+)"}).replace(A,"(.*?)"),new RegExp("^"+a+"$")},_extractParameters:function(a,b){var c=a.exec(b).slice(1);return f.map(c,function(a){return a?decodeURIComponent(a):null})}});var C=a.History=function(){this.handlers=[],f.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},D=/^[#\/]|\s+$/g,E=/^\/+|\/+$/g,F=/msie [\w.]+/,G=/\/$/,H=/[?#].*$/;C.started=!1,f.extend(C.prototype,g,{interval:50,getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=this.location.pathname;var c=this.root.replace(G,"");a.indexOf(c)||(a=a.slice(c.length))}else a=this.getHash();return a.replace(D,"")},start:function(b){if(C.started)throw new Error("Backbone.history has already been started");C.started=!0,this.options=f.extend({root:"/"},this.options,b),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var c=this.getFragment(),d=document.documentMode,e=F.exec(navigator.userAgent.toLowerCase())&&(!d||7>=d);this.root=("/"+this.root+"/").replace(E,"/"),e&&this._wantsHashChange&&(this.iframe=a.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(c)),this._hasPushState?a.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!e?a.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=c;var g=this.location,h=g.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!h)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._hasPushState&&h&&g.hash&&(this.fragment=this.getHash().replace(D,""),this.history.replaceState({},document.title,this.root+this.fragment+g.search))}return this.options.silent?void 0:this.loadUrl()},stop:function(){a.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),C.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){var b=this.getFragment();return b===this.fragment&&this.iframe&&(b=this.getFragment(this.getHash(this.iframe))),b===this.fragment?!1:(this.iframe&&this.navigate(b),void this.loadUrl())},loadUrl:function(a){return a=this.fragment=this.getFragment(a),f.any(this.handlers,function(b){return b.route.test(a)?(b.callback(a),!0):void 0})},navigate:function(a,b){if(!C.started)return!1;b&&b!==!0||(b={trigger:!!b});var c=this.root+(a=this.getFragment(a||""));if(a=a.replace(H,""),this.fragment!==a){if(this.fragment=a,""===a&&"/"!==c&&(c=c.slice(0,-1)),this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else{if(!this._wantsHashChange)return this.location.assign(c);this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace))}return b.trigger?this.loadUrl(a):void 0}},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b}}),a.history=new C;var I=function(a,b){var c,d=this;c=a&&f.has(a,"constructor")?a.constructor:function(){return d.apply(this,arguments)},f.extend(c,d,b);var e=function(){this.constructor=c};return e.prototype=d.prototype,c.prototype=new e,a&&f.extend(c.prototype,a),c.__super__=d.prototype,c};l.extend=n.extend=x.extend=s.extend=C.extend=I;var J=function(){throw new Error('A "url" property or function must be specified')},K=function(a,b){var c=b.error;b.error=function(d){c&&c(a,d,b),a.trigger("error",a,d,b)}}}.call(this),define("backbone",["underscore","jquery"],function(a){return function(){var b;return b||a.Backbone}}(this)),function(a){"use strict";if("function"==typeof bootstrap)bootstrap("promise",a);else if("object"==typeof exports&&"object"==typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define("q",a);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=a}else{if("undefined"==typeof self)throw new Error("This environment was not anticipated by Q. Please file a bug.");self.Q=a()}}(function(){function a(a){return function(){return W.apply(a,arguments)}}function b(a){return a===Object(a)}function c(a){return"[object StopIteration]"===ca(a)||a instanceof S}function d(a,b){if(P&&b.stack&&"object"==typeof a&&null!==a&&a.stack&&-1===a.stack.indexOf(da)){for(var c=[],d=b;d;d=d.source)d.stack&&c.unshift(d.stack);c.unshift(a.stack);var f=c.join("\n"+da+"\n");a.stack=e(f)}}function e(a){for(var b=a.split("\n"),c=[],d=0;d<b.length;++d){var e=b[d];h(e)||f(e)||!e||c.push(e)}return c.join("\n")}function f(a){return-1!==a.indexOf("(module.js:")||-1!==a.indexOf("(node.js:")}function g(a){var b=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(a);if(b)return[b[1],Number(b[2])];var c=/at ([^ ]+):(\d+):(?:\d+)$/.exec(a);if(c)return[c[1],Number(c[2])];var d=/.*@(.+):(\d+)$/.exec(a);return d?[d[1],Number(d[2])]:void 0}function h(a){var b=g(a);if(!b)return!1;var c=b[0],d=b[1];return c===R&&d>=T&&ha>=d}function i(){if(P)try{throw new Error}catch(a){var b=a.stack.split("\n"),c=b[0].indexOf("@")>0?b[1]:b[2],d=g(c);if(!d)return;return R=d[0],d[1]}}function j(a,b,c){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn,a.apply(a,arguments)}}function k(a){return a instanceof o?a:s(a)?B(a):A(a)}function l(){function a(a){b=a,f.source=a,Y(c,function(b,c){k.nextTick(function(){a.promiseDispatch.apply(a,c)})},void 0),c=void 0,d=void 0}var b,c=[],d=[],e=_(l.prototype),f=_(o.prototype);if(f.promiseDispatch=function(a,e,f){var g=X(arguments);c?(c.push(g),"when"===e&&f[1]&&d.push(f[1])):k.nextTick(function(){b.promiseDispatch.apply(b,g)})},f.valueOf=function(){if(c)return f;var a=q(b);return r(a)&&(b=a),a},f.inspect=function(){return b?b.inspect():{state:"pending"}},k.longStackSupport&&P)try{throw new Error}catch(g){f.stack=g.stack.substring(g.stack.indexOf("\n")+1)}return e.promise=f,e.resolve=function(c){b||a(k(c))},e.fulfill=function(c){b||a(A(c))},e.reject=function(c){b||a(z(c))},e.notify=function(a){b||Y(d,function(b,c){k.nextTick(function(){c(a)})},void 0)},e}function m(a){if("function"!=typeof a)throw new TypeError("resolver must be a function.");var b=l();try{a(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}return b.promise}function n(a){return m(function(b,c){for(var d=0,e=a.length;e>d;d++)k(a[d]).then(b,c)})}function o(a,b,c){void 0===b&&(b=function(a){return z(new Error("Promise does not support operation: "+a))}),void 0===c&&(c=function(){return{state:"unknown"}});var d=_(o.prototype);if(d.promiseDispatch=function(c,e,f){var g;try{g=a[e]?a[e].apply(d,f):b.call(d,e,f)}catch(h){g=z(h)}c&&c(g)},d.inspect=c,c){var e=c();"rejected"===e.state&&(d.exception=e.reason),d.valueOf=function(){var a=c();return"pending"===a.state||"rejected"===a.state?d:a.value}}return d}function p(a,b,c,d){return k(a).then(b,c,d)}function q(a){if(r(a)){var b=a.inspect();if("fulfilled"===b.state)return b.value}return a}function r(a){return a instanceof o}function s(a){return b(a)&&"function"==typeof a.then}function t(a){return r(a)&&"pending"===a.inspect().state}function u(a){return!r(a)||"fulfilled"===a.inspect().state}function v(a){return r(a)&&"rejected"===a.inspect().state}function w(){ea.length=0,fa.length=0,ga||(ga=!0)}function x(a,b){ga&&(fa.push(a),b&&"undefined"!=typeof b.stack?ea.push(b.stack):ea.push("(no stack) "+b))}function y(a){if(ga){var b=Z(fa,a);-1!==b&&(fa.splice(b,1),ea.splice(b,1))}}function z(a){var b=o({when:function(b){return b&&y(this),b?b(a):this}},function(){return this},function(){return{state:"rejected",reason:a}});return x(b,a),b}function A(a){return o({when:function(){return a},get:function(b){return a[b]},set:function(b,c){a[b]=c},"delete":function(b){delete a[b]},post:function(b,c){return null===b||void 0===b?a.apply(void 0,c):a[b].apply(a,c)},apply:function(b,c){return a.apply(b,c)},keys:function(){return ba(a)}},void 0,function(){return{state:"fulfilled",value:a}})}function B(a){var b=l();return k.nextTick(function(){try{a.then(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}}),b.promise}function C(a){return o({isDef:function(){}},function(b,c){return I(a,b,c)},function(){return k(a).inspect()})}function D(a,b,c){return k(a).spread(b,c)}function E(a){return function(){function b(a,b){var g;if("undefined"==typeof StopIteration){try{g=d[a](b)}catch(h){return z(h)}return g.done?k(g.value):p(g.value,e,f)}try{g=d[a](b)}catch(h){return c(h)?k(h.value):z(h)}return p(g,e,f)}var d=a.apply(this,arguments),e=b.bind(b,"next"),f=b.bind(b,"throw");return e()}}function F(a){k.done(k.async(a)())}function G(a){throw new S(a)}function H(a){return function(){return D([this,J(arguments)],function(b,c){return a.apply(b,c)})}}function I(a,b,c){return k(a).dispatch(b,c)}function J(a){return p(a,function(a){var b=0,c=l();return Y(a,function(d,e,f){var g;r(e)&&"fulfilled"===(g=e.inspect()).state?a[f]=g.value:(++b,p(e,function(d){a[f]=d,0===--b&&c.resolve(a)},c.reject,function(a){c.notify({index:f,value:a})}))},void 0),0===b&&c.resolve(a),c.promise})}function K(a){if(0===a.length)return k.resolve();var b=k.defer(),c=0;return Y(a,function(d,e,f){function g(a){b.resolve(a)}function h(){c--,0===c&&b.reject(new Error("Can't get fulfillment value from any promise, all promises were rejected."))}function i(a){b.notify({index:f,value:a})}var j=a[f];c++,p(j,g,h,i)},void 0),b.promise}function L(a){return p(a,function(a){return a=$(a,k),p(J($(a,function(a){return p(a,U,U)})),function(){return a})})}function M(a){return k(a).allSettled()}function N(a,b){return k(a).then(void 0,void 0,b)}function O(a,b){return k(a).nodeify(b)}var P=!1;try{throw new Error}catch(Q){P=!!Q.stack}var R,S,T=i(),U=function(){},V=function(){function a(){for(;b.next;){b=b.next;var c=b.task;b.task=void 0;var e=b.domain;e&&(b.domain=void 0,e.enter());try{c()}catch(g){if(f)throw e&&e.exit(),setTimeout(a,0),e&&e.enter(),g;setTimeout(function(){throw g},0)}e&&e.exit()}d=!1}var b={task:void 0,next:null},c=b,d=!1,e=void 0,f=!1;if(V=function(a){c=c.next={task:a,domain:f&&process.domain,next:null},d||(d=!0,e())},"undefined"!=typeof process&&process.nextTick)f=!0,e=function(){process.nextTick(a)};else if("function"==typeof setImmediate)e="undefined"!=typeof window?setImmediate.bind(window,a):function(){setImmediate(a)};else if("undefined"!=typeof MessageChannel){var g=new MessageChannel;g.port1.onmessage=function(){e=h,g.port1.onmessage=a,a()};var h=function(){g.port2.postMessage(0)};e=function(){setTimeout(a,0),h()}}else e=function(){setTimeout(a,0)};return V}(),W=Function.call,X=a(Array.prototype.slice),Y=a(Array.prototype.reduce||function(a,b){var c=0,d=this.length;if(1===arguments.length)for(;;){if(c in this){b=this[c++];break}if(++c>=d)throw new TypeError}for(;d>c;c++)c in this&&(b=a(b,this[c],c));return b}),Z=a(Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1}),$=a(Array.prototype.map||function(a,b){var c=this,d=[];return Y(c,function(e,f,g){d.push(a.call(b,f,g,c))},void 0),d}),_=Object.create||function(a){function b(){}return b.prototype=a,new b},aa=a(Object.prototype.hasOwnProperty),ba=Object.keys||function(a){var b=[];for(var c in a)aa(a,c)&&b.push(c);return b},ca=a(Object.prototype.toString);S="undefined"!=typeof ReturnValue?ReturnValue:function(a){this.value=a};var da="From previous event:";k.resolve=k,k.nextTick=V,k.longStackSupport=!1,"object"==typeof process&&process&&process.env&&process.env.Q_DEBUG&&(k.longStackSupport=!0),k.defer=l,l.prototype.makeNodeResolver=function(){var a=this;return function(b,c){b?a.reject(b):arguments.length>2?a.resolve(X(arguments,1)):a.resolve(c)}},k.Promise=m,k.promise=m,m.race=n,m.all=J,m.reject=z,m.resolve=k,k.passByCopy=function(a){return a},o.prototype.passByCopy=function(){return this},k.join=function(a,b){return k(a).join(b)},o.prototype.join=function(a){return k([this,a]).spread(function(a,b){if(a===b)return a;throw new Error("Can't join: not the same: "+a+" "+b)})},k.race=n,o.prototype.race=function(){return this.then(k.race)},k.makePromise=o,o.prototype.toString=function(){return"[object Promise]"},o.prototype.then=function(a,b,c){function e(b){try{return"function"==typeof a?a(b):b}catch(c){return z(c)}}function f(a){if("function"==typeof b){d(a,h);try{return b(a)}catch(c){return z(c)}}return z(a)}function g(a){return"function"==typeof c?c(a):a}var h=this,i=l(),j=!1;return k.nextTick(function(){h.promiseDispatch(function(a){j||(j=!0,i.resolve(e(a)))},"when",[function(a){j||(j=!0,i.resolve(f(a)))}])}),h.promiseDispatch(void 0,"when",[void 0,function(a){var b,c=!1;try{b=g(a)}catch(d){if(c=!0,!k.onerror)throw d;k.onerror(d)}c||i.notify(b)}]),i.promise},k.tap=function(a,b){return k(a).tap(b)},o.prototype.tap=function(a){return a=k(a),this.then(function(b){return a.fcall(b).thenResolve(b)})},k.when=p,o.prototype.thenResolve=function(a){return this.then(function(){return a})},k.thenResolve=function(a,b){return k(a).thenResolve(b)},o.prototype.thenReject=function(a){return this.then(function(){throw a})},k.thenReject=function(a,b){return k(a).thenReject(b)},k.nearer=q,k.isPromise=r,k.isPromiseAlike=s,k.isPending=t,o.prototype.isPending=function(){return"pending"===this.inspect().state},k.isFulfilled=u,o.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},k.isRejected=v,o.prototype.isRejected=function(){return"rejected"===this.inspect().state};var ea=[],fa=[],ga=!0;k.resetUnhandledRejections=w,k.getUnhandledReasons=function(){return ea.slice()},k.stopUnhandledRejectionTracking=function(){w(),ga=!1},w(),k.reject=z,k.fulfill=A,k.master=C,k.spread=D,o.prototype.spread=function(a,b){return this.all().then(function(b){return a.apply(void 0,b)},b)},k.async=E,k.spawn=F,k["return"]=G,k.promised=H,k.dispatch=I,o.prototype.dispatch=function(a,b){var c=this,d=l();return k.nextTick(function(){c.promiseDispatch(d.resolve,a,b)}),d.promise},k.get=function(a,b){return k(a).dispatch("get",[b])},o.prototype.get=function(a){return this.dispatch("get",[a])},k.set=function(a,b,c){return k(a).dispatch("set",[b,c])},o.prototype.set=function(a,b){return this.dispatch("set",[a,b])},k.del=k["delete"]=function(a,b){return k(a).dispatch("delete",[b])},o.prototype.del=o.prototype["delete"]=function(a){return this.dispatch("delete",[a])},k.mapply=k.post=function(a,b,c){return k(a).dispatch("post",[b,c])},o.prototype.mapply=o.prototype.post=function(a,b){return this.dispatch("post",[a,b])},k.send=k.mcall=k.invoke=function(a,b){return k(a).dispatch("post",[b,X(arguments,2)])},o.prototype.send=o.prototype.mcall=o.prototype.invoke=function(a){return this.dispatch("post",[a,X(arguments,1)])},k.fapply=function(a,b){return k(a).dispatch("apply",[void 0,b])},o.prototype.fapply=function(a){return this.dispatch("apply",[void 0,a])},k["try"]=k.fcall=function(a){return k(a).dispatch("apply",[void 0,X(arguments,1)])},o.prototype.fcall=function(){return this.dispatch("apply",[void 0,X(arguments)])},k.fbind=function(a){var b=k(a),c=X(arguments,1);return function(){return b.dispatch("apply",[this,c.concat(X(arguments))])}},o.prototype.fbind=function(){var a=this,b=X(arguments);return function(){return a.dispatch("apply",[this,b.concat(X(arguments))])}},k.keys=function(a){return k(a).dispatch("keys",[])},o.prototype.keys=function(){return this.dispatch("keys",[])},k.all=J,o.prototype.all=function(){return J(this)},k.any=K,o.prototype.any=function(){return K(this)},k.allResolved=j(L,"allResolved","allSettled"),o.prototype.allResolved=function(){return L(this)},k.allSettled=M,o.prototype.allSettled=function(){return this.then(function(a){return J($(a,function(a){function b(){return a.inspect()}return a=k(a),a.then(b,b)}))})},k.fail=k["catch"]=function(a,b){return k(a).then(void 0,b)},o.prototype.fail=o.prototype["catch"]=function(a){return this.then(void 0,a)},k.progress=N,o.prototype.progress=function(a){return this.then(void 0,void 0,a)},k.fin=k["finally"]=function(a,b){return k(a)["finally"](b)},o.prototype.fin=o.prototype["finally"]=function(a){return a=k(a),this.then(function(b){return a.fcall().then(function(){return b})},function(b){return a.fcall().then(function(){throw b})})},k.done=function(a,b,c,d){return k(a).done(b,c,d)},o.prototype.done=function(a,b,c){var e=function(a){k.nextTick(function(){if(d(a,f),!k.onerror)throw a;k.onerror(a)})},f=a||b||c?this.then(a,b,c):this;"object"==typeof process&&process&&process.domain&&(e=process.domain.bind(e)),f.then(void 0,e)},k.timeout=function(a,b,c){return k(a).timeout(b,c)},o.prototype.timeout=function(a,b){var c=l(),d=setTimeout(function(){b&&"string"!=typeof b||(b=new Error(b||"Timed out after "+a+" ms"),b.code="ETIMEDOUT"),c.reject(b)},a);return this.then(function(a){clearTimeout(d),c.resolve(a)},function(a){clearTimeout(d),c.reject(a)},c.notify),c.promise},k.delay=function(a,b){return void 0===b&&(b=a,a=void 0),k(a).delay(b)},o.prototype.delay=function(a){return this.then(function(b){var c=l();return setTimeout(function(){c.resolve(b)},a),c.promise})},k.nfapply=function(a,b){return k(a).nfapply(b)},o.prototype.nfapply=function(a){var b=l(),c=X(a);return c.push(b.makeNodeResolver()),this.fapply(c).fail(b.reject),b.promise},k.nfcall=function(a){var b=X(arguments,1);return k(a).nfapply(b)},o.prototype.nfcall=function(){var a=X(arguments),b=l();return a.push(b.makeNodeResolver()),this.fapply(a).fail(b.reject),b.promise},k.nfbind=k.denodeify=function(a){var b=X(arguments,1);return function(){var c=b.concat(X(arguments)),d=l();return c.push(d.makeNodeResolver()),k(a).fapply(c).fail(d.reject),d.promise}},o.prototype.nfbind=o.prototype.denodeify=function(){var a=X(arguments);return a.unshift(this),k.denodeify.apply(void 0,a)},k.nbind=function(a,b){var c=X(arguments,2);return function(){function d(){return a.apply(b,arguments)}var e=c.concat(X(arguments)),f=l();return e.push(f.makeNodeResolver()),k(d).fapply(e).fail(f.reject),f.promise}},o.prototype.nbind=function(){var a=X(arguments,0);return a.unshift(this),k.nbind.apply(void 0,a)},k.nmapply=k.npost=function(a,b,c){return k(a).npost(b,c)},o.prototype.nmapply=o.prototype.npost=function(a,b){var c=X(b||[]),d=l();return c.push(d.makeNodeResolver()),this.dispatch("post",[a,c]).fail(d.reject),d.promise},k.nsend=k.nmcall=k.ninvoke=function(a,b){var c=X(arguments,2),d=l();return c.push(d.makeNodeResolver()),k(a).dispatch("post",[b,c]).fail(d.reject),d.promise},o.prototype.nsend=o.prototype.nmcall=o.prototype.ninvoke=function(a){var b=X(arguments,1),c=l();return b.push(c.makeNodeResolver()),this.dispatch("post",[a,b]).fail(c.reject),c.promise},k.nodeify=O,o.prototype.nodeify=function(a){return a?void this.then(function(b){k.nextTick(function(){a(null,b)})},function(b){k.nextTick(function(){a(b)})}):this};var ha=i();return k}),define("browserDetector",["require"],function(a){var b=function(a){a=a||window.navigator.userAgent,this.browser=null,this.os=null,this.osVersion=null,this.version=null,this.majorVersion=null,this.instructionSet="x86",this.device="workstation",this.cookies=!1;var b={mac:{is:function(a){return/macintosh/i.test(a)},getVersion:function(a){var b=/Mac OS X ([\d_\.]+)[;\)]/i.exec(a)[1];return b.replace(/_/g,".")}},windows:{is:function(a){return/windows/i.test(a)},getVersion:function(a){return/windows.*?([\d\.]+?)[;\)]/i.exec(a)[1]}},solaris:{is:function(a){return/sunos/i.test(a)},getVersion:function(a){return"0"}},bsd:{is:function(a){return/bsd/i.test(a)},getVersion:function(a){return 0}},linux:{is:function(a){return/linux/i.test(a)},getVersion:function(a){return"0"}}},c={firefox:{is:function(a){return/firefox/i.test(a)},getVersion:function(a){return/firefox\/(.+?)(?:\s|$)/i.exec(a)[1]},getMajorVersion:function(a){return/\d+/i.exec(a)[0]}},chrome:{is:function(a){return/chrome\//i.test(a)&&!c.edge.is(a)&&!c.opera.is(a)},getVersion:function(a){return/chrome\/(.+?)(?:\s|$)/i.exec(a)[1]},getMajorVersion:function(a){return/\d+/i.exec(a)[0]}},safari:{is:function(a){return/safari/i.test(a)&&!c.chrome.is(a)&&!c.edge.is(a)&&!c.opera.is(a)},getVersion:function(a){return/version\/(.+?)(?:\s|$)/i.exec(a)?/version\/(.+?)(?:\s|$)/i.exec(a)[1]:"6.0"},getMajorVersion:function(a){return/\d+/i.exec(a)[0]}},ie:{is:function(a){return/msie|Trident/i.test(a)},getVersion:function(a){return-1!=a.indexOf("Trident")?""+(parseFloat(/Trident\/(.+?)[\);]/i.exec(a)[1])+4)+".0":/msie (.+?);/i.exec(a)[1]},getMajorVersion:function(a){return/\d+/i.exec(a)[0]},getInstructionSet:function(a){return/x64;/i.test(a)?"x86-64":"x86"}},opera:{is:function(a){return/(Opera|OPR)\/(\d+(\.\d+)?)/i.test(a)},getVersion:function(a){return/OPR\/(.+?)(?:\s|$)/i.exec(a)[1]},getMajorVersion:function(a){return/\d+/i.exec(a)[0]}},edge:{is:function(a){return/Edge/i.test(a)},getVersion:function(a){return/Edge\/(.+?)(?:\s|$)/i.exec(a)[1]},getMajorVersion:function(a){return/\d+/i.exec(a)[0]}}},d={ipad:{is:function(a){return/ipad/i.test(a)}},ipod:{is:function(a){return/ipod/i.test(a)}},iphone:{is:function(a){return/iphone/i.test(a)}},android:{is:function(a){return/android/i.test(a)}}};for(var e in d){var f=d[e];if(f.is(a)){this.device=e;break}}for(var g in b){var h=b[g];if(h.is(a)){this.os=g,this.osVersion=h.getVersion(a);break}}for(var i in c){var j=c[i];if(j.is(a)){this.browser=i,this.version=j.getVersion(a),this.majorVersion=j.getMajorVersion(this.version),j.getInstructionSet&&(this.instructionSet=j.getInstructionSet(a));break}}this.cookies=window.navigator.cookieEnabled};return new b}),define("Logger",["underscore","my","browserDetector"],function(a,b,c){var d,e={windows:{chrome:[{screenWidth:1920,columns:267},{screenWidth:1080,columns:147}],firefox:[{screenWidth:1920,columns:271},{screenWidth:1080,columns:151}],opera:[{screenWidth:1920,columns:315},{screenWidth:1080,columns:175}],ie:[{screenWidth:1920,columns:270},{screenWidth:1080,columns:149}]},mac:{chrome:[{screenWidth:1280,columns:176},{screenWidth:1024,columns:139}],firefox:[{screenWidth:1280,columns:190},{screenWidth:1024,columns:151}],safari:[{screenWidth:1280,columns:135},{screenWidth:1024,columns:99}]}},f={chrome:" skinny.js:12345".length,firefox:"skinny.js?7211GG0 (line 12345)".length,opera:"skinny.js:12345".length,safari:"skinny.js:12345".length,ie:"LOG: ".length},g={ALL:{func:null,include:function(a){return/all/i.test(a)},exclude:null},ERROR:{func:"error",include:function(a){return/\+error/i.test(a)},exclude:function(a){return/\-error/i.test(a)}},WARN:{func:"warn",include:function(a){return/\+warn/i.test(a)},exclude:function(a){return/\-warn/i.test(a)}},INFO:{func:"info",include:function(a){return/\+info/i.test(a)},exclude:function(a){return/\-info/i.test(a)}},LOG:{func:"log",include:function(a){return/\+log/i.test(a)},exclude:function(a){return/\-log/i.test(a)}},DEBUG:{func:"debug",include:function(a){return/\+debug/i.test(a)},exclude:function(a){return/\-debug/i.test(a)}}},h=["debug","log","info","warn","error"],i=b.Class({STATIC:{TIME_FORMAT:"hh:mm:ss.SSSS"},constructor:function(){a.bindAll(this)},getCurrentLogLevel:function(){var b=this.controlLevel(),c=a(h).indexOf(b),d=c>=0?a(h).first(c):h;return["all"].concat(d.join("-")).join("-")},log:function(){this._log(arguments,g.LOG)},debug:function(){this._log(arguments,g.DEBUG)},info:function(){this._log(arguments,g.INFO)},warn:function(){this._log(arguments,g.WARN)},error:function(){this._log(arguments,g.ERROR)},isLevel:function(a){return new RegExp("level="+a,"i").test(window.location.search)},controlLevel:function(){var b=this;return a.find(h,function(a){return b.isLevel(a)})},_log:function(b,c){try{var d=new Date,e=("0"+d.getHours()).substr(-2)+":"+("0"+d.getMinutes()).substr(-2)+":"+("0"+d.getSeconds()).substr(-2)+"."+("000"+d.getMilliseconds()).substr(-4);if(b[0]="["+e+"]("+c.func.toUpperCase()+"): "+b[0],window.console&&window.console.log){window.location.search.match(/log=debug/);var f=this.getCurrentLogLevel();(g.ALL.include(f)&&!c.exclude(f)||c.include(f))&&("function"==typeof window.console[c.func]?window.console[c.func].apply(window.console,b):window.console[c.func](a(b).toArray().join(", ")))}}catch(h){}},pluginLog:function(a,b,c,e){d||require(["mediaController"],function(a){d=a});try{var f=[];f[0]=a.toUpperCase()+"  â¦ ["+b+":"+c+"]"+e[0].replace(/\s+\(/g," ("),d&&d.pluginLog(f)}catch(g){}},check:function(a){var b=g[a.toUpperCase()],c=this.controlLevel();return b?g.ALL.include(c)&&!b.exclude(c)||b.include(c):!1},prepare:function(b,d,e,g){var h=a(g).toArray();b=b.toUpperCase();var j=(new moment).format(i.TIME_FORMAT);h[0]=j+" @ "+(b+"  ").substr(0,5)+" â¦ "+h[0];var k="("+d+":"+("0000"+e).substr(-Math.max(String(e).length,3))+")";if(h.length>1)h.push(k);else{var l=h[0].length,m=Math.max(1,this.getConsoleColumns()-f[c.browser]-l-k.length-1);m=isNaN(m)?1:m;var n=new Array(m+1).join(" ");h[0]+=n+k}return h},getCurrentTime:function(a){var b=new Date,c="";switch(a){case"hh:mm:ss.SSSS":c=b.getHours()+":"+b.getMinutes()+":"+b.getSeconds()+"."+b.getMilliseconds()}return c},getConsoleColumns:function(){var a,b,d=c.browser,f=c.os,g=e[f]&&e[f][d]?e[f][d]:0,h=window.innerWidth;return g?(a=(g[0].columns-g[1].columns)/(g[0].screenWidth-g[1].screenWidth),b=g[0].columns-a*g[0].screenWidth):(a=0,b=0),Math.floor(a*h+b)}});return new i}),define("WebRTC_SDK/utilities/RTCBlueJay",["require","my.Class","underscore","Logger"],function(a){var b=a("my.Class"),c=a("underscore"),d=(a("Logger"),b.Class({STATIC:{MESSAGE_BASE:{bluejay:"1.0"}},constructor:function(a){this.messageId=0,this.METHODS={CONNECT:"connect",UPDATE:"update",ANSWER:"answer",DISCONNECT:"disconnect",KEEPALIVE:"keepalive",CANDIDATE:"candidate",MUTE:"mute",TOKEN:"token",INFO:"info",ICE:"ice"},this.TOKEN_TYPES={STATUS:"status",RELEASE:"release",TOKENINDICATION:"tokenindication",CONTENTINDICATION:"contentindication"},this.TOKEN_STATUS={GRANTED:"granted",DENIED:"denied",REVOKED:"revoked",RELEASED:"released",WAITING:"waiting_user_confirmation",CANCELLED:"cancelled"}},generateMsgId:function(){return++this.messageId},setCallid:function(a){this.callId=a},getCallId:function(){return this.callId},getRequestMessage:function(a){var b=c.extend({},d.MESSAGE_BASE,{call:this.callId,id:this.generateMsgId()},a);return b},getConnectMessage:function(a){return this.getRequestMessage({method:"connect",params:a})},getUpdateMessage:function(a){return this.getRequestMessage({method:"update",params:a})},getMuteMessage:function(a){return this.getRequestMessage({method:"mute",params:a})},requestTokenMsg:function(){return this.getRequestMessage({method:"token",params:{type:"request"}})},releaseTokenMsg:function(){return this.getRequestMessage({method:"token",params:{type:"release"}})},getIceCandidateMessage:function(a){return this.getRequestMessage({method:"ice",params:{iceCandidate:a}})},getInfoMsg:function(a){return this.getRequestMessage({method:"info",params:a})},getKeepaliveMessage:function(){return this.getRequestMessage({method:"keepalive",params:{}})},getDisconnectMessage:function(a){return this.getRequestMessage({method:"disconnect",params:a})},getSuccessResponse:function(a){return c.extend({},d.MESSAGE_BASE,{id:a,call:this.callId,result:"null"})},getErrorResponse:function(a,b){return c.extend({},d.MESSAGE_BASE,{id:a,call:this.callId,error:b})}}));return new d}),define("WebRTC_SDK/utilities/RTCUtils",["require","jquery","q","my.Class","underscore","Logger"],function(a){var b=(a("jquery"),a("q")),c=a("my.Class"),d=a("underscore"),e=a("Logger"),f=c.Class({constructor:function(){},promiseDecorator:function(a){return function(){var c=b.defer();return a.apply(this,arguments),c.resolve(),c.promise}},deepMergeObjects:function(a,b){var c=d.keys(a),e=d.keys(b),f=d.extend({},a),g=Object.prototype.toString;
return d.each(e,function(e,h,i){if(-1===d.indexOf(c,e))f[e]=b[e];else{var j=a[e],k=b[e];g.call(j)!==g.call(k)?f[e]=b[e]:"[object Object]"===g.call(j)?f[e]=this.deepMergeObjects(j,k):"[object Array]"===g.call(j)?f[e]=this.deepMergeArrays(j,k):f[e]=b[e]}},this),f},deepMergeArrays:function(a,b){var c=a,e=Object.prototype.toString;return d.each(b,function(b,f,g){if("[object Object]"!==e.call(b))c.push(b);else{var h,i,j,k=!1;i=d.keys(b),d.each(a,function(a,f,g){"[object Object]"===e.call(a)&&(h=d.keys(a),j=d.difference(h,i),j.length||(c[f]=this.deepMergeObjects(a,b),k=!0))},this),k||c.push(b)}},this),c},getLocalStreamType:function(a){var b;switch(a.bjn_label){case"local_audio_stream":b="localAudioStream";break;case"local_video_stream":b="localVideoStream";break;case"preview_stream":b="previewStream";break;case"content_stream":b="localContentStream";break;case"fake_stream":b="fakeStream";break;default:e.error("RTCUtils: Unknown stream type. Stream label: "+a.bjn_label)}return b},getRemoteStreamType:function(a){return"stream_label"===a.id?"remoteStream":"remoteContentStream"}});return new f}),!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define("socket.io-client",[],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.io=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};a[g][0].call(j.exports,function(b){var c=a[g][1][b];return e(c?c:b)},j,j.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){b.exports=a("./lib/")},{"./lib/":2}],2:[function(a,b,c){function d(a,b){"object"==typeof a&&(b=a,a=void 0),b=b||{};var c,d=e(a),f=d.source,j=d.id;return b.forceNew||b["force new connection"]||!1===b.multiplex?(h("ignoring socket cache for %s",f),c=g(f,b)):(i[j]||(h("new io instance for %s",f),i[j]=g(f,b)),c=i[j]),c.socket(d.path)}var e=a("./url"),f=a("socket.io-parser"),g=a("./manager"),h=a("debug")("socket.io-client");b.exports=c=d;var i=c.managers={};c.protocol=f.protocol,c.connect=d,c.Manager=a("./manager"),c.Socket=a("./socket")},{"./manager":3,"./socket":5,"./url":6,debug:10,"socket.io-parser":46}],3:[function(a,b,c){function d(a,b){return this instanceof d?(a&&"object"==typeof a&&(b=a,a=void 0),b=b||{},b.path=b.path||"/socket.io",this.nsps={},this.subs=[],this.opts=b,this.reconnection(b.reconnection!==!1),this.reconnectionAttempts(b.reconnectionAttempts||1/0),this.reconnectionDelay(b.reconnectionDelay||1e3),this.reconnectionDelayMax(b.reconnectionDelayMax||5e3),this.randomizationFactor(b.randomizationFactor||.5),this.backoff=new m({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==b.timeout?2e4:b.timeout),this.readyState="closed",this.uri=a,this.connected=[],this.encoding=!1,this.packetBuffer=[],this.encoder=new h.Encoder,this.decoder=new h.Decoder,this.autoConnect=b.autoConnect!==!1,void(this.autoConnect&&this.open())):new d(a,b)}var e=(a("./url"),a("engine.io-client")),f=a("./socket"),g=a("component-emitter"),h=a("socket.io-parser"),i=a("./on"),j=a("component-bind"),k=(a("object-component"),a("debug")("socket.io-client:manager")),l=a("indexof"),m=a("backo2");b.exports=d,d.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var a in this.nsps)this.nsps[a].emit.apply(this.nsps[a],arguments)},d.prototype.updateSocketIds=function(){for(var a in this.nsps)this.nsps[a].id=this.engine.id},g(d.prototype),d.prototype.reconnection=function(a){return arguments.length?(this._reconnection=!!a,this):this._reconnection},d.prototype.reconnectionAttempts=function(a){return arguments.length?(this._reconnectionAttempts=a,this):this._reconnectionAttempts},d.prototype.reconnectionDelay=function(a){return arguments.length?(this._reconnectionDelay=a,this.backoff&&this.backoff.setMin(a),this):this._reconnectionDelay},d.prototype.randomizationFactor=function(a){return arguments.length?(this._randomizationFactor=a,this.backoff&&this.backoff.setJitter(a),this):this._randomizationFactor},d.prototype.reconnectionDelayMax=function(a){return arguments.length?(this._reconnectionDelayMax=a,this.backoff&&this.backoff.setMax(a),this):this._reconnectionDelayMax},d.prototype.timeout=function(a){return arguments.length?(this._timeout=a,this):this._timeout},d.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},d.prototype.open=d.prototype.connect=function(a){if(k("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;k("opening %s",this.uri),this.engine=e(this.uri,this.opts);var b=this.engine,c=this;this.readyState="opening",this.skipReconnect=!1;var d=i(b,"open",function(){c.onopen(),a&&a()}),f=i(b,"error",function(b){if(k("connect_error"),c.cleanup(),c.readyState="closed",c.emitAll("connect_error",b),a){var d=new Error("Connection error");d.data=b,a(d)}else c.maybeReconnectOnOpen()});if(!1!==this._timeout){var g=this._timeout;k("connect attempt will timeout after %d",g);var h=setTimeout(function(){k("connect attempt timed out after %d",g),d.destroy(),b.close(),b.emit("error","timeout"),c.emitAll("connect_timeout",g)},g);this.subs.push({destroy:function(){clearTimeout(h)}})}return this.subs.push(d),this.subs.push(f),this},d.prototype.onopen=function(){k("open"),this.cleanup(),this.readyState="open",this.emit("open");var a=this.engine;this.subs.push(i(a,"data",j(this,"ondata"))),this.subs.push(i(this.decoder,"decoded",j(this,"ondecoded"))),this.subs.push(i(a,"error",j(this,"onerror"))),this.subs.push(i(a,"close",j(this,"onclose")))},d.prototype.ondata=function(a){this.decoder.add(a)},d.prototype.ondecoded=function(a){this.emit("packet",a)},d.prototype.onerror=function(a){k("error",a),this.emitAll("error",a)},d.prototype.socket=function(a){var b=this.nsps[a];if(!b){b=new f(this,a),this.nsps[a]=b;var c=this;b.on("connect",function(){b.id=c.engine.id,~l(c.connected,b)||c.connected.push(b)})}return b},d.prototype.destroy=function(a){var b=l(this.connected,a);~b&&this.connected.splice(b,1),this.connected.length||this.close()},d.prototype.packet=function(a){k("writing packet %j",a);var b=this;b.encoding?b.packetBuffer.push(a):(b.encoding=!0,this.encoder.encode(a,function(a){for(var c=0;c<a.length;c++)b.engine.write(a[c]);b.encoding=!1,b.processPacketQueue()}))},d.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var a=this.packetBuffer.shift();this.packet(a)}},d.prototype.cleanup=function(){for(var a;a=this.subs.shift();)a.destroy();this.packetBuffer=[],this.encoding=!1,this.decoder.destroy()},d.prototype.close=d.prototype.disconnect=function(){this.skipReconnect=!0,this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},d.prototype.onclose=function(a){k("close"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",a),this._reconnection&&!this.skipReconnect&&this.reconnect()},d.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var a=this;if(this.backoff.attempts>=this._reconnectionAttempts)k("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var b=this.backoff.duration();k("will wait %dms before reconnect attempt",b),this.reconnecting=!0;var c=setTimeout(function(){a.skipReconnect||(k("attempting reconnect"),a.emitAll("reconnect_attempt",a.backoff.attempts),a.emitAll("reconnecting",a.backoff.attempts),a.skipReconnect||a.open(function(b){b?(k("reconnect attempt error"),a.reconnecting=!1,a.reconnect(),a.emitAll("reconnect_error",b.data)):(k("reconnect success"),a.onreconnect())}))},b);this.subs.push({destroy:function(){clearTimeout(c)}})}},d.prototype.onreconnect=function(){var a=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",a)}},{"./on":4,"./socket":5,"./url":6,backo2:7,"component-bind":8,"component-emitter":9,debug:10,"engine.io-client":11,indexof:42,"object-component":43,"socket.io-parser":46}],4:[function(a,b,c){function d(a,b,c){return a.on(b,c),{destroy:function(){a.removeListener(b,c)}}}b.exports=d},{}],5:[function(a,b,c){function d(a,b){this.io=a,this.nsp=b,this.json=this,this.ids=0,this.acks={},this.io.autoConnect&&this.open(),this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0}var e=a("socket.io-parser"),f=a("component-emitter"),g=a("to-array"),h=a("./on"),i=a("component-bind"),j=a("debug")("socket.io-client:socket"),k=a("has-binary");b.exports=c=d;var l={connect:1,connect_error:1,connect_timeout:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1},m=f.prototype.emit;f(d.prototype),d.prototype.subEvents=function(){if(!this.subs){var a=this.io;this.subs=[h(a,"open",i(this,"onopen")),h(a,"packet",i(this,"onpacket")),h(a,"close",i(this,"onclose"))]}},d.prototype.open=d.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"==this.io.readyState&&this.onopen(),this)},d.prototype.send=function(){var a=g(arguments);return a.unshift("message"),this.emit.apply(this,a),this},d.prototype.emit=function(a){if(l.hasOwnProperty(a))return m.apply(this,arguments),this;var b=g(arguments),c=e.EVENT;k(b)&&(c=e.BINARY_EVENT);var d={type:c,data:b};return"function"==typeof b[b.length-1]&&(j("emitting packet with ack id %d",this.ids),this.acks[this.ids]=b.pop(),d.id=this.ids++),this.connected?this.packet(d):this.sendBuffer.push(d),this},d.prototype.packet=function(a){a.nsp=this.nsp,this.io.packet(a)},d.prototype.onopen=function(){j("transport is open - connecting"),"/"!=this.nsp&&this.packet({type:e.CONNECT})},d.prototype.onclose=function(a){j("close (%s)",a),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",a)},d.prototype.onpacket=function(a){if(a.nsp==this.nsp)switch(a.type){case e.CONNECT:this.onconnect();break;case e.EVENT:this.onevent(a);break;case e.BINARY_EVENT:this.onevent(a);break;case e.ACK:this.onack(a);break;case e.BINARY_ACK:this.onack(a);break;case e.DISCONNECT:this.ondisconnect();break;case e.ERROR:this.emit("error",a.data)}},d.prototype.onevent=function(a){var b=a.data||[];j("emitting event %j",b),null!=a.id&&(j("attaching ack callback to event"),b.push(this.ack(a.id))),this.connected?m.apply(this,b):this.receiveBuffer.push(b)},d.prototype.ack=function(a){var b=this,c=!1;return function(){if(!c){c=!0;var d=g(arguments);j("sending ack %j",d);var f=k(d)?e.BINARY_ACK:e.ACK;b.packet({type:f,id:a,data:d})}}},d.prototype.onack=function(a){j("calling ack %s with %j",a.id,a.data);var b=this.acks[a.id];b.apply(this,a.data),delete this.acks[a.id]},d.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},d.prototype.emitBuffered=function(){var a;for(a=0;a<this.receiveBuffer.length;a++)m.apply(this,this.receiveBuffer[a]);for(this.receiveBuffer=[],a=0;a<this.sendBuffer.length;a++)this.packet(this.sendBuffer[a]);this.sendBuffer=[]},d.prototype.ondisconnect=function(){j("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},d.prototype.destroy=function(){if(this.subs){for(var a=0;a<this.subs.length;a++)this.subs[a].destroy();this.subs=null}this.io.destroy(this)},d.prototype.close=d.prototype.disconnect=function(){return this.connected&&(j("performing disconnect (%s)",this.nsp),this.packet({type:e.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}},{"./on":4,"component-bind":8,"component-emitter":9,debug:10,"has-binary":38,"socket.io-parser":46,"to-array":50}],6:[function(a,b,c){(function(c){function d(a,b){var d=a,b=b||c.location;return null==a&&(a=b.protocol+"//"+b.host),"string"==typeof a&&("/"==a.charAt(0)&&(a="/"==a.charAt(1)?b.protocol+a:b.hostname+a),/^(https?|wss?):\/\//.test(a)||(f("protocol-less url %s",a),a="undefined"!=typeof b?b.protocol+"//"+a:"https://"+a),f("parse %s",a),d=e(a)),d.port||(/^(http|ws)$/.test(d.protocol)?d.port="80":/^(http|ws)s$/.test(d.protocol)&&(d.port="443")),d.path=d.path||"/",d.id=d.protocol+"://"+d.host+":"+d.port,d.href=d.protocol+"://"+d.host+(b&&b.port==d.port?"":":"+d.port),d}var e=a("parseuri"),f=a("debug")("socket.io-client:url");b.exports=d}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{debug:10,parseuri:44}],7:[function(a,b,c){function d(a){a=a||{},this.ms=a.min||100,this.max=a.max||1e4,this.factor=a.factor||2,this.jitter=a.jitter>0&&a.jitter<=1?a.jitter:0,this.attempts=0}b.exports=d,d.prototype.duration=function(){var a=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var b=Math.random(),c=Math.floor(b*this.jitter*a);a=0==(1&Math.floor(10*b))?a-c:a+c}return 0|Math.min(a,this.max)},d.prototype.reset=function(){this.attempts=0},d.prototype.setMin=function(a){this.ms=a},d.prototype.setMax=function(a){this.max=a},d.prototype.setJitter=function(a){this.jitter=a}},{}],8:[function(a,b,c){var d=[].slice;b.exports=function(a,b){if("string"==typeof b&&(b=a[b]),"function"!=typeof b)throw new Error("bind() requires a function");var c=d.call(arguments,2);return function(){return b.apply(a,c.concat(d.call(arguments)))}}},{}],9:[function(a,b,c){function d(a){return a?e(a):void 0}function e(a){for(var b in d.prototype)a[b]=d.prototype[b];return a}b.exports=d,d.prototype.on=d.prototype.addEventListener=function(a,b){return this._callbacks=this._callbacks||{},(this._callbacks[a]=this._callbacks[a]||[]).push(b),this},d.prototype.once=function(a,b){function c(){d.off(a,c),b.apply(this,arguments)}var d=this;return this._callbacks=this._callbacks||{},c.fn=b,this.on(a,c),this},d.prototype.off=d.prototype.removeListener=d.prototype.removeAllListeners=d.prototype.removeEventListener=function(a,b){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var c=this._callbacks[a];if(!c)return this;if(1==arguments.length)return delete this._callbacks[a],this;for(var d,e=0;e<c.length;e++)if(d=c[e],d===b||d.fn===b){c.splice(e,1);break}return this},d.prototype.emit=function(a){this._callbacks=this._callbacks||{};var b=[].slice.call(arguments,1),c=this._callbacks[a];if(c){c=c.slice(0);for(var d=0,e=c.length;e>d;++d)c[d].apply(this,b)}return this},d.prototype.listeners=function(a){return this._callbacks=this._callbacks||{},this._callbacks[a]||[]},d.prototype.hasListeners=function(a){return!!this.listeners(a).length}},{}],10:[function(a,b,c){function d(a){return d.enabled(a)?function(b){b=e(b);var c=new Date,f=c-(d[a]||c);d[a]=c,b=a+" "+b+" +"+d.humanize(f),window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}function e(a){return a instanceof Error?a.stack||a.message:a}b.exports=d,d.names=[],d.skips=[],d.enable=function(a){try{localStorage.debug=a}catch(b){}for(var c=(a||"").split(/[\s,]+/),e=c.length,f=0;e>f;f++)a=c[f].replace("*",".*?"),"-"===a[0]?d.skips.push(new RegExp("^"+a.substr(1)+"$")):d.names.push(new RegExp("^"+a+"$"))},d.disable=function(){d.enable("")},d.humanize=function(a){var b=1e3,c=6e4,d=60*c;return a>=d?(a/d).toFixed(1)+"h":a>=c?(a/c).toFixed(1)+"m":a>=b?(a/b|0)+"s":a+"ms"},d.enabled=function(a){for(var b=0,c=d.skips.length;c>b;b++)if(d.skips[b].test(a))return!1;for(var b=0,c=d.names.length;c>b;b++)if(d.names[b].test(a))return!0;return!1};try{window.localStorage&&d.enable(localStorage.debug)}catch(f){}},{}],11:[function(a,b,c){b.exports=a("./lib/")},{"./lib/":12}],12:[function(a,b,c){b.exports=a("./socket"),b.exports.parser=a("engine.io-parser")},{"./socket":13,"engine.io-parser":25}],13:[function(a,b,c){(function(c){function d(a,b){if(!(this instanceof d))return new d(a,b);if(b=b||{},a&&"object"==typeof a&&(b=a,a=null),a&&(a=k(a),b.host=a.host,b.secure="https"==a.protocol||"wss"==a.protocol,b.port=a.port,a.query&&(b.query=a.query)),this.secure=null!=b.secure?b.secure:c.location&&"https:"==location.protocol,b.host){var e=b.host.split(":");b.hostname=e.shift(),e.length?b.port=e.pop():b.port||(b.port=this.secure?"443":"80")}this.agent=b.agent||!1,this.hostname=b.hostname||(c.location?location.hostname:"localhost"),this.port=b.port||(c.location&&location.port?location.port:this.secure?443:80),this.query=b.query||{},"string"==typeof this.query&&(this.query=m.decode(this.query)),this.upgrade=!1!==b.upgrade,this.path=(b.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!b.forceJSONP,this.jsonp=!1!==b.jsonp,this.forceBase64=!!b.forceBase64,this.enablesXDR=!!b.enablesXDR,this.timestampParam=b.timestampParam||"t",this.timestampRequests=b.timestampRequests,this.transports=b.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.callbackBuffer=[],this.policyPort=b.policyPort||843,this.rememberUpgrade=b.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=b.onlyBinaryUpgrades,this.pfx=b.pfx||null,this.key=b.key||null,this.passphrase=b.passphrase||null,this.cert=b.cert||null,this.ca=b.ca||null,this.ciphers=b.ciphers||null,this.rejectUnauthorized=b.rejectUnauthorized||null,this.open()}function e(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}var f=a("./transports"),g=a("component-emitter"),h=a("debug")("engine.io-client:socket"),i=a("indexof"),j=a("engine.io-parser"),k=a("parseuri"),l=a("parsejson"),m=a("parseqs");b.exports=d,d.priorWebsocketSuccess=!1,g(d.prototype),d.protocol=j.protocol,d.Socket=d,d.Transport=a("./transport"),d.transports=a("./transports"),d.parser=a("engine.io-parser"),d.prototype.createTransport=function(a){h('creating transport "%s"',a);var b=e(this.query);b.EIO=j.protocol,b.transport=a,this.id&&(b.sid=this.id);var c=new f[a]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:b,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized});return c},d.prototype.open=function(){var a;if(this.rememberUpgrade&&d.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket"))a="websocket";else{if(0==this.transports.length){var b=this;return void setTimeout(function(){b.emit("error","No transports available")},0)}a=this.transports[0]}this.readyState="opening";var a;try{a=this.createTransport(a)}catch(c){return this.transports.shift(),void this.open()}a.open(),this.setTransport(a)},d.prototype.setTransport=function(a){h("setting transport %s",a.name);var b=this;this.transport&&(h("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=a,a.on("drain",function(){b.onDrain()}).on("packet",function(a){b.onPacket(a)}).on("error",function(a){b.onError(a)}).on("close",function(){b.onClose("transport close")})},d.prototype.probe=function(a){function b(){if(m.onlyBinaryUpgrades){var b=!this.supportsBinary&&m.transport.supportsBinary;l=l||b}l||(h('probe transport "%s" opened',a),k.send([{type:"ping",data:"probe"}]),k.once("packet",function(b){if(!l)if("pong"==b.type&&"probe"==b.data){if(h('probe transport "%s" pong',a),m.upgrading=!0,m.emit("upgrading",k),!k)return;d.priorWebsocketSuccess="websocket"==k.name,h('pausing current transport "%s"',m.transport.name),m.transport.pause(function(){l||"closed"!=m.readyState&&(h("changing transport and sending upgrade packet"),j(),m.setTransport(k),k.send([{type:"upgrade"}]),m.emit("upgrade",k),k=null,m.upgrading=!1,m.flush())})}else{h('probe transport "%s" failed',a);var c=new Error("probe error");c.transport=k.name,m.emit("upgradeError",c)}}))}function c(){l||(l=!0,j(),k.close(),k=null)}function e(b){var d=new Error("probe error: "+b);d.transport=k.name,c(),h('probe transport "%s" failed because of error: %s',a,b),m.emit("upgradeError",d)}function f(){e("transport closed")}function g(){e("socket closed")}function i(a){k&&a.name!=k.name&&(h('"%s" works - aborting "%s"',a.name,k.name),c())}function j(){k.removeListener("open",b),k.removeListener("error",e),k.removeListener("close",f),m.removeListener("close",g),m.removeListener("upgrading",i)}h('probing transport "%s"',a);var k=this.createTransport(a,{probe:1}),l=!1,m=this;d.priorWebsocketSuccess=!1,k.once("open",b),k.once("error",e),k.once("close",f),this.once("close",g),this.once("upgrading",i),k.open()},d.prototype.onOpen=function(){if(h("socket open"),this.readyState="open",d.priorWebsocketSuccess="websocket"==this.transport.name,this.emit("open"),this.flush(),"open"==this.readyState&&this.upgrade&&this.transport.pause){h("starting upgrade probes");for(var a=0,b=this.upgrades.length;b>a;a++)this.probe(this.upgrades[a])}},d.prototype.onPacket=function(a){if("opening"==this.readyState||"open"==this.readyState)switch(h('socket receive: type "%s", data "%s"',a.type,a.data),this.emit("packet",a),this.emit("heartbeat"),a.type){case"open":this.onHandshake(l(a.data));break;case"pong":this.setPing();break;case"error":var b=new Error("server error");b.code=a.data,this.emit("error",b);break;case"message":this.emit("data",a.data),this.emit("message",a.data)}else h('packet received with socket readyState "%s"',this.readyState)},d.prototype.onHandshake=function(a){this.emit("handshake",a),this.id=a.sid,this.transport.query.sid=a.sid,this.upgrades=this.filterUpgrades(a.upgrades),this.pingInterval=a.pingInterval,this.pingTimeout=a.pingTimeout,this.onOpen(),"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},d.prototype.onHeartbeat=function(a){clearTimeout(this.pingTimeoutTimer);var b=this;b.pingTimeoutTimer=setTimeout(function(){"closed"!=b.readyState&&b.onClose("ping timeout")},a||b.pingInterval+b.pingTimeout)},d.prototype.setPing=function(){var a=this;clearTimeout(a.pingIntervalTimer),a.pingIntervalTimer=setTimeout(function(){h("writing ping packet - expecting pong within %sms",a.pingTimeout),a.ping(),a.onHeartbeat(a.pingTimeout)},a.pingInterval)},d.prototype.ping=function(){this.sendPacket("ping")},d.prototype.onDrain=function(){for(var a=0;a<this.prevBufferLen;a++)this.callbackBuffer[a]&&this.callbackBuffer[a]();this.writeBuffer.splice(0,this.prevBufferLen),this.callbackBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0==this.writeBuffer.length?this.emit("drain"):this.flush()},d.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(h("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},d.prototype.write=d.prototype.send=function(a,b){return this.sendPacket("message",a,b),this},d.prototype.sendPacket=function(a,b,c){if("closing"!=this.readyState&&"closed"!=this.readyState){var d={type:a,data:b};this.emit("packetCreate",d),this.writeBuffer.push(d),this.callbackBuffer.push(c),this.flush()}},d.prototype.close=function(){function a(){d.onClose("forced close"),h("socket closing - telling transport to close"),d.transport.close()}function b(){d.removeListener("upgrade",b),d.removeListener("upgradeError",b),a()}function c(){d.once("upgrade",b),d.once("upgradeError",b)}if("opening"==this.readyState||"open"==this.readyState){this.readyState="closing";var d=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?c():a()}):this.upgrading?c():a()}return this},d.prototype.onError=function(a){h("socket error %j",a),d.priorWebsocketSuccess=!1,this.emit("error",a),this.onClose("transport error",a)},d.prototype.onClose=function(a,b){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){h('socket close with reason: "%s"',a);var c=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),setTimeout(function(){c.writeBuffer=[],c.callbackBuffer=[],c.prevBufferLen=0},0),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",a,b)}},d.prototype.filterUpgrades=function(a){for(var b=[],c=0,d=a.length;d>c;c++)~i(this.transports,a[c])&&b.push(a[c]);return b}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./transport":14,"./transports":15,"component-emitter":9,debug:22,"engine.io-parser":25,indexof:42,parsejson:34,parseqs:35,parseuri:36}],14:[function(a,b,c){function d(a){this.path=a.path,this.hostname=a.hostname,this.port=a.port,this.secure=a.secure,this.query=a.query,this.timestampParam=a.timestampParam,this.timestampRequests=a.timestampRequests,this.readyState="",this.agent=a.agent||!1,this.socket=a.socket,this.enablesXDR=a.enablesXDR,this.pfx=a.pfx,this.key=a.key,this.passphrase=a.passphrase,this.cert=a.cert,this.ca=a.ca,this.ciphers=a.ciphers,this.rejectUnauthorized=a.rejectUnauthorized}var e=a("engine.io-parser"),f=a("component-emitter");b.exports=d,f(d.prototype),d.timestamps=0,d.prototype.onError=function(a,b){var c=new Error(a);return c.type="TransportError",c.description=b,this.emit("error",c),this},d.prototype.open=function(){return("closed"==this.readyState||""==this.readyState)&&(this.readyState="opening",this.doOpen()),this},d.prototype.close=function(){return("opening"==this.readyState||"open"==this.readyState)&&(this.doClose(),this.onClose()),this},d.prototype.send=function(a){if("open"!=this.readyState)throw new Error("Transport not open");this.write(a)},d.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},d.prototype.onData=function(a){var b=e.decodePacket(a,this.socket.binaryType);this.onPacket(b)},d.prototype.onPacket=function(a){this.emit("packet",a)},d.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},{"component-emitter":9,"engine.io-parser":25}],15:[function(a,b,c){(function(b){function d(a){var c,d=!1,h=!1,i=!1!==a.jsonp;if(b.location){var j="https:"==location.protocol,k=location.port;k||(k=j?443:80),d=a.hostname!=location.hostname||k!=a.port,h=a.secure!=j}if(a.xdomain=d,a.xscheme=h,c=new e(a),"open"in c&&!a.forceJSONP)return new f(a);if(!i)throw new Error("JSONP disabled");return new g(a)}var e=a("xmlhttprequest"),f=a("./polling-xhr"),g=a("./polling-jsonp"),h=a("./websocket");c.polling=d,c.websocket=h}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling-jsonp":16,"./polling-xhr":17,"./websocket":19,xmlhttprequest:20}],16:[function(a,b,c){(function(c){function d(){}function e(a){f.call(this,a),this.query=this.query||{},h||(c.___eio||(c.___eio=[]),h=c.___eio),this.index=h.length;var b=this;h.push(function(a){b.onData(a)}),this.query.j=this.index,c.document&&c.addEventListener&&c.addEventListener("beforeunload",function(){b.script&&(b.script.onerror=d)},!1)}var f=a("./polling"),g=a("component-inherit");b.exports=e;var h,i=/\n/g,j=/\\n/g;g(e,f),e.prototype.supportsBinary=!1,e.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),f.prototype.doClose.call(this)},e.prototype.doPoll=function(){var a=this,b=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),b.async=!0,b.src=this.uri(),b.onerror=function(b){a.onError("jsonp poll error",b)};var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c),this.script=b;var d="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent);d&&setTimeout(function(){var a=document.createElement("iframe");document.body.appendChild(a),document.body.removeChild(a)},100)},e.prototype.doWrite=function(a,b){function c(){d(),b()}function d(){if(e.iframe)try{e.form.removeChild(e.iframe)}catch(a){e.onError("jsonp polling iframe removal error",a)}try{var b='<iframe src="javascript:0" name="'+e.iframeId+'">';f=document.createElement(b)}catch(a){f=document.createElement("iframe"),f.name=e.iframeId,f.src="javascript:0"}f.id=e.iframeId,e.form.appendChild(f),e.iframe=f}var e=this;if(!this.form){var f,g=document.createElement("form"),h=document.createElement("textarea"),k=this.iframeId="eio_iframe_"+this.index;g.className="socketio",g.style.position="absolute",g.style.top="-1000px",g.style.left="-1000px",g.target=k,g.method="POST",g.setAttribute("accept-charset","utf-8"),h.name="d",g.appendChild(h),document.body.appendChild(g),this.form=g,this.area=h}this.form.action=this.uri(),d(),a=a.replace(j,"\\\n"),this.area.value=a.replace(i,"\\n");try{this.form.submit()}catch(l){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==e.iframe.readyState&&c()}:this.iframe.onload=c}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling":18,"component-inherit":21}],17:[function(a,b,c){(function(c){function d(){}function e(a){if(i.call(this,a),c.location){var b="https:"==location.protocol,d=location.port;d||(d=b?443:80),this.xd=a.hostname!=c.location.hostname||d!=a.port,this.xs=a.secure!=b}}function f(a){this.method=a.method||"GET",this.uri=a.uri,this.xd=!!a.xd,this.xs=!!a.xs,this.async=!1!==a.async,this.data=void 0!=a.data?a.data:null,this.agent=a.agent,this.isBinary=a.isBinary,this.supportsBinary=a.supportsBinary,this.enablesXDR=a.enablesXDR,this.pfx=a.pfx,this.key=a.key,this.passphrase=a.passphrase,this.cert=a.cert,this.ca=a.ca,this.ciphers=a.ciphers,this.rejectUnauthorized=a.rejectUnauthorized,this.create()}function g(){for(var a in f.requests)f.requests.hasOwnProperty(a)&&f.requests[a].abort()}var h=a("xmlhttprequest"),i=a("./polling"),j=a("component-emitter"),k=a("component-inherit"),l=a("debug")("engine.io-client:polling-xhr");b.exports=e,b.exports.Request=f,k(e,i),e.prototype.supportsBinary=!0,e.prototype.request=function(a){return a=a||{},a.uri=this.uri(),a.xd=this.xd,a.xs=this.xs,a.agent=this.agent||!1,a.supportsBinary=this.supportsBinary,a.enablesXDR=this.enablesXDR,a.pfx=this.pfx,a.key=this.key,a.passphrase=this.passphrase,a.cert=this.cert,a.ca=this.ca,a.ciphers=this.ciphers,a.rejectUnauthorized=this.rejectUnauthorized,new f(a)},e.prototype.doWrite=function(a,b){var c="string"!=typeof a&&void 0!==a,d=this.request({method:"POST",data:a,isBinary:c}),e=this;d.on("success",b),d.on("error",function(a){e.onError("xhr post error",a)}),this.sendXhr=d},e.prototype.doPoll=function(){l("xhr poll");var a=this.request(),b=this;a.on("data",function(a){b.onData(a)}),a.on("error",function(a){b.onError("xhr poll error",a)}),this.pollXhr=a},j(f.prototype),f.prototype.create=function(){var a={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};a.pfx=this.pfx,a.key=this.key,a.passphrase=this.passphrase,a.cert=this.cert,a.ca=this.ca,a.ciphers=this.ciphers,a.rejectUnauthorized=this.rejectUnauthorized;var b=this.xhr=new h(a),d=this;try{if(l("xhr open %s: %s",this.method,this.uri),b.open(this.method,this.uri,this.async),this.supportsBinary&&(b.responseType="arraybuffer"),"POST"==this.method)try{this.isBinary?b.setRequestHeader("Content-type","application/octet-stream"):b.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}"withCredentials"in b&&(b.withCredentials=!0),this.hasXDR()?(b.onload=function(){d.onLoad()},b.onerror=function(){d.onError(b.responseText)}):b.onreadystatechange=function(){4==b.readyState&&(200==b.status||1223==b.status?d.onLoad():setTimeout(function(){d.onError(b.status)},0))},l("xhr data %s",this.data),b.send(this.data)}catch(e){return void setTimeout(function(){d.onError(e)},0)}c.document&&(this.index=f.requestsCount++,f.requests[this.index]=this)},f.prototype.onSuccess=function(){
this.emit("success"),this.cleanup()},f.prototype.onData=function(a){this.emit("data",a),this.onSuccess()},f.prototype.onError=function(a){this.emit("error",a),this.cleanup(!0)},f.prototype.cleanup=function(a){if("undefined"!=typeof this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=d:this.xhr.onreadystatechange=d,a)try{this.xhr.abort()}catch(b){}c.document&&delete f.requests[this.index],this.xhr=null}},f.prototype.onLoad=function(){var a;try{var b;try{b=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(c){}a="application/octet-stream"===b?this.xhr.response:this.supportsBinary?"ok":this.xhr.responseText}catch(c){this.onError(c)}null!=a&&this.onData(a)},f.prototype.hasXDR=function(){return"undefined"!=typeof c.XDomainRequest&&!this.xs&&this.enablesXDR},f.prototype.abort=function(){this.cleanup()},c.document&&(f.requestsCount=0,f.requests={},c.attachEvent?c.attachEvent("onunload",g):c.addEventListener&&c.addEventListener("beforeunload",g,!1))}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling":18,"component-emitter":9,"component-inherit":21,debug:22,xmlhttprequest:20}],18:[function(a,b,c){function d(a){var b=a&&a.forceBase64;(!j||b)&&(this.supportsBinary=!1),e.call(this,a)}var e=a("../transport"),f=a("parseqs"),g=a("engine.io-parser"),h=a("component-inherit"),i=a("debug")("engine.io-client:polling");b.exports=d;var j=function(){var b=a("xmlhttprequest"),c=new b({xdomain:!1});return null!=c.responseType}();h(d,e),d.prototype.name="polling",d.prototype.doOpen=function(){this.poll()},d.prototype.pause=function(a){function b(){i("paused"),c.readyState="paused",a()}var c=this;if(this.readyState="pausing",this.polling||!this.writable){var d=0;this.polling&&(i("we are currently polling - waiting to pause"),d++,this.once("pollComplete",function(){i("pre-pause polling complete"),--d||b()})),this.writable||(i("we are currently writing - waiting to pause"),d++,this.once("drain",function(){i("pre-pause writing complete"),--d||b()}))}else b()},d.prototype.poll=function(){i("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},d.prototype.onData=function(a){var b=this;i("polling got data %s",a);var c=function(a,c,d){return"opening"==b.readyState&&b.onOpen(),"close"==a.type?(b.onClose(),!1):void b.onPacket(a)};g.decodePayload(a,this.socket.binaryType,c),"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():i('ignoring poll - transport state "%s"',this.readyState))},d.prototype.doClose=function(){function a(){i("writing close packet"),b.write([{type:"close"}])}var b=this;"open"==this.readyState?(i("transport open - closing"),a()):(i("transport not open - deferring close"),this.once("open",a))},d.prototype.write=function(a){var b=this;this.writable=!1;var c=function(){b.writable=!0,b.emit("drain")},b=this;g.encodePayload(a,this.supportsBinary,function(a){b.doWrite(a,c)})},d.prototype.uri=function(){var a=this.query||{},b=this.secure?"https":"http",c="";return!1!==this.timestampRequests&&(a[this.timestampParam]=+new Date+"-"+e.timestamps++),this.supportsBinary||a.sid||(a.b64=1),a=f.encode(a),this.port&&("https"==b&&443!=this.port||"http"==b&&80!=this.port)&&(c=":"+this.port),a.length&&(a="?"+a),b+"://"+this.hostname+c+this.path+a}},{"../transport":14,"component-inherit":21,debug:22,"engine.io-parser":25,parseqs:35,xmlhttprequest:20}],19:[function(a,b,c){function d(a){var b=a&&a.forceBase64;b&&(this.supportsBinary=!1),e.call(this,a)}var e=a("../transport"),f=a("engine.io-parser"),g=a("parseqs"),h=a("component-inherit"),i=a("debug")("engine.io-client:websocket"),j=a("ws");b.exports=d,h(d,e),d.prototype.name="websocket",d.prototype.supportsBinary=!0,d.prototype.doOpen=function(){if(this.check()){var a=this.uri(),b=void 0,c={agent:this.agent};c.pfx=this.pfx,c.key=this.key,c.passphrase=this.passphrase,c.cert=this.cert,c.ca=this.ca,c.ciphers=this.ciphers,c.rejectUnauthorized=this.rejectUnauthorized,this.ws=new j(a,b,c),void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.binaryType="arraybuffer",this.addEventListeners()}},d.prototype.addEventListeners=function(){var a=this;this.ws.onopen=function(){a.onOpen()},this.ws.onclose=function(){a.onClose()},this.ws.onmessage=function(b){a.onData(b.data)},this.ws.onerror=function(b){a.onError("websocket error",b)}},"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(d.prototype.onData=function(a){var b=this;setTimeout(function(){e.prototype.onData.call(b,a)},0)}),d.prototype.write=function(a){function b(){c.writable=!0,c.emit("drain")}var c=this;this.writable=!1;for(var d=0,e=a.length;e>d;d++)f.encodePacket(a[d],this.supportsBinary,function(a){try{c.ws.send(a)}catch(b){i("websocket closed before onclose event")}});setTimeout(b,0)},d.prototype.onClose=function(){e.prototype.onClose.call(this)},d.prototype.doClose=function(){"undefined"!=typeof this.ws&&this.ws.close()},d.prototype.uri=function(){var a=this.query||{},b=this.secure?"wss":"ws",c="";return this.port&&("wss"==b&&443!=this.port||"ws"==b&&80!=this.port)&&(c=":"+this.port),this.timestampRequests&&(a[this.timestampParam]=+new Date),this.supportsBinary||(a.b64=1),a=g.encode(a),a.length&&(a="?"+a),b+"://"+this.hostname+c+this.path+a},d.prototype.check=function(){return!(!j||"__initialize"in j&&this.name===d.prototype.name)}},{"../transport":14,"component-inherit":21,debug:22,"engine.io-parser":25,parseqs:35,ws:37}],20:[function(a,b,c){var d=a("has-cors");b.exports=function(a){var b=a.xdomain,c=a.xscheme,e=a.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!b||d))return new XMLHttpRequest}catch(f){}try{if("undefined"!=typeof XDomainRequest&&!c&&e)return new XDomainRequest}catch(f){}if(!b)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(f){}}},{"has-cors":40}],21:[function(a,b,c){b.exports=function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],22:[function(a,b,c){function d(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function e(){var a=arguments,b=this.useColors;if(a[0]=(b?"%c":"")+this.namespace+(b?" %c":" ")+a[0]+(b?"%c ":" ")+"+"+c.humanize(this.diff),!b)return a;var d="color: "+this.color;a=[a[0],d,"color: inherit"].concat(Array.prototype.slice.call(a,1));var e=0,f=0;return a[0].replace(/%[a-z%]/g,function(a){"%"!==a&&(e++,"%c"===a&&(f=e))}),a.splice(f,0,d),a}function f(){return"object"==typeof console&&"function"==typeof console.log&&Function.prototype.apply.call(console.log,console,arguments)}function g(a){try{null==a?localStorage.removeItem("debug"):localStorage.debug=a}catch(b){}}function h(){var a;try{a=localStorage.debug}catch(b){}return a}c=b.exports=a("./debug"),c.log=f,c.formatArgs=e,c.save=g,c.load=h,c.useColors=d,c.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],c.formatters.j=function(a){return JSON.stringify(a)},c.enable(h())},{"./debug":23}],23:[function(a,b,c){function d(){return c.colors[k++%c.colors.length]}function e(a){function b(){}function e(){var a=e,b=+new Date,f=b-(j||b);a.diff=f,a.prev=j,a.curr=b,j=b,null==a.useColors&&(a.useColors=c.useColors()),null==a.color&&a.useColors&&(a.color=d());var g=Array.prototype.slice.call(arguments);g[0]=c.coerce(g[0]),"string"!=typeof g[0]&&(g=["%o"].concat(g));var h=0;g[0]=g[0].replace(/%([a-z%])/g,function(b,d){if("%"===b)return b;h++;var e=c.formatters[d];if("function"==typeof e){var f=g[h];b=e.call(a,f),g.splice(h,1),h--}return b}),"function"==typeof c.formatArgs&&(g=c.formatArgs.apply(a,g));var i=e.log||c.log||void 0;i.apply(a,g)}b.enabled=!1,e.enabled=!0;var f=c.enabled(a)?e:b;return f.namespace=a,f}function f(a){c.save(a);for(var b=(a||"").split(/[\s,]+/),d=b.length,e=0;d>e;e++)b[e]&&(a=b[e].replace(/\*/g,".*?"),"-"===a[0]?c.skips.push(new RegExp("^"+a.substr(1)+"$")):c.names.push(new RegExp("^"+a+"$")))}function g(){c.enable("")}function h(a){var b,d;for(b=0,d=c.skips.length;d>b;b++)if(c.skips[b].test(a))return!1;for(b=0,d=c.names.length;d>b;b++)if(c.names[b].test(a))return!0;return!1}function i(a){return a instanceof Error?a.stack||a.message:a}c=b.exports=e,c.coerce=i,c.disable=g,c.enable=f,c.enabled=h,c.humanize=a("ms"),c.names=[],c.skips=[],c.formatters={};var j,k=0},{ms:24}],24:[function(a,b,c){function d(a){var b=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(a);if(b){var c=parseFloat(b[1]),d=(b[2]||"ms").toLowerCase();switch(d){case"years":case"year":case"y":return c*l;case"days":case"day":case"d":return c*k;case"hours":case"hour":case"h":return c*j;case"minutes":case"minute":case"m":return c*i;case"seconds":case"second":case"s":return c*h;case"ms":return c}}}function e(a){return a>=k?Math.round(a/k)+"d":a>=j?Math.round(a/j)+"h":a>=i?Math.round(a/i)+"m":a>=h?Math.round(a/h)+"s":a+"ms"}function f(a){return g(a,k,"day")||g(a,j,"hour")||g(a,i,"minute")||g(a,h,"second")||a+" ms"}function g(a,b,c){return b>a?void 0:1.5*b>a?Math.floor(a/b)+" "+c:Math.ceil(a/b)+" "+c+"s"}var h=1e3,i=60*h,j=60*i,k=24*j,l=365.25*k;b.exports=function(a,b){return b=b||{},"string"==typeof a?d(a):b["long"]?f(a):e(a)}},{}],25:[function(a,b,c){(function(b){function d(a,b){var d="b"+c.packets[a.type]+a.data.data;return b(d)}function e(a,b,d){if(!b)return c.encodeBase64Packet(a,d);var e=a.data,f=new Uint8Array(e),g=new Uint8Array(1+e.byteLength);g[0]=r[a.type];for(var h=0;h<f.length;h++)g[h+1]=f[h];return d(g.buffer)}function f(a,b,d){if(!b)return c.encodeBase64Packet(a,d);var e=new FileReader;return e.onload=function(){a.data=e.result,c.encodePacket(a,b,!0,d)},e.readAsArrayBuffer(a.data)}function g(a,b,d){if(!b)return c.encodeBase64Packet(a,d);if(q)return f(a,b,d);var e=new Uint8Array(1);e[0]=r[a.type];var g=new u([e.buffer,a.data]);return d(g)}function h(a,b,c){for(var d=new Array(a.length),e=m(a.length,c),f=function(a,c,e){b(c,function(b,c){d[a]=c,e(b,d)})},g=0;g<a.length;g++)f(g,a[g],e)}var i=a("./keys"),j=a("has-binary"),k=a("arraybuffer.slice"),l=a("base64-arraybuffer"),m=a("after"),n=a("utf8"),o=navigator.userAgent.match(/Android/i),p=/PhantomJS/i.test(navigator.userAgent),q=o||p;c.protocol=3;var r=c.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},s=i(r),t={type:"error",data:"parser error"},u=a("blob");c.encodePacket=function(a,c,f,h){"function"==typeof c&&(h=c,c=!1),"function"==typeof f&&(h=f,f=null);var i=void 0===a.data?void 0:a.data.buffer||a.data;if(b.ArrayBuffer&&i instanceof ArrayBuffer)return e(a,c,h);if(u&&i instanceof b.Blob)return g(a,c,h);if(i&&i.base64)return d(a,h);var j=r[a.type];return void 0!==a.data&&(j+=f?n.encode(String(a.data)):String(a.data)),h(""+j)},c.encodeBase64Packet=function(a,d){var e="b"+c.packets[a.type];if(u&&a.data instanceof u){var f=new FileReader;return f.onload=function(){var a=f.result.split(",")[1];d(e+a)},f.readAsDataURL(a.data)}var g;try{g=String.fromCharCode.apply(null,new Uint8Array(a.data))}catch(h){for(var i=new Uint8Array(a.data),j=new Array(i.length),k=0;k<i.length;k++)j[k]=i[k];g=String.fromCharCode.apply(null,j)}return e+=b.btoa(g),d(e)},c.decodePacket=function(a,b,d){if("string"==typeof a||void 0===a){if("b"==a.charAt(0))return c.decodeBase64Packet(a.substr(1),b);if(d)try{a=n.decode(a)}catch(e){return t}var f=a.charAt(0);return Number(f)==f&&s[f]?a.length>1?{type:s[f],data:a.substring(1)}:{type:s[f]}:t}var g=new Uint8Array(a),f=g[0],h=k(a,1);return u&&"blob"===b&&(h=new u([h])),{type:s[f],data:h}},c.decodeBase64Packet=function(a,c){var d=s[a.charAt(0)];if(!b.ArrayBuffer)return{type:d,data:{base64:!0,data:a.substr(1)}};var e=l.decode(a.substr(1));return"blob"===c&&u&&(e=new u([e])),{type:d,data:e}},c.encodePayload=function(a,b,d){function e(a){return a.length+":"+a}function f(a,d){c.encodePacket(a,g?b:!1,!0,function(a){d(null,e(a))})}"function"==typeof b&&(d=b,b=null);var g=j(a);return b&&g?u&&!q?c.encodePayloadAsBlob(a,d):c.encodePayloadAsArrayBuffer(a,d):a.length?void h(a,f,function(a,b){return d(b.join(""))}):d("0:")},c.decodePayload=function(a,b,d){if("string"!=typeof a)return c.decodePayloadAsBinary(a,b,d);"function"==typeof b&&(d=b,b=null);var e;if(""==a)return d(t,0,1);for(var f,g,h="",i=0,j=a.length;j>i;i++){var k=a.charAt(i);if(":"!=k)h+=k;else{if(""==h||h!=(f=Number(h)))return d(t,0,1);if(g=a.substr(i+1,f),h!=g.length)return d(t,0,1);if(g.length){if(e=c.decodePacket(g,b,!0),t.type==e.type&&t.data==e.data)return d(t,0,1);var l=d(e,i+f,j);if(!1===l)return}i+=f,h=""}}return""!=h?d(t,0,1):void 0},c.encodePayloadAsArrayBuffer=function(a,b){function d(a,b){c.encodePacket(a,!0,!0,function(a){return b(null,a)})}return a.length?void h(a,d,function(a,c){var d=c.reduce(function(a,b){var c;return c="string"==typeof b?b.length:b.byteLength,a+c.toString().length+c+2},0),e=new Uint8Array(d),f=0;return c.forEach(function(a){var b="string"==typeof a,c=a;if(b){for(var d=new Uint8Array(a.length),g=0;g<a.length;g++)d[g]=a.charCodeAt(g);c=d.buffer}b?e[f++]=0:e[f++]=1;for(var h=c.byteLength.toString(),g=0;g<h.length;g++)e[f++]=parseInt(h[g]);e[f++]=255;for(var d=new Uint8Array(c),g=0;g<d.length;g++)e[f++]=d[g]}),b(e.buffer)}):b(new ArrayBuffer(0))},c.encodePayloadAsBlob=function(a,b){function d(a,b){c.encodePacket(a,!0,!0,function(a){var c=new Uint8Array(1);if(c[0]=1,"string"==typeof a){for(var d=new Uint8Array(a.length),e=0;e<a.length;e++)d[e]=a.charCodeAt(e);a=d.buffer,c[0]=0}for(var f=a instanceof ArrayBuffer?a.byteLength:a.size,g=f.toString(),h=new Uint8Array(g.length+1),e=0;e<g.length;e++)h[e]=parseInt(g[e]);if(h[g.length]=255,u){var i=new u([c.buffer,h.buffer,a]);b(null,i)}})}h(a,d,function(a,c){return b(new u(c))})},c.decodePayloadAsBinary=function(a,b,d){"function"==typeof b&&(d=b,b=null);for(var e=a,f=[],g=!1;e.byteLength>0;){for(var h=new Uint8Array(e),i=0===h[0],j="",l=1;255!=h[l];l++){if(j.length>310){g=!0;break}j+=h[l]}if(g)return d(t,0,1);e=k(e,2+j.length),j=parseInt(j);var m=k(e,0,j);if(i)try{m=String.fromCharCode.apply(null,new Uint8Array(m))}catch(n){var o=new Uint8Array(m);m="";for(var l=0;l<o.length;l++)m+=String.fromCharCode(o[l])}f.push(m),e=k(e,j)}var p=f.length;f.forEach(function(a,e){d(c.decodePacket(a,b,!0),e,p)})}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./keys":26,after:27,"arraybuffer.slice":28,"base64-arraybuffer":29,blob:30,"has-binary":31,utf8:33}],26:[function(a,b,c){b.exports=Object.keys||function(a){var b=[],c=Object.prototype.hasOwnProperty;for(var d in a)c.call(a,d)&&b.push(d);return b}},{}],27:[function(a,b,c){function d(a,b,c){function d(a,e){if(d.count<=0)throw new Error("after called too many times");--d.count,a?(f=!0,b(a),b=c):0!==d.count||f||b(null,e)}var f=!1;return c=c||e,d.count=a,0===a?b():d}function e(){}b.exports=d},{}],28:[function(a,b,c){b.exports=function(a,b,c){var d=a.byteLength;if(b=b||0,c=c||d,a.slice)return a.slice(b,c);if(0>b&&(b+=d),0>c&&(c+=d),c>d&&(c=d),b>=d||b>=c||0===d)return new ArrayBuffer(0);for(var e=new Uint8Array(a),f=new Uint8Array(c-b),g=b,h=0;c>g;g++,h++)f[h]=e[g];return f.buffer}},{}],29:[function(a,b,c){!function(a){"use strict";c.encode=function(b){var c,d=new Uint8Array(b),e=d.length,f="";for(c=0;e>c;c+=3)f+=a[d[c]>>2],f+=a[(3&d[c])<<4|d[c+1]>>4],f+=a[(15&d[c+1])<<2|d[c+2]>>6],f+=a[63&d[c+2]];return e%3===2?f=f.substring(0,f.length-1)+"=":e%3===1&&(f=f.substring(0,f.length-2)+"=="),f},c.decode=function(b){var c,d,e,f,g,h=.75*b.length,i=b.length,j=0;"="===b[b.length-1]&&(h--,"="===b[b.length-2]&&h--);var k=new ArrayBuffer(h),l=new Uint8Array(k);for(c=0;i>c;c+=4)d=a.indexOf(b[c]),e=a.indexOf(b[c+1]),f=a.indexOf(b[c+2]),g=a.indexOf(b[c+3]),l[j++]=d<<2|e>>4,l[j++]=(15&e)<<4|f>>2,l[j++]=(3&f)<<6|63&g;return k}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],30:[function(a,b,c){(function(a){function c(a,b){b=b||{};for(var c=new d,e=0;e<a.length;e++)c.append(a[e]);return b.type?c.getBlob(b.type):c.getBlob()}var d=a.BlobBuilder||a.WebKitBlobBuilder||a.MSBlobBuilder||a.MozBlobBuilder,e=function(){try{var a=new Blob(["hi"]);return 2==a.size}catch(b){return!1}}(),f=d&&d.prototype.append&&d.prototype.getBlob;b.exports=function(){return e?a.Blob:f?c:void 0}()}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],31:[function(a,b,c){(function(c){function d(a){function b(a){if(!a)return!1;if(c.Buffer&&c.Buffer.isBuffer(a)||c.ArrayBuffer&&a instanceof ArrayBuffer||c.Blob&&a instanceof Blob||c.File&&a instanceof File)return!0;if(e(a)){for(var d=0;d<a.length;d++)if(b(a[d]))return!0}else if(a&&"object"==typeof a){a.toJSON&&(a=a.toJSON());for(var f in a)if(a.hasOwnProperty(f)&&b(a[f]))return!0}return!1}return b(a)}var e=a("isarray");b.exports=d}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{isarray:32}],32:[function(a,b,c){b.exports=Array.isArray||function(a){return"[object Array]"==Object.prototype.toString.call(a)}},{}],33:[function(b,c,d){(function(b){!function(e){function f(a){for(var b,c,d=[],e=0,f=a.length;f>e;)b=a.charCodeAt(e++),b>=55296&&56319>=b&&f>e?(c=a.charCodeAt(e++),56320==(64512&c)?d.push(((1023&b)<<10)+(1023&c)+65536):(d.push(b),e--)):d.push(b);return d}function g(a){for(var b,c=a.length,d=-1,e="";++d<c;)b=a[d],b>65535&&(b-=65536,e+=t(b>>>10&1023|55296),b=56320|1023&b),e+=t(b);return e}function h(a,b){return t(a>>b&63|128)}function i(a){if(0==(4294967168&a))return t(a);var b="";return 0==(4294965248&a)?b=t(a>>6&31|192):0==(4294901760&a)?(b=t(a>>12&15|224),b+=h(a,6)):0==(4292870144&a)&&(b=t(a>>18&7|240),b+=h(a,12),b+=h(a,6)),b+=t(63&a|128)}function j(a){for(var b,c=f(a),d=c.length,e=-1,g="";++e<d;)b=c[e],g+=i(b);return g}function k(){if(s>=r)throw Error("Invalid byte index");var a=255&q[s];if(s++,128==(192&a))return 63&a;throw Error("Invalid continuation byte")}function l(){var a,b,c,d,e;if(s>r)throw Error("Invalid byte index");if(s==r)return!1;if(a=255&q[s],s++,0==(128&a))return a;if(192==(224&a)){var b=k();if(e=(31&a)<<6|b,e>=128)return e;throw Error("Invalid continuation byte")}if(224==(240&a)){if(b=k(),c=k(),e=(15&a)<<12|b<<6|c,e>=2048)return e;throw Error("Invalid continuation byte")}if(240==(248&a)&&(b=k(),c=k(),d=k(),e=(15&a)<<18|b<<12|c<<6|d,e>=65536&&1114111>=e))return e;throw Error("Invalid UTF-8 detected")}function m(a){q=f(a),r=q.length,s=0;for(var b,c=[];(b=l())!==!1;)c.push(b);return g(c)}var n="object"==typeof d&&d,o="object"==typeof c&&c&&c.exports==n&&c,p="object"==typeof b&&b;(p.global===p||p.window===p)&&(e=p);var q,r,s,t=String.fromCharCode,u={version:"2.0.0",encode:j,decode:m};if("function"==typeof a&&"object"==typeof a.amd&&a.amd)a(function(){return u});else if(n&&!n.nodeType)if(o)o.exports=u;else{var v={},w=v.hasOwnProperty;for(var x in u)w.call(u,x)&&(n[x]=u[x])}else e.utf8=u}(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],34:[function(a,b,c){(function(a){var c=/^[\],:{}\s]*$/,d=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,e=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,f=/(?:^|:|,)(?:\s*\[)+/g,g=/^\s+/,h=/\s+$/;b.exports=function(b){return"string"==typeof b&&b?(b=b.replace(g,"").replace(h,""),a.JSON&&JSON.parse?JSON.parse(b):c.test(b.replace(d,"@").replace(e,"]").replace(f,""))?new Function("return "+b)():void 0):null}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],35:[function(a,b,c){c.encode=function(a){var b="";for(var c in a)a.hasOwnProperty(c)&&(b.length&&(b+="&"),b+=encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b},c.decode=function(a){for(var b={},c=a.split("&"),d=0,e=c.length;e>d;d++){var f=c[d].split("=");b[decodeURIComponent(f[0])]=decodeURIComponent(f[1])}return b}},{}],36:[function(a,b,c){var d=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,e=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];b.exports=function(a){var b=a,c=a.indexOf("["),f=a.indexOf("]");-1!=c&&-1!=f&&(a=a.substring(0,c)+a.substring(c,f).replace(/:/g,";")+a.substring(f,a.length));for(var g=d.exec(a||""),h={},i=14;i--;)h[e[i]]=g[i]||"";return-1!=c&&-1!=f&&(h.source=b,h.host=h.host.substring(1,h.host.length-1).replace(/;/g,":"),h.authority=h.authority.replace("[","").replace("]","").replace(/;/g,":"),h.ipv6uri=!0),h}},{}],37:[function(a,b,c){function d(a,b,c){var d;return d=b?new f(a,b):new f(a)}var e=function(){return this}(),f=e.WebSocket||e.MozWebSocket;b.exports=f?d:null,f&&(d.prototype=f.prototype)},{}],38:[function(a,b,c){(function(c){function d(a){function b(a){if(!a)return!1;if(c.Buffer&&c.Buffer.isBuffer(a)||c.ArrayBuffer&&a instanceof ArrayBuffer||c.Blob&&a instanceof Blob||c.File&&a instanceof File)return!0;if(e(a)){for(var d=0;d<a.length;d++)if(b(a[d]))return!0}else if(a&&"object"==typeof a){a.toJSON&&(a=a.toJSON());for(var f in a)if(Object.prototype.hasOwnProperty.call(a,f)&&b(a[f]))return!0}return!1}return b(a)}var e=a("isarray");b.exports=d}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{isarray:39}],39:[function(a,b,c){b.exports=a(32)},{}],40:[function(a,b,c){var d=a("global");try{b.exports="XMLHttpRequest"in d&&"withCredentials"in new d.XMLHttpRequest}catch(e){b.exports=!1}},{global:41}],41:[function(a,b,c){b.exports=function(){return this}()},{}],42:[function(a,b,c){var d=[].indexOf;b.exports=function(a,b){if(d)return a.indexOf(b);for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}},{}],43:[function(a,b,c){var d=Object.prototype.hasOwnProperty;c.keys=Object.keys||function(a){var b=[];for(var c in a)d.call(a,c)&&b.push(c);return b},c.values=function(a){var b=[];for(var c in a)d.call(a,c)&&b.push(a[c]);return b},c.merge=function(a,b){for(var c in b)d.call(b,c)&&(a[c]=b[c]);return a},c.length=function(a){return c.keys(a).length},c.isEmpty=function(a){return 0==c.length(a)}},{}],44:[function(a,b,c){var d=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,e=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];b.exports=function(a){for(var b=d.exec(a||""),c={},f=14;f--;)c[e[f]]=b[f]||"";return c}},{}],45:[function(a,b,c){(function(b){var d=a("isarray"),e=a("./is-buffer");c.deconstructPacket=function(a){function b(a){if(!a)return a;if(e(a)){var f={_placeholder:!0,num:c.length};return c.push(a),f}if(d(a)){for(var g=new Array(a.length),h=0;h<a.length;h++)g[h]=b(a[h]);return g}if("object"==typeof a&&!(a instanceof Date)){var g={};for(var i in a)g[i]=b(a[i]);return g}return a}var c=[],f=a.data,g=a;return g.data=b(f),g.attachments=c.length,{packet:g,buffers:c}},c.reconstructPacket=function(a,b){function c(a){if(a&&a._placeholder){var e=b[a.num];return e}if(d(a)){for(var f=0;f<a.length;f++)a[f]=c(a[f]);return a}if(a&&"object"==typeof a){for(var g in a)a[g]=c(a[g]);return a}return a}return a.data=c(a.data),a.attachments=void 0,a},c.removeBlobs=function(a,c){function f(a,i,j){if(!a)return a;if(b.Blob&&a instanceof Blob||b.File&&a instanceof File){g++;var k=new FileReader;k.onload=function(){j?j[i]=this.result:h=this.result,--g||c(h)},k.readAsArrayBuffer(a)}else if(d(a))for(var l=0;l<a.length;l++)f(a[l],l,a);else if(a&&"object"==typeof a&&!e(a))for(var m in a)f(a[m],m,a)}var g=0,h=a;f(h),g||c(h)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./is-buffer":47,isarray:48}],46:[function(a,b,c){function d(){}function e(a){var b="",d=!1;return b+=a.type,(c.BINARY_EVENT==a.type||c.BINARY_ACK==a.type)&&(b+=a.attachments,b+="-"),a.nsp&&"/"!=a.nsp&&(d=!0,b+=a.nsp),null!=a.id&&(d&&(b+=",",d=!1),b+=a.id),null!=a.data&&(d&&(b+=","),b+=l.stringify(a.data)),k("encoded %j as %s",a,b),b}function f(a,b){function c(a){var c=n.deconstructPacket(a),d=e(c.packet),f=c.buffers;f.unshift(d),b(f)}n.removeBlobs(a,c)}function g(){this.reconstructor=null}function h(a){var b={},d=0;if(b.type=Number(a.charAt(0)),null==c.types[b.type])return j();if(c.BINARY_EVENT==b.type||c.BINARY_ACK==b.type){for(var e="";"-"!=a.charAt(++d)&&(e+=a.charAt(d),d!=a.length););if(e!=Number(e)||"-"!=a.charAt(d))throw new Error("Illegal attachments");b.attachments=Number(e)}if("/"==a.charAt(d+1))for(b.nsp="";++d;){var f=a.charAt(d);if(","==f)break;if(b.nsp+=f,d==a.length)break}else b.nsp="/";var g=a.charAt(d+1);if(""!==g&&Number(g)==g){for(b.id="";++d;){var f=a.charAt(d);if(null==f||Number(f)!=f){--d;break}if(b.id+=a.charAt(d),d==a.length)break}b.id=Number(b.id)}if(a.charAt(++d))try{b.data=l.parse(a.substr(d))}catch(h){return j()}return k("decoded %s as %j",a,b),b}function i(a){this.reconPack=a,this.buffers=[]}function j(a){return{type:c.ERROR,data:"parser error"}}var k=a("debug")("socket.io-parser"),l=a("json3"),m=(a("isarray"),a("component-emitter")),n=a("./binary"),o=a("./is-buffer");c.protocol=4,c.types=["CONNECT","DISCONNECT","EVENT","BINARY_EVENT","ACK","BINARY_ACK","ERROR"],c.CONNECT=0,c.DISCONNECT=1,c.EVENT=2,c.ACK=3,c.ERROR=4,c.BINARY_EVENT=5,c.BINARY_ACK=6,c.Encoder=d,c.Decoder=g,d.prototype.encode=function(a,b){if(k("encoding packet %j",a),c.BINARY_EVENT==a.type||c.BINARY_ACK==a.type)f(a,b);else{var d=e(a);b([d])}},m(g.prototype),g.prototype.add=function(a){var b;if("string"==typeof a)b=h(a),c.BINARY_EVENT==b.type||c.BINARY_ACK==b.type?(this.reconstructor=new i(b),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",b)):this.emit("decoded",b);else{if(!o(a)&&!a.base64)throw new Error("Unknown type: "+a);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");b=this.reconstructor.takeBinaryData(a),b&&(this.reconstructor=null,this.emit("decoded",b))}},g.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},i.prototype.takeBinaryData=function(a){if(this.buffers.push(a),this.buffers.length==this.reconPack.attachments){var b=n.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),b}return null},i.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},{"./binary":45,"./is-buffer":47,"component-emitter":9,debug:10,isarray:48,json3:49}],47:[function(a,b,c){(function(a){function c(b){return a.Buffer&&a.Buffer.isBuffer(b)||a.ArrayBuffer&&b instanceof ArrayBuffer}b.exports=c}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],48:[function(a,b,c){b.exports=a(32)},{}],49:[function(b,c,d){!function(b){function c(a){if(c[a]!==g)return c[a];var b;if("bug-string-char-index"==a)b="a"!="a"[0];else if("json"==a)b=c("json-stringify")&&c("json-parse");else{var d,e='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==a){var f=k.stringify,i="function"==typeof f&&l;if(i){(d=function(){return 1}).toJSON=d;try{i="0"===f(0)&&"0"===f(new Number)&&'""'==f(new String)&&f(h)===g&&f(g)===g&&f()===g&&"1"===f(d)&&"[1]"==f([d])&&"[null]"==f([g])&&"null"==f(null)&&"[null,null,null]"==f([g,h,null])&&f({a:[d,!0,!1,null,"\x00\b\n\f\r	"]})==e&&"1"===f(null,d)&&"[\n 1,\n 2\n]"==f([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==f(new Date(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==f(new Date(864e13))&&'"-000001-01-01T00:00:00.000Z"'==f(new Date(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==f(new Date(-1))}catch(j){i=!1}}b=i}if("json-parse"==a){var m=k.parse;if("function"==typeof m)try{if(0===m("0")&&!m(!1)){d=m(e);var n=5==d.a.length&&1===d.a[0];if(n){try{n=!m('"	"')}catch(j){}if(n)try{n=1!==m("01")}catch(j){}if(n)try{n=1!==m("1.")}catch(j){}}}}catch(j){n=!1}b=n}}return c[a]=!!b}var e,f,g,h={}.toString,i="function"==typeof a&&a.amd,j="object"==typeof JSON&&JSON,k="object"==typeof d&&d&&!d.nodeType&&d;k&&j?(k.stringify=j.stringify,k.parse=j.parse):k=b.JSON=j||{};var l=new Date(-0xc782b5b800cec);try{l=-109252==l.getUTCFullYear()&&0===l.getUTCMonth()&&1===l.getUTCDate()&&10==l.getUTCHours()&&37==l.getUTCMinutes()&&6==l.getUTCSeconds()&&708==l.getUTCMilliseconds()}catch(m){}if(!c("json")){var n="[object Function]",o="[object Date]",p="[object Number]",q="[object String]",r="[object Array]",s="[object Boolean]",t=c("bug-string-char-index");if(!l)var u=Math.floor,v=[0,31,59,90,120,151,181,212,243,273,304,334],w=function(a,b){return v[b]+365*(a-1970)+u((a-1969+(b=+(b>1)))/4)-u((a-1901+b)/100)+u((a-1601+b)/400)};(e={}.hasOwnProperty)||(e=function(a){var b,c={};return(c.__proto__=null,c.__proto__={toString:1},c).toString!=h?e=function(a){var b=this.__proto__,c=a in(this.__proto__=null,this);return this.__proto__=b,c}:(b=c.constructor,e=function(a){var c=(this.constructor||b).prototype;return a in this&&!(a in c&&this[a]===c[a])}),c=null,e.call(this,a)});var x={"boolean":1,number:1,string:1,undefined:1},y=function(a,b){var c=typeof a[b];return"object"==c?!!a[b]:!x[c]};if(f=function(a,b){var c,d,g,i=0;(c=function(){this.valueOf=0}).prototype.valueOf=0,d=new c;for(g in d)e.call(d,g)&&i++;return c=d=null,i?f=2==i?function(a,b){var c,d={},f=h.call(a)==n;for(c in a)f&&"prototype"==c||e.call(d,c)||!(d[c]=1)||!e.call(a,c)||b(c)}:function(a,b){var c,d,f=h.call(a)==n;for(c in a)f&&"prototype"==c||!e.call(a,c)||(d="constructor"===c)||b(c);(d||e.call(a,c="constructor"))&&b(c)}:(d=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],f=function(a,b){var c,f,g=h.call(a)==n,i=!g&&"function"!=typeof a.constructor&&y(a,"hasOwnProperty")?a.hasOwnProperty:e;for(c in a)g&&"prototype"==c||!i.call(a,c)||b(c);for(f=d.length;c=d[--f];i.call(a,c)&&b(c));}),f(a,b)},!c("json-stringify")){var z={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},A="000000",B=function(a,b){return(A+(b||0)).slice(-a)},C="\\u00",D=function(a){var b,c='"',d=0,e=a.length,f=e>10&&t;for(f&&(b=a.split(""));e>d;d++){var g=a.charCodeAt(d);switch(g){case 8:case 9:case 10:case 12:case 13:case 34:case 92:c+=z[g];break;default:if(32>g){c+=C+B(2,g.toString(16));break}c+=f?b[d]:t?a.charAt(d):a[d]}}return c+'"'},E=function(a,b,c,d,i,j,k){var l,m,n,t,v,x,y,z,A,C,F,G,H,I,J,K;try{l=b[a]}catch(L){}if("object"==typeof l&&l)if(m=h.call(l),m!=o||e.call(l,"toJSON"))"function"==typeof l.toJSON&&(m!=p&&m!=q&&m!=r||e.call(l,"toJSON"))&&(l=l.toJSON(a));else if(l>-1/0&&1/0>l){if(w){for(v=u(l/864e5),n=u(v/365.2425)+1970-1;w(n+1,0)<=v;n++);for(t=u((v-w(n,0))/30.42);w(n,t+1)<=v;t++);v=1+v-w(n,t),x=(l%864e5+864e5)%864e5,y=u(x/36e5)%24,z=u(x/6e4)%60,A=u(x/1e3)%60,C=x%1e3}else n=l.getUTCFullYear(),t=l.getUTCMonth(),v=l.getUTCDate(),y=l.getUTCHours(),z=l.getUTCMinutes(),A=l.getUTCSeconds(),C=l.getUTCMilliseconds();l=(0>=n||n>=1e4?(0>n?"-":"+")+B(6,0>n?-n:n):B(4,n))+"-"+B(2,t+1)+"-"+B(2,v)+"T"+B(2,y)+":"+B(2,z)+":"+B(2,A)+"."+B(3,C)+"Z"}else l=null;if(c&&(l=c.call(b,a,l)),null===l)return"null";if(m=h.call(l),m==s)return""+l;if(m==p)return l>-1/0&&1/0>l?""+l:"null";if(m==q)return D(""+l);if("object"==typeof l){for(I=k.length;I--;)if(k[I]===l)throw TypeError();if(k.push(l),F=[],J=j,j+=i,m==r){for(H=0,I=l.length;I>H;H++)G=E(H,l,c,d,i,j,k),F.push(G===g?"null":G);K=F.length?i?"[\n"+j+F.join(",\n"+j)+"\n"+J+"]":"["+F.join(",")+"]":"[]"}else f(d||l,function(a){var b=E(a,l,c,d,i,j,k);b!==g&&F.push(D(a)+":"+(i?" ":"")+b)}),K=F.length?i?"{\n"+j+F.join(",\n"+j)+"\n"+J+"}":"{"+F.join(",")+"}":"{}";return k.pop(),K}};k.stringify=function(a,b,c){var d,e,f,g;if("function"==typeof b||"object"==typeof b&&b)if((g=h.call(b))==n)e=b;else if(g==r){f={};for(var i,j=0,k=b.length;k>j;i=b[j++],g=h.call(i),(g==q||g==p)&&(f[i]=1));}if(c)if((g=h.call(c))==p){if((c-=c%1)>0)for(d="",c>10&&(c=10);d.length<c;d+=" ");}else g==q&&(d=c.length<=10?c:c.slice(0,10));return E("",(i={},i[""]=a,i),e,f,d,"",[])}}if(!c("json-parse")){var F,G,H=String.fromCharCode,I={92:"\\",34:'"',47:"/",
98:"\b",116:"	",110:"\n",102:"\f",114:"\r"},J=function(){throw F=G=null,SyntaxError()},K=function(){for(var a,b,c,d,e,f=G,g=f.length;g>F;)switch(e=f.charCodeAt(F)){case 9:case 10:case 13:case 32:F++;break;case 123:case 125:case 91:case 93:case 58:case 44:return a=t?f.charAt(F):f[F],F++,a;case 34:for(a="@",F++;g>F;)if(e=f.charCodeAt(F),32>e)J();else if(92==e)switch(e=f.charCodeAt(++F)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:a+=I[e],F++;break;case 117:for(b=++F,c=F+4;c>F;F++)e=f.charCodeAt(F),e>=48&&57>=e||e>=97&&102>=e||e>=65&&70>=e||J();a+=H("0x"+f.slice(b,F));break;default:J()}else{if(34==e)break;for(e=f.charCodeAt(F),b=F;e>=32&&92!=e&&34!=e;)e=f.charCodeAt(++F);a+=f.slice(b,F)}if(34==f.charCodeAt(F))return F++,a;J();default:if(b=F,45==e&&(d=!0,e=f.charCodeAt(++F)),e>=48&&57>=e){for(48==e&&(e=f.charCodeAt(F+1),e>=48&&57>=e)&&J(),d=!1;g>F&&(e=f.charCodeAt(F),e>=48&&57>=e);F++);if(46==f.charCodeAt(F)){for(c=++F;g>c&&(e=f.charCodeAt(c),e>=48&&57>=e);c++);c==F&&J(),F=c}if(e=f.charCodeAt(F),101==e||69==e){for(e=f.charCodeAt(++F),(43==e||45==e)&&F++,c=F;g>c&&(e=f.charCodeAt(c),e>=48&&57>=e);c++);c==F&&J(),F=c}return+f.slice(b,F)}if(d&&J(),"true"==f.slice(F,F+4))return F+=4,!0;if("false"==f.slice(F,F+5))return F+=5,!1;if("null"==f.slice(F,F+4))return F+=4,null;J()}return"$"},L=function(a){var b,c;if("$"==a&&J(),"string"==typeof a){if("@"==(t?a.charAt(0):a[0]))return a.slice(1);if("["==a){for(b=[];a=K(),"]"!=a;c||(c=!0))c&&(","==a?(a=K(),"]"==a&&J()):J()),","==a&&J(),b.push(L(a));return b}if("{"==a){for(b={};a=K(),"}"!=a;c||(c=!0))c&&(","==a?(a=K(),"}"==a&&J()):J()),(","==a||"string"!=typeof a||"@"!=(t?a.charAt(0):a[0])||":"!=K())&&J(),b[a.slice(1)]=L(K());return b}J()}return a},M=function(a,b,c){var d=N(a,b,c);d===g?delete a[b]:a[b]=d},N=function(a,b,c){var d,e=a[b];if("object"==typeof e&&e)if(h.call(e)==r)for(d=e.length;d--;)M(e,d,c);else f(e,function(a){M(e,a,c)});return c.call(a,b,e)};k.parse=function(a,b){var c,d;return F=0,G=""+a,c=L(K()),"$"!=K()&&J(),F=G=null,b&&h.call(b)==n?N((d={},d[""]=c,d),"",b):c}}}i&&a(function(){return k})}(this)},{}],50:[function(a,b,c){function d(a,b){var c=[];b=b||0;for(var d=b||0;d<a.length;d++)c[d-b]=a[d];return c}b.exports=d},{}]},{},[1])(1)}),define("WebRTC_SDK/utilities/RTCErrors",["require","my.Class","Logger","q"],function(a){var b=a("my.Class"),c=a("Logger"),d=(a("q"),b.Class({constructor:function(a){this.SIGNALING_ERRORS={BAD_REQUEST:{code:"400",message:"Bad Request"},DOESNOT_EXIST:{code:"481",message:"Call Does Not Exists"},NOT_ALLOWED:{code:"405",message:"Method Not Allowed"},METHOD_NOT_IMPLEMENTED:{code:"501",message:"Method Not Implemented"}},this.DISCONNECT_REASONS={REQ_TIMED_OUT:{code:"408",message:"Request Timeout"},TRANSPORT_FAIL:{code:"500",message:"Server Internal Error"},KEEPALIVE_TIMEOUT:{code:"450",message:"Keep Alive Timeout"},USER_INITIATED:{code:"200",message:"User Action"},NODE_DRAIN:{code:"302",message:"Node Draining"},SERVICE_UNAVAILABLE:{code:"503",message:"Service Unavailable"},ICE_CONNECTION_FAILED:{code:"520",message:"Ice Connection Failed"},ICE_GATHERING_FAILED:{code:"521",message:"Ice Gathering Failed"},SIG_CHANNEL_CLOSED:{code:"522",message:"Signaling Channel Closed"}},this.GET_LOCAL_MEDIA_STATES={AVAILABLE:{code:200,message:"Requested devices are available",details:""},DEVICES_NOT_FOUND:{code:404,message:"Requested devices were not found",details:""},PERMISSION_DENIED:{code:401,message:"User denied access to local device streams",details:""},SOURCE_UNAVAILABLE:{code:423,message:"Device is unavailable, maybe locked by another process",details:""},NOT_READABLE:{code:409,message:"Device source in use",details:""},EXCEPTION:{code:500,message:"Unknown error",details:""}},this.SCREEN_SHARING_STATES={STARTED:{code:200,message:"Screen Sharing has started",details:""},INSTALL_EXTENSION_FAILED:{code:421,message:"Chrome Extension installation failed",details:""},GET_TOKEN_FAILED:{code:408,message:"Token request timed out",details:""},GET_SCREEN_MEDIA_FAILED:{code:400,message:"Failed to get screen media stream",details:""},EXCEPTION:{code:500,message:"Unknown error",details:""},STOPPED:{code:204,message:"Screen Sharing has stopped",details:""}},this.PEER_CONNECTION_ERRORS={PC_CLOSED:{code:410,message:"Peer Connection is closed, request cannot be processed",details:""}}},translateGetUserMediaError:function(a){var b={},d=this.GET_LOCAL_MEDIA_STATES;switch(a.name){case"DevicesNotFoundError":b=d.DEVICES_NOT_FOUND;break;case"PermissionDeniedError":b=d.PERMISSION_DENIED;break;case"SourceUnavailableError":b=d.SOURCE_UNAVAILABLE;break;case"NotReadableError":b=d.NOT_READABLE;break;default:c.warn("Unhandled error in getUserMedia: ",a),b=d.EXCEPTION}return b.details=a,b},detectCameraStatus:function(a){var b,d=!1,e=this;return a&&"function"==typeof a.getVideoTracks?(b=a.getVideoTracks()[0],b?"ended"===b.readyState?(d=!1,c.warn("RTCErrors: Camera feed is unavailable, faulty camera or its in use by another program"),e.GET_LOCAL_MEDIA_STATES.SOURCE_UNAVAILABLE):(d=!0,e.GET_LOCAL_MEDIA_STATES.AVAILABLE):(c.warn("RTCErrors: No video tracks available in the stream, triggering camera unavailable state"),this.GET_LOCAL_MEDIA_STATES.SOURCE_UNAVAILABLE)):this.GET_LOCAL_MEDIA_STATES.DEVICES_NOT_FOUND}}));return new d}),define("WebRTC_SDK/utilities/RTCMessageParser",["require","my.Class","underscore","Logger","WebRTC_SDK/utilities/RTCBlueJay","WebRTC_SDK/utilities/RTCErrors"],function(a){var b=a("my.Class"),c=a("underscore"),d=a("Logger"),e=a("WebRTC_SDK/utilities/RTCBlueJay"),f=a("WebRTC_SDK/utilities/RTCErrors"),g=b.Class({STATIC:{SUPPORTED_METHODS:c.values(e.METHODS),ERROR:f.SIGNALING_ERRORS},constructor:function(a){c.bindAll(this),this.callbacks=a.callbacks},getMessgeType:function(a){return c.isUndefined(a.id)?"notification":c.isEmpty(a.error)?c.isEmpty(a.result)?c.isEmpty(a.params)?(d.error("Message passed is in invalid format. Supported message types are: request, response, error, notification"),"invalid"):"request":"response":"error"},parseIncomingMessage:function(a){var b=this,c=JSON.parse(a),d=function(a){b.callbacks.invalidMessage.apply(b,[c,a])},e=function(){var a=b.getMessgeType(c);"function"==typeof b.callbacks[a]&&b.callbacks[a].apply(b,[c])};this.validateMessage(c,e,d)},validateMessage:function(a,b,f){var h=e.getCallId();c.isNull(a.call)||c.isUndefined(a.call)?(d.error("Invalid message received from Remote Server, 'call' field not defined in message"),f(g.ERROR.BAD_REQUEST)):a.call!==h?(d.error("Invalid call id, Transaction does not exists"),f(g.ERROR.DOESNOT_EXIST)):c.isUndefined(a.method)||-1!==c.indexOf(g.SUPPORTED_METHODS,a.method)?b():(d.error("Invalid message received from Remote Server, 'method' passed is not supported: "+a.method),f(g.ERROR.METHOD_NOT_IMPLEMENTED))}});return g}),define("WebRTC_SDK/RTCStates",["require","my.Class","Logger"],function(a){var b=a("my.Class"),c=(a("Logger"),b.Class({constructor:function(a){this.BJ_CALLSTATES={IDLE:"idle",INITIALISING:"initialising",CONNECTING:"connecting",STARTING_MEDIA:"starting-media",CONNECTED:"connected",RESTART_MEDIA:"restart-media",REINITIALISING:"re-initialising",RECONNECTING:"reconnecting",DISCONNECTED:"disconnected"},this.WEBRTC_STATES={iceGatheringState:{NEW:"new",GATHERING:"gathering",COMPLETE:"complete"},iceConnectionState:{NEW:"new",CHECKING:"checking",CONNECTED:"connected",COMPLETED:"completed",FAILED:"failed",DISCONNECTED:"disconnected",CLOSED:"closed"},signalingState:{STABLE:"stable",HAVE_LOCAL_OFFER:"have-local-offer",HAVE_REMOTE_OFFER:"have-remote-offer",HAVE_LOCAL_PRANSWER:"have-local-pranswer",HAVE_REMOTE_PRANSWER:"have-remote-pranswer",CLOSED:"closed"}},this.STATE_EVENTS={INITIALISE:"initialise",CONNECT:"connect",START_MEDIA:"startMedia",ESTABLISH_CONNECTION:"establishConnection",MEDIA_DISRUPTION:"mediaDisruption",DISCONNECT:"disconnect",RESET:"reset"},this.TRANSACTION_STATES={INIT:"init",RESEND:"resend",FAILED:"failed",FINISHED:"finished",ERROR:"error"},this.EXTENSION_STATES={NOT_INSTALLED:"not_installed",INSTALLING:"installing",BG_SCRIPTS_INJECTED:"background_scripts_injected",INSTALLED:"installed",IFRAME_INSTALL_FAILED:"iframe_install_failed",INSTALL_FAILED_DOMAIN_UNVERIFIED:"install_failed_domain_not_verified",INSTALL_FAILED:"install_failed",INSTALL_CANCELLED:"install_cancelled",REQUEST_FAILED:"request_failed"},this.WS_STATES={CONNECTED:"connected",RECONNECTED:"reconnected",DISCONNECTED:"disconnected",FAILED:"failed",CLOSED:"closed"},this.WS_STATES={CONNECTED:"connected",RECONNECTED:"reconnected",DISCONNECTED:"disconnected",FAILED:"failed",CLOSED:"closed"}},addWebrtcStatePrefix:function(a,b){var c={};return _.forEach(b,function(b,d){c[d]=a+b}),c}}));return new c}),define("WebRTC_SDK/manager/RTCSignallingManager",["require","my.Class","underscore","Logger","socket.io-client","WebRTC_SDK/utilities/RTCBlueJay","WebRTC_SDK/utilities/RTCMessageParser","WebRTC_SDK/RTCStates","backbone"],function(a){var b=a("my.Class"),c=a("underscore"),d=a("Logger"),e=a("socket.io-client"),f=(a("WebRTC_SDK/utilities/RTCBlueJay"),a("WebRTC_SDK/utilities/RTCMessageParser")),g=a("WebRTC_SDK/RTCStates"),h=a("backbone"),i=b.Class({STATIC:{MESSAGE_BASE:{bluejay:"1.0"}},config:{callId:null,sockUrl:null,socketId:null,socketioOpts:{reconnectionAttempts:15,reconnectionDelay:2e3,reconnectionDelayMax:2500,timeout:2e3,forceNew:!0}},constructor:function(a){c.bindAll(this),c.extend(this.config,a),c.extend(this,h.Events),this.isConnected=!1,this.WS_STATES=g.WS_STATES},createSocket:function(a){this.socket=e.connect(a.sockUrl,this.config.socketioOpts),this.setupListeners()},setupListeners:function(){this.socket.on("message",this.handleMessage),this.socket.on("connect",this.socketConnected),this.socket.on("error",this.socketError),this.socket.on("disconnect",this.socketDisconnect),this.socket.on("reconnecting",this.socketReconnecting),this.socket.on("reconnect_failed",this.socketReconnectFailed),this.socket.on("reconnect",this.socketReconnect),this.socket.on("connect_error",this.onConnectError)},setupMessageParser:function(a){this.messageParser=new f({callbacks:a})},handleMessage:function(a){d.debug("RTCSignallingManager: Received message on socket: "+a),this.messageParser.parseIncomingMessage(a)},socketConnected:function(){this.isConnected=!0,this.config.socketId=this.socket.id,this.trigger("wsConnectionStateChange",this.WS_STATES.CONNECTED,this.socket.id),d.debug("RTCSignallingManager: Socket connected successfully")},socketError:function(a){this.isConnected=!1,this.trigger("wsConnectionStateChange",this.WS_STATES.DISCONNECTED,this.config.socketId),d.error("RTCSignallingManager: Received 'error' message on socket")},socketDisconnect:function(a){this.isConnected=!1,this.trigger("wsConnectionStateChange",this.WS_STATES.DISCONNECTED,this.config.socketId),"io client disconnect"===a?d.debug("RTCSignallingManager: Socket disconnected, initiated by client: ",a):d.error("RTCSignallingManager: Socket disconnected, not initiated by client: ",a)},socketReconnecting:function(a){this.isConnected=!1,d.debug("RTCSignallingManager: Reconnecting socket, reconnect attempt ",a)},socketReconnectFailed:function(){this.isConnected=!1,this.trigger("wsConnectionStateChange",this.WS_STATES.FAILED,this.config.socketId),d.debug("RTCSignallingManager: Socket reconnection failed")},socketReconnect:function(){d.debug("RTCSignallingManager: Socket reconnected"),this.isConnected=!0,this.config.socketId=this.socket.id,this.trigger("wsConnectionStateChange",this.WS_STATES.RECONNECTED,this.socket.id)},onConnectError:function(a){d.debug("RTCSignallingManager :: connect error : "+a)},sendMsg:function(a){return c.isNull(a.call)||c.isUndefined(a.call)?(d.warn("RTCSignallingManager: Invalid BlueJay message, 'call' field is missing"),!1):a.id?this.isConnected?(this.socket.emit("message",JSON.stringify(a)),d.debug("RTCSignallingManager: Sending socket message: "+JSON.stringify(a)),!0):(d.warn("RTCSignallingManager: Socket is not connected, Message :: "+JSON.stringify(a)),!1):(d.warn("RTCSignallingManager: Invalid BlueJay message, 'id' field is missing"),!1)},close:function(){this.socket?(this.isConnected=!1,this.socket.disconnect(),this.socket=null):d.warn("RTCSignallingManager: Socket has already been closed.")}});return new i}),define("WebRTC_SDK/models/RTCTransactionModel",["require","underscore","backbone"],function(a){var b=a("underscore"),c=(a("backbone"),Backbone.Model.extend({defaults:{bluejayReqMap:{},bluejayKeepAlive:{},bluejayRespMap:{},requestCallbacks:{},bluejayMuteMsg:{},bluejayTokenMsg:{},connectResponseReceived:!1,callState:"idle"},addRequest:function(a,b){this.get("bluejayReqMap")[a]=b},updateRequest:function(a,b){this.get("bluejayReqMap")[a]=b},removeRequest:function(a){this.get("bluejayReqMap")[a]&&this.unset("bluejayReqMap"[a],{silent:!0})},addResponse:function(a,b){this.get("bluejayRespMap")[a]=b},getRequest:function(a){return this.get("bluejayReqMap")[a]},getResponse:function(a){return this.get("bluejayRespMap")[a]},addKeepAlive:function(a){this.set("bluejayKeepAlive",a)},addMuteMessage:function(a){this.set("bluejayMuteMsg",a)},addTokenMessage:function(a){this.set("bluejayTokenMsg",a)},getMuteMessage:function(){return this.get("bluejayMuteMsg")},getTokenMessage:function(){return this.get("bluejayTokenMsg")},getAllRequestMsgIds:function(){return b.keys(this.get("bluejayReqMap"))},resetTransaction:function(){this.set(this.defaults,{silent:!0})}}));return c}),function(a){a("state_machine",["require","exports","module","lodash"],function(a,b,c){function d(a,b){if(!a)throw b||"Assertion failed"}var e=a("lodash"),f=function(a,b){return{call:function(c,d){void 0!==a.from&&a.from!==c||void 0!==a.to&&a.to!==d||b({from:c,to:d})}}},g={transition:function(a){return function(b,c){var d=Array.isArray(a)?e.find(a,function(a){return a.from==b.getState()}):a;return d&&void 0!==d.from&&(b.getState()==d.from||e.include(d.from,b.getState()))?(c(b.getState(),d.to,d.resetTriggers),!0):void 0}},afterTransition:function(a,b){return e.extend(f(a,b),{beforeTransition:!1})},beforeTransition:function(a,b){return e.extend(f(a,b),{beforeTransition:!0})}},h={anyOf:function(a){return{isFulfilled:function(a){return!e.isEmpty(this.matchingTriggers(a))},matchingTriggers:function(b){return e.intersection(a,b)}}},allOf:function(a){return{isFulfilled:function(a){return e.isEmpty(e.difference(this.matchingTriggers(a),a))},matchingTriggers:function(){return a}}}},i=function(a){function b(a,b,c){a&&e.each(a,function(a){a.call(b,c)})}function c(){e.each(f.triggers,function(a){var b=a.activatedBy.isFulfilled(g.activatedTriggers);if(b&&f[a.event]()){var c=a.activatedBy.matchingTriggers(g.activatedTriggers);g.activatedTriggers=e.difference(g.activatedTriggers,c)}})}d(void 0!==a.initial,"initial state is mandatory");var f={};f.events=a.events,f.triggers=a.triggers,f.callbacks=a.callbacks;var g={state:a.initial,activatedTriggers:[]},h=function(a,c,d){var h=e.groupBy(f.callbacks,function(a){return a.beforeTransition===!0}),i=h[!0];i&&b(i,a,c),g.state=c;var j=h[!1];j&&b(j,a,c),d===!0&&(g.activatedTriggers=[])};return f.getState=function(){return g.state},e.each(e.keys(f.events),function(b){var c=a.events[b];d(void 0!==c),f[b]=function(){return c(f,h)}}),f.trigger=function(a){g.activatedTriggers.push(a),c()},f};return{create:i,transitions:g,triggers:h}})}("object"==typeof module&&"function"!=typeof define?function(a){module.exports=a(require,exports,module)}:define),define("WebRTC_SDK/manager/RTCStateManager",["require","my.Class","underscore","backbone","Logger","state_machine","WebRTC_SDK/RTCStates"],function(a){var b=a("my.Class"),c=a("underscore"),d=a("backbone"),e=a("Logger"),f=a("state_machine"),g=a("WebRTC_SDK/RTCStates"),h=d.Model.extend({defaults:{currentState:"",prevState:[],iceConnectionState:"",iceGatheringState:"",signalingState:"",disconnectCode:"",disconnectReason:""},setCurrentState:function(a){var b=this.get("currentState"),c=this.get("prevState");a!==b&&(c.push(b),this.set("currentState",a)),this.logStateTransition()},logStateTransition:function(){e.debug("RTCStateManager: Call State: "+this.get("currentState")+", Ice-Gathering: "+this.get("iceGatheringState")+", Ice-Connection: "+this.get("iceConnectionState")+", Signaling: "+this.get("signalingState"))},getCurrentState:function(){return this.get("currentState")},getPreviousState:function(){return this.get("prevState")},getDisconnectReason:function(){return this.get("disconnectReason")}}),i=b.Class({STATIC:{BJ_CALLSTATES:g.BJ_CALLSTATES,ICE_G_STATES:g.addWebrtcStatePrefix("iceG_",g.WEBRTC_STATES.iceGatheringState),ICE_C_STATES:g.addWebrtcStatePrefix("ice_",g.WEBRTC_STATES.iceConnectionState),SIG_STATES:g.addWebrtcStatePrefix("sig_",g.WEBRTC_STATES.signalingState),STATE_EVTS:g.STATE_EVENTS},constructor:function(a){c.bindAll(this),c.extend(this,d.Events),this.model=new h,this.stateMachine=this.initStateMachine()},initStateMachine:function(){var a=f.transitions.transition,b=f.triggers.anyOf,d=f.triggers.allOf,e=i.BJ_CALLSTATES,g=i.ICE_C_STATES,h=i.ICE_G_STATES,j=i.SIG_STATES,k=i.STATE_EVTS,l=function(a){this.callStateChange(a)}.bind(this);return f.create({initial:e.IDLE,events:{initialise:a([{from:e.IDLE,to:e.INITIALISING},{from:e.RESTART_MEDIA,to:e.REINITIALISING}]),connect:a([{from:e.INITIALISING,to:e.CONNECTING},{from:e.REINITIALISING,to:e.RECONNECTING}]),startMedia:a([{from:e.CONNECTING,to:e.STARTING_MEDIA},{from:e.RECONNECTING,to:e.STARTING_MEDIA}]),establishConnection:a([{from:e.STARTING_MEDIA,to:e.CONNECTED},{from:e.RESTART_MEDIA,to:e.CONNECTED}]),mediaDisruption:a({from:e.CONNECTED,to:e.RESTART_MEDIA,resetTriggers:!0}),disconnect:a({from:c.without(c.values(e),e.DISCONNECTED),to:e.DISCONNECTED,resetTriggers:!0}),reset:a({from:c.without(c.values(e),e.IDLE),to:e.IDLE,resetTriggers:!0})},triggers:[{event:k.INITIALISE,activatedBy:d([j.HAVE_LOCAL_OFFER])},{event:k.CONNECT,activatedBy:b([h.GATHERING,h.COMPLETE])},{event:k.START_MEDIA,activatedBy:d([j.STABLE])},{event:k.ESTABLISH_CONNECTION,activatedBy:b([g.COMPLETED,g.CONNECTED])},{event:k.MEDIA_DISRUPTION,activatedBy:d([g.DISCONNECTED])},{event:k.DISCONNECT,activatedBy:d([g.FAILED,g.CLOSED])}],callbacks:[f.transitions.afterTransition({},l)]})},iceGatheringStateChange:function(a){this.model.set("iceGatheringState",a),this.stateMachine.trigger("iceG_"+a)},signalingStateChange:function(a){this.model.set("signalingState",a),this.stateMachine.trigger("sig_"+a)},iceConnectionStateChange:function(a){this.model.set("iceConnectionState",a),this.stateMachine.trigger("ice_"+a)},callDisconnected:function(a){this.stateMachine.disconnect(),this._updateDisconnectState(a),this.model.setCurrentState(this.stateMachine.getState())},_updateDisconnectState:function(a){var b=a&&a.code||"",c=a&&a.message||"";b&&(b="string"==typeof b?parseInt(b,10):b,this.model.set({disconnectCode:b,disconnectReason:{code:b,message:c}}))},getCurrentCallState:function(){return this.model.getCurrentState()},getDisconnectReason:function(){return this.model.getDisconnectReason()},callStateChange:function(a){"disconnected"!==a.to&&this.model.setCurrentState(a.to)},reset:function(){this.stateMachine.reset(),this.model.setCurrentState(this.stateMachine.getState())}});return new i}),define("WebRTC_SDK/manager/RTCTransactionManager",["require","my.Class","underscore","q","backbone","WebRTC_SDK/models/RTCTransactionModel","WebRTC_SDK/utilities/RTCBlueJay","WebRTC_SDK/RTCStates","Logger","WebRTC_SDK/manager/RTCStateManager"],function(a){var b=a("my.Class"),c=a("underscore"),d=(a("q"),a("backbone")),e=a("WebRTC_SDK/models/RTCTransactionModel"),f=a("WebRTC_SDK/utilities/RTCBlueJay"),g=(a("WebRTC_SDK/RTCStates"),a("Logger")),h=(a("WebRTC_SDK/manager/RTCStateManager"),b.Class({config:{requestTimeout:5e3,keepaliveTimeout:1e4,maxRetransmitAttempts:3},STATIC:{METHODS:f.METHODS},constructor:function(){c.bindAll(this),c.extend(this,d.Events),this.model=new e,this.requestTimers={}},onRequest:function(a){var b=this,c=function(){b.onRequestTimeout(a)};this.requestTimers[a]=setInterval(c,this.config.requestTimeout)},onBlueJayRequest:function(a){switch(this.model.addRequest(a.id,{method:a.method,message:a,state:"init",retransmitAttempts:0}),a.method){case f.METHODS.MUTE:var b=this.model.getMuteMessage();c.isUndefined(b)||this.removeRequestTransaction(b),this.model.addMuteMessage(a.id);break;case f.METHODS.TOKEN:var d=this.model.getTokenMessage();c.isUndefined(d)||this.removeRequestTransaction(d),this.model.addTokenMessage(a.id)}this.onRequest(a.id)},removeRequestTransaction:function(a){c.isUndefined(this.requestTimers[a])||(clearInterval(this.requestTimers[a]),delete this.requestTimers[a]),this.model.removeRequest(a)},onOutgoingBlueJayResponse:function(a,b){this.model.addResponse(a,{response:b})},onIncomingBlueJayResponse:function(a){var b=this.model.getRequest(a);if(c.isUndefined(b))this.model.get("bluejayKeepAlive").messageId==a&&this.model.addKeepAlive({messageId:a,state:"finished"});else switch(this.removeRequestTransaction(a),b.method){case f.METHODS.CONNECT:this.model.set("connectResponseReceived",!0),this.trigger("receivedConnectResponse");break;case f.METHODS.DISCONNECT:this.trigger("closeSocketConnection")}},lookupOutgoingResponse:function(a){return this.model.getResponse(a)},onKeepaliveRequest:function(a){this.model.addKeepAlive({messageId:a,state:"init"})},getKeepaliveMessageState:function(){return this.model.get("bluejayKeepAlive").state},onRequestTimeout:function(a){var b=this.model.getRequest(a);if(b.method===f.METHODS.DISCONNECT)return this.removeRequestTransaction(a),void this.trigger("closeSocketConnection");if(!c.isUndefined(b))switch(b.state){case"init":case"resend":this.retransmitRequest(b,a)}},retransmitRequest:function(a,b){a.retransmitAttempts>=this.config.maxRetransmitAttempts?(g.warn("RTCTransactionManager: Request timeout occured for - Method :"+a.method+" :: Id - "+b),this.removeRequestTransaction(b),this.trigger("requestTimeout",{messageId:b,method:a.method})):(a.state="resend",a.retransmitAttempts++,this.trigger("retransmitRequest",a.message),this.model.addRequest(b,a))},getRequestMessage:function(a){return this.model.getRequest(a).message},updateCallState:function(a){this.model.set("callState",a)},reset:function(){c.each(this.requestTimers,function(a){clearInterval(a)}),this.model.resetTransaction(),this.model.set("connectResponseReceived",!1)}}));return new h}),!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define("util",[],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.util=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"function"==typeof Object.create?b.exports=function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:b.exports=function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],2:[function(a,b,c){function d(){}var e=b.exports={};e.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.MutationObserver,c="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};var d=[];if(b){var e=document.createElement("div"),f=new MutationObserver(function(){var a=d.slice();d.length=0,a.forEach(function(a){a()})});return f.observe(e,{attributes:!0}),function(a){d.length||e.setAttribute("yes","no"),d.push(a)}}return c?(window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),d.length>0)){var c=d.shift();c()}},!0),function(a){d.push(a),window.postMessage("process-tick","*")}):function(a){setTimeout(a,0)}}(),e.title="browser",e.browser=!0,e.env={},e.argv=[],e.on=d,e.addListener=d,e.once=d,e.off=d,e.removeListener=d,e.removeAllListeners=d,e.emit=d,e.binding=function(a){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(a){throw new Error("process.chdir is not supported")}},{}],3:[function(a,b,c){b.exports=function(a){return a&&"object"==typeof a&&"function"==typeof a.copy&&"function"==typeof a.fill&&"function"==typeof a.readUInt8}},{}],4:[function(a,b,c){(function(b,d){function e(a,b){var d={seen:[],stylize:g};return arguments.length>=3&&(d.depth=arguments[2]),arguments.length>=4&&(d.colors=arguments[3]),p(b)?d.showHidden=b:b&&c._extend(d,b),v(d.showHidden)&&(d.showHidden=!1),v(d.depth)&&(d.depth=2),v(d.colors)&&(d.colors=!1),v(d.customInspect)&&(d.customInspect=!0),d.colors&&(d.stylize=f),i(d,a,d.depth)}function f(a,b){var c=e.styles[b];return c?"["+e.colors[c][0]+"m"+a+"["+e.colors[c][1]+"m":a}function g(a,b){return a}function h(a){var b={};return a.forEach(function(a,c){b[a]=!0}),b}function i(a,b,d){if(a.customInspect&&b&&A(b.inspect)&&b.inspect!==c.inspect&&(!b.constructor||b.constructor.prototype!==b)){var e=b.inspect(d,a);return t(e)||(e=i(a,e,d)),e}var f=j(a,b);if(f)return f;var g=Object.keys(b),p=h(g);if(a.showHidden&&(g=Object.getOwnPropertyNames(b)),z(b)&&(g.indexOf("message")>=0||g.indexOf("description")>=0))return k(b);if(0===g.length){if(A(b)){var q=b.name?": "+b.name:"";return a.stylize("[Function"+q+"]","special")}if(w(b))return a.stylize(RegExp.prototype.toString.call(b),"regexp");if(y(b))return a.stylize(Date.prototype.toString.call(b),"date");if(z(b))return k(b)}var r="",s=!1,u=["{","}"];if(o(b)&&(s=!0,u=["[","]"]),A(b)){var v=b.name?": "+b.name:"";r=" [Function"+v+"]"}if(w(b)&&(r=" "+RegExp.prototype.toString.call(b)),y(b)&&(r=" "+Date.prototype.toUTCString.call(b)),z(b)&&(r=" "+k(b)),0===g.length&&(!s||0==b.length))return u[0]+r+u[1];if(0>d)return w(b)?a.stylize(RegExp.prototype.toString.call(b),"regexp"):a.stylize("[Object]","special");a.seen.push(b);var x;return x=s?l(a,b,d,p,g):g.map(function(c){return m(a,b,d,p,c,s)}),a.seen.pop(),n(x,r,u)}function j(a,b){if(v(b))return a.stylize("undefined","undefined");if(t(b)){var c="'"+JSON.stringify(b).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a.stylize(c,"string")}return s(b)?a.stylize(""+b,"number"):p(b)?a.stylize(""+b,"boolean"):q(b)?a.stylize("null","null"):void 0}function k(a){return"["+Error.prototype.toString.call(a)+"]"}function l(a,b,c,d,e){for(var f=[],g=0,h=b.length;h>g;++g)D(b,String(g))?f.push(m(a,b,c,d,String(g),!0)):f.push("");return e.forEach(function(e){e.match(/^\d+$/)||f.push(m(a,b,c,d,e,!0))}),f}function m(a,b,c,d,e,f){var g,h,j;if(j=Object.getOwnPropertyDescriptor(b,e)||{value:b[e]},j.get?h=j.set?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):j.set&&(h=a.stylize("[Setter]","special")),D(d,e)||(g="["+e+"]"),h||(a.seen.indexOf(j.value)<0?(h=q(c)?i(a,j.value,null):i(a,j.value,c-1),h.indexOf("\n")>-1&&(h=f?h.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+h.split("\n").map(function(a){return"   "+a}).join("\n"))):h=a.stylize("[Circular]","special")),v(g)){if(f&&e.match(/^\d+$/))return h;g=JSON.stringify(""+e),g.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(g=g.substr(1,g.length-2),g=a.stylize(g,"name")):(g=g.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),g=a.stylize(g,"string"))}return g+": "+h}function n(a,b,c){var d=0,e=a.reduce(function(a,b){return d++,b.indexOf("\n")>=0&&d++,a+b.replace(/\u001b\[\d\d?m/g,"").length+1},0);return e>60?c[0]+(""===b?"":b+"\n ")+" "+a.join(",\n  ")+" "+c[1]:c[0]+b+" "+a.join(", ")+" "+c[1]}function o(a){return Array.isArray(a)}function p(a){return"boolean"==typeof a}function q(a){return null===a}function r(a){return null==a}function s(a){return"number"==typeof a}function t(a){return"string"==typeof a}function u(a){return"symbol"==typeof a}function v(a){return void 0===a}function w(a){return x(a)&&"[object RegExp]"===C(a)}function x(a){return"object"==typeof a&&null!==a}function y(a){return x(a)&&"[object Date]"===C(a)}function z(a){return x(a)&&("[object Error]"===C(a)||a instanceof Error)}function A(a){return"function"==typeof a}function B(a){return null===a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||"symbol"==typeof a||"undefined"==typeof a}function C(a){return Object.prototype.toString.call(a)}function D(a,b){return Object.prototype.hasOwnProperty.call(a,b)}var E=/%[sdj%]/g;c.format=function(a){if(!t(a)){for(var b=[],c=0;c<arguments.length;c++)b.push(e(arguments[c]));return b.join(" ")}for(var c=1,d=arguments,f=d.length,g=String(a).replace(E,function(a){if("%%"===a)return"%";if(c>=f)return a;switch(a){case"%s":return String(d[c++]);case"%d":return Number(d[c++]);case"%j":try{return JSON.stringify(d[c++])}catch(b){return"[Circular]"}default:return a}}),h=d[c];f>c;h=d[++c])g+=q(h)||!x(h)?" "+h:" "+e(h);return g},c.deprecate=function(a,e){function f(){if(!g){if(b.throwDeprecation)throw new Error(e);b.traceDeprecation,g=!0}return a.apply(this,arguments)}if(v(d.process))return function(){return c.deprecate(a,e).apply(this,arguments)};if(b.noDeprecation===!0)return a;var g=!1;return f};var F,G={};c.debuglog=function(a){if(v(F)&&(F=b.env.NODE_DEBUG||""),a=a.toUpperCase(),!G[a])if(new RegExp("\\b"+a+"\\b","i").test(F)){b.pid;G[a]=function(){c.format.apply(c,arguments)}}else G[a]=function(){};return G[a]},c.inspect=e,e.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},e.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},c.isArray=o,c.isBoolean=p,c.isNull=q,c.isNullOrUndefined=r,c.isNumber=s,c.isString=t,c.isSymbol=u,c.isUndefined=v,c.isRegExp=w,c.isObject=x,c.isDate=y,c.isError=z,c.isFunction=A,c.isPrimitive=B,c.isBuffer=a("./support/isBuffer");c.log=function(){},c.inherits=a("inherits"),c._extend=function(a,b){if(!b||!x(b))return a;for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a}}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":3,_process:2,inherits:1}],5:[function(a,b,c){b.exports=a("util")},{util:4}]},{},[5])(5)}),function(a){if("function"==typeof bootstrap)bootstrap("hark",a);else if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define("hark",a);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeHark=a}else"undefined"!=typeof window?window.hark=a():global.hark=a()}(function(){return function(a,b,c){function d(c,f){if(!b[c]){if(!a[c]){var g="function"==typeof require&&require;if(!f&&g)return g(c,!0);if(e)return e(c,!0);throw new Error("Cannot find module '"+c+"'")}var h=b[c]={exports:{}};a[c][0].call(h.exports,function(b){var e=a[c][1][b];return d(e?e:b)},h,h.exports)}return b[c].exports}for(var e="function"==typeof require&&require,f=0;f<c.length;f++)d(c[f]);return d}({1:[function(a,b,c){function d(a,b){var c=-(1/0);a.getFloatFrequencyData(b);for(var d=4,e=b.length;e>d;d++)b[d]>c&&b[d]<0&&(c=b[d]);return c}var e=a("wildemitter"),f=window.AudioContext||window.webkitAudioContext,g=null;b.exports=function(a,b){var c=new e;if(!f)return c;var b=b||{},h=b.smoothing||.1,i=b.interval||50,j=b.threshold,k=b.play,l=b.history||10,m=!0;g||(g=new f);var n,o,p;p=g.createAnalyser(),p.fftSize=512,p.smoothingTimeConstant=h,o=new Float32Array(p.fftSize),a.jquery&&(a=a[0]),a instanceof HTMLAudioElement||a instanceof HTMLVideoElement?(n=g.createMediaElementSource(a),"undefined"==typeof k&&(k=!0),j=j||-50):(n=g.createMediaStreamSource(a),
j=j||-50),n.connect(p),k&&p.connect(g.destination),c.speaking=!1,c.setThreshold=function(a){j=a},c.setInterval=function(a){i=a},c.stop=function(){m=!1,c.emit("volume_change",-100,j),c.speaking&&(c.speaking=!1,c.emit("stopped_speaking"))},c.speakingHistory=[];for(var q=0;l>q;q++)c.speakingHistory.push(0);var r=function(){setTimeout(function(){if(m){var a=d(p,o);c.emit("volume_change",a,j);var b=0;if(a>j&&!c.speaking){for(var e=c.speakingHistory.length-3;e<c.speakingHistory.length;e++)b+=c.speakingHistory[e];b>=2&&(c.speaking=!0,c.emit("speaking"))}else if(j>a&&c.speaking){for(var e=0;e<c.speakingHistory.length;e++)b+=c.speakingHistory[e];0==b&&(c.speaking=!1,c.emit("stopped_speaking"))}c.speakingHistory.shift(),c.speakingHistory.push(0+(a>j)),r()}},i)};return r(),c}},{wildemitter:2}],2:[function(a,b,c){function d(){this.callbacks={}}b.exports=d,d.prototype.on=function(a,b,c){var d=3===arguments.length,e=d?arguments[1]:void 0,f=d?arguments[2]:arguments[1];return f._groupName=e,(this.callbacks[a]=this.callbacks[a]||[]).push(f),this},d.prototype.once=function(a,b,c){function d(){e.off(a,d),h.apply(this,arguments)}var e=this,f=3===arguments.length,g=f?arguments[1]:void 0,h=f?arguments[2]:arguments[1];return this.on(a,g,d),this},d.prototype.releaseGroup=function(a){var b,c,d,e;for(b in this.callbacks)for(e=this.callbacks[b],c=0,d=e.length;d>c;c++)e[c]._groupName===a&&(e.splice(c,1),c--,d--);return this},d.prototype.off=function(a,b){var c,d=this.callbacks[a];return d?1===arguments.length?(delete this.callbacks[a],this):(c=d.indexOf(b),d.splice(c,1),this):this},d.prototype.emit=function(a){var b,c,d,e=[].slice.call(arguments,1),f=this.callbacks[a],g=this.getWildcardCallbacks(a);if(f)for(d=f.slice(),b=0,c=d.length;c>b&&d[b];++b)d[b].apply(this,e);if(g)for(c=g.length,d=g.slice(),b=0,c=d.length;c>b&&d[b];++b)d[b].apply(this,[a].concat(e));return this},d.prototype.getWildcardCallbacks=function(a){var b,c,d=[];for(b in this.callbacks)c=b.split("*"),("*"===b||2===c.length&&a.slice(0,c[0].length)===c[0])&&(d=d.concat(this.callbacks[b]));return d}},{}]},{},[1])(1)}),define("webrtcsupport",["require","exports","module"],function(a,b,c){var d,e;window.mozRTCPeerConnection||navigator.mozGetUserMedia?(d="moz",e=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10)):(window.webkitRTCPeerConnection||navigator.webkitGetUserMedia)&&(d="webkit",e=navigator.userAgent.match(/Chrom(e|ium)/)&&parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2],10));var f=window.mozRTCPeerConnection||window.webkitRTCPeerConnection,g=window.mozRTCIceCandidate||window.RTCIceCandidate,h=window.mozRTCSessionDescription||window.RTCSessionDescription,i=window.webkitMediaStream||window.MediaStream,j="https:"===window.location.protocol&&("webkit"===d&&e>=26||"moz"===d&&e>=33),k=window.AudioContext||window.webkitAudioContext,l=document.createElement("video"),m=l&&l.canPlayType&&"probably"===l.canPlayType('video/webm; codecs="vp8", vorbis'),n=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia;c.exports={prefix:d,browserVersion:e,support:!!f&&m&&!!n,supportRTCPeerConnection:!!f,supportVp8:m,supportGetUserMedia:!!n,supportDataChannel:!!(f&&f.prototype&&f.prototype.createDataChannel),supportWebAudio:!(!k||!k.prototype.createMediaStreamSource),supportMediaStream:!(!i||!i.prototype.removeTrack),supportScreenSharing:!!j,dataChannel:!!(f&&f.prototype&&f.prototype.createDataChannel),webAudio:!(!k||!k.prototype.createMediaStreamSource),mediaStream:!(!i||!i.prototype.removeTrack),screenSharing:!!j,AudioContext:k,PeerConnection:f,SessionDescription:h,IceCandidate:g,MediaStream:i,getUserMedia:n}}),function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define("getusermedia",[],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.getUserMedia=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){b.exports=function(a,b){var c,d=2===arguments.length,e={video:!0,audio:!0},f="PermissionDeniedError",g="PERMISSION_DENIED",h="ConstraintNotSatisfiedError";return d||(b=a,a=e),"undefined"!=typeof navigator&&navigator.getUserMedia?a.audio||a.video?void navigator.mediaDevices.getUserMedia(a).then(function(a){b(null,a)})["catch"](function(a){var c;"string"==typeof a?(c=new Error("MediaStreamError"),a===f||a===g?c.name=f:c.name=h):(c=a,c.name||(c[f]?a.name=f:a.name=h)),b(c)}):(c=new Error("MediaStreamError"),c.name="NoMediaRequestedError",setTimeout(function(){b(c)},0)):(c=new Error("MediaStreamError"),c.name="NotSupportedError",setTimeout(function(){b(c)},0))}},{}]},{},[1])(1)}),!function(a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define("getscreenmedia",a):"undefined"!=typeof window?window.getScreenMedia=a():"undefined"!=typeof global?global.getScreenMedia=a():"undefined"!=typeof self&&(self.getScreenMedia=a())}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d=a("getusermedia"),e={};b.exports=function(a,b){var c,f=2===arguments.length,g=f?b:a;if("undefined"==typeof window||"http:"===window.location.protocol)return c=new Error("NavigatorUserMediaError"),c.name="HTTPS_REQUIRED",g(c);if(window.navigator.userAgent.match("Chrome")){var h=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),i=33,j=!window.chrome.webstore;if(window.navigator.userAgent.match("Linux")&&(i=35),j||h>=26&&i>=h)a=f&&a||{video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3,chromeMediaSource:"screen"}}},d(a,g);else{var k=window.setTimeout(function(){return c=new Error("NavigatorUserMediaError"),c.name="EXTENSION_UNAVAILABLE",g(c)},1e3);e[k]=[g,f?constraint:null],window.postMessage({type:"getScreen",id:k},"*")}}else if(window.navigator.userAgent.match("Firefox")){var l=parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10);l>=33?(a=f&&a||{video:{mozMediaSource:"window",mediaSource:"window"}},d(a,function(a,b){if(g(a,b),!a)var c=b.currentTime,d=window.setInterval(function(){b||window.clearInterval(d),b.currentTime==c&&(window.clearInterval(d),b.onended&&b.onended()),c=b.currentTime},500)})):(c=new Error("NavigatorUserMediaError"),c.name="EXTENSION_UNAVAILABLE")}},window.addEventListener("message",function(a){if(a.origin==window.location.origin)if("gotScreen"==a.data.type&&e[a.data.id]){var b=e[a.data.id],c=b[1],f=b[0];if(delete e[a.data.id],""===a.data.sourceId){var g=new Error("NavigatorUserMediaError");g.name="PERMISSION_DENIED",f(g)}else c=c||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},c.video.mandatory.chromeMediaSourceId=a.data.sourceId,d(c,f)}else"getScreenPending"==a.data.type&&window.clearTimeout(a.data.id)})},{getusermedia:2}],2:[function(a,b,c){var d=window.navigator.getUserMedia||window.navigator.webkitGetUserMedia||window.navigator.mozGetUserMedia||window.navigator.msGetUserMedia;b.exports=function(a,b){var c,e=2===arguments.length,f={video:!0,audio:!0},g="PermissionDeniedError",h="ConstraintNotSatisfiedError";if(e||(b=a,a=f),!d)return c=new Error("MediaStreamError"),c.name="NotSupportedError",window.setTimeout(function(){b(c)},0);var i=window.location.protocol;return"http:"!==i&&"https:"!==i?(c=new Error("MediaStreamError"),c.name="NotSupportedError",window.setTimeout(function(){b(c)},0)):a.audio||a.video?(localStorage&&"true"===localStorage.useFirefoxFakeDevice&&(a.fake=!0),void d.call(window.navigator,a,function(a){b(null,a)},function(a){var c;"string"==typeof a?(c=new Error("MediaStreamError"),a===g?c.name=g:c.name=h):(c=a,c.name||(c[g]?a.name=g:a.name=h)),b(c)})):(c=new Error("MediaStreamError"),c.name="NoMediaRequestedError",window.setTimeout(function(){b(c)},0))}},{}]},{},[1])(1)}),define("wildemitter",["require","exports","module"],function(a,b,c){function d(){this.callbacks={}}c.exports=d,d.prototype.on=function(a,b,c){var d=3===arguments.length,e=d?arguments[1]:void 0,f=d?arguments[2]:arguments[1];return f._groupName=e,(this.callbacks[a]=this.callbacks[a]||[]).push(f),this},d.prototype.once=function(a,b,c){function d(){e.off(a,d),h.apply(this,arguments)}var e=this,f=3===arguments.length,g=f?arguments[1]:void 0,h=f?arguments[2]:arguments[1];return this.on(a,g,d),this},d.prototype.releaseGroup=function(a){var b,c,d,e;for(b in this.callbacks)for(e=this.callbacks[b],c=0,d=e.length;d>c;c++)e[c]._groupName===a&&(e.splice(c,1),c--,d--);return this},d.prototype.off=function(a,b){var c,d=this.callbacks[a];return d?1===arguments.length?(delete this.callbacks[a],this):(c=d.indexOf(b),d.splice(c,1),0===d.length&&delete this.callbacks[a],this):this},d.prototype.emit=function(a){var b,c,d,e=[].slice.call(arguments,1),f=this.callbacks[a],g=this.getWildcardCallbacks(a);if(f)for(d=f.slice(),b=0,c=d.length;c>b&&d[b];++b)d[b].apply(this,e);if(g)for(c=g.length,d=g.slice(),b=0,c=d.length;c>b&&d[b];++b)d[b].apply(this,[a].concat(e));return this},d.prototype.getWildcardCallbacks=function(a){var b,c,d=[];for(b in this.callbacks)c=b.split("*"),("*"===b||2===c.length&&a.slice(0,c[0].length)===c[0])&&(d=d.concat(this.callbacks[b]));return d}}),!function(a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define("mediastream-gain",a):"undefined"!=typeof window?window.MediaStreamGainController=a():"undefined"!=typeof global?global.MediaStreamGainController=a():"undefined"!=typeof self&&(self.MediaStreamGainController=a())}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(a){if(this.support=e.webAudio&&e.mediaStream,this.gain=1,this.support){var b=this.context=new e.AudioContext;this.microphone=b.createMediaStreamSource(a),this.gainFilter=b.createGain(),this.destination=b.createMediaStreamDestination(),this.outputStream=this.destination.stream,this.microphone.connect(this.gainFilter),this.gainFilter.connect(this.destination),a.addTrack(this.outputStream.getAudioTracks()[0]),a.removeTrack(a.getAudioTracks()[0])}this.stream=a}var e=a("webrtcsupport");d.prototype.setGain=function(a){this.support&&(this.gainFilter.gain.value=a,this.gain=a)},d.prototype.getGain=function(){return this.gain},d.prototype.off=function(){return this.setGain(0)},d.prototype.on=function(){this.setGain(1)},b.exports=d},{webrtcsupport:2}],2:[function(a,b,c){var d,e=!1,f=!1,g=window.navigator.userAgent.toLowerCase();-1!==g.indexOf("firefox")?(d="moz",f=!0):-1!==g.indexOf("chrome")&&(d="webkit",e=!0);var h=window.mozRTCPeerConnection||window.webkitRTCPeerConnection,i=window.mozRTCIceCandidate||window.RTCIceCandidate,j=window.mozRTCSessionDescription||window.RTCSessionDescription,k=window.webkitMediaStream||window.MediaStream,l=window.navigator.userAgent.match("Chrome")&&parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10)>=26,m=window.AudioContext;b.exports={support:!!h,dataChannel:e||f||h&&h.prototype&&h.prototype.createDataChannel,prefix:d,webAudio:!(!m||!m.prototype.createMediaStreamSource),mediaStream:!(!k||!k.prototype.removeTrack),screenSharing:!!l,AudioContext:m,PeerConnection:h,SessionDescription:j,IceCandidate:i}},{}]},{},[1])(1)}),function(a){if("function"==typeof bootstrap)bootstrap("mockconsole",a);else if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define("mockconsole",a);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeMockconsole=a}else"undefined"!=typeof window?window.mockconsole=a():global.mockconsole=a()}(function(){return function(a,b,c){function d(c,f){if(!b[c]){if(!a[c]){var g="function"==typeof require&&require;if(!f&&g)return g(c,!0);if(e)return e(c,!0);throw new Error("Cannot find module '"+c+"'")}var h=b[c]={exports:{}};a[c][0].call(h.exports,function(b){var e=a[c][1][b];return d(e?e:b)},h,h.exports)}return b[c].exports}for(var e="function"==typeof require&&require,f=0;f<c.length;f++)d(c[f]);return d}({1:[function(a,b,c){for(var d="assert,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,time,timeEnd,trace,warn".split(","),e=d.length,f=function(){},g={};e--;)g[d[e]]=f;b.exports=g},{}]},{},[1])(1)}),define("localmedia",["require","util","hark","webrtcsupport","getusermedia","getscreenmedia","wildemitter","mediastream-gain","mockconsole"],function(a){function b(a){h.call(this);var b,c=this.config={autoAdjustMic:!1,detectSpeakingEvents:!0,audioFallback:!1,media:{audio:!0,video:!0},logger:j};for(b in a)this.config[b]=a[b];this.logger=c.logger,this._log=this.logger.log.bind(this.logger,"LocalMedia:"),this._logerror=this.logger.error.bind(this.logger,"LocalMedia:"),this.screenSharingSupport=e.screenSharing,this.localStreams=[],this.localScreens=[],e.support||this._logerror("Your browser does not support local media capture.")}var c=a("util"),d=a("hark"),e=a("webrtcsupport"),f=a("getusermedia"),g=a("getscreenmedia"),h=a("wildemitter"),i=a("mediastream-gain"),j=a("mockconsole");return c.inherits(b,h),b.prototype.start=function(a,b){var c=this,d=a||this.config.media;f(d,function(a,e){if(a){if(c.config.audioFallback&&"DevicesNotFoundError"===a.name&&d.video!==!1)return d.video=!1,void c.start(d,b)}else d.audio&&c.config.detectSpeakingEvents&&c.setupAudioMonitor(e,c.config.harkOptions),c.localStreams.push(e),c.config.autoAdjustMic&&(c.gainController=new i(e),c.setMicIfEnabled(.5)),e.onended=function(){},c.emit("localStream",e);return b?b(a,e):void 0})},b.prototype.stop=function(a){var b=this;if(a){a.getTracks().forEach(function(a){a.stop()});var c=b.localStreams.indexOf(a);c>-1?(b.emit("localStreamStopped",a),b.localStreams=b.localStreams.splice(c,1)):(c=b.localScreens.indexOf(a),c>-1&&(b.emit("localScreenStopped",a),b.localScreens=b.localScreens.splice(c,1)))}else this.stopStreams(),this.stopScreenShare()},b.prototype.stopStreams=function(){var a=this;this.audioMonitor&&(this.audioMonitor.stop(),delete this.audioMonitor),this.localStreams.forEach(function(b){b.getTracks().forEach(function(a){a.stop()}),a.emit("localStreamStopped",b)}),this.localStreams=[]},b.prototype.startScreenShare=function(a){var b=this;g(function(c,d){return c||(b.localScreens.push(d),d.onended=function(){var a=b.localScreens.indexOf(d);a>-1&&b.localScreens.splice(a,1),b.emit("localScreenStopped",d)},b.emit("localScreen",d)),a?a(c,d):void 0})},b.prototype.stopScreenShare=function(a){var b=this;a?(a.getTracks().forEach(function(a){a.stop()}),this.emit("localScreenStopped",a)):(this.localScreens.forEach(function(a){a.getTracks().forEach(function(a){a.stop()}),b.emit("localScreenStopped",a)}),this.localScreens=[])},b.prototype.mute=function(){this._audioEnabled(!1),this.hardMuted=!0,this.emit("audioOff")},b.prototype.unmute=function(){this._audioEnabled(!0),this.hardMuted=!1,this.emit("audioOn")},b.prototype.setupAudioMonitor=function(a,b){this._log("Setup audio");var c,e=this.audioMonitor=d(a,b),f=this;e.on("speaking",function(){f.emit("speaking"),f.hardMuted||f.setMicIfEnabled(1)}),e.on("stopped_speaking",function(){c&&clearTimeout(c),c=setTimeout(function(){f.emit("stoppedSpeaking"),f.hardMuted||f.setMicIfEnabled(.5)},1e3)}),e.on("volume_change",function(a,b){f.emit("volumeChange",a,b)})},b.prototype.setMicIfEnabled=function(a){this.config.autoAdjustMic&&this.gainController.setGain(a)},b.prototype.pauseVideo=function(){this._videoEnabled(!1),this.emit("videoOff")},b.prototype.resumeVideo=function(){this._videoEnabled(!0),this.emit("videoOn")},b.prototype.pause=function(){this.mute(),this.pauseVideo()},b.prototype.resume=function(){this.unmute(),this.resumeVideo()},b.prototype._audioEnabled=function(a){this.setMicIfEnabled(a?1:0),this.localStreams.forEach(function(b){b.getAudioTracks().forEach(function(b){b.enabled=!!a})})},b.prototype._videoEnabled=function(a){this.localStreams.forEach(function(b){b.getVideoTracks().forEach(function(b){b.enabled=!!a})})},b.prototype.isAudioEnabled=function(){var a=!0;return this.localStreams.forEach(function(b){b.getAudioTracks().forEach(function(b){a=a&&b.enabled})}),a},b.prototype.isVideoEnabled=function(){var a=!0;return this.localStreams.forEach(function(b){b.getVideoTracks().forEach(function(b){a=a&&b.enabled})}),a},b.prototype.startLocalMedia=b.prototype.start,b.prototype.stopLocalMedia=b.prototype.stop,Object.defineProperty(b.prototype,"localStream",{get:function(){return this.localStreams.length>0?this.localStreams[0]:null}}),Object.defineProperty(b.prototype,"localScreen",{get:function(){return this.localScreens.length>0?this.localScreens[0]:null}}),b}),!function(a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define("attachmediastream",a):"undefined"!=typeof window?window.attachMediaStream=a():"undefined"!=typeof global?global.attachMediaStream=a():"undefined"!=typeof self&&(self.attachMediaStream=a())}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){b.exports=function(a,b,c){var d,e=(window.URL,b),f={autoplay:!0,mirror:!1,muted:!1,audio:!1,disableContextMenu:!1};if(c)for(d in c)f[d]=c[d];return e?"audio"===e.tagName.toLowerCase()&&(f.audio=!0):e=document.createElement(f.audio?"audio":"video"),f.disableContextMenu&&(e.oncontextmenu=function(a){a.preventDefault()}),f.autoplay&&(e.autoplay="autoplay"),f.muted&&(e.muted=!0),!f.audio&&f.mirror&&["","moz","webkit","o","ms"].forEach(function(a){var b=a?a+"Transform":"transform";e.style[b]="scaleX(-1)"}),e.srcObject=a,e}},{}]},{},[1])(1)}),define("WebRTC_SDK/manager/RTCLocalMediaManager",["require","my.Class","underscore","Logger","backbone","q","WebRTC_SDK/utilities/RTCUtils","WebRTC_SDK/utilities/RTCErrors","WebRTC_SDK/utilities/RTCBlueJay","WebRTC_SDK/manager/RTCSignallingManager","WebRTC_SDK/manager/RTCTransactionManager","localmedia","attachmediastream","hark","browserDetector"],function(a){var b=a("my.Class"),c=a("underscore"),d=a("Logger"),e=a("backbone"),f=a("q"),g=a("WebRTC_SDK/utilities/RTCUtils"),h=a("WebRTC_SDK/utilities/RTCErrors"),i=a("WebRTC_SDK/utilities/RTCBlueJay"),j=a("WebRTC_SDK/manager/RTCSignallingManager"),k=a("WebRTC_SDK/manager/RTCTransactionManager"),l=a("localmedia"),m=a("attachmediastream"),n=a("hark"),o=a("browserDetector"),p=e.Model.extend({defaults:{previewStream:null,localStream:null,localAudioStream:null,localVideoStream:null,remoteStream:null,localAudioMuted:!1,localVideoMuted:!1,remoteAudioMuted:!1,remoteVideoMuted:!1,localStreamStopped:!1,availableDevices:{audioIn:[],videoIn:[],audioOut:[]},selectedMic:null,selectedCamera:null,selectedSpeaker:null,volumeLevel:0,isSpeaking:!1}}),q=b.Class({chromeConfig:{mediaConstraints:{audio:{advanced:[{googEchoCancellation:!0},{googAutoGainControl:!0},{googNoiseSuppression:!0},{googHighpassFilter:!0},{googAudioMirroring:!1},{googNoiseSuppression2:!0},{googEchoCancellation2:!0},{googAutoGainControl2:!0},{googDucking:!1}]},video:{width:{min:1280,max:1280},height:{min:720,max:720}}},selfViewConfig:{autoplay:!0,mirror:!0,muted:!0},volumeMonitoring:{interval:300,threshold:-50}},firefoxConfig:{mediaConstraints:{audio:{advanced:[{echoCancellation:!0},{mozAutoGainControl:!0},{mozNoiseSuppression:!0}]},video:{width:{min:"640",ideal:"1280"},height:{min:"360",ideal:"720"}}},selfViewConfig:{autoplay:!0,mirror:!0,muted:!0},volumeMonitoring:{interval:300,threshold:-50}},volumeMonitor:null,isSignallingChannelReady:!1,vadCount:0,constructor:function(a){c.bindAll(this),c.extend(this,e.Events),this.config="firefox"===o.browser?this.firefoxConfig:this.chromeConfig,this.config=g.deepMergeObjects(this.config,a),this.model=new p,this.localMedia=new l(this.config),this.cachedMediaConstraints=this.config.mediaConstraints,k.on("receivedConnectResponse",this.onReceiveConnectResponse)},startMedia:function(a,b){var c=this,d=f.defer(),e=g.deepMergeObjects(this.cachedMediaConstraints,a),h=this.cachedMediaConstraints;return this._startMedia(e,b).then(function(a){d.resolve(a),c.detectDeviceChange(h,e)},function(a){d.reject(a)}),this.cachedMediaConstraints=e,d.promise},_startMedia:function(a,b){var e=f.defer(),g=this,i=this.hasMicPreferenceChanged(this.cachedMediaConstraints,a),j=this.hasCameraPreferenceChanged(this.cachedMediaConstraints,a),k=[],l=!1;if("firefox"===o.browser&&"preview_stream"===b&&!i&&!j){var m=this.model.get("localStream");if(this.stopPreviewStream(),!c.isUndefined(m)&&!c.isNull(m)){var n=m.clone();n.bjn_label="preview_stream",n.getTracks().forEach(function(a){a.enabled=!0}),this.model.set("previewStream",n),k.push(n),e.resolve(k),l=!0}}return l||("firefox"===o.browser&&(this.stopLocalStreams(),this.stopPreviewStream(),this.stopVolumeMonitor(),this.stopLocalStreamClone()),"firefox"===o.browser&&a.audio===!1&&a.video===!1?(k=g.startMediaSuccess({stream:null,type:b,micChanged:!1,cameraChanged:!1}),e.reject(h.GET_LOCAL_MEDIA_STATES.DevicesNotFoundError)):this.localMedia.start(a,function(a,c){if(a){var f=h.translateGetUserMediaError(a);d.error("RTCLocalMediaManager: Error in get user media: ",JSON.stringify(f)),e.reject(f)}else g.startMediaSuccess({stream:c,type:b,micChanged:i,cameraChanged:j}).then(function(a){e.resolve(a)})})),e.promise},startMediaSuccess:function(a){var b=null,c=a.stream,e=null,g=this.model.get("localVideoMuted"),h=[],i=this,j=f.defer();return"firefox"===o.browser&&c&&this.saveLocalStream(c),"local_stream"===a.type?(this.createLocalStreams(c).then(function(a){j.resolve(a)}),j.promise):(this.stopPreviewStream(),b=c,b.bjn_label="preview_stream",b.onended=function(){d.warn("RTCLocalMediaManager: Preview stream has ended. Id: ",this.id)},h.push(b),a.micChanged||!g&&a.cameraChanged||a.cameraChanged&&"firefox"===o.browser?(this.stopLocalStreams(),e=c.clone(),this.model.set("previewStream",b),this.createLocalStreams(e).then(function(a){h=h.concat(a),i.trigger("localStreamsChanged"),j.resolve(h)}),j.promise):(this.model.set("previewStream",b),j.resolve(h),j.promise))},createLocalStreams:function(a){var b=f.defer(),c=null,e=[],g=this,h=[];return c=this.hasVideoTracks(a)&&this.hasAudioTracks(a)?a.clone():a,h.push(this.extractAudioOnlyStream(a).then(function(a){a&&(e.push(a),g.model.set("localAudioStream",a))},function(a){d.error("RTCLocalMediaManager :: error while extracting audio stream",a)})),h.push(this.extractVideoOnlyStream(c).then(function(a){a&&(e.push(a),g.model.set("localVideoStream",a))},function(a){d.error("RTCLocalMediaManager :: error while extracting audio stream",a)})),f.all(h).then(function(){b.resolve(e)},function(a){d.error("RTCLocalMediaManager: Failed to create local streams"),b.reject(a)}),b.promise},saveLocalStream:function(a){var b=this.model.get("localStream");b&&(this.localMedia.stop(b),b=null);var c=a.clone();c.getTracks().forEach(function(a){a.enabled=!1}),c.label="local_stream",this.model.set("localStream",c)},hasMicPreferenceChanged:function(a,b){var d=this.getSourceId(a.audio),e=this.getSourceId(b.audio);return c.isNull(e)||d===e?!1:!0},hasCameraPreferenceChanged:function(a,b){var d=this.getSourceId(a.video),e=this.getSourceId(b.video);return c.isNull(e)||d===e?!1:!0},getSourceId:function(a){var b=null;return a.deviceId&&(b=a.deviceId),b},hasAudioTracks:function(a){return a&&a.getAudioTracks().length>0},hasVideoTracks:function(a){return a&&a.getVideoTracks().length>0},extractAudioOnlyStream:function(a){var b=f.defer(),c=this.model.get("localAudioMuted"),e=this,g=function(a){return c&&a.getAudioTracks().forEach(function(a){a.enabled=!c}),a.bjn_label="local_audio_stream",a.getAudioTracks()[0].onended=function(){d.warn("RTCLocalMediaManager: Local Audio track has ended. Id: ",this.id),e.model.set("localAudioStream",null)},a};if(this.hasAudioTracks(a)){var h=a;h.getVideoTracks().length>0&&(h.getVideoTracks()[0].stop(),h.removeTrack(h.getVideoTracks()[0])),h=g(h),b.resolve(h)}else"firefox"===o.browser?navigator.mediaDevices.getUserMedia({audio:!0,fake:!0}).then(function(a){var d=a;c=!0,d=g(d),b.resolve(d)},function(a){d.debug("RTCLocalMediaManager :: Error creating audio fake stream"),b.reject(a)}):b.resolve(null);return b.promise},extractVideoOnlyStream:function(a){var b=f.defer(),c=this.model.get("localVideoMuted"),e=this,g=function(a,b){return c&&a.getVideoTracks().forEach(function(a){"firefox"!==o.browser||b?a.stop():a.enabled=!c}),a.bjn_label="local_video_stream",a.getVideoTracks()[0].onended=function(){d.warn("RTCLocalMediaManager: Local Video track has ended. Id: ",this.id),e.model.set("localVideoStream",null)},a};if(this.hasVideoTracks(a)){var h=a;h.getAudioTracks().length>0&&(h.getAudioTracks()[0].stop(),h.removeTrack(h.getAudioTracks()[0])),h=g(h,!1),b.resolve(h)}else"firefox"===o.browser?navigator.mediaDevices.getUserMedia({video:!0,fake:!0}).then(function(a){var d=a;c=!0,d=g(d,!0),b.resolve(d)},function(a){d.debug("RTCLocalMediaManager :: Error creating fake stream"),b.reject(a)}):b.resolve(null);return b.promise},stopLocalStreams:function(){this.stopLocalAudioStream(),this.stopLocalVideoStream()},stopLocalAudioStream:function(){this.stopMedia(this.model.get("localAudioStream"),"localAudioStream")},stopLocalVideoStream:function(){this.stopMedia(this.model.get("localVideoStream"),"localVideoStream")},stopPreviewStream:function(){this.stopMedia(this.model.get("previewStream"),"previewStream")},stopLocalStreamClone:function(){this.stopMedia(this.model.get("localStream"),"localStream")},stopMedia:function(a,b){c.isNull(a)||c.isUndefined(a)||(this.localMedia.stop(a),d.debug("RTCLocalMediaManager: "+b+" has been stopped."),this.model.set(b,null,{silent:!0}))},renderStream:function(a){return a.config=c.defaults({autoplay:!0,mirror:!1,muted:!1},a.config),this.attachMediaStream(a)},renderSelfView:function(a){return a.config=c.defaults(this.config.selfViewConfig,a.config),this.attachMediaStream(a)},attachMediaStream:function(a){return a.stream&&a.el?(a.el&&(a.el.oncontextmenu=function(){return!1}),m(a.stream,a.el,a.config)):(d.error("RTCLocalMediaManager: Incorrect params passed to attachmediastream API. stream: "+a.stream+", el: "+a.el),null)},getDevices:function(){var a=this,b=f.defer(),d="",e="",g={audioIn:null,videoIn:null};this.model.get("localAudioStream")&&(d=this.model.get("localAudioStream").getAudioTracks()[0].label),this.model.get("localVideoStream")&&(e=this.model.get("localVideoStream").getVideoTracks()[0].label);var h=function(f){var h={audioIn:[],videoIn:[],audioOut:[]};c.each(f,function(b,c,f){"audio"===b.kind||"audioinput"===b.kind?(h.audioIn.push(a.translateDeviceInfo(b)),b.label===d&&(g.audioIn=b)):"video"===b.kind||"videoinput"===b.kind?(h.videoIn.push(a.translateDeviceInfo(b)),b.label===e&&(g.videoIn=b)):"audiooutput"===b.kind&&h.audioOut.push(a.translateDeviceInfo(b))}),a.model.set("availableDevices",h),b.resolve({available:h,selected:g})},i=function(a){b.reject("Error in navigator.mediaDevices.enumerateDevices API")};return navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then(h)["catch"](i):MediaStreamTrack.getSources?MediaStreamTrack.getSources(h):b.reject("Browser doesn't support MediaStreamTrack.getSources API"),b.promise},translateDeviceInfo:function(a){var b=a.id||a.deviceId;return"audiooutput"===a.kind&&(b=this.transformSpeakerId(b,!0)),{id:b,label:a.label,kind:a.kind,facing:a.facing,groupId:a.groupId}},transformSpeakerId:function(a,b){var c="_speaker";return b?a+c:(a&&-1!==a.indexOf(c)&&(a=a.split(c)[0]),a)},updateStream:function(a){c.isUndefined(a.remoteStream)||this.model.set("remoteStream",a.remoteStream)},muteStreams:function(a){var b=f.defer(),e=[];return c.isUndefined(a.localAudio)||e.push(this.muteLocalAudio(a.localAudio)),c.isUndefined(a.localVideo)||e.push(this.muteLocalVideo(a.localVideo)),c.isUndefined(a.remoteAudio)||e.push(this.muteRemoteAudio(a.remoteAudio)),c.isUndefined(a.remoteVideo)||e.push(this.muteRemoteVideo(a.remoteVideo)),f.all(e).then(function(){b.resolve()},function(){d.error("RTCLocalMediaManager: Failed to mute local/remote stream")}),b.promise},muteLocalAudio:function(a){var b=f.defer(),e=this.model.get("localAudioStream"),g=this.isAudioMuted(e),h=c.isBoolean(a)&&g!==a;return h?(c.isNull(e)||c.isUndefined(e)?d.warn("Local Audio stream is null, cannot mute/unmute local audio"):(d.debug("RTCLocalMediaManager: "+(a?"Muting ":"Unmuting ")+"local audio stream now"),e.getAudioTracks().forEach(function(b){b.enabled=!a}),this.model.set("localAudioMuted",a),d.debug("RTCLocalMediaManager: Local Audio ",a?"muted":"unmuted")),b.resolve(),b.promise):(d.debug("Local Audio is already "+(g?"muted.":"unmuted.")+" Ignoring the mute request."),b.resolve(),b.promise)},muteLocalVideo:function(a){var b=f.defer(),e=this.model.get("localVideoMuted"),g=c.isBoolean(a)&&e!==a;return g?(a?this._stopLocalVideo(b):this._resumeLocalVideo(b),b.promise):(d.debug("Local Video is already "+(e?"muted.":"unmuted.")+" Ignoring the mute request."),b.resolve(),b.promise)},_stopLocalVideo:function(a){var b=null;b=this.model.get("localVideoStream"),c.isNull(b)||c.isUndefined(b)?d.warn("Local Video stream is null, cannot mute/unmute local video"):(d.debug("RTCLocalMediaManager: Stopping/Muting local video stream now"),b.getVideoTracks().forEach(function(a){"firefox"===o.browser?a.enabled=!1:a.stop()}),d.debug("RTCLocalMediaManager: Local Video muted")),this.model.set("localVideoMuted",!0),a.resolve()},_resumeLocalVideo:function(a){var b=g.deepMergeObjects(this.cachedMediaConstraints,{audio:!1});if(this.model.set("localVideoMuted",!1),"firefox"===o.browser){var e=this.model.get("localVideoStream");c.isNull(e)||c.isUndefined(e)||e.getVideoTracks().forEach(function(a){a.enabled=!0}),a.resolve()}else this._startMedia(b,"local_stream").then(function(b){d.debug("RTCLocalMediaManager: Local Video unmuted"),a.resolve()},function(b){d.warn("RTCLocalMediaManager: Failed to get local video stream: "+b),a.resolve()})},muteRemoteAudio:function(a){var b=f.defer(),e=this.model.get("remoteStream");return c.isNull(e)||c.isUndefined(e)?d.warn("Remote stream is null, cannot mute/unmute remote audio"):(e.getAudioTracks().forEach(function(b){b.enabled=!a}),this.model.set("remoteAudioMuted",a)),b.resolve(),b.promise},muteRemoteVideo:function(a){var b=f.defer(),e=this.model.get("remoteStream");return c.isNull(e)||c.isUndefined(e)?d.warn("Remote stream is null, cannot mute/unmute remote video"):(e.getVideoTracks().forEach(function(b){b.enabled=!a}),this.model.set("remoteVideoMuted",a)),b.resolve(),b.promise},isAudioMuted:function(a){var b=!0;return c.isNull(a)||c.isUndefined(a)||a.getAudioTracks().forEach(function(a){
b=b&&!a.enabled}),b},startVolumeMonitor:function(a,b){c.extend(this.config.volumeMonitoring,b);var e=a.clone();e.getAudioTracks().forEach(function(a){a.enabled=!0}),e.getVideoTracks().forEach(function(a){a.stop()}),this.volumeMonitor=n(e,b),this.volumeMonitor.monitoredStream=e,this.volumeMonitor.on("volume_change",this.volumeLevelChanged),d.debug("RTCLocalMediaManager: Started volume monitor")},volumeLevelChanged:function(a,b){var c=Math.abs(1-Math.abs(a/100));"number"==typeof c&&(c=parseFloat(c.toFixed(3)));var d=1>c?c:0;this.model.set("volumeLevel",d),this.checkIfSpeaking(a)},checkIfSpeaking:function(a){var b=20,c=140/b,d=260/b;a>=this.config.volumeMonitoring.threshold?(this.vadCount++,this.vadCount>=c&&(this.vadCount=d+c)):(this.vadCount--,this.vadCount<c&&(this.vadCount=0)),this.model.set("isSpeaking",this.vadCount>=c?!0:!1)},stopVolumeMonitor:function(){c.isNull(this.volumeMonitor)||(d.debug("RTCLocalMediaManager: Stopping volume monitor"),this.volumeMonitor.monitoredStream&&(this.volumeMonitor.monitoredStream.getTracks().forEach(function(a){a.stop()}),this.volumeMonitor.monitoredStream=null),this.volumeMonitor.stop())},setSpeaker:function(a){var b=this,d=a.mediaElements,e=a.speakerId;c.each(d,function(a){a&&"function"==typeof a.setSinkId&&e&&a.setSinkId(b.transformSpeakerId(e,!1))}),e&&e!==this.model.get("selectedSpeaker")&&(this.model.set("selectedSpeaker",e),this.sendDeviceInfo())},detectCameraStatus:function(a){var b,c=this,e=f.defer(),g="local_stream"===a?this.model.get("localVideoStream"):this.model.get("previewStream");return g&&"function"==typeof g.getVideoTracks?(b=g.getVideoTracks()[0],b?window.setTimeout(function(){var f="local_stream"===a?c.model.get("localVideoMuted"):!1;"ended"!==b.readyState||f?e.resolve(h.GET_LOCAL_MEDIA_STATES.AVAILABLE):(d.warn("RTCLocalMediaManager: Camera feed is unavailable, faulty camera or its in use by another program"),e.resolve(h.GET_LOCAL_MEDIA_STATES.SOURCE_UNAVAILABLE))},500):(d.warn("RTCLocalMediaManager: Stream doesn't have any video tracks"),e.resolve(h.GET_LOCAL_MEDIA_STATES.SOURCE_UNAVAILABLE))):e.resolve(h.GET_LOCAL_MEDIA_STATES.DEVICES_NOT_FOUND),e.promise},detectDeviceChange:function(a,b){var c=this.hasMicPreferenceChanged(a,b),d=this.hasCameraPreferenceChanged(a,b);this.model.set("selectedCamera",this.getSourceId(b.video)),this.model.set("selectedMic",this.getSourceId(b.audio)),(c||d)&&this.sendDeviceInfo()},sendDeviceInfo:function(){if(this.isSignallingChannelReady){var a=this.model.get("selectedMic"),b=this.model.get("selectedCamera"),c=this.model.get("selectedSpeaker"),e=this.getDeviceLabel(a,"audioIn"),f=this.getDeviceLabel(b,"videoIn"),g=this.getDeviceLabel(c,"audioOut");d.debug("RTCLocalMediaManager: Devices in use, Mic - "+e+", Camera - "+f+", Speaker - "+g);var h=i.getInfoMsg({type:"deviceinfo",device:{input:{audio:e,video:f},output:{audio:g,video:"Default"}}});j.sendMsg(h),k.onBlueJayRequest(h)}},getDeviceLabel:function(a,b){var d=null,e=this.model.get("availableDevices");return c.each(e[b],function(b,c,e){b.id===a&&(d=b.label)}),d},onReceiveConnectResponse:function(){this.isSignallingChannelReady=!0},close:function(){this.stopMediaCapture(),this.isSignallingChannelReady=!1,this.model.clear().set(p.defaults)},stopMediaCapture:function(){this.stopLocalStreams(),this.stopPreviewStream(),this.stopLocalStreamClone(),this.cachedMediaConstraints.audio.deviceId=null,this.cachedMediaConstraints.video.deviceId=null}});return q}),function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define("adapter",[],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.adapter=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d={};d.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},d.localCName=d.generateIdentifier(),d.splitLines=function(a){return a.trim().split("\n").map(function(a){return a.trim()})},d.splitSections=function(a){var b=a.split("\nm=");return b.map(function(a,b){return(b>0?"m="+a:a).trim()+"\r\n"})},d.matchPrefix=function(a,b){return d.splitLines(a).filter(function(a){return 0===a.indexOf(b)})},d.parseCandidate=function(a){var b;b=0===a.indexOf("a=candidate:")?a.substring(12).split(" "):a.substring(10).split(" ");for(var c={foundation:b[0],component:b[1],protocol:b[2].toLowerCase(),priority:parseInt(b[3],10),ip:b[4],port:parseInt(b[5],10),type:b[7]},d=8;d<b.length;d+=2)switch(b[d]){case"raddr":c.relatedAddress=b[d+1];break;case"rport":c.relatedPort=parseInt(b[d+1],10);break;case"tcptype":c.tcpType=b[d+1]}return c},d.writeCandidate=function(a){var b=[];b.push(a.foundation),b.push(a.component),b.push(a.protocol.toUpperCase()),b.push(a.priority),b.push(a.ip),b.push(a.port);var c=a.type;return b.push("typ"),b.push(c),"host"!==c&&a.relatedAddress&&a.relatedPort&&(b.push("raddr"),b.push(a.relatedAddress),b.push("rport"),b.push(a.relatedPort)),a.tcpType&&"tcp"===a.protocol.toLowerCase()&&(b.push("tcptype"),b.push(a.tcpType)),"candidate:"+b.join(" ")},d.parseRtpMap=function(a){var b=a.substr(9).split(" "),c={payloadType:parseInt(b.shift(),10)};return b=b[0].split("/"),c.name=b[0],c.clockRate=parseInt(b[1],10),c.numChannels=3===b.length?parseInt(b[2],10):1,c},d.writeRtpMap=function(a){var b=a.payloadType;return void 0!==a.preferredPayloadType&&(b=a.preferredPayloadType),"a=rtpmap:"+b+" "+a.name+"/"+a.clockRate+(1!==a.numChannels?"/"+a.numChannels:"")+"\r\n"},d.parseExtmap=function(a){var b=a.substr(9).split(" ");return{id:parseInt(b[0],10),uri:b[1]}},d.writeExtmap=function(a){return"a=extmap:"+(a.id||a.preferredId)+" "+a.uri+"\r\n"},d.parseFmtp=function(a){for(var b,c={},d=a.substr(a.indexOf(" ")+1).split(";"),e=0;e<d.length;e++)b=d[e].trim().split("="),c[b[0].trim()]=b[1];return c},d.writeFmtp=function(a){var b="",c=a.payloadType;if(void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType),a.parameters&&Object.keys(a.parameters).length){var d=[];Object.keys(a.parameters).forEach(function(b){d.push(b+"="+a.parameters[b])}),b+="a=fmtp:"+c+" "+d.join(";")+"\r\n"}return b},d.parseRtcpFb=function(a){var b=a.substr(a.indexOf(" ")+1).split(" ");return{type:b.shift(),parameter:b.join(" ")}},d.writeRtcpFb=function(a){var b="",c=a.payloadType;return void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType),a.rtcpFeedback&&a.rtcpFeedback.length&&a.rtcpFeedback.forEach(function(a){b+="a=rtcp-fb:"+c+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+"\r\n"}),b},d.parseSsrcMedia=function(a){var b=a.indexOf(" "),c={ssrc:parseInt(a.substr(7,b-7),10)},d=a.indexOf(":",b);return d>-1?(c.attribute=a.substr(b+1,d-b-1),c.value=a.substr(d+1)):c.attribute=a.substr(b+1),c},d.getDtlsParameters=function(a,b){var c=d.splitLines(a);c=c.concat(d.splitLines(b));var e=c.filter(function(a){return 0===a.indexOf("a=fingerprint:")})[0].substr(14),f={role:"auto",fingerprints:[{algorithm:e.split(" ")[0],value:e.split(" ")[1]}]};return f},d.writeDtlsParameters=function(a,b){var c="a=setup:"+b+"\r\n";return a.fingerprints.forEach(function(a){c+="a=fingerprint:"+a.algorithm+" "+a.value+"\r\n"}),c},d.getIceParameters=function(a,b){var c=d.splitLines(a);c=c.concat(d.splitLines(b));var e={usernameFragment:c.filter(function(a){return 0===a.indexOf("a=ice-ufrag:")})[0].substr(12),password:c.filter(function(a){return 0===a.indexOf("a=ice-pwd:")})[0].substr(10)};return e},d.writeIceParameters=function(a){return"a=ice-ufrag:"+a.usernameFragment+"\r\na=ice-pwd:"+a.password+"\r\n"},d.parseRtpParameters=function(a){for(var b={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=d.splitLines(a),e=c[0].split(" "),f=3;f<e.length;f++){var g=e[f],h=d.matchPrefix(a,"a=rtpmap:"+g+" ")[0];if(h){var i=d.parseRtpMap(h),j=d.matchPrefix(a,"a=fmtp:"+g+" ");switch(i.parameters=j.length?d.parseFmtp(j[0]):{},i.rtcpFeedback=d.matchPrefix(a,"a=rtcp-fb:"+g+" ").map(d.parseRtcpFb),b.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":b.fecMechanisms.push(i.name.toUpperCase())}}}return d.matchPrefix(a,"a=extmap:").forEach(function(a){b.headerExtensions.push(d.parseExtmap(a))}),b},d.writeRtpDescription=function(a,b){var c="";return c+="m="+a+" ",c+=b.codecs.length>0?"9":"0",c+=" UDP/TLS/RTP/SAVPF ",c+=b.codecs.map(function(a){return void 0!==a.preferredPayloadType?a.preferredPayloadType:a.payloadType}).join(" ")+"\r\n",c+="c=IN IP4 0.0.0.0\r\n",c+="a=rtcp:9 IN IP4 0.0.0.0\r\n",b.codecs.forEach(function(a){c+=d.writeRtpMap(a),c+=d.writeFmtp(a),c+=d.writeRtcpFb(a)}),c+="a=rtcp-mux\r\n"},d.parseRtpEncodingParameters=function(a){var b,c=[],e=d.parseRtpParameters(a),f=-1!==e.fecMechanisms.indexOf("RED"),g=-1!==e.fecMechanisms.indexOf("ULPFEC"),h=d.matchPrefix(a,"a=ssrc:").map(function(a){return d.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute}),i=h.length>0&&h[0].ssrc,j=d.matchPrefix(a,"a=ssrc-group:FID").map(function(a){var b=a.split(" ");return b.shift(),b.map(function(a){return parseInt(a,10)})});j.length>0&&j[0].length>1&&j[0][0]===i&&(b=j[0][1]),e.codecs.forEach(function(a){if("RTX"===a.name.toUpperCase()&&a.parameters.apt){var d={ssrc:i,codecPayloadType:parseInt(a.parameters.apt,10),rtx:{payloadType:a.payloadType,ssrc:b}};c.push(d),f&&(d=JSON.parse(JSON.stringify(d)),d.fec={ssrc:b,mechanism:g?"red+ulpfec":"red"},c.push(d))}}),0===c.length&&i&&c.push({ssrc:i});var k=d.matchPrefix(a,"b=");return k.length&&(0===k[0].indexOf("b=TIAS:")?k=parseInt(k[0].substr(7),10):0===k[0].indexOf("b=AS:")&&(k=parseInt(k[0].substr(5),10)),c.forEach(function(a){a.maxBitrate=k})),c},d.writeSessionBoilerplate=function(){return"v=0\r\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},d.writeMediaSection=function(a,b,c,e){var f=d.writeRtpDescription(a.kind,b);if(f+=d.writeIceParameters(a.iceGatherer.getLocalParameters()),f+=d.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),"offer"===c?"actpass":"active"),f+="a=mid:"+a.mid+"\r\n",f+=a.rtpSender&&a.rtpReceiver?"a=sendrecv\r\n":a.rtpSender?"a=sendonly\r\n":a.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",a.rtpSender){var g="msid:"+e.id+" "+a.rtpSender.track.id+"\r\n";f+="a="+g,f+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" "+g}return f+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" cname:"+d.localCName+"\r\n"},d.getDirection=function(a,b){for(var c=d.splitLines(a),e=0;e<c.length;e++)switch(c[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[e].substr(2)}return b?d.getDirection(b):"sendrecv"},b.exports=d},{}],2:[function(a,b,c){!function(){var c=a("./utils").log,d=a("./utils").browserDetails;b.exports.browserDetails=d,b.exports.extractVersion=a("./utils").extractVersion,b.exports.disableLog=a("./utils").disableLog;var e=a("./chrome/chrome_shim")||null,f=a("./edge/edge_shim")||null,g=a("./firefox/firefox_shim")||null,h=a("./safari/safari_shim")||null;switch(d.browser){case"opera":case"chrome":if(!e||!e.shimPeerConnection)return void c("Chrome shim is not included in this adapter release.");c("adapter.js shimming chrome."),b.exports.browserShim=e,e.shimGetUserMedia(),e.shimMediaStream(),e.shimSourceObject(),e.shimPeerConnection(),e.shimOnTrack();break;case"firefox":if(!g||!g.shimPeerConnection)return void c("Firefox shim is not included in this adapter release.");c("adapter.js shimming firefox."),b.exports.browserShim=g,g.shimGetUserMedia(),g.shimSourceObject(),g.shimPeerConnection(),g.shimOnTrack();break;case"edge":if(!f||!f.shimPeerConnection)return void c("MS edge shim is not included in this adapter release.");c("adapter.js shimming edge."),b.exports.browserShim=f,f.shimGetUserMedia(),f.shimPeerConnection();break;case"safari":if(!h)return void c("Safari shim is not included in this adapter release.");c("adapter.js shimming safari."),b.exports.browserShim=h,h.shimGetUserMedia();break;default:c("Unsupported browser!")}}()},{"./chrome/chrome_shim":3,"./edge/edge_shim":5,"./firefox/firefox_shim":7,"./safari/safari_shim":9,"./utils":10}],3:[function(a,b,c){var d=a("../utils.js").log,e=a("../utils.js").browserDetails,f={shimMediaStream:function(){window.MediaStream=window.MediaStream||window.webkitMediaStream},shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){var b=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=a),this.addEventListener("addstream",this._ontrackpoly=function(a){a.stream.addEventListener("addtrack",function(c){var d=new Event("track");d.track=c.track,d.receiver={track:c.track},d.streams=[a.stream],b.dispatchEvent(d)}),a.stream.getTracks().forEach(function(b){var c=new Event("track");c.track=b,c.receiver={track:b},c.streams=[a.stream],this.dispatchEvent(c)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(a){var b=this;return this._srcObject=a,this.src&&URL.revokeObjectURL(this.src),a?(this.src=URL.createObjectURL(a),a.addEventListener("addtrack",function(){b.src&&URL.revokeObjectURL(b.src),b.src=URL.createObjectURL(a)}),void a.addEventListener("removetrack",function(){b.src&&URL.revokeObjectURL(b.src),b.src=URL.createObjectURL(a)})):void(this.src="")}}))},shimPeerConnection:function(){window.RTCPeerConnection=function(a,b){d("PeerConnection"),a&&a.iceTransportPolicy&&(a.iceTransports=a.iceTransportPolicy);var c=new webkitRTCPeerConnection(a,b),e=c.getStats.bind(c);return c.getStats=function(a,b,c){var d=this,f=arguments;if(arguments.length>0&&"function"==typeof a)return e(a,b);var g=function(a){var b={},c=a.result();return c.forEach(function(a){var c={id:a.id,timestamp:a.timestamp,type:a.type};a.names().forEach(function(b){c[b]=a.stat(b)}),b[c.id]=c}),b},h=function(a,b){var c=new Map(Object.keys(a).map(function(b){return[b,a[b]]}));return b=b||a,Object.keys(b).forEach(function(a){c[a]=b[a]}),c};if(arguments.length>=2){var i=function(a){f[1](h(g(a)))};return e.apply(this,[i,arguments[0]])}return new Promise(function(b,c){1===f.length&&"object"==typeof a?e.apply(d,[function(a){b(h(g(a)))},c]):e.apply(d,[function(a){b(h(g(a),a.result()))},c])}).then(b,c)},c},window.RTCPeerConnection.prototype=webkitRTCPeerConnection.prototype,webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return webkitRTCPeerConnection.generateCertificate}}),["createOffer","createAnswer"].forEach(function(a){var b=webkitRTCPeerConnection.prototype[a];webkitRTCPeerConnection.prototype[a]=function(){var a=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var c=1===arguments.length?arguments[0]:void 0;return new Promise(function(d,e){b.apply(a,[d,e,c])})}return b.apply(this,arguments)}}),e.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){var b=webkitRTCPeerConnection.prototype[a];webkitRTCPeerConnection.prototype[a]=function(){var a=arguments,c=this,d=new Promise(function(d,e){b.apply(c,[a[0],d,e])});return a.length<2?d:d.then(function(){a[1].apply(null,[])},function(b){a.length>=3&&a[2].apply(null,[b])})}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){var b=webkitRTCPeerConnection.prototype[a];webkitRTCPeerConnection.prototype[a]=function(){return arguments[0]=new("addIceCandidate"===a?RTCIceCandidate:RTCSessionDescription)(arguments[0]),b.apply(this,arguments)}});var a=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return null===arguments[0]?Promise.resolve():a.apply(this,arguments)}}};b.exports={shimMediaStream:f.shimMediaStream,shimOnTrack:f.shimOnTrack,shimSourceObject:f.shimSourceObject,shimPeerConnection:f.shimPeerConnection,shimGetUserMedia:a("./getusermedia")}},{"../utils.js":10,"./getusermedia":4}],4:[function(a,b,c){var d=a("../utils.js").log;b.exports=function(){var a=function(a){if("object"!=typeof a||a.mandatory||a.optional)return a;var b={};return Object.keys(a).forEach(function(c){if("require"!==c&&"advanced"!==c&&"mediaSource"!==c){var d="object"==typeof a[c]?a[c]:{ideal:a[c]};void 0!==d.exact&&"number"==typeof d.exact&&(d.min=d.max=d.exact);var e=function(a,b){return a?a+b.charAt(0).toUpperCase()+b.slice(1):"deviceId"===b?"sourceId":b};if(void 0!==d.ideal){b.optional=b.optional||[];var f={};"number"==typeof d.ideal?(f[e("min",c)]=d.ideal,b.optional.push(f),f={},f[e("max",c)]=d.ideal,b.optional.push(f)):(f[e("",c)]=d.ideal,b.optional.push(f))}void 0!==d.exact&&"number"!=typeof d.exact?(b.mandatory=b.mandatory||{},b.mandatory[e("",c)]=d.exact):["min","max"].forEach(function(a){void 0!==d[a]&&(b.mandatory=b.mandatory||{},b.mandatory[e(a,c)]=d[a])})}}),a.advanced&&(b.optional=(b.optional||[]).concat(a.advanced)),b},b=function(b,c){if(b=JSON.parse(JSON.stringify(b)),b&&b.audio&&(b.audio=a(b.audio)),b&&"object"==typeof b.video){var e=b.video.facingMode;if(e=e&&("object"==typeof e?e:{ideal:e}),e&&("user"===e.exact||"environment"===e.exact||"user"===e.ideal||"environment"===e.ideal)&&(!navigator.mediaDevices.getSupportedConstraints||!navigator.mediaDevices.getSupportedConstraints().facingMode)&&(delete b.video.facingMode,"environment"===e.exact||"environment"===e.ideal))return navigator.mediaDevices.enumerateDevices().then(function(f){f=f.filter(function(a){return"videoinput"===a.kind});var g=f.find(function(a){return-1!==a.label.toLowerCase().indexOf("back")})||f.length&&f[f.length-1];return g&&(b.video.deviceId=e.exact?{exact:g.deviceId}:{ideal:g.deviceId}),b.video=a(b.video),d("chrome: "+JSON.stringify(b)),c(b)});b.video=a(b.video)}return d("chrome: "+JSON.stringify(b)),c(b)},c=function(a){return{name:{PermissionDeniedError:"NotAllowedError",ConstraintNotSatisfiedError:"OverconstrainedError"}[a.name]||a.name,message:a.message,constraint:a.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},e=function(a,d,e){b(a,function(a){navigator.webkitGetUserMedia(a,d,function(a){e(c(a))})})};navigator.getUserMedia=e;var f=function(a){return new Promise(function(b,c){navigator.getUserMedia(a,b,c)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:f,enumerateDevices:function(){return new Promise(function(a){var b={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(c){a(c.map(function(a){return{label:a.label,kind:b[a.kind],deviceId:a.id,groupId:""}}))})})}}),navigator.mediaDevices.getUserMedia){var g=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(a){return b(a,function(a){return g(a)["catch"](function(a){return Promise.reject(c(a))})})}}else navigator.mediaDevices.getUserMedia=function(a){return f(a)};"undefined"==typeof navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){d("Dummy mediaDevices.addEventListener called.")}),"undefined"==typeof navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){d("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":10}],5:[function(a,b,c){var d=a("sdp"),e=a("../utils").browserDetails,f={shimPeerConnection:function(){window.RTCIceGatherer&&(window.RTCIceCandidate||(window.RTCIceCandidate=function(a){return a}),window.RTCSessionDescription||(window.RTCSessionDescription=function(a){return a})),window.RTCPeerConnection=function(a){var b=this,c=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(a){b[a]=c[a].bind(c)}),this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return b.localStreams},this.getRemoteStreams=function(){return b.remoteStreams},this.localDescription=new RTCSessionDescription({type:"",sdp:""}),this.remoteDescription=new RTCSessionDescription({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},a&&a.iceTransportPolicy)switch(a.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=a.iceTransportPolicy;break;case"none":throw new TypeError('iceTransportPolicy "none" not supported')}if(this.usingBundle=a&&"max-bundle"===a.bundlePolicy,a&&a.iceServers){var d=JSON.parse(JSON.stringify(a.iceServers));this.iceOptions.iceServers=d.filter(function(a){if(a&&a.urls){var b=a.urls;return"string"==typeof b&&(b=[b]),b=b.filter(function(a){return 0===a.indexOf("turn:")&&-1!==a.indexOf("transport=udp")&&-1===a.indexOf("turn:[")||0===a.indexOf("stun:")&&e.version>=14393})[0],!!b}return!1})}this.transceivers=[],this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype._emitBufferedCandidates=function(){var a=this,b=d.splitSections(a.localDescription.sdp);this._localIceCandidatesBuffer.forEach(function(c){var d=!c.candidate||0===Object.keys(c.candidate).length;if(d)for(var e=1;e<b.length;e++)-1===b[e].indexOf("\r\na=end-of-candidates\r\n")&&(b[e]+="a=end-of-candidates\r\n");else-1===c.candidate.candidate.indexOf("typ endOfCandidates")&&(b[c.candidate.sdpMLineIndex+1]+="a="+c.candidate.candidate+"\r\n");if(a.localDescription.sdp=b.join(""),a.dispatchEvent(c),null!==a.onicecandidate&&a.onicecandidate(c),!c.candidate&&"complete"!==a.iceGatheringState){var f=a.transceivers.every(function(a){return a.iceGatherer&&"completed"===a.iceGatherer.state});f&&(a.iceGatheringState="complete")}}),this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype.addStream=function(a){this.localStreams.push(a.clone()),this._maybeFireNegotiationNeeded()},window.RTCPeerConnection.prototype.removeStream=function(a){var b=this.localStreams.indexOf(a);b>-1&&(this.localStreams.splice(b,1),this._maybeFireNegotiationNeeded())},window.RTCPeerConnection.prototype.getSenders=function(){return this.transceivers.filter(function(a){return!!a.rtpSender}).map(function(a){return a.rtpSender})},window.RTCPeerConnection.prototype.getReceivers=function(){return this.transceivers.filter(function(a){return!!a.rtpReceiver}).map(function(a){return a.rtpReceiver})},window.RTCPeerConnection.prototype._getCommonCapabilities=function(a,b){var c={codecs:[],headerExtensions:[],fecMechanisms:[]};return a.codecs.forEach(function(a){for(var d=0;d<b.codecs.length;d++){var e=b.codecs[d];if(a.name.toLowerCase()===e.name.toLowerCase()&&a.clockRate===e.clockRate&&a.numChannels===e.numChannels){c.codecs.push(e),e.rtcpFeedback=e.rtcpFeedback.filter(function(b){for(var c=0;c<a.rtcpFeedback.length;c++)if(a.rtcpFeedback[c].type===b.type&&a.rtcpFeedback[c].parameter===b.parameter)return!0;return!1});break}}}),a.headerExtensions.forEach(function(a){for(var d=0;d<b.headerExtensions.length;d++){var e=b.headerExtensions[d];if(a.uri===e.uri){c.headerExtensions.push(e);break}}}),c},window.RTCPeerConnection.prototype._createIceAndDtlsTransports=function(a,b){var c=this,e=new RTCIceGatherer(c.iceOptions),f=new RTCIceTransport(e);e.onlocalcandidate=function(g){var h=new Event("icecandidate");h.candidate={sdpMid:a,sdpMLineIndex:b};var i=g.candidate,j=!i||0===Object.keys(i).length;j?(void 0===e.state&&(e.state="completed"),h.candidate.candidate="candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates"):(i.component="RTCP"===f.component?2:1,h.candidate.candidate=d.writeCandidate(i));var k=d.splitSections(c.localDescription.sdp);-1===h.candidate.candidate.indexOf("typ endOfCandidates")?k[h.candidate.sdpMLineIndex+1]+="a="+h.candidate.candidate+"\r\n":k[h.candidate.sdpMLineIndex+1]+="a=end-of-candidates\r\n",c.localDescription.sdp=k.join("");var l=c.transceivers.every(function(a){return a.iceGatherer&&"completed"===a.iceGatherer.state});switch(c.iceGatheringState){case"new":c._localIceCandidatesBuffer.push(h),j&&l&&c._localIceCandidatesBuffer.push(new Event("icecandidate"));break;case"gathering":c._emitBufferedCandidates(),c.dispatchEvent(h),null!==c.onicecandidate&&c.onicecandidate(h),l&&(c.dispatchEvent(new Event("icecandidate")),null!==c.onicecandidate&&c.onicecandidate(new Event("icecandidate")),c.iceGatheringState="complete");break;case"complete":}},f.onicestatechange=function(){c._updateConnectionState()};var g=new RTCDtlsTransport(f);return g.ondtlsstatechange=function(){c._updateConnectionState()},g.onerror=function(){g.state="failed",c._updateConnectionState()},{iceGatherer:e,iceTransport:f,dtlsTransport:g}},window.RTCPeerConnection.prototype._transceive=function(a,b,c){var e=this._getCommonCapabilities(a.localCapabilities,a.remoteCapabilities);b&&a.rtpSender&&(e.encodings=a.sendEncodingParameters,e.rtcp={cname:d.localCName},a.recvEncodingParameters.length&&(e.rtcp.ssrc=a.recvEncodingParameters[0].ssrc),a.rtpSender.send(e)),c&&a.rtpReceiver&&(e.encodings=a.recvEncodingParameters,e.rtcp={cname:a.cname},a.sendEncodingParameters.length&&(e.rtcp.ssrc=a.sendEncodingParameters[0].ssrc),a.rtpReceiver.receive(e))},window.RTCPeerConnection.prototype.setLocalDescription=function(a){var b,c,e=this;if("offer"===a.type)this._pendingOffer&&(b=d.splitSections(a.sdp),c=b.shift(),b.forEach(function(a,b){var c=d.parseRtpParameters(a);e._pendingOffer[b].localCapabilities=c}),this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===a.type){b=d.splitSections(e.remoteDescription.sdp),c=b.shift();var f=d.matchPrefix(c,"a=ice-lite").length>0;b.forEach(function(a,b){var g=e.transceivers[b],h=g.iceGatherer,i=g.iceTransport,j=g.dtlsTransport,k=g.localCapabilities,l=g.remoteCapabilities,m="0"===a.split("\n",1)[0].split(" ",2)[1];if(!m&&!g.isDatachannel){var n=d.getIceParameters(a,c);if(f){var o=d.matchPrefix(a,"a=candidate:").map(function(a){return d.parseCandidate(a)}).filter(function(a){return"1"===a.component});o.length&&i.setRemoteCandidates(o)}var p=d.getDtlsParameters(a,c);f&&(p.role="server"),e.usingBundle&&0!==b||(i.start(h,n,f?"controlling":"controlled"),j.start(p));var q=e._getCommonCapabilities(k,l);e._transceive(g,q.codecs.length>0,!1)}})}switch(this.localDescription={type:a.type,sdp:a.sdp},a.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+a.type+'"')}var g=arguments.length>1&&"function"==typeof arguments[1];if(g){var h=arguments[1];window.setTimeout(function(){h(),"new"===e.iceGatheringState&&(e.iceGatheringState="gathering"),e._emitBufferedCandidates()},0)}var i=Promise.resolve();return i.then(function(){g||("new"===e.iceGatheringState&&(e.iceGatheringState="gathering"),window.setTimeout(e._emitBufferedCandidates.bind(e),500))}),i},window.RTCPeerConnection.prototype.setRemoteDescription=function(a){var b=this,c=new MediaStream,e=[],f=d.splitSections(a.sdp),g=f.shift(),h=d.matchPrefix(g,"a=ice-lite").length>0;switch(this.usingBundle=d.matchPrefix(g,"a=group:BUNDLE ").length>0,f.forEach(function(f,i){var j=d.splitLines(f),k=j[0].substr(2).split(" "),l=k[0],m="0"===k[1],n=d.getDirection(f,g),o=d.matchPrefix(f,"a=mid:");if(o=o.length?o[0].substr(6):d.generateIdentifier(),"application"===l&&"DTLS/SCTP"===k[2])return void(b.transceivers[i]={mid:o,isDatachannel:!0});var p,q,r,s,t,u,v,w,x,y,z,A,B=d.parseRtpParameters(f);m||(z=d.getIceParameters(f,g),A=d.getDtlsParameters(f,g),A.role="client"),w=d.parseRtpEncodingParameters(f);var C,D=d.matchPrefix(f,"a=ssrc:").map(function(a){return d.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute})[0];D&&(C=D.value);var E=d.matchPrefix(f,"a=end-of-candidates",g).length>0,F=d.matchPrefix(f,"a=candidate:").map(function(a){return d.parseCandidate(a)}).filter(function(a){return"1"===a.component});if("offer"!==a.type||m)"answer"!==a.type||m||(p=b.transceivers[i],q=p.iceGatherer,r=p.iceTransport,s=p.dtlsTransport,t=p.rtpSender,u=p.rtpReceiver,v=p.sendEncodingParameters,x=p.localCapabilities,b.transceivers[i].recvEncodingParameters=w,b.transceivers[i].remoteCapabilities=B,b.transceivers[i].cname=C,(h||E)&&F.length&&r.setRemoteCandidates(F),b.usingBundle&&0!==i||(r.start(q,z,"controlling"),s.start(A)),b._transceive(p,"sendrecv"===n||"recvonly"===n,"sendrecv"===n||"sendonly"===n),!u||"sendrecv"!==n&&"sendonly"!==n?delete p.rtpReceiver:(y=u.track,e.push([y,u]),c.addTrack(y)));else{var G=b.usingBundle&&i>0?{iceGatherer:b.transceivers[0].iceGatherer,iceTransport:b.transceivers[0].iceTransport,dtlsTransport:b.transceivers[0].dtlsTransport}:b._createIceAndDtlsTransports(o,i);if(E&&G.iceTransport.setRemoteCandidates(F),x=RTCRtpReceiver.getCapabilities(l),v=[{ssrc:1001*(2*i+2)}],u=new RTCRtpReceiver(G.dtlsTransport,l),y=u.track,e.push([y,u]),c.addTrack(y),b.localStreams.length>0&&b.localStreams[0].getTracks().length>=i){var H;"audio"===l?H=b.localStreams[0].getAudioTracks()[0]:"video"===l&&(H=b.localStreams[0].getVideoTracks()[0]),H&&(t=new RTCRtpSender(H,G.dtlsTransport))}b.transceivers[i]={iceGatherer:G.iceGatherer,iceTransport:G.iceTransport,dtlsTransport:G.dtlsTransport,localCapabilities:x,remoteCapabilities:B,rtpSender:t,rtpReceiver:u,kind:l,mid:o,cname:C,sendEncodingParameters:v,recvEncodingParameters:w},b._transceive(b.transceivers[i],!1,"sendrecv"===n||"sendonly"===n)}}),this.remoteDescription={type:a.type,sdp:a.sdp},a.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+a.type+'"')}return c.getTracks().length&&(b.remoteStreams.push(c),window.setTimeout(function(){var a=new Event("addstream");a.stream=c,b.dispatchEvent(a),null!==b.onaddstream&&window.setTimeout(function(){b.onaddstream(a)},0),e.forEach(function(d){var e=d[0],f=d[1],g=new Event("track");g.track=e,g.receiver=f,g.streams=[c],b.dispatchEvent(a),null!==b.ontrack&&window.setTimeout(function(){b.ontrack(g)},0)})},0)),arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.close=function(){this.transceivers.forEach(function(a){a.iceTransport&&a.iceTransport.stop(),a.dtlsTransport&&a.dtlsTransport.stop(),a.rtpSender&&a.rtpSender.stop(),a.rtpReceiver&&a.rtpReceiver.stop()}),this._updateSignalingState("closed")},window.RTCPeerConnection.prototype._updateSignalingState=function(a){this.signalingState=a;var b=new Event("signalingstatechange");this.dispatchEvent(b),null!==this.onsignalingstatechange&&this.onsignalingstatechange(b)},window.RTCPeerConnection.prototype._maybeFireNegotiationNeeded=function(){var a=new Event("negotiationneeded");this.dispatchEvent(a),null!==this.onnegotiationneeded&&this.onnegotiationneeded(a)},window.RTCPeerConnection.prototype._updateConnectionState=function(){var a,b=this,c={"new":0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};if(this.transceivers.forEach(function(a){c[a.iceTransport.state]++,c[a.dtlsTransport.state]++}),c.connected+=c.completed,a="new",c.failed>0?a="failed":c.connecting>0||c.checking>0?a="connecting":c.disconnected>0?a="disconnected":c["new"]>0?a="new":(c.connected>0||c.completed>0)&&(a="connected"),a!==b.iceConnectionState){b.iceConnectionState=a;var d=new Event("iceconnectionstatechange");
this.dispatchEvent(d),null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange(d)}},window.RTCPeerConnection.prototype.createOffer=function(){var a=this;if(this._pendingOffer)throw new Error("createOffer called while there is a pending offer.");var b;1===arguments.length&&"function"!=typeof arguments[0]?b=arguments[0]:3===arguments.length&&(b=arguments[2]);var c=[],e=0,f=0;if(this.localStreams.length&&(e=this.localStreams[0].getAudioTracks().length,f=this.localStreams[0].getVideoTracks().length),b){if(b.mandatory||b.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==b.offerToReceiveAudio&&(e=b.offerToReceiveAudio),void 0!==b.offerToReceiveVideo&&(f=b.offerToReceiveVideo)}for(this.localStreams.length&&this.localStreams[0].getTracks().forEach(function(a){c.push({kind:a.kind,track:a,wantReceive:"audio"===a.kind?e>0:f>0}),"audio"===a.kind?e--:"video"===a.kind&&f--});e>0||f>0;)e>0&&(c.push({kind:"audio",wantReceive:!0}),e--),f>0&&(c.push({kind:"video",wantReceive:!0}),f--);var g=d.writeSessionBoilerplate(),h=[];c.forEach(function(b,c){var e,f,g=b.track,i=b.kind,j=d.generateIdentifier(),k=a.usingBundle&&c>0?{iceGatherer:h[0].iceGatherer,iceTransport:h[0].iceTransport,dtlsTransport:h[0].dtlsTransport}:a._createIceAndDtlsTransports(j,c),l=RTCRtpSender.getCapabilities(i),m=[{ssrc:1001*(2*c+1)}];g&&(e=new RTCRtpSender(g,k.dtlsTransport)),b.wantReceive&&(f=new RTCRtpReceiver(k.dtlsTransport,i)),h[c]={iceGatherer:k.iceGatherer,iceTransport:k.iceTransport,dtlsTransport:k.dtlsTransport,localCapabilities:l,remoteCapabilities:null,rtpSender:e,rtpReceiver:f,kind:i,mid:j,sendEncodingParameters:m,recvEncodingParameters:null}}),this.usingBundle&&(g+="a=group:BUNDLE "+h.map(function(a){return a.mid}).join(" ")+"\r\n"),c.forEach(function(b,c){var e=h[c];g+=d.writeMediaSection(e,e.localCapabilities,"offer",a.localStreams[0])}),this._pendingOffer=h;var i=new RTCSessionDescription({type:"offer",sdp:g});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,i),Promise.resolve(i)},window.RTCPeerConnection.prototype.createAnswer=function(){var a=this,b=d.writeSessionBoilerplate();this.usingBundle&&(b+="a=group:BUNDLE "+this.transceivers.map(function(a){return a.mid}).join(" ")+"\r\n"),this.transceivers.forEach(function(c){if(c.isDatachannel)return void(b+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+c.mid+"\r\n");var e=a._getCommonCapabilities(c.localCapabilities,c.remoteCapabilities);b+=d.writeMediaSection(c,e,"answer",a.localStreams[0])});var c=new RTCSessionDescription({type:"answer",sdp:b});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,c),Promise.resolve(c)},window.RTCPeerConnection.prototype.addIceCandidate=function(a){if(null===a)this.transceivers.forEach(function(a){a.iceTransport.addRemoteCandidate({})});else{var b=a.sdpMLineIndex;if(a.sdpMid)for(var c=0;c<this.transceivers.length;c++)if(this.transceivers[c].mid===a.sdpMid){b=c;break}var e=this.transceivers[b];if(e){var f=Object.keys(a.candidate).length>0?d.parseCandidate(a.candidate):{};if("tcp"===f.protocol&&(0===f.port||9===f.port))return;if("1"!==f.component)return;"endOfCandidates"===f.type&&(f={}),e.iceTransport.addRemoteCandidate(f);var g=d.splitSections(this.remoteDescription.sdp);g[b+1]+=(f.type?a.candidate.trim():"a=end-of-candidates")+"\r\n",this.remoteDescription.sdp=g.join("")}}return arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.getStats=function(){var a=[];this.transceivers.forEach(function(b){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(c){b[c]&&a.push(b[c].getStats())})});var b=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1];return new Promise(function(c){var d=new Map;Promise.all(a).then(function(a){a.forEach(function(a){Object.keys(a).forEach(function(b){d.set(b,a[b]),d[b]=a[b]})}),b&&window.setTimeout(b,0,d),c(d)})})}}};b.exports={shimPeerConnection:f.shimPeerConnection,shimGetUserMedia:a("./getusermedia")}},{"../utils":10,"./getusermedia":6,sdp:1}],6:[function(a,b,c){b.exports=function(){var a=function(a){return{name:{PermissionDeniedError:"NotAllowedError"}[a.name]||a.name,message:a.message,constraint:a.constraint,toString:function(){return this.name}}},b=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(c){return b(c)["catch"](function(b){return Promise.reject(a(b))})}}},{}],7:[function(a,b,c){var d=a("../utils").browserDetails,e={shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=a),this.addEventListener("addstream",this._ontrackpoly=function(a){a.stream.getTracks().forEach(function(b){var c=new Event("track");c.track=b,c.receiver={track:b},c.streams=[a.stream],this.dispatchEvent(c)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(a){this.mozSrcObject=a}}))},shimPeerConnection:function(){if("object"==typeof window&&(window.RTCPeerConnection||window.mozRTCPeerConnection)){window.RTCPeerConnection||(window.RTCPeerConnection=function(a,b){if(d.version<38&&a&&a.iceServers){for(var c=[],e=0;e<a.iceServers.length;e++){var f=a.iceServers[e];if(f.hasOwnProperty("urls"))for(var g=0;g<f.urls.length;g++){var h={url:f.urls[g]};0===f.urls[g].indexOf("turn")&&(h.username=f.username,h.credential=f.credential),c.push(h)}else c.push(a.iceServers[e])}a.iceServers=c}return new mozRTCPeerConnection(a,b)},window.RTCPeerConnection.prototype=mozRTCPeerConnection.prototype,mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){var b=RTCPeerConnection.prototype[a];RTCPeerConnection.prototype[a]=function(){return arguments[0]=new("addIceCandidate"===a?RTCIceCandidate:RTCSessionDescription)(arguments[0]),b.apply(this,arguments)}});var a=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return null===arguments[0]?Promise.resolve():a.apply(this,arguments)};var b=function(a){var b=new Map;return Object.keys(a).forEach(function(c){b.set(c,a[c]),b[c]=a[c]}),b},c=RTCPeerConnection.prototype.getStats;RTCPeerConnection.prototype.getStats=function(a,d,e){return c.apply(this,[a||null]).then(function(a){return b(a)}).then(d,e)}}}};b.exports={shimOnTrack:e.shimOnTrack,shimSourceObject:e.shimSourceObject,shimPeerConnection:e.shimPeerConnection,shimGetUserMedia:a("./getusermedia")}},{"../utils":10,"./getusermedia":8}],8:[function(a,b,c){var d=a("../utils").log,e=a("../utils").browserDetails;b.exports=function(){var a=function(a){return{name:{SecurityError:"NotAllowedError",PermissionDeniedError:"NotAllowedError"}[a.name]||a.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[a.message]||a.message,constraint:a.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},b=function(b,c,f){var g=function(a){if("object"!=typeof a||a.require)return a;var b=[];return Object.keys(a).forEach(function(c){if("require"!==c&&"advanced"!==c&&"mediaSource"!==c){var d=a[c]="object"==typeof a[c]?a[c]:{ideal:a[c]};if((void 0!==d.min||void 0!==d.max||void 0!==d.exact)&&b.push(c),void 0!==d.exact&&("number"==typeof d.exact?d.min=d.max=d.exact:a[c]=d.exact,delete d.exact),void 0!==d.ideal){a.advanced=a.advanced||[];var e={};"number"==typeof d.ideal?e[c]={min:d.ideal,max:d.ideal}:e[c]=d.ideal,a.advanced.push(e),delete d.ideal,Object.keys(d).length||delete a[c]}}}),b.length&&(a.require=b),a};return b=JSON.parse(JSON.stringify(b)),e.version<38&&(d("spec: "+JSON.stringify(b)),b.audio&&(b.audio=g(b.audio)),b.video&&(b.video=g(b.video)),d("ff37: "+JSON.stringify(b))),navigator.mozGetUserMedia(b,c,function(b){f(a(b))})},c=function(a){return new Promise(function(c,d){b(a,c,d)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:c,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(a){var b=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];a(b)})},e.version<41){var f=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return f().then(void 0,function(a){if("NotFoundError"===a.name)return[];throw a})}}if(e.version<49){var g=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(b){return g(b)["catch"](function(b){return Promise.reject(a(b))})}}navigator.getUserMedia=function(a,c,d){return e.version<44?b(a,c,d):void navigator.mediaDevices.getUserMedia(a).then(c,d)}}},{"../utils":10}],9:[function(a,b,c){var d={shimGetUserMedia:function(){navigator.getUserMedia=navigator.webkitGetUserMedia}};b.exports={shimGetUserMedia:d.shimGetUserMedia}},{}],10:[function(a,b,c){var d=!0,e={disableLog:function(a){return"boolean"!=typeof a?new Error("Argument type: "+typeof a+". Please use a boolean."):(d=a,a?"adapter.js logging disabled":"adapter.js logging enabled")},log:function(){if("object"==typeof window){if(d)return;"undefined"!=typeof console&&"function"==typeof console.log}},extractVersion:function(a,b,c){var d=a.match(b);return d&&d.length>=c&&parseInt(d[c],10)},detectBrowser:function(){var a={};if(a.browser=null,a.version=null,"undefined"==typeof window||!window.navigator)return a.browser="Not a browser.",a;if(navigator.mozGetUserMedia)a.browser="firefox",a.version=this.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1);else if(navigator.webkitGetUserMedia)if(window.webkitRTCPeerConnection)a.browser="chrome",a.version=this.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2);else{if(!navigator.userAgent.match(/Version\/(\d+).(\d+)/))return a.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",a;a.browser="safari",a.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/([0-9]+)\./,1)}else{if(!navigator.mediaDevices||!navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))return a.browser="Not a supported browser.",a;a.browser="edge",a.version=this.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2)}return a}};b.exports={log:e.log,disableLog:e.disableLog,browserDetails:e.detectBrowser(),extractVersion:e.extractVersion}},{}]},{},[2])(2)}),define("WebRTC_SDK/models/RTCCallStatsModel",["require","backbone","underscore","Logger","browserDetector"],function(a){var b=a("backbone"),c=a("underscore"),d=(a("Logger"),a("browserDetector")),e=b.Model.extend({STATIC:{LABELS:{VIDEO_TRACK:"video_label",CONTENT_TRACK:"content_label"}},defaults:{audioInputLevel:null,audioPacketsSent:null,audioPacketsRecvd:null,videoRecvHeight:null,videoRecvWidth:null,contentRecvHeight:null,contentRecvWidth:null},updateStats:function(a){var b=[];Object.keys(a).forEach(function(c){var d={},e=a[c];Object.keys(e).forEach(function(a){d[a]=e[a]}),b.push(d)}),this.parseStats(b)},parseStats:function(a){var b={},e=this;c.each(a,function(a,f,g){if("firefox"!==d.browser){if("ssrc"===a.type)if(a.id&&-1!==a.id.indexOf("_send")&&(c.isUndefined(a.audioInputLevel)||(b.audioInputLevel=a.audioInputLevel,b.audioPacketsSent=a.packetsSent)),a.id&&-1!==a.id.indexOf("_recv"))c.isUndefined(a.audioOutputLevel)||(b.audioPacketsRecvd=a.packetsReceived);else switch(a.googTrackId){case e.STATIC.LABELS.VIDEO_TRACK:b.videoRecvHeight=a.googFrameHeightReceived?parseInt(a.googFrameHeightReceived,10):null,b.videoRecvWidth=a.googFrameWidthReceived?parseInt(a.googFrameWidthReceived,10):null;break;case e.STATIC.LABELS.CONTENT_TRACK:b.contentRecvHeight=a.googFrameHeightReceived?parseInt(a.googFrameHeightReceived,10):null,b.contentRecvWidth=a.googFrameWidthReceived?parseInt(a.googFrameWidthReceived,10):null}}else"outboundrtp"===a.type&&"audio"===a.mediaType?b.audioPacketsSent=a.packetsSent:"inboundrtp"===a.type&&"audio"===a.mediaType&&(b.audioPacketsRecvd=a.packetsReceived)}),this.set(b)}});return e}),define("WebRTC_SDK/RTCCallStats",["require","my.Class","underscore","backbone","Logger","WebRTC_SDK/models/RTCCallStatsModel","WebRTC_SDK/models/RTCCallStatsModel","browserDetector"],function(a){var b=a("my.Class"),c=a("underscore"),d=a("backbone"),e=a("Logger"),f=a("WebRTC_SDK/models/RTCCallStatsModel"),f=a("WebRTC_SDK/models/RTCCallStatsModel"),g=a("browserDetector"),h=b.Class({STATIC:{},constructor:function(a){c.bindAll(this),c.extend(this,d.Events),this.model=new f,this.peerConnection=a.peerConnection,this.pollInterval=a.statsPollInterval},startPollingStats:function(){var a=this;this.pollStatsHandle||(e.debug("RTCCallStats: Starting call stats poll with interval: ",this.pollInterval),this.pollStatsHandle=window.setInterval(function(){a.getStats({peerConnection:a.peerConnection,success:a.getStatsSuccess,error:a.getStatsError})},this.pollInterval))},stopPollingStats:function(){return this.pollStatsHandle?(e.debug("RTCCallStats: Stopping call stats poll"),window.clearInterval(this.pollStatsHandle),void(this.pollStatsHandle=null)):void e.warn("RTCCallStats: Call stats poll already stopped")},getStats:function(a){var b=a.peerConnection;b&&b.getStats&&b.getStats(null,a.success,a.error)},getStatsSuccess:function(a){"firefox"===g.browser&&this.trigger("rtcstats",a),this.model.updateStats(a)},getStatsError:function(a){e.error("RTCCallStats: Failed to get webrtc call stats",a)},close:function(){this.stopPollingStats()}});return h}),define("WebRTC_SDK/models/RTCPeerModel",["require","backbone","WebRTC_SDK/utilities/RTCUtils"],function(a){var b=a("backbone"),c=a("WebRTC_SDK/utilities/RTCUtils"),d=b.Model.extend({initialize:function(){},setStreamByType:function(a,b,d){var e="local"===b?c.getLocalStreamType(a):c.getRemoteStreamType(a);this.set(e,d)}},{getDefaults:function(){return{id:null,receiveMedia:{offerToReceiveAudio:!0,offerToReceiveVideo:!0},peerConnectionConfig:{iceServers:[],bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",iceTransports:"all"},peerConnectionConstraints:{optional:[]},iceGatheringState:"",iceConnectionState:"",useTrickleICE:!1,localSdp:null,remoteSdp:null,localVideoStream:null,localAudioStream:null,localContentStream:null,remoteStream:null,remoteContentStream:null,closed:!1,signalingState:""}}});return d}),function(a){"function"==typeof define&&define.amd?define("sdpUtils",a):a(window.require)}(function(a,b,c){"use strict";function d(a){}function e(a,b){return"true"===b.opusStereo?a=u(a,"opus/48000","stereo","1"):"false"===b.opusStereo&&(a=v(a,"opus/48000","stereo")),"true"===b.opusFec?a=u(a,"opus/48000","useinbandfec","1"):"false"===b.opusFec&&(a=v(a,"opus/48000","useinbandfec")),"true"===b.opusDtx?a=u(a,"opus/48000","usedtx","1"):"false"===b.opusDtx&&(a=v(a,"opus/48000","usedtx")),b.opusMaxPbr&&(a=u(a,"opus/48000","maxplaybackrate",b.opusMaxPbr)),a}function f(a,b){return b.audioSendBitrate?(d("Prefer audio send bitrate: "+b.audioSendBitrate),j(a,b.audioSendBitrate,"audio")):a}function g(a,b){return b.audioRecvBitrate?(d("Prefer audio receive bitrate: "+b.audioRecvBitrate),j(a,b.audioRecvBitrate,"audio")):a}function h(a,b){return b.videoSendBitrate?(d("Prefer video send bitrate: "+b.videoSendBitrate),j(a,b.videoSendBitrate,"video")):a}function i(a,b){return b.videoRecvBitrate?(d("Prefer video receive bitrate: "+b.videoRecvBitrate),j(a,b.videoRecvBitrate,"video")):a}function j(a,b,c){var e=a.split("\r\n"),f=z(e,"m=",c);if(null===f)return d("Failed to add bandwidth line to sdp, as no m-line found"),a;var g=A(e,f+1,-1,"m=");null===g&&(g=e.length);var h=A(e,f+1,g,"c=");if(null===h)return d("Failed to add bandwidth line to sdp, as no c-line found"),a;var i=A(e,h+1,g,"b=AS");i&&e.splice(i,1);var j="b=AS:"+b;return e.splice(h+1,0,j),a=e.join("\r\n")}function k(a,b){var c=b.videoSendInitialBitrate;if(!c)return a;var e=c,f=b.videoSendBitrate;f&&(c>f&&(d("Clamping initial bitrate to max bitrate of "+f+" kbps."),c=f,b.videoSendInitialBitrate=c),e=f);var g=a.split("\r\n"),h=z(g,"m=","video");if(null===h)return d("Failed to find video m-line"),a;var i=b.videoRecvCodec;return a=u(a,i,"x-google-min-bitrate",b.videoSendInitialBitrate.toString()),a=u(a,i,"x-google-max-bitrate",e.toString())}function l(a,b){a=a.split(" ");for(var c=0;c<a.length;++c)a[c]===b.toString()&&a.splice(c,1);return a.join(" ")}function m(a,b){var c=z(a,"a=rtpmap",b);if(null===c)return a;var d=C(a[c]);a.splice(c,1);var e=z(a,"m=","video");return null===e?a:(a[e]=l(a[e],d),a)}function n(a,b){var c=z(a,"a=rtpmap",b.toString());if(null===c)return a;a.splice(c,1);var d=z(a,"m=","video");return null===d?a:(a[d]=l(a[d],b),a)}function o(a,b){if("false"!==b.videoFec)return a;var c=a.split("\r\n"),d=z(c,"a=rtpmap","red");if(null===d)return a;var e=C(c[d]);if(c=n(c,e),c=m(c,"ulpfec"),d=z(c,"a=fmtp",e.toString()),null===d)return a;var f=w(c[d]),g=f.pt;return null===g?a:(c.splice(d,1),c=n(c,g),c.join("\r\n"))}function p(a,b){return t(a,"audio","send",b.audioSendCodec)}function q(a,b){return t(a,"audio","receive",b.audioRecvCodec)}function r(a,b){return t(a,"video","send",b.videoSendCodec)}function s(a,b){return t(a,"video","receive",b.videoRecvCodec)}function t(a,b,c,e){var f=b+" "+c+" codec";if(!e)return d("No preference on "+f+"."),a;d("Prefer "+f+": "+e);var g=a.split("\r\n"),h=z(g,"m=",b);if(null===h)return a;var i=B(g,e);return i&&(g[h]=D(g[h],i)),a=g.join("\r\n")}function u(a,b,c,d){var e=a.split("\r\n"),f=y(e,b),g={};if(null===f){var h=z(e,"a=rtpmap",b);if(null===h)return a;var i=C(e[h]);g.pt=i.toString(),g.params={},g.params[c]=d,e.splice(h+1,0,x(g))}else g=w(e[f]),g.params[c]=d,e[f]=x(g);return a=e.join("\r\n")}function v(a,b,c){var d=a.split("\r\n"),e=y(d,b);if(null===e)return a;var f=w(d[e]);delete f.params[c];var g=x(f);return null===g?d.splice(e,1):d[e]=g,a=d.join("\r\n")}function w(a){var b={},c=a.indexOf(" "),d=a.substring(c+1).split("; "),e=new RegExp("a=fmtp:(\\d+)"),f=a.match(e);if(!f||2!==f.length)return null;b.pt=f[1];for(var g={},h=0;h<d.length;++h){var i=d[h].split("=");2===i.length&&(g[i[0]]=i[1])}return b.params=g,b}function x(a){if(!a.hasOwnProperty("pt")||!a.hasOwnProperty("params"))return null;var b=a.pt,c=a.params,d=[],e=0;for(var f in c)d[e]=f+"="+c[f],++e;return 0===e?null:"a=fmtp:"+b.toString()+" "+d.join("; ")}function y(a,b){var c=B(a,b);return c?z(a,"a=fmtp:"+c.toString()):null}function z(a,b,c){return A(a,0,-1,b,c)}function A(a,b,c,d,e){for(var f=-1!==c?c:a.length,g=b;f>g;++g)if(0===a[g].indexOf(d)&&(!e||-1!==a[g].toLowerCase().indexOf(e.toLowerCase())))return g;return null}function B(a,b){var c=z(a,"a=rtpmap",b);return c?C(a[c]):null}function C(a){var b=new RegExp("a=rtpmap:(\\d+) [a-zA-Z0-9-]+\\/\\d+"),c=a.match(b);return c&&2===c.length?c[1]:null}function D(a,b){var c=a.split(" "),d=c.slice(0,3);d.push(b);for(var e=3;e<c.length;e++)c[e]!==b&&d.push(c[e]);return d.join(" ")}function E(a){var b=a.split("\r\n"),c=z,c=z(b,"m=");if(null===c)return a;var d=A(b,0,c,"a=ice-options","trickle");if(d)return a;var e="a=ice-options:trickle";return b.splice(c-1,0,e),a=b.join("\r\n")}function F(a,b){var c=a.split("\r\n"),d=z(c,"m=","video 0");return null===d?c.join("\r\n"):(c[d]=G(c[d],b),c.join("\r\n"))}function G(a,b){return a=a.split(" "),a[1]=b,a.join(" ")}function H(a,b){var c=a.split("\r\n"),d=z(c,"m=video");if(null===d)return a;if(-1==c[d].search(b))return a;c[d]=c[d].replace(" "+b,"");var e=z(c,"a=rtpmap:"+b);e&&c.splice(e,1);var f=z(c,"a=fmtp:"+b);return f&&c.splice(f,1),a=c.join("\r\n")}var I={setDefaultCodec:D,setCodecParam:u,maybeSetOpusOptions:e,maybePreferCodec:t,maybePreferVideoReceiveCodec:s,maybePreferVideoSendCodec:r,maybePreferAudioReceiveCodec:q,maybePreferAudioSendCodec:p,maybeSetVideoReceiveBitRate:i,maybeSetVideoSendBitRate:h,maybeSetAudioReceiveBitRate:g,maybeSetAudioSendBitRate:f,maybeSetVideoSendInitialBitRate:k,maybeSetTrickleIceAttr:E,maybeRemoveVideoFec:o,maybeReplaceVideoPortNumber:F,maybeRemoveCodecFromSDP:H};return I}),define("sdp-transform/grammar",["require","exports","module"],function(a,b,c){var d=c.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(a){return a.encoding?"rtpmap:%d %s/%s/%s":a.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(a){return null!=a.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(a){return null!=a.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["value","uri","config"],format:function(a){return null!=a.config?"extmap:%s %s %s":"extmap:%s %s"}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(a){return null!=a.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation"],format:function(a){var b="candidate:%s %d %s %d %s %d typ %s";return b+=null!=a.raddr?" raddr %s rport %d":"%v%v",b+=null!=a.tcptype?" tcptype %s":"%v",null!=a.generation&&(b+=" generation %d"),b}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_]*):(.*)/,names:["id","attribute","value"],format:"ssrc:%d %s:%s"},{push:"ssrcGroups",reg:/^ssrc-group:(\w*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{push:"invalid",names:["value"]}]};Object.keys(d).forEach(function(a){var b=d[a];b.forEach(function(a){a.reg||(a.reg=/(.*)/),a.format||(a.format="%s")})})}),define("sdp-transform/parser",["require","exports","module","sdp-transform/grammar"],function(a,b,c){var d=function(a){return String(Number(a))===a?Number(a):a},e=function(a,b,c,e){if(e&&!c)b[e]=d(a[1]);else for(var f=0;f<c.length;f+=1)null!=a[f+1]&&(b[c[f]]=d(a[f+1]))},f=function(a,b,c){var d=a.name&&a.names;a.push&&!b[a.push]?b[a.push]=[]:d&&!b[a.name]&&(b[a.name]={});var f=a.push?{}:d?b[a.name]:b;e(c.match(a.reg),f,a.names,a.name),a.push&&b[a.push].push(f)},g=a("sdp-transform/grammar"),h=RegExp.prototype.test.bind(/^([a-z])=(.*)/);b.parse=function(a){var b={},c=[],d=b;return a.split(/(\r\n|\r|\n)/).filter(h).forEach(function(a){var b=a[0],e=a.slice(2);"m"===b&&(c.push({rtp:[],fmtp:[]}),d=c[c.length-1]);for(var h=0;h<(g[b]||[]).length;h+=1){var i=g[b][h];if(i.reg.test(e))return f(i,d,e)}}),b.media=c,b};var i=function(a,b){var c=b.split("=");return 2===c.length&&(a[c[0]]=d(c[1])),a};b.parseFmtpConfig=function(a){return a.split(/\;\s?/).reduce(i,{})},b.parsePayloads=function(a){return a.split(" ").map(Number)},b.parseRemoteCandidates=function(a){for(var b=[],c=a.split(" ").map(d),e=0;e<c.length;e+=3)b.push({component:c[e],ip:c[e+1],port:c[e+2]});return b}}),define("sdp-transform/writer",["require","exports","module","sdp-transform/grammar"],function(a,b,c){var d=a("sdp-transform/grammar"),e=/%[sdv%]/g,f=function(a){var b=1,c=arguments,d=c.length;return a.replace(e,function(a){if(b>=d)return a;var e=c[b];switch(b+=1,a){case"%%":return"%";case"%s":return String(e);case"%d":return Number(e);case"%v":return""}})},g=function(a,b,c){var d=b.format instanceof Function?b.format(b.push?c:c[b.name]):b.format,e=[a+"="+d];if(b.names)for(var g=0;g<b.names.length;g+=1){var h=b.names[g];b.name?e.push(c[b.name][h]):e.push(c[b.names[g]])}else e.push(c[b.name]);return f.apply(null,e)},h=["v","o","s","i","u","e","p","c","b","t","r","z","a"],i=["i","c","b","a"];c.exports=function(a,b){b=b||{},null==a.version&&(a.version=0),null==a.name&&(a.name=" "),a.media.forEach(function(a){null==a.payloads&&(a.payloads="")});var c=b.outerOrder||h,e=b.innerOrder||i,f=[];return c.forEach(function(b){d[b].forEach(function(c){c.name in a&&null!=a[c.name]?f.push(g(b,c,a)):c.push in a&&null!=a[c.push]&&a[c.push].forEach(function(a){f.push(g(b,c,a))})})}),a.media.forEach(function(a){f.push(g("m",d.m[0],a)),e.forEach(function(b){d[b].forEach(function(c){c.name in a&&null!=a[c.name]?f.push(g(b,c,a)):c.push in a&&null!=a[c.push]&&a[c.push].forEach(function(a){f.push(g(b,c,a))})})})}),f.join("\r\n")+"\r\n"}}),define("sdp-transform/index",["require","exports","module","sdp-transform/parser","sdp-transform/writer"],function(a,b,c){var d=a("sdp-transform/parser"),e=a("sdp-transform/writer");b.write=e,b.parse=d.parse,b.parseFmtpConfig=d.parseFmtpConfig,b.parsePayloads=d.parsePayloads,b.parseRemoteCandidates=d.parseRemoteCandidates}),define("sdp-interop/transform",["require","exports","module","sdp-transform/index"],function(a,b,c){var d=a("sdp-transform/index");b.write=function(a,b){return"undefined"!=typeof a&&"undefined"!=typeof a.media&&Array.isArray(a.media)&&a.media.forEach(function(a){"undefined"!=typeof a.sources&&0!==Object.keys(a.sources).length&&(a.ssrcs=[],Object.keys(a.sources).forEach(function(b){var c=a.sources[b];Object.keys(c).forEach(function(d){a.ssrcs.push({id:b,attribute:d,value:c[d]})})}),delete a.sources),"undefined"!=typeof a.ssrcGroups&&Array.isArray(a.ssrcGroups)&&a.ssrcGroups.forEach(function(a){"undefined"!=typeof a.ssrcs&&Array.isArray(a.ssrcs)&&(a.ssrcs=a.ssrcs.join(" "))})}),"undefined"!=typeof a&&"undefined"!=typeof a.groups&&Array.isArray(a.groups)&&a.groups.forEach(function(a){"undefined"!=typeof a.mids&&Array.isArray(a.mids)&&(a.mids=a.mids.join(" "))}),d.write(a,b)},b.parse=function(a){var b=d.parse(a);return"undefined"!=typeof b&&"undefined"!=typeof b.media&&Array.isArray(b.media)&&b.media.forEach(function(a){"undefined"!=typeof a.ssrcs&&Array.isArray(a.ssrcs)&&(a.sources={},a.ssrcs.forEach(function(b){a.sources[b.id]||(a.sources[b.id]={}),a.sources[b.id][b.attribute]=b.value}),delete a.ssrcs),"undefined"!=typeof a.ssrcGroups&&Array.isArray(a.ssrcGroups)&&a.ssrcGroups.forEach(function(a){"string"==typeof a.ssrcs&&(a.ssrcs=a.ssrcs.split(" "))})}),"undefined"!=typeof b&&"undefined"!=typeof b.groups&&Array.isArray(b.groups)&&b.groups.forEach(function(a){"string"==typeof a.mids&&(a.mids=a.mids.split(" "))}),b}}),define("sdp-interop/array-equals",["require","exports","module"],function(a,b,c){c.exports=function d(a){if(!a)return!1;if(this.length!=a.length)return!1;for(var b=0,c=this.length;c>b;b++)if(this[b]instanceof Array&&a[b]instanceof Array){if(!d.apply(this[b],[a[b]]))return!1}else if(this[b]!=a[b])return!1;return!0}}),define("sdp-interop/interop",["require","exports","module","sdp-interop/transform","sdp-interop/array-equals"],function(a,b,c){function d(){this.cache={}}var e=a("sdp-interop/transform"),f=a("sdp-interop/array-equals");c.exports=d,d.prototype.getFirstSendingIndexFromAnswer=function(a){if(!this.cache.answer)return null;var b=e.parse(this.cache.answer);if(b&&b.media&&Array.isArray(b.media))for(var c=0;c<b.media.length;c++)if(b.media[c].type==a&&(!b.media[c].direction||"sendrecv"===b.media[c].direction||"sendonly"===b.media[c].direction))return c;return null},d.prototype.toPlanB=function(a){var b=this;if("object"!=typeof a||null===a||"string"!=typeof a.sdp)return a;var c=e.parse(a.sdp);if("undefined"==typeof c.media||!Array.isArray(c.media)||0===c.media.length)return a;if(c.media.length<=3&&c.media.every(function(a){return-1!==["video","audio","data"].indexOf(a.mid)}))return a;for(var d=a.sdp,f=!1,g=0;g<c.media.length;g++){var h=c.media[g];h.rtp.forEach(function(a){if("NULL"===a.codec){f=!0;var c=e.parse(b.cache.offer);a.codec=c.media[g].rtp[0].codec}})}f&&(d=e.write(c)),this.cache[a.type]=d;var i=c.media;c.media=[];var j={},k=[];i.forEach(function(a){if(("string"!=typeof a.rtcpMux||"rtcp-mux"!==a.rtcpMux)&&"inactive"!==a.direction)throw new Error("Cannot convert to Plan B because m-lines without the rtcp-mux attribute were found.");return"application"===a.type?(c.media.push(a),void k.push(a.mid)):("undefined"==typeof j[a.type]&&(j[a.type]=a),"object"==typeof a.sources&&Object.keys(a.sources).forEach(function(b){"object"!=typeof j[a.type].sources&&(j[a.type].sources={}),j[a.type].sources[b]=a.sources[b],"undefined"!=typeof a.msid&&(j[a.type].sources[b].msid=a.msid)}),"undefined"!=typeof a.ssrcGroups&&Array.isArray(a.ssrcGroups)&&("undefined"!=typeof j[a.type].ssrcGroups&&Array.isArray(j[a.type].ssrcGroups)||(j[a.type].ssrcGroups=[]),j[a.type].ssrcGroups=j[a.type].ssrcGroups.concat(a.ssrcGroups)),void(j[a.type]===a&&(a.candidates=i[0].candidates,a.iceUfrag=i[0].iceUfrag,a.icePwd=i[0].icePwd,a.fingerprint=i[0].fingerprint,a.mid=a.type,delete a.bundleOnly,delete a.msid,k.push(a.type),c.media.push(a))))}),c.groups.some(function(a){return"BUNDLE"===a.type?(a.mids=k.join(" "),!0):void 0}),c.msidSemantic={semantic:"WMS",token:"*"};var l=e.write(c);return new RTCSessionDescription({type:a.type,sdp:l})},d.prototype.toUnifiedPlan=function(a){var b=this;if("object"!=typeof a||null===a||"string"!=typeof a.sdp)return a;var c=e.parse(a.sdp);if("undefined"==typeof c.media||!Array.isArray(c.media)||0===c.media.length)return a;if(c.media.length>3||!c.media.every(function(a){
return-1!==["video","audio","data"].indexOf(a.mid)}))return a;var d=[];c.media.forEach(function(a){d.push(a.mid)});var g=!1;if("undefined"!=typeof c.groups&&Array.isArray(c.groups)&&(g=c.groups.every(function(a){return"BUNDLE"!==a.type||f.apply(a.mids.sort(),[d.sort()])})),!g)throw new Error("Cannot convert to Unified Plan because m-lines that are not bundled were found.");var h;"undefined"!=typeof this.cache[a.type]&&(h=e.parse(this.cache[a.type]));var i={audio:{},video:{}},j={};if(c.media.forEach(function(b){if(("string"!=typeof b.rtcpMux||"rtcp-mux"!==b.rtcpMux)&&"inactive"!==b.direction)throw new Error("Cannot convert to Unified Plan because m-lines without the rtcp-mux attribute were found.");if("application"===b.type)return void(j[b.mid]=b);var c=b.sources,d=b.ssrcGroups,e=b.candidates,f=b.iceUfrag,g=b.icePwd,k=b.fingerprint,l=b.port;delete b.sources,delete b.ssrcGroups,delete b.candidates,delete b.iceUfrag,delete b.icePwd,delete b.fingerprint,delete b.port,delete b.mid;var m={};"undefined"!=typeof d&&Array.isArray(d)&&d.forEach(function(a){"SIM"!==a.semantics&&"undefined"!=typeof a.ssrcs&&Array.isArray(a.ssrcs)&&a.ssrcs.forEach(function(b){"undefined"==typeof m[b]&&(m[b]=[]),m[b].push(a)})});var n={};"object"==typeof c&&Object.keys(c).forEach(function(d){var o;return"offer"!==a.type||c[d].msid?("undefined"!=typeof m[d]&&Array.isArray(m[d])&&m[d].some(function(a){return a.ssrcs.some(function(a){return"object"==typeof n[a]?(o=n[a],!0):void 0})}),void("object"==typeof o?(o.sources[d]=c[d],delete c[d].msid):(o=Object.create(b),n[d]=o,"undefined"!=typeof c[d].msid&&(o.msid=c[d].msid,o.direction="sendrecv",delete c[d].msid),o.sources={},o.sources[d]=c[d],o.ssrcGroups=m[d],"undefined"!=typeof h&&"undefined"!=typeof h.media&&Array.isArray(h.media)&&h.media.forEach(function(a){"object"==typeof a.sources&&Object.keys(a.sources).forEach(function(b){b===d&&(o.mid=a.mid)})}),"undefined"==typeof o.mid&&("answer"===a.type,o.mid=[b.type,"-",d].join("")),o.candidates=e,o.iceUfrag=f,o.icePwd=g,o.fingerprint=k,o.port=l,j[o.mid]=o))):void(i[b.type][d]=c[d])})}),c.media=[],d=[],"offer"===a.type)for(var k=0;k<h.media.length;k++){var l=h.media[k];"undefined"==typeof j[l.mid]&&(delete l.msid,delete l.sources,delete l.ssrcGroups,l.direction&&"sendrecv"!==l.direction?"sendonly"===l.direction&&(l.direction="inactive"):l.direction="recvonly"),c.media.push(l),"string"==typeof l.mid&&d.push(l.mid)}else"undefined"!=typeof h&&"undefined"!=typeof h.media&&Array.isArray(h.media)&&h.media.forEach(function(a){d.push(a.mid),"undefined"!=typeof j[a.mid]?c.media.push(j[a.mid]):(delete a.msid,delete a.sources,delete a.ssrcGroups,a.direction&&"sendrecv"!==a.direction||(a.direction="recvonly"),a.direction&&"sendonly"!==a.direction||(a.direction="inactive"),c.media.push(a))}),Object.keys(j).forEach(function(a){-1===d.indexOf(a)&&(d.push(a),"recvonly"===j[a].direction?c.media.some(function(b){return"sendrecv"!==b.direction&&"sendonly"!==b.direction||b.type!==j[a].type?void 0:(Object.keys(j[a].sources).forEach(function(c){b.sources[c]=j[a].sources[c]}),!0)}):c.media.push(j[a]))});["audio","video"].forEach(function(a){if(c&&c.media&&Array.isArray(c.media)){var d=null;if(Object.keys(i[a]).length>0&&(d=b.getFirstSendingIndexFromAnswer(a),null===d))for(var e=0;e<c.media.length;e++)if(c.media[e].type===a){d=e;break}if(d&&c.media.length>d){var f=c.media[d];Object.keys(i[a]).forEach(function(b){f.sources&&f.sources[b],f.sources||(f.sources={}),f.sources[b]=i[a][b]})}}}),c.groups.some(function(a){return"BUNDLE"===a.type?(a.mids=d.join(" "),!0):void 0}),c.msidSemantic={semantic:"WMS",token:"*"};var m=0;d=[],c.media.forEach(function(a){0==m?a.mid="sdparta_0":1==m?a.mid="sdparta_1":2==m&&(a.mid="sdparta_2"),d.push(a.mid),m++}),c.groups.some(function(a){return"BUNDLE"===a.type?(a.mids=d.join(" "),!0):void 0});var n=e.write(c);return this.cache[a.type]=n,new RTCSessionDescription({type:a.type,sdp:n})}}),define("sdp-interop/index",["require","exports","module","sdp-interop/interop"],function(a,b,c){b.Interop=a("sdp-interop/interop")}),define("WebRTC_SDK/RTCPeer",["require","q","my.Class","underscore","backbone","Logger","adapter","WebRTC_SDK/utilities/RTCErrors","WebRTC_SDK/utilities/RTCBlueJay","WebRTC_SDK/RTCCallStats","WebRTC_SDK/RTCStates","WebRTC_SDK/utilities/RTCUtils","WebRTC_SDK/models/RTCPeerModel","WebRTC_SDK/manager/RTCStateManager","sdpUtils","sdp-interop/index","browserDetector"],function(a){var b=a("q"),c=a("my.Class"),d=a("underscore"),e=a("backbone"),f=a("Logger"),g=(a("adapter"),a("WebRTC_SDK/utilities/RTCErrors")),h=a("WebRTC_SDK/utilities/RTCBlueJay"),i=a("WebRTC_SDK/RTCCallStats"),j=a("WebRTC_SDK/RTCStates"),k=a("WebRTC_SDK/utilities/RTCUtils"),l=a("WebRTC_SDK/models/RTCPeerModel"),m=a("WebRTC_SDK/manager/RTCStateManager"),n=a("sdpUtils"),o=a("sdp-interop/index"),p=a("browserDetector"),q=c.Class({iceRestartTimer:null,iceRestartTimeout:1e4,iceConnectivityTimeout:2e4,iceConnectivityTimer:null,numIceCandidates:0,constructor:function(a){d.bindAll(this),d.extend(this,e.Events),this.isFirefox="firefox"===p.browser?!0:!1,this.ICE_CONNECTION_STATES=j.WEBRTC_STATES.iceConnectionState;var b=k.deepMergeObjects(l.getDefaults(),a.peerConfig);this.model=new l(b),this.isConnectionLost=!1,this.oldPktCount=0,this.maxPktRecvCounter=5,this.pktRecvCounter=this.maxPktRecvCounter,this.isClosing=!1,this.isRemoteMute=!1;var c=this.model.get("peerConnectionConfig"),g=this.model.get("peerConnectionConstraints");f.debug("RTCPeer: Force turn is enabled, get only relay ICE candidates"),c.iceTransportPolicy="relay",c.webrtcDisableBundling&&!this.isFirefox?(f.debug("RTCPeer: Disable ICE bundling"),c.bundlePolicy="balanced",this.bundlePolicy="balanced"):this.bundlePolicy="max-bundle",this.isFirefox&&c.iceServers.forEach(function(a){a.username=a.username+"#firefox"}),("chrome"===p.browser||"opera"===p.browser)&&(c.sdpSemantics="plan-b"),this.pc=new RTCPeerConnection(c,g),this.pc.onicecandidate=this.onIceCandidate,this.pc.onaddstream=this.onRemoteStreamAdded,this.pc.onremovestream=this.onRemoteStreamRemoved,this.pc.onsignalingstatechange=this.onSignalingStateChanged,this.pc.oniceconnectionstatechange=this.onIceConnectionStateChanged,this.pc.onicegatheringstatechange=this.onIceGatheringStateChanged,this.pc.onnegotiationneeded=this.onNegotiationNeeded,d.isNull(a.localAudioStream)||d.isUndefined(a.localAudioStream)||this.addStream(a.localAudioStream),d.isNull(a.localVideoStream)||d.isUndefined(a.localVideoStream)||this.addStream(a.localVideoStream),d.isNull(a.fakeStream)||d.isUndefined(a.fakeStream)||this.addStream(a.fakeStream),this.callStats=new i({peerConnection:this.pc,statsPollInterval:this.isFirefox?1e3:this.model.get("statsPollInterval")}),this.callStatsModel=this.callStats.model,this.callStats.on("rtcstats",this.checkFFMediaConnectivity),this.isFirefox&&(this.sdpInterop=new o.Interop),this.webrtcFec=c.webrtcFec},addStream:function(a){return this.isPCClosed()?(f.warn("RTCPeer: Peer connection is closed, ignoring addStream request"),g.PEER_CONNECTION_ERRORS.PC_CLOSED):(this.pc.addStream(a),this.model.setStreamByType(a,"local",a),f.debug("RTCPeer: Added stream to peer connection: ",a.id),void 0)},removeStream:function(a){return this.isPCClosed()?(f.warn("RTCPeer: Peer connection is closed, ignoring removeStream request"),g.PEER_CONNECTION_ERRORS.PC_CLOSED):(this.pc.removeStream(a),this.model.setStreamByType(a,"local",null),f.debug("RTCPeer: Removed stream from peer connection: ",a.id),void 0)},removeAudioStream:function(){var a=this.model.get("localAudioStream");d.isNull(a)||d.isUndefined(a)?f.debug("RTCPeer: Local Audio Stream in PC is null, cannot remove"):this.removeStream(a)},removeVideoStream:function(){var a=this.model.get("localVideoStream");d.isNull(a)||d.isUndefined(a)?f.debug("RTCPeer: Local Video Stream in PC is null, cannot remove"):this.removeStream(a)},onIceCandidate:function(a){var b=a.candidate;b?(this.model.set("iceGatheringState",this.pc.iceGatheringState),this.trigger("iceCandidate",this,b),this.numIceCandidates++):null===b&&(0===this.numIceCandidates?(f.debug("RTCPeer :: Received NULL Ice Candidate before gathering candidates"),this.onIceGatheringFailure()):(f.debug("RTCPeer: Ice Gathering complete, Ice Candidate count "+this.numIceCandidates),this.model.set("iceGatheringState",this.pc.iceGatheringState)))},onIceConnectionStateChanged:function(a){if(this.pc)switch(this.model.set("iceConnectionState",this.pc.iceConnectionState),f.debug("RTCPeer: iceConnectionState changed to: "+this.pc.iceConnectionState),this.pc.iceConnectionState){case this.ICE_CONNECTION_STATES.CHECKING:this.initIceConnectivityTimer();break;case this.ICE_CONNECTION_STATES.CONNECTED:case this.ICE_CONNECTION_STATES.COMPLETED:this.initCallStats(),this.clearIceConnectivityTimer();break;case this.ICE_CONNECTION_STATES.DISCONNECTED:this.initIceRestart(),this.initIceConnectivityTimer();break;case this.ICE_CONNECTION_STATES.FAILED:this.isFirefox?(f.warn("ICE connection failed, restarting the call"),m.callDisconnected(g.DISCONNECT_REASONS.ICE_CONNECTION_FAILED)):(this.initIceConnectivityTimer(),this.restartIce());break;case this.ICE_CONNECTION_STATES.CLOSED:this.isPCClosed()||this.trigger("iceConnectionClosed")}},ffIceConnectionChange:function(a){this.pc&&(this.model.set("iceConnectionState",a),a===this.ICE_CONNECTION_STATES.CONNECTED?this.clearIceConnectivityTimer():(this.initIceRestart(),this.initIceConnectivityTimer()))},initIceRestart:function(){var a=this,b=this.model.get("iceConnectionState");this.iceRestartTimer=window.setTimeout(function(){b=a.model.get("iceConnectionState"),b===a.ICE_CONNECTION_STATES.CONNECTED||b===a.ICE_CONNECTION_STATES.COMPLETED?a.clearIceRestartTimer():a.restartIce()},this.iceRestartTimeout)},restartIce:function(){this.trigger("restartICE"),this.clearIceRestartTimer(),this.isConnectionLost=!1},initIceConnectivityTimer:function(){var a=this;null===a.iceConnectivityTimer&&(a.iceConnectivityTimer=setTimeout(function(){var b=a.model.get("iceConnectionState");b!==a.ICE_CONNECTION_STATES.CONNECTED&&b!==a.ICE_CONNECTION_STATES.COMPLETED&&(f.warn("Can not establish ICE connectivity, restarting the call"),0===a.numIceCandidates?m.callDisconnected(g.DISCONNECT_REASONS.ICE_GATHERING_FAILED):m.callDisconnected(g.DISCONNECT_REASONS.ICE_CONNECTION_FAILED))},a.iceConnectivityTimeout))},clearIceRestartTimer:function(){this.iceRestartTimer&&window.clearTimeout(this.iceRestartTimer),this.iceRestartTimer=null},clearIceConnectivityTimer:function(){this.iceConnectivityTimer&&window.clearTimeout(this.iceConnectivityTimer),this.iceConnectivityTimer=null},onIceGatheringStateChanged:function(a){f.debug("RTCPeer: Received 'iceGatheringStateChange' event")},onNegotiationNeeded:function(a){},onSignalingStateChanged:function(a){this.pc&&(f.debug("RTCPeer: signalingState changed to: "+this.pc.signalingState),this.model.set("signalingState",this.pc.signalingState),"closed"!==this.pc.signalingState||this.isClosing||m.callDisconnected(g.DISCONNECT_REASONS.SIG_CHANNEL_CLOSED))},onIceCandidatesEnded:function(){f.debug("RTCPeer: Received 'endOfCandidates' event")},onRemoteStreamAdded:function(a){var b=a.stream;d.isNull(b)||d.isUndefined(b)?f.error("RTCPeer: onRemoteStreamAdded event has invalid stream in it: ",b):(this.model.setStreamByType(b,"remote",b),f.debug("RTCPeer: Connector added a stream to peer connection: ",b))},onRemoteStreamRemoved:function(a){var b=a.stream;d.isNull(b)||d.isUndefined(b)?f.error("RTCPeer: onRemoteStreamRemoved event has invalid stream in it: ",b):(this.model.setStreamByType(b,"remote",null),f.debug("RTCPeer: Connector removed a stream from peer connection: ",b))},initCallStats:function(){this.callStats.startPollingStats()},checkFFMediaConnectivity:function(a){var b=function(a,b){return a.type==b&&!a.isRemote};if(!this.isRemoteMute&&"connected"===this.model.get("iceConnectionState")){var c=0;Object.keys(a).find(function(d){b(a[d],"inboundrtp")&&(c+=a[d].packetsReceived)});var d=c-this.oldPktCount?!0:!1;d?(this.pktRecvCounter=this.maxPktRecvCounter,this.isConnectionLost&&(this.isConnectionLost=!1,this.ffIceConnectionChange("connected"),f.debug("RTCPeer :: ICE connected"))):this.pktRecvCounter?this.pktRecvCounter--:this.isConnectionLost||(this.ffIceConnectionChange("disconnected"),this.isConnectionLost=!0,f.debug("RTPeer :: ICE disconnected")),this.oldPktCount=c}},handleResponseMessage:function(a){},handleErrorMessage:function(a){f.debug("RTCPeer: Received 'error' message: "+a)},handleNotificationMessage:function(a){f.debug("RTCPeer: Received 'notification' message: "+a);var b=h.METHODS;switch(a.method){case b.CANDIDATE:this.pc.processIce(a.iceCandidate);break;default:f.error("RTCPeer: Method received in notification message: "+a.method+" is not supported.")}},createOffer:function(a){var c=this,e=b.defer();if(this.isFirefox)var h=a;else var h=d.extend({},this.model.get("receiveMedia"),a);h&&h.iceRestart&&(this.numIceCandidates=0);var i=function(a){(!c.webrtcFec||c.isFirefox||p.version<"48")&&(p.version<"51"&&!c.isFirefox?(a.sdp=n.maybeRemoveCodecFromSDP(a.sdp,"98"),a.sdp=n.maybeRemoveCodecFromSDP(a.sdp,"116")):a.sdp=n.maybeRemoveVideoFec(a.sdp,{videoFec:"false"})),c.pc.setLocalDescription(a,function(){c.isFirefox&&(a=c.sdpInterop.toPlanB(a),a.sdp=n.maybeReplaceVideoPortNumber(a.sdp,9)),a=c._appendInfoToSdp(a),c.model.set("localSdp",a),e.resolve(a)},function(a){f.error("RTCPeer: Error while setting localSdp: "+a),e.reject(a)})},j=function(a){f.error("RTCPeer: Error while creating offer sdp: "+a),e.reject(a)};return this.isPCClosed()?(f.warn("RTCPeer: Peer connection is closed, ignoring createOffer request"),e.reject(g.PEER_CONNECTION_ERRORS.PC_CLOSED)):this.pc.createOffer(i,j,h),e.promise},handleOffer:function(a){var c=this,d=a.params.sessionDescription,e=b.defer(),h=function(a){f.error("RTCPeer: Error while processing incoming offer request: "+a),e.reject(a)};return this.isPCClosed()?(f.warn("RTCPeer: Peer connection is closed, ignoring handleOffer request"),e.reject(g.PEER_CONNECTION_ERRORS.PC_CLOSED)):this.pc.setRemoteDescription(new RTCSessionDescription(d),function(){c.model.set("remoteSdp",d),c.pc.createAnswer(function(a){c.pc.setLocalDescription(answer,function(){a=c._appenInfotoSdp(a),c.model.set("localSdp",a),e.resolve()},h)},h)},h),e.promise},handleAnswer:function(a){var c=this,d=a.params.sessionDescription,e=b.defer();return this.isPCClosed()?(f.warn("RTCPeer: Peer connection is closed, ignoring handleAnswer request"),e.reject(g.PEER_CONNECTION_ERRORS.PC_CLOSED)):(this.isFirefox&&(d=this.sdpInterop.toUnifiedPlan(d)),this.pc.setRemoteDescription(new RTCSessionDescription(d),function(){c.model.set("remoteSdp",d),e.resolve()},function(a){f.error("RTCPeer: Error while setting remote description: "+a),e.reject(a)})),e.promise},handleUpdate:function(a){var c=b.defer();return f.warn("RTCPeer: 'update' Method is not supported yet"),c.resolve(),c.promise},handleKeepAlive:function(a){f.debug("RTCPeer: Received a keepalive message");var c=b.defer();return c.resolve(),c.promise},handleDisconnect:function(a){var c=b.defer();return this.pc?(this.isClosing=!0,"closed"!==this.pc.signalingState&&this.pc.close(),this.model.set("remoteStream",null),this.model.set("closed",!0),this.pc=null):f.warn("RTCPeer: This Peer Connection has already been closed!!"),c.resolve(),c.promise},handleIceCandidate:function(a){var c=b.defer();if(this.isFirefox&&("audio"===a.sdpMid?a.sdpMid="sdparta_0":(a.sdpMid="sdparta_1",a.sdpMLineIndex=1)),this.pc){var d=new RTCIceCandidate({sdpMLineIndex:a.sdpMLineIndex,candidate:a.candidate,sdpMid:a.sdpMid});this.pc.addIceCandidate(d),c.resolve()}return c.promise},isPCClosed:function(){return this.model.get("closed")===!0||"closed"===this.pc.signalingState?!0:!1},_appendInfoToSdp:function(a){var b=new Object({audioMsid:"",videoMsid:"",contnetMsid:""});return this.pc.getLocalStreams().forEach(function(a){switch(a.bjn_label){case"local_av_stream":b.audioMsid=a.id,b.videoMsid=a.id;break;case"local_audio_stream":b.audioMsid=a.id;break;case"local_video_stream":b.videoMsid=a.id;break;case"content_stream":case"fake_stream":b.contentMsid=a.id;break;default:f.error("RTCPeer: Invalid Stream found in PC "+a.bjn_label)}}),a.streamInfo=b,a},onIceGatheringFailure:function(){var a=this;window.setTimeout(function(){0===a.numIceCandidates&&(f.warn("RTCPeer :: Received only NULL Ice Candidate before gathering candidates, Restarting the call"),m.callDisconnected(g.DISCONNECT_REASONS.ICE_GATHERING_FAILED))},5e3)},replaceTrack:function(a,b){var c=this,e=null;if("audio"===a||"video"===a?e="audio"===a?this.model.get("localAudioStream"):this.model.get("localVideoStream"):b?(this.model.setStreamByType(b,"local",b),e=this.model.get("fakeStream")):(e=this.model.get("localContentStream"),b=this.model.get("fakeStream"),this.model.setStreamByType(e,"local",null)),d.isNull(e)||d.isUndefined(e)||!this.pc)f.debug("RTCPeer: Local Stream in PC is null, cannot replace the track");else if(e.id!==b.id){var g=e.getTracks()[0].id;this.pc.getSenders().forEach(function(a){a&&a.track.id===g&&(a.replaceTrack(b.getTracks()[0]),c.model.setStreamByType(b,"local",b))})}},close:function(){f.debug("RTCPeer: closing RTCPeerConnection now"),this.isClosing=!0,this.clearIceConnectivityTimer(),this.clearIceRestartTimer(),this.handleDisconnect(),this.callStats.close(),this.numIceCandidates=0}});return q}),define("WebRTC_SDK/models/RTCScreenSharingModel",["require","backbone","jquery","underscore","Logger","WebRTC_SDK/RTCStates"],function(a){var b=a("backbone"),c=a("jquery"),d=a("underscore"),e=a("Logger"),f=a("WebRTC_SDK/RTCStates"),g=b.Model.extend({defaults:{localContentStream:null,chromeMediaSourceId:null,isChromeExtensionInstalled:!1,extensionStatus:f.EXTENSION_STATES.NOT_INSTALLED,screenShareState:null,tokenStatus:null,presentationToken:{},firefoxScreenShareCancelled:null},isExtensionInstalled:function(){var a=c("body").find(".InMeetingExtensionIsInstalled"),b=!1,g=this;d.each(a,function(a,d,e){c(a).attr("data-extension-id")===g.get("extensionId")&&(b=!0)});var h=this.get("extensionStatus")===f.EXTENSION_STATES.INSTALLED;return b||h?(e.debug("RTCScreenSharingModel: The Screen Sharing Chrome extension has been installed."),!0):(e.warn("RTCScreenSharingModel: The Screen Sharing Chrome extension is not installed."),!1)},isExtensionInstalling:function(){return this.model.get("extensionStatus")===f.EXTENSION_STATES.INSTALLING}});return g}),define("WebRTC_SDK/manager/RTCScreenSharingManager",["require","underscore","jquery","my.Class","q","backbone","Logger","WebRTC_SDK/utilities/RTCBlueJay","WebRTC_SDK/RTCStates","WebRTC_SDK/utilities/RTCErrors","WebRTC_SDK/utilities/RTCUtils","WebRTC_SDK/models/RTCScreenSharingModel","WebRTC_SDK/manager/RTCSignallingManager","WebRTC_SDK/manager/RTCTransactionManager","WebRTC_SDK/manager/RTCStateManager","browserDetector"],function(a){var b=a("underscore"),c=a("jquery"),d=a("my.Class"),e=a("q"),f=(a("backbone"),a("Logger")),g=a("WebRTC_SDK/utilities/RTCBlueJay"),h=a("WebRTC_SDK/RTCStates"),i=a("WebRTC_SDK/utilities/RTCErrors"),j=a("WebRTC_SDK/utilities/RTCUtils"),k=a("WebRTC_SDK/models/RTCScreenSharingModel"),l=a("WebRTC_SDK/manager/RTCSignallingManager"),m=a("WebRTC_SDK/manager/RTCTransactionManager"),n=a("WebRTC_SDK/manager/RTCStateManager"),o=a("browserDetector"),p=d.Class({config:{chromeMediaConstraints:{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:1920,maxHeight:1080},optional:[{maxFrameRate:5},{minFrameRate:5},{googTemporalLayeredScreencast:!0}]}},ffMediaConstraints:{audio:!1,video:{mediaSource:"screen",width:{max:"1920"},height:{max:"1080"},frameRate:{exact:"5"}}}},installationCompletedRetries:0,maxInstallationCompletedRetries:5,constructor:function(a){b.bindAll(this),this.isFirefox="firefox"===o.browser?!0:!1,this.model=new k,this.model.on("change:extensionStatus",this.onExtensionStatusChanged),this.model.on("change:tokenStatus",this.onTokenStatusChange)},setParams:function(a){this.model.set("extensionId",a.extensionId),this.config.features=a.features,this.config.extensionID=a.extensionId,this.screenSharingExtensionUrl="https://chrome.google.com/webstore/detail/"+a.extensionId},onExtensionStatusChanged:function(){var a=this.model.get("extensionStatus"),b=h.EXTENSION_STATES;switch(f.debug("RTCScreenSharingManager: Extension status changed to: ",a),a){case b.NOT_INSTALLED:break;case b.INSTALLING:break;case b.INSTALLED:this.doScreenSharing&&(f.debug("RTCScreenSharingManager: Screen sharing is on, sending msg to extension to get desktop media source ID"),this.getDesktopMediaSourceId());break;case b.IFRAME_INSTALL_FAILED:this.model.set("screenShareState",i.SCREEN_SHARING_STATES.INSTALL_EXTENSION_FAILED);break;case b.INSTALL_FAILED:this.model.set("screenShareState",i.SCREEN_SHARING_STATES.INSTALL_EXTENSION_FAILED);break;case b.INSTALL_CANCELLED:break;case b.REQUEST_FAILED:}},startScreenSharing:function(a){var b=this.model.isExtensionInstalled(),c=a||{};this.isFirefox?(this.initFFScreenSharing(),this.doScreenSharing=!0):(this.doScreenSharing=!0,this.installationCompletedRetries=0,this.model.set("extensionStatus",h.EXTENSION_STATES.NOT_INSTALLED),b||c.skipInlineInstallation?(f.debug('RTCScreenSharingManager: Content Scripts have been injected, "ping" extension to check if extension is not uninstalled'),this.pingAndStartSharing()):(f.warn("RTCScreenSharingManager: Content Scripts have not been injected, extension has not been installed"),"chrome"===o.browser?this.triggerInlineInstallation():"opera"===o.browser&&this.triggerOperaAddOnInlineInstallation(a)))},stopScreenSharing:function(){this.doScreenSharing=!1;var a=this.model.get("localContentStream");a?(f.debug("RTCScreenSharingManager: Stopping screen sharing now"),a.getTracks().forEach(function(a){a.stop()}),this.isFirefox&&this.reset()):(f.debug("RTCScreenSharingManager: Screen sharing has already been stopped"),this.reset())},triggerInlineInstallation:function(){var a=this,b=function(b){f.debug("RTCScreenSharingManager: Chrome inline installation was successful."),a.model.set("extensionStatus",h.EXTENSION_STATES.INSTALLING),a.pingAndStartSharing()},d=function(b){a.handleInstallationFailure(b)};try{c("head").append('<link rel="chrome-webstore-item" href='+this.screenSharingExtensionUrl+">"),window.chrome.webstore.install(this.screenSharingExtensionUrl,b,d)}catch(e){a.handleInstallationFailure(e)}},triggerOperaAddOnInlineInstallation:function(a){var b=this,c=function(a){f.debug("RTCScreenSharingManager: Opera inline installation was successful."),b.model.set("extensionStatus",h.EXTENSION_STATES.INSTALLING),b.pingAndStartSharing()},d=function(a){b.handleInstallationFailure(a)};try{opr.addons.installExtension(b.config.extensionID,c,d)}catch(e){b.handleInstallationFailure(e)}},handleInstallationFailure:function(a){var b,c=h.EXTENSION_STATES;switch(f.error("RTCScreenSharingManager: Inline installation of Chrome extension failed: "+a),a){case"User cancelled install":b=c.INSTALL_CANCELLED;break;case"Chrome Web Store installations can only be started by the top frame.":b=c.IFRAME_INSTALL_FAILED;break;case"Installs can only be initiated by one of the Chrome Web Store item's verified sites.":b=c.INSTALL_FAILED_DOMAIN_UNVERIFIED;break;default:b=c.INSTALL_FAILED}this.model.set("extensionStatus",b)},pingAndStartSharing:function(){var a=this;this.installationCompletedRetries<this.maxInstallationCompletedRetries?window.setTimeout(function(){a.installationCompletedRetries++,f.debug('RTCScreenSharingManager: Sending "ping" to extension. Attempt no. ',a.installationCompletedRetries),a.pingExtension(function(b){a.installationCompletedRetries=0,a.onPingSuccess(b)},function(b){"emptyResponse"===b?a.pingAndStartSharing():a.model.set("extensionStatus",h.EXTENSION_STATES.REQUEST_FAILED)})},500):this.model.set("extensionStatus",h.EXTENSION_STATES.INSTALL_FAILED)},pingExtension:function(a,b){this.sendMessageToExtension({type:"ping"}).then(a,b)},onPingSuccess:function(a){"pong"===a.type&&this.doScreenSharing&&(this.model.set("extensionStatus",h.EXTENSION_STATES.INSTALLED,{silent:!0}),this.model.trigger("change:extensionStatus",this.model))},getDesktopMediaSourceId:function(){var a=e.defer(),b=this;return this.model.set("tokenStatus",g.TOKEN_STATUS.WAITING),this.sendMessageToExtension({type:"getScreen",options:this.config.features.applicationSharing?["screen","window"]:["screen"]}).then(function(a){switch(a.type){case"gotScreenSharing":b.model.set("chromeMediaSourceId",a.sourceId),b.requestToken();break;case"canceledGetScreen":b.model.set("tokenStatus",g.TOKEN_STATUS.CANCELLED);break;default:f.error('RTCScreenSharingManager: Unhandled message type for "getScreen" API'),b.model.set("tokenStatus",g.TOKEN_STATUS.CANCELLED)}},function(a){}),a.promise},sendMessageToExtension:function(a){var c=e.defer(),d=b.extend({targetModule:"RTCDesktopMedia"},a);try{window.chrome.runtime.sendMessage(this.model.get("extensionId"),d,b.bind(function(a){f.debug("RTCScreenSharingManager: Response from extension: "+JSON.stringify(a)),b.isUndefined(a)?c.reject("emptyResponse"):c.resolve(a)},this))}catch(g){f.error("RTCScreenSharingManager: Exception occured while sending message to Extension: ",g),c.reject("error")}return c.promise},initFFScreenSharing:function(){this.model.set("tokenStatus",g.TOKEN_STATUS.WAITING),this.getDesktopMediaStream()},getDesktopMediaStream:function(){var a=this.config.features.applicationSharing?"application":"screen";this.config.ffMediaConstraints.video.mediaSource=a;var b=this.isFirefox?this.config.ffMediaConstraints:j.deepMergeObjects(this.config.chromeMediaConstraints,{video:{mandatory:{chromeMediaSourceId:this.model.get("chromeMediaSourceId")}}});window.navigator.getUserMedia(b,this.getDesktopMediaSuccess,this.getDesktopMediaError)},getDesktopMediaSuccess:function(a){f.debug("RTCScreenSharingManager: Local Content has been acquired"),this.isFirefox&&this.requestToken(),a.bjn_label="content_stream",a.getVideoTracks()[0].onended=b.bind(function(){f.debug("RTCScreenSharingManager: Local Content Stream has ended."),this.reset(),this.isFirefox||this.sendMessageToExtension({type:"focusTab"})},this),this.model.set("localContentStream",a)},getDesktopMediaError:function(a){f.error("Failed to get desktop media stream, error: ",a);var b=!1;this.model.get("tokenStatus")===g.TOKEN_STATUS.CANCELLED&&(b=!0),this.model.set("tokenStatus",g.TOKEN_STATUS.CANCELLED),b&&this.model.trigger("change:firefoxScreenShareCancelled",this.model),this.stopScreenSharing()},requestToken:function(){var a=g.requestTokenMsg();l.sendMsg(a),n.getCurrentCallState()!==h.BJ_CALLSTATES.IDLE&&m.onBlueJayRequest(a)},releaseToken:function(){var a=g.releaseTokenMsg();l.sendMsg(a),m.onBlueJayRequest(a),this.model.set("tokenStatus",g.TOKEN_STATUS.RELEASED)},handleTokenMessage:function(a){var b=a.params.type;switch(b){case g.TOKEN_TYPES.STATUS:this.model.set("tokenStatus",a.params.status);break;case g.TOKEN_TYPES.TOKENINDICATION:this.model.set("presentationToken",a.params);break;case g.TOKEN_TYPES.CONTENTINDICATION:this.model.set("presentationToken",a.params);break;default:f.error("RTCScreenSharingManager: Invalid type passed in token msg: ",b)}},onTokenStatusChange:function(a){var b=a.get("tokenStatus");switch(b){case g.TOKEN_STATUS.GRANTED:this.doScreenSharing?this.isFirefox||this.getDesktopMediaStream():(f.info("RTCScreenSharingManager: Screen sharing was cancelled while acquiring token"),this.releaseToken());break;case g.TOKEN_STATUS.REVOKED:f.debug("RTCScreenSharingManager: Token has been 'revoked', must have been hijacked!"),this.stopScreenSharing()}},sendPresentaionRatio:function(a){var b={type:"presentationratio",ratio:{content:a.content,video:a.video}},c=g.getInfoMsg(b);l.sendMsg(c),m.onBlueJayRequest(c)},reset:function(){this.doScreenSharing=!1;this.model.get("tokenStatus");this.releaseToken(),this.model.set("localContentStream",null),this.model.set("chromeMediaSourceId",null)},close:function(){this.stopScreenSharing()}});return new p}),define("WebRTC_SDK/manager/RTCPeerConnectionManager",["require","q","my.Class","underscore","backbone","Logger","WebRTC_SDK/RTCPeer","WebRTC_SDK/utilities/RTCBlueJay","WebRTC_SDK/RTCStates","sdpUtils","WebRTC_SDK/manager/RTCStateManager","WebRTC_SDK/manager/RTCSignallingManager","WebRTC_SDK/manager/RTCTransactionManager","WebRTC_SDK/manager/RTCScreenSharingManager","WebRTC_SDK/utilities/RTCErrors","browserDetector"],function(a){var b=a("q"),c=a("my.Class"),d=a("underscore"),e=a("backbone"),f=a("Logger"),g=a("WebRTC_SDK/RTCPeer"),h=a("WebRTC_SDK/utilities/RTCBlueJay"),i=a("WebRTC_SDK/RTCStates"),j=a("sdpUtils"),k=a("WebRTC_SDK/manager/RTCStateManager"),l=a("WebRTC_SDK/manager/RTCSignallingManager"),m=a("WebRTC_SDK/manager/RTCTransactionManager"),n=a("WebRTC_SDK/manager/RTCScreenSharingManager"),o=a("WebRTC_SDK/utilities/RTCErrors"),p=a("browserDetector"),q=c.Class({config:{keepAliveMaxFailures:6,keepAliveConnectorfailure:2,sdpParams:{videoRecvBitrate:1200}},peer:null,offerInProgress:!1,createOfferQueued:!1,keepAliveTimer:null,keepAliveFailedAttempts:0,isSignallingChannelReady:!1,constructor:function(a){d.bindAll(this),d.extend(this.config,a),d.extend(this,e.Events),this.BJ_CALLSTATES=i.BJ_CALLSTATES,this.WEBRTC_STATES=i.WEBRTC_STATES,l.setupMessageParser(this.getSignallingCallbacks()),this.iceCandidates=[],this.isSignalingChannelReady=!1,m.on("receivedConnectResponse",this.onReceiveConnectResponse),m.on("receivedKeepAliveResponse",this.onKeepAliveResponse)},createPeer:function(a){this.peer=new g(a),this.peer.on("iceCandidate",this.onNewIceCandiate),this.peer.model.on("change:iceGatheringState",this.onIceGatheringStateChanged),this.peer.model.on("change:iceConnectionState",this.onIceConnectionStateChange),this.peer.model.on("change:signalingState",this.onSignalingStateChange)},getPeer:function(){return this.peer},updateMeetingParams:function(a){if(this.meetingParams=a,this.meetingParams.maxBandwidth){var b=window.parseInt(this.meetingParams.maxBandwidth,10);b>=100&&4096>=b?(this.config.sdpParams.videoRecvBitrate=this.meetingParams.maxBandwidth,f.debug("RTCPeerConnectionManager :: Updating max session bitrate to - "+this.config.sdpParams.videoRecvBitrate)):f.debug("RTCPeerConnectionManager :: received invalid max bitrate "+b+", using default value")}else f.debug("RTCPeerConnectionManager :: using default max session bitrate - "+this.config.sdpParams.videoRecvBitrate)},signallingChannelCreated:function(){this.initKeepAliveMessage(),this.sendKeepAliveMessage(!1),this.isSignalingChannelReady=!0,this.enqueueIceCandidates()},initiateCall:function(a,b){var c=this;this.iceCandidates=[],this.createOffer(a).then(function(a){var b=k.getCurrentCallState();b===c.BJ_CALLSTATES.CONNECTING||b===c.BJ_CALLSTATES.INITIALISING||b===c.BJ_CALLSTATES.IDLE?c.sendConnectMessage(a):(b===c.BJ_CALLSTATES.RECONNECTING||b===c.BJ_CALLSTATES.REINITIALISING)&&c.sendUpdateMessage(a)},function(a){throw f.error("RTCPeerConnectionManager: Error while creating offerSdp, reconnecting the call"),k.callDisconnected(o.DISCONNECT_REASONS.SIG_CHANNEL_CLOSED),a})},sendIceCandidate:function(a){if(a){"firefox"===p.browser&&("sdparta_0"===a.sdpMid?a.sdpMid="audio":("sdparta_1"===a.sdpMid||"sdparta_2"===a.sdpMid)&&(a.sdpMid="video",a.sdpMLineIndex=1));var b=h.getIceCandidateMessage(a);l.sendMsg(b),m.onBlueJayRequest(b)}},enqueueIceCandidates:function(){var a=this;a.iceCandidates.forEach(function(b){a.sendIceCandidate(b)})},onNewIceCandiate:function(a,b){this.isSignalingChannelReady===!1?this.iceCandidates.push(b):this.sendIceCandidate(b)},onIceGatheringStateChanged:function(a){k.iceGatheringStateChange(a.get("iceGatheringState"))},onIceConnectionStateChange:function(a){k.iceConnectionStateChange(a.get("iceConnectionState"))},onSignalingStateChange:function(a){k.signalingStateChange(a.get("signalingState"))},handleResponseMessage:function(a){var b=this.getPeer();return b.handleResponseMessage(a)},handleErrorMessage:function(a){var b=this.getPeer();return b.handleErrorMessage(a)},handleNotificationMessage:function(a){var b=this.getPeer();return b.handleNotificationMessage(a);
},handleRequestMessage:function(a){var b=h.METHODS,c=this.getPeer();switch(a.method){case b.CONNECT:return this.onConnect(c,a);case b.ANSWER:return this.onAnswer(c,a);case b.UPDATE:return this.onUpdate(c,a);case b.DISCONNECT:return this.onDisconnect(c,a);case b.KEEPALIVE:return this.onKeepAlive(c,a);case b.ICE:return this.onIceCandidate(c,a);default:f.error("RTCPeerConnectionManager: Method received in message: "+a.method+" is not supported.")}},onConnect:function(a,b){return a.handleOffer(b)},onAnswer:function(a,b){var c=this;return b.params.sessionDescription.sdp=j.maybeSetVideoReceiveBitRate(b.params.sessionDescription.sdp,c.config.sdpParams),a.handleAnswer(b).then(function(){c.offerInProgress=!1,c.createOfferQueued&&(f.debug("RTCPeerConnectionManager: Processing previously Queued 'update offer' request"),c.createUpdateOffer(),c.createOfferQueued=!1)})},onUpdate:function(a,b){return a.handleUpdate(b)},onDisconnect:function(a,b){return a.handleDisconnect(b)},onKeepAlive:function(a,b){return a.handleKeepAlive(b)},onIceCandidate:function(a,b){return a.handleIceCandidate(b.params.iceCandidate)},addPeerStream:function(a){var b=this.getPeer();return b?(b.addStream(a),this.createUpdateOffer(),!0):(f.warn("RTCPeerConnectionManager: RTCPeer does not exist, ignoring addStream API on it"),!1)},updatePeerStream:function(a){var b=this.getPeer();return b?(d.isUndefined(a.newAudioStream)||d.isNull(a.newAudioStream)||("firefox"===p.browser?b.replaceTrack("audio",a.newAudioStream):(b.removeAudioStream(),b.addStream(a.newAudioStream))),d.isUndefined(a.newVideoStream)||d.isNull(a.newVideoStream)||("firefox"===p.browser?b.replaceTrack("video",a.newVideoStream):(b.removeVideoStream(),b.addStream(a.newVideoStream))),void("firefox"!==p.browser&&this.createUpdateOffer())):(f.warn("RTCPeerConnectionManager: RTCPeer does not exist, ignoring updatePeerStream API on it"),!1)},updateContentStream:function(a){var b=this.getPeer();b.replaceTrack("content",a)},removePeerStream:function(a){var b=this.getPeer();return b?(b.removeStream(a),this.createUpdateOffer(),!0):(f.warn("RTCPeerConnectionManager: RTCPeer does not exist, ignoring removeStream API on it"),!1)},createUpdateOffer:function(a){var b=this;return this.isSignallingChannelReady===!1?void(this.createOfferQueued=!0):void this.createOffer(a).then(function(a){b.sendUpdateMessage(a)},function(a){f.error('RTCPeerConnectionManager: RTCPeer failed to create "updated" offer')})},createOffer:function(a){var c=this.getPeer(),d=this,e=b.defer(),g=k.getCurrentCallState();return this.offerInProgress?(this.createOfferQueued=!0,f.debug("RTCPeerConnectionManager: Queing 'update offer' request. Current call state: ",g)):(d.offerInProgress=!0,c.createOffer(a).then(function(a){a.sdp=j.maybeSetVideoReceiveBitRate(a.sdp,d.config.sdpParams),a.sdp=j.maybeSetTrickleIceAttr(a.sdp),e.resolve(a)},function(a){d.offerInProgress=!1,e.reject(a)})),e.promise},sendConnectMessage:function(a){var b=h.getConnectMessage({sessionId:this.meetingParams.sessionId,endpointProperties:this.meetingParams.endpointDetails,sessionDescription:a,streamInfo:a.streamInfo,bundlingPolicy:this.peer.bundlePolicy});m.onBlueJayRequest(b),l.sendMsg(b)},sendUpdateMessage:function(a){var b=h.getUpdateMessage({sessionDescription:a,streamInfo:a.streamInfo});m.onBlueJayRequest(b),l.sendMsg(b)},sendKeepAliveMessage:function(a){if(!a||this.keepAliveFailedAttempts>=this.config.keepAliveMaxFailures-1){var b=h.getKeepaliveMessage();m.onKeepaliveRequest(b.id),l.sendMsg(b)}},getSignallingCallbacks:function(){return{request:this.onRequestMessage,response:this.onResponseMessage,error:this.onErrorMessage,notification:this.onNotificationMessage,invalidMessage:this.onInvalidMessage}},onRequestMessage:function(a){var b=h.getSuccessResponse(a.id);d.isUndefined(m.lookupOutgoingResponse(a.id))?a.method===h.METHODS.TOKEN?(n.handleTokenMessage(a),l.sendMsg(b)):this.handleRequestMessage(a).then(function(c){l.sendMsg(b),m.onOutgoingBlueJayResponse(a.id,b),"disconnect"===a.method&&k.callDisconnected(a.params)},function(b){f.debug("RTCPeerConnectionManager :: Error while handling request message "+b);var c=h.getErrorResponse(a.id,o.SIGNALING_ERRORS.BAD_REQUEST);l.sendMsg(c)}):l.sendMsg(b)},onResponseMessage:function(a){this.handleResponseMessage(a),m.onIncomingBlueJayResponse(a.id)},onErrorMessage:function(a){return this.handleErrorMessage(a),a.error.code===o.SIGNALING_ERRORS.METHOD_NOT_IMPLEMENTED.code?void f.warn("RTCPeerConnectionManager :: Method not Implemented, Message :: "+JSON.stringify(m.getRequestMessage(a.id))):void k.callDisconnected(o.DISCONNECT_REASONS.TRANSPORT_FAIL)},onNotificationMessage:function(a){this.handleNotificationMessage(a)},onInvalidMessage:function(a,b){var c=h.getErrorResponse(a.id,b);l.sendMsg(c)},initKeepAliveMessage:function(){var a=this;a.keepAliveTimer=setInterval(function(){"finished"===m.getKeepaliveMessageState()?(a.sendKeepAliveMessage(!1),a.keepAliveFailedAttempts=0):(a.keepAliveFailedAttempts++,a.keepAliveFailedAttempts==a.config.keepAliveConnectorfailure&&l.WS_STATES===i.WS_STATES.CONNECTED||a.keepAliveFailedAttempts>=a.config.keepAliveMaxFailures?(f.warn("RTCPeerConnectionManager: KeepAlive timeout has occurred, call will need to be reconnected!!"),k.callDisconnected(o.DISCONNECT_REASONS.KEEPALIVE_TIMEOUT)):a.sendKeepAliveMessage(!1))},m.config.keepaliveTimeout)},stopKeepAliveMessages:function(){this.keepAliveFailedAttempts=0,clearInterval(this.keepAliveTimer)},onReceiveConnectResponse:function(){this.isSignallingChannelReady=!0},onKeepAliveResponse:function(){this.keepAliveFailedAttempts=0},reset:function(){this.close()},close:function(){var a=this.getPeer();this.stopKeepAliveMessages(),this.createOfferQueued=!1,this.offerInProgress=!1,this.isSignalingChannelReady=!1,a&&a.close()}});return q}),function(){function a(a,b,c){var d=b&&c||0,e=0;for(b=b||[],a.toLowerCase().replace(/[0-9a-f]{2}/g,function(a){16>e&&(b[d+e++]=m[a])});16>e;)b[d+e++]=0;return b}function b(a,b){var c=b||0,d=l;return d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]}function c(a,c,d){var e=c&&d||0,f=c||[];a=a||{};var g=null!=a.clockseq?a.clockseq:q,h=null!=a.msecs?a.msecs:(new Date).getTime(),i=null!=a.nsecs?a.nsecs:s+1,j=h-r+(i-s)/1e4;if(0>j&&null==a.clockseq&&(g=g+1&16383),(0>j||h>r)&&null==a.nsecs&&(i=0),i>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");r=h,s=i,q=g,h+=122192928e5;var k=(1e4*(268435455&h)+i)%4294967296;f[e++]=k>>>24&255,f[e++]=k>>>16&255,f[e++]=k>>>8&255,f[e++]=255&k;var l=h/4294967296*1e4&268435455;f[e++]=l>>>8&255,f[e++]=255&l,f[e++]=l>>>24&15|16,f[e++]=l>>>16&255,f[e++]=g>>>8|128,f[e++]=255&g;for(var m=a.node||p,n=0;6>n;n++)f[e+n]=m[n];return c?c:b(f)}function d(a,c,d){var f=c&&d||0;"string"==typeof a&&(c="binary"==a?new k(16):null,a=null),a=a||{};var g=a.random||(a.rng||e)();if(g[6]=15&g[6]|64,g[8]=63&g[8]|128,c)for(var h=0;16>h;h++)c[f+h]=g[h];return c||b(g)}var e,f=this;if("function"==typeof f.require)try{var g=f.require("crypto").randomBytes;e=g&&function(){return g(16)}}catch(h){}if(!e&&f.crypto&&crypto.getRandomValues){var i=new Uint8Array(16);e=function(){return crypto.getRandomValues(i),i}}if(!e){var j=new Array(16);e=function(){for(var a,b=0;16>b;b++)0===(3&b)&&(a=4294967296*Math.random()),j[b]=a>>>((3&b)<<3)&255;return j}}for(var k="function"==typeof f.Buffer?f.Buffer:Array,l=[],m={},n=0;256>n;n++)l[n]=(n+256).toString(16).substr(1),m[l[n]]=n;var o=e(),p=[1|o[0],o[1],o[2],o[3],o[4],o[5]],q=16383&(o[6]<<8|o[7]),r=0,s=0,t=d;if(t.v1=c,t.v4=d,t.parse=a,t.unparse=b,t.BufferClass=k,"function"==typeof define&&define.amd)define("nodeuuid",[],function(){return t});else if("undefined"!=typeof module&&module.exports)module.exports=t;else{var u=f.uuid;t.noConflict=function(){return f.uuid=u,t},f.uuid=t}}.call(this),define("WebRTC_SDK/manager/RTCCapabilitiesManager",["require","my.Class","underscore","backbone","Logger","q"],function(a){var b=a("my.Class"),c=a("underscore"),d=a("backbone"),e=(a("Logger"),a("q")),f=d.Model.extend({defaults:{supportsOutputSpeakerSelection:null}}),g=b.Class({STATIC:{},constructor:function(a){c.bindAll(this),this.model=new f},detectCapabilities:function(){var a=e.defer();return this.detectOutputSpeakerSelection(),a.resolve(),a.promise},detectOutputSpeakerSelection:function(){$("body").append('<video id="testSpeakerSelection" style="display:none"></video>');var a=$("#testSpeakerSelection")[0];this.model.set("supportsOutputSpeakerSelection",a&&void 0!==a.setSinkId?!0:!1),$("#testSpeakerSelection").remove()}});return new g}),define("WebRTC_SDK/RTCController",["require","q","my.Class","underscore","backbone","Logger","browserDetector","WebRTC_SDK/utilities/RTCBlueJay","WebRTC_SDK/utilities/RTCUtils","WebRTC_SDK/manager/RTCSignallingManager","WebRTC_SDK/manager/RTCLocalMediaManager","WebRTC_SDK/manager/RTCPeerConnectionManager","WebRTC_SDK/manager/RTCTransactionManager","WebRTC_SDK/manager/RTCStateManager","WebRTC_SDK/RTCStates","nodeuuid","WebRTC_SDK/manager/RTCScreenSharingManager","WebRTC_SDK/utilities/RTCErrors","WebRTC_SDK/manager/RTCCapabilitiesManager"],function(a){var b=a("q"),c=a("my.Class"),d=a("underscore"),e=a("backbone"),f=a("Logger"),g=a("browserDetector"),h=a("WebRTC_SDK/utilities/RTCBlueJay"),i=(a("WebRTC_SDK/utilities/RTCUtils"),a("WebRTC_SDK/manager/RTCSignallingManager")),j=a("WebRTC_SDK/manager/RTCLocalMediaManager"),k=a("WebRTC_SDK/manager/RTCPeerConnectionManager"),l=a("WebRTC_SDK/manager/RTCTransactionManager"),m=a("WebRTC_SDK/manager/RTCStateManager"),n=a("WebRTC_SDK/RTCStates"),o=a("nodeuuid"),p=a("WebRTC_SDK/manager/RTCScreenSharingManager"),q=a("WebRTC_SDK/utilities/RTCErrors"),r=a("WebRTC_SDK/manager/RTCCapabilitiesManager"),s=e.Model.extend({defaults:{localVideoStream:null,localAudioStream:null,previewStream:null,remoteStream:null,localContentStream:null,remoteContentStream:null,connectionState:"",callState:"",disconnectCode:"",localAudioMuted:null,localVideoMuted:null,remoteAudioMuted:!1,remoteVideoMuted:!1,isSpeaking:!1,volumeLevel:0,devices:{available:{audioIn:[],videoIn:[]},selected:{audioIn:null,videoIn:null}},presentationToken:null,presentationState:null,isWSConnected:!1,isIceRestarted:!1,capabilities:{}}}),t=e.Model.extend({defaults:{wsConnectionState:"closed",wsSocketId:"",isIceRestarted:!1,dtlsCertificate:null}}),u=c.Class({config:{},resendMute:!1,constructor:function(a){d.bindAll(this),d.extend(this.config,a),d.extend(this,e.Events),"firefox"===g.browser&&(this.isFirefox=!0),this.model=new s,this.internalModel=new t,this.BJ_CALLSTATES=n.BJ_CALLSTATES,this.TOKEN_STATUS=h.TOKEN_STATUS,this.EXTENSION_STATES=n.EXTENSION_STATES,this.WS_STATES=n.WS_STATES,this.localMediaManager=new j(this.config.localMediaParams),this.peerConnectionManager=new k({peerConfig:this.config.peerConfig,meetingParams:a.meetingParams}),this.localMediaManager.model.on("change:localAudioStream",this.onLocalAudioStreamChange),this.localMediaManager.model.on("change:localVideoStream",this.onLocalVideoStreamChange),this.localMediaManager.model.on("change:previewStream",this.onPreviewStreamChange),this.localMediaManager.model.on("change:remoteAudioMuted",this.onRemoteAudioMuteChange),this.localMediaManager.model.on("change:remoteVideoMuted",this.onRemoteVideoMuteChange),this.localMediaManager.model.on("change:isSpeaking",this.isSpeaking),this.localMediaManager.model.on("change:volumeLevel",this.updateVolumeLevel),this.localMediaManager.on("localStreamsChanged",this.onLocalStreamsChanged),l.on("retransmitRequest",this.onRetransmitRequest),l.on("receivedConnectResponse",this.onReceiveConnectResponse),l.on("requestTimeout",this.onRequestTimeout),l.on("closeSocketConnection",this.closeSocket),m.model.on("change:disconnectCode",this.onDisconnectCodeChange),m.model.on("change:currentState",this.onCallStateChange),i.on("wsConnectionStateChange",this.wsConnectionStateChange),p.setParams({extensionId:this.config.extensionId,features:this.config.features}),p.model.on("change:presentationToken",this.onReceivePresentationToken),p.model.on("change:localContentStream",this.onLocalContentStreamChanged),p.model.on("change:tokenStatus",this.onPresentationTokenStatusChanged),p.model.on("change:extensionStatus",this.onExtensionStatusChanged),p.model.on("change:firefoxScreenShareCancelled",this.triggerFirefoxScreenShareCancelled)},getLocalMedia:function(a,c){var d=b.defer();return this.localMediaManager.startMedia(a,c).then(function(a){return d.resolve(a)},function(a){return f.warn("RTCController: Could not get access to user's media devices"),d.reject(a)}),d.promise},getLocalDevices:function(){var a=this,c=b.defer();return this.localMediaManager.getDevices().then(function(b){var d=a.model.get("devices");d.available=b.available,d.selected=b.selected,a.model.set("devices",d),c.resolve(d)},function(a){c.reject(a)}),c.promise},getCameraStatus:function(a){return this.localMediaManager.detectCameraStatus(a)},getCapabilities:function(){return r.detectCapabilities().then(d.bind(function(){this.model.set("capabilities",r.model.attributes)},this),function(){f.error("RTCController: failed to get RTC capabilities")})},setSpeaker:function(a){this.localMediaManager.setSpeaker(a)},renderSelfView:function(a){return this.localMediaManager.renderSelfView(a)},renderStream:function(a){return this.localMediaManager.renderStream(a)},stopLocalMedia:function(a){this.localMediaManager.stopMedia(a)},createPeerConnection:function(a){this.peerConnectionManager.createPeer(a),this.peerConnectionManager.peer.model.on("change:remoteStream",this.onRemoteStreamChanged),this.peerConnectionManager.peer.model.on("change:remoteContentStream",this.onRemoteContentStreamChanged),this.peerConnectionManager.peer.on("iceConnectionClosed",this.onIceConnectivityClosed),this.peerConnectionManager.peer.on("restartICE",this.restartMediaChannel),this.peerConnectionManager.peer.on("iceConnectivityTimeout",this.onIceConnectivityTimeout),this.peerConnectionManager.peer.callStatsModel.on("change",function(a){this.model.set(a.attributes)},this)},onCallStateChange:function(a){var b=a.get("currentState");this.model.set("callState",b),l.updateCallState(b),this.reactToCallStateChange()},reactToCallStateChange:function(){var a=this.model.get("callState");switch(a){case this.BJ_CALLSTATES.CONNECTED:this.model.set("isIceRestarted",!1);break;case this.BJ_CALLSTATES.DISCONNECTED:this.reset(),this.sendDisconnectMessage(m.getDisconnectReason())}},onDisconnectCodeChange:function(){this.model.set("disconnectCode",m.model.get("disconnectCode"))},initializePeerConnection:function(a,b){(void 0===b||b===!0)&&m.reset(),this.peerConnectionManager.initiateCall(a,!0)},startConnection:function(a){var b=o.v1();i.createSocket(a),this.peerConnectionManager.updateMeetingParams(a),h.setCallid(b)},generateDtlsRsaCertificate:function(){var a,c=b.defer(),d=this;return webkitRTCPeerConnection.generateCertificate?(a=d.internalModel.get("dtlsCertificate"),a?c.resolve(a):webkitRTCPeerConnection.generateCertificate({name:"RSASSA-PKCS1-v1_5",hash:"SHA-256",modulusLength:2048,publicExponent:new Uint8Array([1,0,1])}).then(function(a){f.debug("RTCController :: Successfully created DTLS RSA certificate"),d.internalModel.set("dtlsCertificate",a),c.resolve(a)},function(a){c.reject(a)})):c.resolve(),c.promise},makeCall:function(a,b){var c=this;l.reset(),m.reset(),this.closeSocket(),this.isFirefox?(c.startConnection(b),c.createPeerConnection(a)):this.generateDtlsRsaCertificate().then(function(d){d&&(a.peerConfig.peerConnectionConfig.certificates=[d]),c.startConnection(b),c.createPeerConnection(a)},function(a){f.error("RTCController :: Failed to start call, Error :"+a)})},joinMeeting:function(){var a=this.model.get("callState");if(a!==this.BJ_CALLSTATES.CONNECTING&&a!==this.BJ_CALLSTATES.RECONNECTING)throw f.error("RTCController: callState is not in connecting/reconnecting state, cannot proceed with call yet"),"Connection state not ready to call";var b=this.config.peerConfig.receiveMedia;b.iceRestart=!1,this.peerConnectionManager.initiateCall(b,!1)},restartMediaChannel:function(){var a=this.internalModel.get("wsConnectionState");if(a!==this.WS_STATES.CONNECTED&&a!==this.WS_STATES.RECONNECTED||this.model.get("isIceRestarted")!==!1)f.debug("RTCController : Failed to restart media channel, Signalling channel is disconnected or media restart is already in progress.");else{f.debug("Re-starting the media channel - ICE Restart, get new local SDP");var b=this.config.peerConfig.receiveMedia;b.iceRestart=!0,this.initializePeerConnection(b,!1),this.model.set("isIceRestarted",!0)}},onRetransmitRequest:function(a){i.sendMsg(a)},onLocalAudioStreamChange:function(a){this.model.set("localAudioStream",a.get("localAudioStream"))},onLocalVideoStreamChange:function(a){this.model.set("localVideoStream",a.get("localVideoStream"))},onPreviewStreamChange:function(a){this.model.set("previewStream",a.get("previewStream"))},onRemoteStreamChanged:function(a){this.model.set("remoteStream",a.get("remoteStream")),this.localMediaManager.updateStream({remoteStream:a.get("remoteStream")})},onRemoteContentStreamChanged:function(a){this.model.set("remoteContentStream",a.get("remoteContentStream"))},onReceivePresentationToken:function(a){this.model.set("presentationToken",a.get("presentationToken"))},_applyCachedMuteStates:function(){f.info("RTCController: Applying cached mute states"),this.muteStreams({resendMuteMsg:!0,localAudio:this.localMediaManager.model.get("localAudioMuted"),localVideo:this.localMediaManager.model.get("localVideoMuted"),remoteAudio:this.localMediaManager.model.get("remoteAudioMuted"),remoteVideo:this.localMediaManager.model.get("remoteVideoMuted")})},muteStreams:function(a){var b=this,c=l.model.get("connectResponseReceived"),e=(d.isBoolean(a.localAudio)&&a.localAudio!==this.model.get("localAudioMuted"),d.isBoolean(a.localVideo)&&a.localVideo!==this.model.get("localVideoMuted"));this.peerConnectionManager&&this.peerConnectionManager.peer&&(d.isUndefined(a.remoteAudio)||d.isUndefined(a.remoteVideo)||(this.peerConnectionManager.peer.isRemoteMute=a.remoteAudio&&a.remoteVideo)),this.localMediaManager.muteStreams(a).then(function(){if(!a.localMuteOnly&&c){e&&a.localVideo===!1&&b.onLocalStreamsChanged();var d=a.localAudio,f=a.localVideo,g=a.remoteAudio,j=a.remoteVideo,k=h.getMuteMessage({audio:d?"muted":"unmuted",video:f?"muted":"unmuted",remoteAudio:g?"muted":"unmuted",remoteVideo:j?"muted":"unmuted"});i.sendMsg(k)?(l.onBlueJayRequest(k),b.resendMute=!1):b.resendMute=!0,b.model.set({localAudioMuted:d,localVideoMuted:f})}},function(){f.error("RTCController: Failed to Mute streams")})},onRemoteAudioMuteChange:function(a){this.model.set("remoteAudioMuted",a.get("remoteAudioMuted"))},onRemoteVideoMuteChange:function(a){this.model.set("remoteVideoMuted",a.get("remoteVideoMuted"))},updateLocalStream:function(a){return this.peerConnectionManager.updatePeerStream(a)},startVolumeMonitoring:function(a,b){null==this.localMediaManager.volumeMoniter?this.localMediaManager.startVolumeMonitor(a,b):f.debug("Already monitering volume")},stopVolumeMonitoring:function(){this.localMediaManager.stopVolumeMonitor()},isSpeaking:function(a){this.model.set("isSpeaking",a.get("isSpeaking"))},setIsSpeaking:function(a){this.localMediaManager.model.set("isSpeaking",a),a||(this.localMediaManager.vadCount=0)},updateVolumeLevel:function(a){this.model.set("volumeLevel",a.get("volumeLevel"))},onLocalStreamsChanged:function(){var a=this.localMediaManager.model.get("localAudioStream"),b=this.localMediaManager.model.get("localVideoStream");this.model.get("callState");this.peerConnectionManager.updatePeerStream({newVideoStream:b,newAudioStream:a})},onLocalStreamSuccessCB:function(a){var b=this,c=null,e=null,f=b.model.get("localVideoStream"),g=b.model.get("localAudioStream"),h=this.model.get("callState");d.each(a,function(a,d,f){a.getVideoTracks().length>0?(c=a,b.model.set("localVideoStream",c)):(e=a,b.model.set("localAudioStream",e))}),h===this.BJ_CALLSTATES.CONNECTED&&b.peerConnectionManager.updatePeerStream({currentVideoStream:f,newVideoStream:c,currentAudioStream:g,newAudioStream:e})},onReceiveConnectResponse:function(){this._applyCachedMuteStates(),this.peerConnectionManager.signallingChannelCreated(),this.localMediaManager.sendDeviceInfo()},onCallDisconnected:function(a){m.callDisconnected(a)},onRequestTimeout:function(){m.callDisconnected(q.DISCONNECT_REASONS.REQ_TIMED_OUT)},endCall:function(){this.sendDisconnectMessage(q.DISCONNECT_REASONS.USER_INITIATED),this.localMediaManager.close(),this.reset()},reset:function(){var a=b.defer();return this.peerConnectionManager.close(),p.close(),l.reset(),a.resolve(),a.promise},sendDisconnectMessage:function(a){var b=h.getDisconnectMessage(a);l.onBlueJayRequest(b),i.sendMsg(b)},closeSocket:function(){f.debug("RTCController closing socket"),i.close()},getVersion:function(){return"1.0"},startScreenSharing:function(a){p.startScreenSharing(a)},stopScreenSharing:function(){p.stopScreenSharing()},onLocalContentStreamChanged:function(a){var b=a.get("localContentStream");this.isFirefox?this.peerConnectionManager.updateContentStream(b):b?this.peerConnectionManager.addPeerStream(b):(b=this.model.get("localContentStream"),b&&this.peerConnectionManager.removePeerStream(b)),this.model.set("localContentStream",a.get("localContentStream"))},onPresentationTokenStatusChanged:function(a){this.model.set("presentationTokenStatus",a.get("tokenStatus"))},triggerFirefoxScreenShareCancelled:function(a){this.model.trigger("change:presentationTokenStatus",this.model)},onExtensionStatusChanged:function(a){this.model.set("extensionStatus",a.get("extensionStatus"))},wsConnectionStateChange:function(a,b){var c=this.internalModel.get("wsConnectionState");switch(this.internalModel.set("wsConnectionState",a),a){case this.WS_STATES.CONNECTED:(m.getCurrentCallState()===this.BJ_CALLSTATES.IDLE||c!==this.WS_STATES.RECONNECTED)&&this.initializePeerConnection();break;case this.WS_STATES.RECONNECTED:var d=this.internalModel.get("wsSocketId");d!==b&&m.getCurrentCallState()===this.BJ_CALLSTATES.RESTART_MEDIA&&this.restartMediaChannel(),this.peerConnectionManager.sendKeepAliveMessage(!0),this.resendMute&&this._applyCachedMuteStates();break;case this.WS_STATES.FAILED:m.callDisconnected(q.DISCONNECT_REASONS.TRANSPORT_FAIL);break;case this.WS_STATES.DISCONNECTED:case this.WS_STATES.CLOSED:}this.internalModel.set("wsSocketId",b)},onIceConnectivityTimeout:function(){m.callDisconnected(q.DISCONNECT_REASONS.TRANSPORT_FAIL)},setPresentationRatio:function(a){p.sendPresentaionRatio(a)},onIceConnectivityClosed:function(){f.debug("RTCController :: Ice connection is closed, ending the call"),m.callDisconnected(q.DISCONNECT_REASONS.USER_INITIATED),this.localMediaManager.close()}});return u}),define("config",[],function(){return{environment:{hostname:"https://bluejeans.com",cert:{key:"",certificate:""}},user:{name:"BJNClient"},events:["meeting","endpoint","chat"]}}),define("clientSDK/src/clients/RestClient",["config"],function(a){var b=a,c=15e3,d=function(a,d){var e=JSON.stringify({uri:a.sipUrl}),f=new XMLHttpRequest;f||d("sipDialout: XMLHttpRequest is not supported"),f.timeout=c,f.addEventListener("readystatechange",function(){if(4===this.readyState)if(200===this.status)d(null,this.responseText);else{var a=this.status||408;d(a)}}),f.addEventListener("error",function(a){d(this.err)}),f.addEventListener("abort",function(a){d(this.err)}),f.ontimeout=function(a){d("XMLHttpRequest timeout")};var g=b.environment.hostname+"/seamapi/v1/user/"+a.oauthInfo.scope.meeting.leaderId+"/live_meetings/"+a.oauthInfo.scope.meeting.meetingNumericId+"/dialout/pstn?access_token="+encodeURIComponent(a.oauthInfo.access_token);f.open("POST",g,!0),f.setRequestHeader("X-Foo","header to trigger preflight"),f.setRequestHeader("Content-Type","application/json"),f.send(e)},e=function(a,d){var e=b.environment.hostname+a.url,f=JSON.stringify(a.body),g=new XMLHttpRequest;g||d("POST: XMLHttpRequest is not supported"),g.timeout=c,g.addEventListener("readystatechange",function(){if(4===this.readyState)if(200===this.status||201===this.status)d(null,this.responseText);else{var a=this.status||408;d({status:a})}}),g.addEventListener("error",function(a){d(a)}),g.addEventListener("abort",function(a){d(a)}),g.ontimeout=function(){d({status:408,error:"POST timeout"})},g.open("POST",e,!0),g.setRequestHeader("X-Foo","header to trigger preflight"),g.setRequestHeader("Content-Type","application/json"),g.send(f)};return{sipDialout:d,post:e}}),define("clientSDK/src/clients/SecurePerimeterClient",["clientSDK/src/clients/RestClient"],function(a){var b=function(b,c){var d="/seamapi/v1/services/pairingCodeGenerator?stringifyOauthJson=false&includeProfilePictureUrl=false&includePhoneContactInfo=false&includePairing=false",e=b,f={url:d,body:e};a.post(f,c)},c=function(b,c){var d="/seamapi/v1/user/"+b.oauthInfo.scope.meeting.leaderId+"/live_meetings/"+b.oauthInfo.scope.meeting.meetingNumericId+"/pairing_code/webrtc?access_token="+encodeURIComponent(b.oauthInfo.access_token),e={endpointType:4,userId:b.oauthInfo.scope.meeting.leaderId,languageCode:"en",capabilities:["AUDIO","VIDEO","CONTENT"]},f={url:d,body:e};a.post(f,c)},d=function(b,c,d){var e="/seamapi/v1/user/"+b.oauthInfo.scope.meeting.leaderId+"/live_meetings/"+b.oauthInfo.scope.meeting.meetingNumericId+"/dialout/pstn?access_token="+encodeURIComponent(b.oauthInfo.access_token),f={uri:c},g={url:e,body:f};a.post(g,d)};return{aggregatePairing:b,webRTCPairing:c,sipDialout:d}}),define("clientSDK/src/models/Connection",["require","backbone","underscore"],function(a){var b=a("backbone"),c=a("underscore"),d=b.Model.extend({idAttribute:"connectionGuid"},{translationMatrix:function(a){var b=c.clone(a);return b.capabilities&&(b.capabilities=c.map(b.capabilities,function(a){return a.toLowerCase()})),b}});return d.Collection=b.Collection.extend({model:d}),d}),define("clientSDK/src/models/Participant",["require","backbone","underscore","./Connection"],function(a){var b=a("backbone"),c=a("underscore"),d=a("./Connection"),e=b.Model.extend({defaults:{isPinned:!1,unreadMessages:0,isOpenedChat:!1},collectionProps:{connections:d.Collection},sync:function(a,b,c){},destroy:function(a){b.Model.prototype.destroy.call(this,a)},set:function(a,d,e){var f,g=this,h=function(a){return c.object(c.map(a,function(a,c){if(!g.collectionProps[c])return[c,a];if(a instanceof b.Collection)return[c,a];var d=g.get(c);return d.set(a),[c,d]}))},i=function(){return c.object(c.map(g.collectionProps,function(a,b){return[b,new a]}))};if("object"==typeof a){this._collectionsInitialized||(b.Model.prototype.set.call(g,i(),e),this._collectionsInitialized=!0);var j=a;e=d,f=h(j),b.Model.prototype.set.call(g,f,e)}else f=h(c.object([a],[d])),void 0!==f[a]&&b.Model.prototype.set.call(g,a,d,e)},isEntered:function(){var a=c.any(this.get("connections").toJSON(),function(a){return"Skinny"==a.endpoint});return a?c.any(this.get("connections").toJSON(),function(a){return a.capabilities.length>0}):!0}},{translationMatrixShort:function(a,b){return{dataObject:a,chatEndpointGuid:a.ch,callguid:a.c,id:a.E1,name:a.n,type:a.t||"endpoint",callQuality:parseInt(a.C1,10),isLeader:1==a.L1,isSelf:b&&a.E1==b.id,endpointType:a.e,isSpeaking:"1"==a.T,isPresenting:"1"==a.C2,isSecure:"Freeswitch"==a.e||"Phone"==a.e||"PartnerParticipant"==a.e||"1"==a.S1,isPhone:"Phone"==a.e||"PartnerParticipant"==a.e,meetingId:a.m,isVisible:!a.v||"1"==a.v,isChatOnly:"SkinnyChat"==a.e,inWaitingRoom:!a.L2||"1"==a.L2,isPresentationLayout:"2"==a.L2,isVideoLayout:"4"==a.L2,currentLayout:a.S2,isCurrentlyShowingVideo:"1"==a.V1,isSendingVideo:"1"!=a.V2,isServerMutingVideo:"1"==a.V3,isVideoSeen:"1"!=a.V2&&"1"!=a.V3,isCurrentlyShowingAudio:"1"==a.A1,isSendingAudio:"1"!=a.A2,isServerMutingAudio:"1"==a.A3,isAudioHeard:"1"!=a.A2&&"1"!=a.A3,alerts:a.a?a.a.split(","):void 0,audioRecvCodec:void 0!==a.A4&&""!==a.A4?a.A4:null,audioSendCodec:void 0!==a.A5&&""!==a.A5?a.A5:null,videoRecvCodec:void 0!==a.V4&&""!==a.V4?a.V4:null,videoRecvHeight:a.V5&&""!==a.V5?parseInt(a.V5,10):null,videoRecvWidth:a.V6&&""!==a.V6?parseInt(a.V6,10):null,videoSendCodec:void 0!==a.V7&&""!==a.V7?a.V7:null,videoSendHeight:a.V8&&""!==a.V8?parseInt(a.V8,10):null,videoSendWidth:a.V9&&""!==a.V9?parseInt(a.V9,10):null,contentRecvHeight:a.C3&&""!==a.C3?parseInt(a.C3,10):null,contentRecvWidth:a.C4&&""!==a.C4?parseInt(a.C4,10):null,videoShareRecvHeight:a.VideoShareRecvHeight&&""!==a.VideoShareRecvHeight?parseInt(a.VideoShareRecvHeight,10):null,videoShareRecvWidth:a.VideoShareRecvWidth&&""!==a.VideoShareRecvWidth?parseInt(a.VideoShareRecvWidth,10):null,pinnedGuid:a.P1,connections:a.C5?c.map(a.C5,function(a){return d.translationMatrix(a)}):null,rdcControllee:void 0!==a.r&&"None"!==a.r?a.r:null,rdcVersion:a.R1,isRdcControllerCapable:"1"==a.R2,isRdcControlleeCapable:"1"==a.R3}},translateAttributes:function(a,b){var d=b&&b.get("dataObject")?b.get("dataObject"):{},e=c.extend(d,a);b&&b.get("id")&&(e.id=b.get("id"));var f=this.translationMatrixShort(e,b);return f},getId:function(a){return a.E1}});return e}),define("clientSDK/src/models/ParticipantsCollection",["require","backbone","underscore","./Participant"],function(a){var b=a("backbone"),c=a("underscore"),d=a("./Participant"),e=0,f=1,g=3,h="aaa",i=b.Collection.extend({model:d,initialize:function(){b.Collection.prototype.initialize.apply(this),c.bindAll(this,"getExistingForRaw"),this.callGuidMap={},this.chatGuidMap={}},comparator:function(a){var b=g;return b=a.get("isLeader")?f:b,b=a.get("isSelf")?e:b,b+(a.get("name")?a.get("name").toLowerCase():h)},sync:function(a,b,c){b.trigger("fetch",a,c)},getExistingForRaw:function(a){return this.get(this.model.getId(a))},getEnteredLength:function(){return this.filter(function(a){return a.isEntered()}).length}});return i}),define("clientSDK/src/Roster",["require","underscore","my.Class","./models/ParticipantsCollection","./models/Participant"],function(a){var b=a("underscore"),c=a("my.Class"),d=a("./models/ParticipantsCollection"),e=a("./models/Participant"),f=c.Class({constructor:function(a){this.collection=a,this.selfParticipant=new e},extractSelf:function(a){var c,d=this.selfParticipant?this.selfParticipant.id:null;a.f&&(b(a.f).filter(function(a){return d&&e.getId(a)===d?(c=a,!1):!0}),c&&this.processSelf(c,this.selfParticipant));var f;a.a&&(b(a.a).filter(function(a){return d&&e.getId(a)===d?(f=a,!1):!0}),f&&this.processSelf(f,this.selfParticipant));var g;a.m&&(b(a.m).filter(function(a){return d&&e.getId(a)===d?(g=a,!1):!0}),g&&this.processSelf(g,this.selfParticipant)),a.d&&b(a.d).filter(b.bind(function(a){return d&&e.getId(a)===d?(this.selfLeft(),!1):!0},this))},fullUpdate:function(a,c){var e=this.collection?this.collection:new d,f=[],g=[],h=[],i=[];this.extractSelf(a),b(a.f).each(function(a){var b=e.getExistingForRaw(a);b?(g.push(a),i.push(b.get("id"))):f.push(a)}),b(b.difference(b.pluck(e.models,"id"),i)).each(function(a){h.push(e.get(a))}),this.processAdded(f,c),this.processModified(g,c),this.processDeleted(h,c,!0)},partialUpdate:function(a,b){this.extractSelf(a),a.a&&this.processAdded(a.a,b),a.m&&this.processModified(a.m,b),a.d&&this.processDeleted(a.d,b)},processAdded:function(a,c){var d=this.collection,e=b(a).map(b.bind(function(a){var b=d.model.translateAttributes(a,void 0);return new d.model(b)},this)).filter(function(a){return a.get("isVisible")});b.each(e,function(a){d.add(a,c)})},processModified:function(a,c){var d=this.collection,e=b(a).map(function(a){return d.model.translateAttributes(a,d.getExistingForRaw(a))}).value();b.each(e,function(a){var b=d.get(a.id);b&&b.set(a)})},processDeleted:function(a,c,d){var e=this.collection;b(a).each(function(a){var b=d?e.get(a):e.getExistingForRaw(a);b&&b.destroy()})},assignedSelf:function(a){var c,d=this.collection;this.selfParticipant.id=a.E1,d&&(d=b(d).filter(function(b){return b?a&&a.E1&&b.id===a.E1?(c=b,!1):!0:!1}),c?this.processSelf(c):e.translateAttributes(a,this.selfParticipant))},processSelf:function(a,b){if(void 0!==a){var c=b?b:new e,d=this.collection.model.translateAttributes(a,c);
c.set(d)}},selfLeft:function(){},registerMeetingEventsProcessor:function(a){var c=this.collection?this.collection:new d;this.meetingEventsProcessor=a;var e=this;b.defer(function(){e.meetingEventsProcessor.processFullRoster(c)})}});return f}),!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define("bluebird",[],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.Promise=a()}}(function(){var a,b,c;return function d(a,b,c){function e(g,h){if(!b[g]){if(!a[g]){var i="function"==typeof _dereq_&&_dereq_;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=b[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,d,a,b,c)}return b[g].exports}for(var f="function"==typeof _dereq_&&_dereq_,g=0;g<c.length;g++)e(c[g]);return e}({1:[function(a,b,c){b.exports=function(a){function b(a){var b=new c(a),d=b.promise();return b.setHowMany(1),b.setUnwrap(),b.init(),d}var c=a._SomePromiseArray;a.any=function(a){return b(a)},a.prototype.any=function(){return b(this)}}},{}],2:[function(a,b,c){function d(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new m(16),this._normalQueue=new m(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var a=this;this.drainQueues=function(){a._drainQueues()},this._schedule=l}function e(a,b,c){this._lateQueue.push(a,b,c),this._queueTick()}function f(a,b,c){this._normalQueue.push(a,b,c),this._queueTick()}function g(a){this._normalQueue._pushOne(a),this._queueTick()}function h(a){for(;a.length()>0;)i(a)}function i(a){var b=a.shift();if("function"!=typeof b)b._settlePromises();else{var c=a.shift(),d=a.shift();b.call(c,d)}}var j;try{throw new Error}catch(k){j=k}var l=a("./schedule"),m=a("./queue"),n=a("./util");d.prototype.setScheduler=function(a){var b=this._schedule;return this._schedule=a,this._customScheduler=!0,b},d.prototype.hasCustomScheduler=function(){return this._customScheduler},d.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},d.prototype.disableTrampolineIfNecessary=function(){n.hasDevTools&&(this._trampolineEnabled=!1)},d.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},d.prototype.fatalError=function(a,b){b?(process.stderr.write("Fatal "+(a instanceof Error?a.stack:a)+"\n"),process.exit(2)):this.throwLater(a)},d.prototype.throwLater=function(a,b){if(1===arguments.length&&(b=a,a=function(){throw b}),"undefined"!=typeof setTimeout)setTimeout(function(){a(b)},0);else try{this._schedule(function(){a(b)})}catch(c){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},n.hasDevTools?(d.prototype.invokeLater=function(a,b,c){this._trampolineEnabled?e.call(this,a,b,c):this._schedule(function(){setTimeout(function(){a.call(b,c)},100)})},d.prototype.invoke=function(a,b,c){this._trampolineEnabled?f.call(this,a,b,c):this._schedule(function(){a.call(b,c)})},d.prototype.settlePromises=function(a){this._trampolineEnabled?g.call(this,a):this._schedule(function(){a._settlePromises()})}):(d.prototype.invokeLater=e,d.prototype.invoke=f,d.prototype.settlePromises=g),d.prototype._drainQueues=function(){h(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,h(this._lateQueue)},d.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},d.prototype._reset=function(){this._isTickUsed=!1},b.exports=d,b.exports.firstLineError=j},{"./queue":26,"./schedule":29,"./util":36}],3:[function(a,b,c){b.exports=function(a,b,c,d){var e=!1,f=function(a,b){this._reject(b)},g=function(a,b){b.promiseRejectionQueued=!0,b.bindingPromise._then(f,f,null,this,a)},h=function(a,b){0===(50397184&this._bitField)&&this._resolveCallback(b.target)},i=function(a,b){b.promiseRejectionQueued||this._reject(a)};a.prototype.bind=function(f){e||(e=!0,a.prototype._propagateFrom=d.propagateFromFunction(),a.prototype._boundValue=d.boundValueFunction());var j=c(f),k=new a(b);k._propagateFrom(this,1);var l=this._target();if(k._setBoundTo(j),j instanceof a){var m={promiseRejectionQueued:!1,promise:k,target:l,bindingPromise:j};l._then(b,g,void 0,k,m),j._then(h,i,void 0,k,m),k._setOnCancel(j)}else k._resolveCallback(l);return k},a.prototype._setBoundTo=function(a){void 0!==a?(this._bitField=2097152|this._bitField,this._boundTo=a):this._bitField=-2097153&this._bitField},a.prototype._isBound=function(){return 2097152===(2097152&this._bitField)},a.bind=function(b,c){return a.resolve(c).bind(b)}}},{}],4:[function(a,b,c){function d(){try{Promise===f&&(Promise=e)}catch(a){}return f}var e;"undefined"!=typeof Promise&&(e=Promise);var f=a("./promise")();f.noConflict=d,b.exports=f},{"./promise":22}],5:[function(a,b,c){var d=Object.create;if(d){var e=d(null),f=d(null);e[" size"]=f[" size"]=0}b.exports=function(b){function c(a,c){var d;if(null!=a&&(d=a[c]),"function"!=typeof d){var e="Object "+h.classString(a)+" has no method '"+h.toString(c)+"'";throw new b.TypeError(e)}return d}function d(a){var b=this.pop(),d=c(a,b);return d.apply(a,this)}function e(a){return a[this]}function f(a){var b=+this;return 0>b&&(b=Math.max(0,b+a.length)),a[b]}var g,h=a("./util"),i=h.canEvaluate;h.isIdentifier;b.prototype.call=function(a){var b=[].slice.call(arguments,1);return b.push(a),this._then(d,void 0,void 0,b,void 0)},b.prototype.get=function(a){var b,c="number"==typeof a;if(c)b=f;else if(i){var d=g(a);b=null!==d?d:e}else b=e;return this._then(b,void 0,void 0,a,void 0)}}},{"./util":36}],6:[function(a,b,c){b.exports=function(b,c,d,e){var f=a("./util"),g=f.tryCatch,h=f.errorObj,i=b._async;b.prototype["break"]=b.prototype.cancel=function(){if(!e.cancellation())return this._warn("cancellation is disabled");for(var a=this,b=a;a._isCancellable();){if(!a._cancelBy(b)){b._isFollowing()?b._followee().cancel():b._cancelBranched();break}var c=a._cancellationParent;if(null==c||!c._isCancellable()){a._isFollowing()?a._followee().cancel():a._cancelBranched();break}a._isFollowing()&&a._followee().cancel(),a._setWillBeCancelled(),b=a,a=c}},b.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},b.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},b.prototype._cancelBy=function(a){return a===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),this._enoughBranchesHaveCancelled()?(this._invokeOnCancel(),!0):!1)},b.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},b.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),i.invoke(this._cancelPromises,this,void 0))},b.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},b.prototype._unsetOnCancel=function(){this._onCancelField=void 0},b.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},b.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},b.prototype._doInvokeOnCancel=function(a,b){if(f.isArray(a))for(var c=0;c<a.length;++c)this._doInvokeOnCancel(a[c],b);else if(void 0!==a)if("function"==typeof a){if(!b){var d=g(a).call(this._boundValue());d===h&&(this._attachExtraTrace(d.e),i.throwLater(d.e))}}else a._resultCancelled(this)},b.prototype._invokeOnCancel=function(){var a=this._onCancel();this._unsetOnCancel(),i.invoke(this._doInvokeOnCancel,this,a)},b.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},b.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(a,b,c){b.exports=function(b){function c(a,c,h){return function(i){var j=h._boundValue();a:for(var k=0;k<a.length;++k){var l=a[k];if(l===Error||null!=l&&l.prototype instanceof Error){if(i instanceof l)return f(c).call(j,i)}else if("function"==typeof l){var m=f(l).call(j,i);if(m===g)return m;if(m)return f(c).call(j,i)}else if(d.isObject(i)){for(var n=e(l),o=0;o<n.length;++o){var p=n[o];if(l[p]!=i[p])continue a}return f(c).call(j,i)}}return b}}var d=a("./util"),e=a("./es5").keys,f=d.tryCatch,g=d.errorObj;return c}},{"./es5":13,"./util":36}],8:[function(a,b,c){b.exports=function(a){function b(){this._trace=new b.CapturedTrace(d())}function c(){return e?new b:void 0}function d(){var a=f.length-1;return a>=0?f[a]:void 0}var e=!1,f=[];return a.prototype._promiseCreated=function(){},a.prototype._pushContext=function(){},a.prototype._popContext=function(){return null},a._peekContext=a.prototype._peekContext=function(){},b.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,f.push(this._trace))},b.prototype._popContext=function(){if(void 0!==this._trace){var a=f.pop(),b=a._promiseCreated;return a._promiseCreated=null,b}return null},b.CapturedTrace=null,b.create=c,b.deactivateLongStackTraces=function(){},b.activateLongStackTraces=function(){var c=a.prototype._pushContext,f=a.prototype._popContext,g=a._peekContext,h=a.prototype._peekContext,i=a.prototype._promiseCreated;b.deactivateLongStackTraces=function(){a.prototype._pushContext=c,a.prototype._popContext=f,a._peekContext=g,a.prototype._peekContext=h,a.prototype._promiseCreated=i,e=!1},e=!0,a.prototype._pushContext=b.prototype._pushContext,a.prototype._popContext=b.prototype._popContext,a._peekContext=a.prototype._peekContext=d,a.prototype._promiseCreated=function(){var a=this._peekContext();a&&null==a._promiseCreated&&(a._promiseCreated=this)}},b}},{}],9:[function(a,b,c){b.exports=function(b,c){function d(a,b){return{promise:b}}function e(){return!1}function f(a,b,c){var d=this;try{a(b,c,function(a){if("function"!=typeof a)throw new TypeError("onCancel must be a function, got: "+N.toString(a));d._attachCancellationCallback(a)})}catch(e){return e}}function g(a){if(!this._isCancellable())return this;var b=this._onCancel();void 0!==b?N.isArray(b)?b.push(a):this._setOnCancel([b,a]):this._setOnCancel(a)}function h(){return this._onCancelField}function i(a){this._onCancelField=a}function j(){this._cancellationParent=void 0,this._onCancelField=void 0}function k(a,b){if(0!==(1&b)){this._cancellationParent=a;var c=a._branchesRemainingToCancel;void 0===c&&(c=0),a._branchesRemainingToCancel=c+1}0!==(2&b)&&a._isBound()&&this._setBoundTo(a._boundTo)}function l(a,b){0!==(2&b)&&a._isBound()&&this._setBoundTo(a._boundTo)}function m(){var a=this._boundTo;return void 0!==a&&a instanceof b?a.isFulfilled()?a.value():void 0:a}function n(){this._trace=new G(this._peekContext())}function o(a,b){if(P(a)){var c=this._trace;if(void 0!==c&&b&&(c=c._parent),void 0!==c)c.attachExtraTrace(a);else if(!a.__stackCleaned__){var d=y(a);N.notEnumerableProp(a,"stack",d.message+"\n"+d.stack.join("\n")),N.notEnumerableProp(a,"__stackCleaned__",!0)}}}function p(){this._trace=void 0}function q(a,b,c,d,e){if(void 0===a&&null!==b&&Z){if(void 0!==e&&e._returnedNonUndefined())return;if(0===(65535&d._bitField))return;c&&(c+=" ");var f="",g="";if(b._trace){for(var h=b._trace.stack.split("\n"),i=w(h),j=i.length-1;j>=0;--j){var k=i[j];if(!R.test(k)){var l=k.match(S);l&&(f="at "+l[1]+":"+l[2]+":"+l[3]+" ");break}}if(i.length>0)for(var m=i[0],j=0;j<h.length;++j)if(h[j]===m){j>0&&(g="\n"+h[j-1]);break}}var n="a promise was created in a "+c+"handler "+f+"but was not returned from it, see http://goo.gl/rRqMUw"+g;d._warn(n,!0,b)}}function r(a,b){var c=a+" is deprecated and will be removed in a future version.";return b&&(c+=" Use "+b+" instead."),s(c)}function s(a,c,d){if(ha.warnings){var e,f=new M(a);if(c)d._attachExtraTrace(f);else if(ha.longStackTraces&&(e=b._peekContext()))e.attachExtraTrace(f);else{var g=y(f);f.stack=g.message+"\n"+g.stack.join("\n")}ca("warning",f)||z(f,"",!0)}}function t(a,b){for(var c=0;c<b.length-1;++c)b[c].push("From previous event:"),b[c]=b[c].join("\n");return c<b.length&&(b[c]=b[c].join("\n")),a+"\n"+b.join("\n")}function u(a){for(var b=0;b<a.length;++b)(0===a[b].length||b+1<a.length&&a[b][0]===a[b+1][0])&&(a.splice(b,1),b--)}function v(a){for(var b=a[0],c=1;c<a.length;++c){for(var d=a[c],e=b.length-1,f=b[e],g=-1,h=d.length-1;h>=0;--h)if(d[h]===f){g=h;break}for(var h=g;h>=0;--h){var i=d[h];if(b[e]!==i)break;b.pop(),e--}b=d}}function w(a){for(var b=[],c=0;c<a.length;++c){var d=a[c],e="    (No stack trace)"===d||T.test(d),f=e&&ea(d);e&&!f&&(V&&" "!==d.charAt(0)&&(d="    "+d),b.push(d))}return b}function x(a){for(var b=a.stack.replace(/\s+$/g,"").split("\n"),c=0;c<b.length;++c){var d=b[c];if("    (No stack trace)"===d||T.test(d))break}return c>0&&"SyntaxError"!=a.name&&(b=b.slice(c)),b}function y(a){var b=a.stack,c=a.toString();return b="string"==typeof b&&b.length>0?x(a):["    (No stack trace)"],{message:c,stack:"SyntaxError"==a.name?b:w(b)}}function z(a,b,c){if("undefined"!=typeof console){var d;if(N.isObject(a)){var e=a.stack;d=b+U(e,a)}else d=b+String(a);"function"==typeof J?J(d,c):"function"==typeof console.log||"object"==typeof console.log}}function A(a,b,c,d){var e=!1;try{"function"==typeof b&&(e=!0,"rejectionHandled"===a?b(d):b(c,d))}catch(f){L.throwLater(f)}"unhandledRejection"===a?ca(a,c,d)||e||z(c,"Unhandled rejection "):ca(a,d)}function B(a){var b;if("function"==typeof a)b="[function "+(a.name||"anonymous")+"]";else{b=a&&"function"==typeof a.toString?a.toString():N.toString(a);var c=/\[object [a-zA-Z0-9$_]+\]/;if(c.test(b))try{var d=JSON.stringify(a);b=d}catch(e){}0===b.length&&(b="(empty array)")}return"(<"+C(b)+">, no stack trace)"}function C(a){var b=41;return a.length<b?a:a.substr(0,b-3)+"..."}function D(){return"function"==typeof ga}function E(a){var b=a.match(fa);return b?{fileName:b[1],line:parseInt(b[2],10)}:void 0}function F(a,b){if(D()){for(var c,d,e=a.stack.split("\n"),f=b.stack.split("\n"),g=-1,h=-1,i=0;i<e.length;++i){var j=E(e[i]);if(j){c=j.fileName,g=j.line;break}}for(var i=0;i<f.length;++i){var j=E(f[i]);if(j){d=j.fileName,h=j.line;break}}0>g||0>h||!c||!d||c!==d||g>=h||(ea=function(a){if(Q.test(a))return!0;var b=E(a);return b&&b.fileName===c&&g<=b.line&&b.line<=h?!0:!1})}}function G(a){this._parent=a,this._promisesCreated=0;var b=this._length=1+(void 0===a?0:a._length);ga(this,G),b>32&&this.uncycle()}var H,I,J,K=b._getDomain,L=b._async,M=a("./errors").Warning,N=a("./util"),O=a("./es5"),P=N.canAttachTrace,Q=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,R=/\((?:timers\.js):\d+:\d+\)/,S=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,T=null,U=null,V=!1,W=!(0==N.env("BLUEBIRD_DEBUG")),X=!(0==N.env("BLUEBIRD_WARNINGS")||!W&&!N.env("BLUEBIRD_WARNINGS")),Y=!(0==N.env("BLUEBIRD_LONG_STACK_TRACES")||!W&&!N.env("BLUEBIRD_LONG_STACK_TRACES")),Z=0!=N.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(X||!!N.env("BLUEBIRD_W_FORGOTTEN_RETURN"));b.prototype.suppressUnhandledRejections=function(){var a=this._target();a._bitField=-1048577&a._bitField|524288},b.prototype._ensurePossibleRejectionHandled=function(){if(0===(524288&this._bitField)){this._setRejectionIsUnhandled();var a=this;setTimeout(function(){a._notifyUnhandledRejection()},1)}},b.prototype._notifyUnhandledRejectionIsHandled=function(){A("rejectionHandled",H,void 0,this)},b.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},b.prototype._returnedNonUndefined=function(){return 0!==(268435456&this._bitField)},b.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var a=this._settledValue();this._setUnhandledRejectionIsNotified(),A("unhandledRejection",I,a,this)}},b.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},b.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},b.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},b.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},b.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},b.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},b.prototype._warn=function(a,b,c){return s(a,b,c||this)},b.onPossiblyUnhandledRejection=function(a){var b=K();I="function"==typeof a?null===b?a:N.domainBind(b,a):void 0},b.onUnhandledRejectionHandled=function(a){var b=K();H="function"==typeof a?null===b?a:N.domainBind(b,a):void 0};var $=function(){};b.longStackTraces=function(){if(L.haveItemsQueued()&&!ha.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!ha.longStackTraces&&D()){var a=b.prototype._captureStackTrace,d=b.prototype._attachExtraTrace,e=b.prototype._dereferenceTrace;ha.longStackTraces=!0,$=function(){if(L.haveItemsQueued()&&!ha.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");b.prototype._captureStackTrace=a,b.prototype._attachExtraTrace=d,b.prototype._dereferenceTrace=e,c.deactivateLongStackTraces(),L.enableTrampoline(),ha.longStackTraces=!1},b.prototype._captureStackTrace=n,b.prototype._attachExtraTrace=o,b.prototype._dereferenceTrace=p,c.activateLongStackTraces(),L.disableTrampolineIfNecessary()}},b.hasLongStackTraces=function(){return ha.longStackTraces&&D()};var _=function(){try{if("function"==typeof CustomEvent){var a=new CustomEvent("CustomEvent");return N.global.dispatchEvent(a),function(a,b){var c={detail:b,cancelable:!0};O.defineProperty(c,"promise",{value:b.promise}),O.defineProperty(c,"reason",{value:b.reason});var d=new CustomEvent(a.toLowerCase(),c);return!N.global.dispatchEvent(d)}}if("function"==typeof Event){var a=new Event("CustomEvent");return N.global.dispatchEvent(a),function(a,b){var c=new Event(a.toLowerCase(),{cancelable:!0});return c.detail=b,O.defineProperty(c,"promise",{value:b.promise}),O.defineProperty(c,"reason",{value:b.reason}),!N.global.dispatchEvent(c)}}var a=document.createEvent("CustomEvent");return a.initCustomEvent("testingtheevent",!1,!0,{}),N.global.dispatchEvent(a),function(a,b){var c=document.createEvent("CustomEvent");return c.initCustomEvent(a.toLowerCase(),!1,!0,b),!N.global.dispatchEvent(c)}}catch(b){}return function(){return!1}}(),aa=function(){return N.isNode?function(){return process.emit.apply(process,arguments)}:N.global?function(a){var b="on"+a.toLowerCase(),c=N.global[b];return c?(c.apply(N.global,[].slice.call(arguments,1)),!0):!1}:function(){return!1}}(),ba={promiseCreated:d,promiseFulfilled:d,promiseRejected:d,promiseResolved:d,promiseCancelled:d,promiseChained:function(a,b,c){return{promise:b,child:c}},warning:function(a,b){return{warning:b}},unhandledRejection:function(a,b,c){return{reason:b,promise:c}},rejectionHandled:d},ca=function(a){var b=!1;try{b=aa.apply(null,arguments)}catch(c){L.throwLater(c),b=!0}var d=!1;try{d=_(a,ba[a].apply(null,arguments))}catch(c){L.throwLater(c),d=!0}return d||b};b.config=function(a){if(a=Object(a),"longStackTraces"in a&&(a.longStackTraces?b.longStackTraces():!a.longStackTraces&&b.hasLongStackTraces()&&$()),"warnings"in a){var c=a.warnings;ha.warnings=!!c,Z=ha.warnings,N.isObject(c)&&"wForgottenReturn"in c&&(Z=!!c.wForgottenReturn)}if("cancellation"in a&&a.cancellation&&!ha.cancellation){if(L.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");b.prototype._clearCancellationData=j,b.prototype._propagateFrom=k,b.prototype._onCancel=h,b.prototype._setOnCancel=i,b.prototype._attachCancellationCallback=g,b.prototype._execute=f,da=k,ha.cancellation=!0}return"monitoring"in a&&(a.monitoring&&!ha.monitoring?(ha.monitoring=!0,b.prototype._fireEvent=ca):!a.monitoring&&ha.monitoring&&(ha.monitoring=!1,b.prototype._fireEvent=e)),b},b.prototype._fireEvent=e,b.prototype._execute=function(a,b,c){try{a(b,c)}catch(d){return d}},b.prototype._onCancel=function(){},b.prototype._setOnCancel=function(a){},b.prototype._attachCancellationCallback=function(a){},b.prototype._captureStackTrace=function(){},b.prototype._attachExtraTrace=function(){},b.prototype._dereferenceTrace=function(){},b.prototype._clearCancellationData=function(){},b.prototype._propagateFrom=function(a,b){};var da=l,ea=function(){return!1},fa=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;N.inherits(G,Error),c.CapturedTrace=G,G.prototype.uncycle=function(){var a=this._length;if(!(2>a)){for(var b=[],c={},d=0,e=this;void 0!==e;++d)b.push(e),e=e._parent;a=this._length=d;for(var d=a-1;d>=0;--d){var f=b[d].stack;void 0===c[f]&&(c[f]=d)}for(var d=0;a>d;++d){var g=b[d].stack,h=c[g];if(void 0!==h&&h!==d){h>0&&(b[h-1]._parent=void 0,b[h-1]._length=1),b[d]._parent=void 0,b[d]._length=1;var i=d>0?b[d-1]:this;a-1>h?(i._parent=b[h+1],i._parent.uncycle(),i._length=i._parent._length+1):(i._parent=void 0,i._length=1);for(var j=i._length+1,k=d-2;k>=0;--k)b[k]._length=j,j++;return}}}},G.prototype.attachExtraTrace=function(a){if(!a.__stackCleaned__){this.uncycle();for(var b=y(a),c=b.message,d=[b.stack],e=this;void 0!==e;)d.push(w(e.stack.split("\n"))),e=e._parent;v(d),u(d),N.notEnumerableProp(a,"stack",t(c,d)),N.notEnumerableProp(a,"__stackCleaned__",!0)}};var ga=function(){var a=/^\s*at\s*/,b=function(a,b){return"string"==typeof a?a:void 0!==b.name&&void 0!==b.message?b.toString():B(b)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,T=a,U=b;var c=Error.captureStackTrace;return ea=function(a){return Q.test(a)},function(a,b){Error.stackTraceLimit+=6,c(a,b),Error.stackTraceLimit-=6}}var d=new Error;if("string"==typeof d.stack&&d.stack.split("\n")[0].indexOf("stackDetection@")>=0)return T=/@/,U=b,V=!0,function(a){a.stack=(new Error).stack};var e;try{throw new Error}catch(f){e="stack"in f}return"stack"in d||!e||"number"!=typeof Error.stackTraceLimit?(U=function(a,b){return"string"==typeof a?a:"object"!=typeof b&&"function"!=typeof b||void 0===b.name||void 0===b.message?B(b):b.toString()},null):(T=a,U=b,function(a){Error.stackTraceLimit+=6;try{throw new Error}catch(b){a.stack=b.stack}Error.stackTraceLimit-=6})}([]);"undefined"!=typeof console&&"undefined"!=typeof console.warn&&(J=function(a){},N.isNode&&process.stderr.isTTY?J=function(a,b){}:N.isNode||"string"!=typeof(new Error).stack||(J=function(a,b){}));var ha={warnings:X,longStackTraces:!1,cancellation:!1,monitoring:!1};return Y&&b.longStackTraces(),{longStackTraces:function(){return ha.longStackTraces},warnings:function(){return ha.warnings},cancellation:function(){return ha.cancellation},monitoring:function(){return ha.monitoring},propagateFromFunction:function(){return da},boundValueFunction:function(){return m},checkForgottenReturns:q,setBounds:F,warn:s,deprecated:r,CapturedTrace:G,fireDomEvent:_,fireGlobalEvent:aa}}},{"./errors":12,"./es5":13,"./util":36}],10:[function(a,b,c){b.exports=function(a){function b(){return this.value}function c(){throw this.reason}a.prototype["return"]=a.prototype.thenReturn=function(c){return c instanceof a&&c.suppressUnhandledRejections(),this._then(b,void 0,void 0,{value:c},void 0)},a.prototype["throw"]=a.prototype.thenThrow=function(a){return this._then(c,void 0,void 0,{reason:a},void 0)},a.prototype.catchThrow=function(a){if(arguments.length<=1)return this._then(void 0,c,void 0,{reason:a},void 0);var b=arguments[1],d=function(){throw b};return this.caught(a,d)},a.prototype.catchReturn=function(c){if(arguments.length<=1)return c instanceof a&&c.suppressUnhandledRejections(),this._then(void 0,b,void 0,{value:c},void 0);var d=arguments[1];d instanceof a&&d.suppressUnhandledRejections();var e=function(){return d};return this.caught(c,e)}}},{}],11:[function(a,b,c){b.exports=function(a,b){function c(){return f(this)}function d(a,c){return e(a,c,b,b)}var e=a.reduce,f=a.all;a.prototype.each=function(a){return e(this,a,b,0)._then(c,void 0,void 0,this,void 0)},a.prototype.mapSeries=function(a){return e(this,a,b,b)},a.each=function(a,d){return e(a,d,b,0)._then(c,void 0,void 0,a,void 0)},a.mapSeries=d}},{}],12:[function(a,b,c){function d(a,b){function c(d){return this instanceof c?(l(this,"message","string"==typeof d?d:b),l(this,"name",a),void(Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this))):new c(d)}return k(c,Error),c}function e(a){return this instanceof e?(l(this,"name","OperationalError"),l(this,"message",a),this.cause=a,this.isOperational=!0,void(a instanceof Error?(l(this,"message",a.message),l(this,"stack",a.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new e(a)}var f,g,h=a("./es5"),i=h.freeze,j=a("./util"),k=j.inherits,l=j.notEnumerableProp,m=d("Warning","warning"),n=d("CancellationError","cancellation error"),o=d("TimeoutError","timeout error"),p=d("AggregateError","aggregate error");try{f=TypeError,g=RangeError}catch(q){f=d("TypeError","type error"),g=d("RangeError","range error")}for(var r="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),s=0;s<r.length;++s)"function"==typeof Array.prototype[r[s]]&&(p.prototype[r[s]]=Array.prototype[r[s]]);h.defineProperty(p.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),p.prototype.isOperational=!0;var t=0;p.prototype.toString=function(){var a=Array(4*t+1).join(" "),b="\n"+a+"AggregateError of:\n";t++,a=Array(4*t+1).join(" ");for(var c=0;c<this.length;++c){for(var d=this[c]===this?"[Circular AggregateError]":this[c]+"",e=d.split("\n"),f=0;f<e.length;++f)e[f]=a+e[f];d=e.join("\n"),b+=d+"\n"}return t--,b},k(e,Error);var u=Error.__BluebirdErrorTypes__;u||(u=i({CancellationError:n,TimeoutError:o,OperationalError:e,RejectionError:e,AggregateError:p}),h.defineProperty(Error,"__BluebirdErrorTypes__",{value:u,writable:!1,enumerable:!1,configurable:!1})),b.exports={Error:Error,TypeError:f,RangeError:g,CancellationError:u.CancellationError,OperationalError:u.OperationalError,TimeoutError:u.TimeoutError,AggregateError:u.AggregateError,Warning:m}},{"./es5":13,"./util":36}],13:[function(a,b,c){var d=function(){"use strict";return void 0===this}();if(d)b.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:d,propertyIsWritable:function(a,b){var c=Object.getOwnPropertyDescriptor(a,b);return!(c&&!c.writable&&!c.set)}};else{var e={}.hasOwnProperty,f={}.toString,g={}.constructor.prototype,h=function(a){var b=[];for(var c in a)e.call(a,c)&&b.push(c);return b},i=function(a,b){return{value:a[b]}},j=function(a,b,c){return a[b]=c.value,a},k=function(a){return a},l=function(a){try{return Object(a).constructor.prototype}catch(b){return g}},m=function(a){try{return"[object Array]"===f.call(a)}catch(b){return!1}};b.exports={isArray:m,keys:h,names:h,defineProperty:j,getDescriptor:i,freeze:k,getPrototypeOf:l,isES5:d,propertyIsWritable:function(){return!0}}}},{}],14:[function(a,b,c){b.exports=function(a,b){var c=a.map;a.prototype.filter=function(a,d){return c(this,a,d,b)},a.filter=function(a,d,e){return c(a,d,e,b)}}},{}],15:[function(a,b,c){b.exports=function(b,c,d){function e(a,b,c){this.promise=a,this.type=b,this.handler=c,this.called=!1,this.cancelPromise=null}function f(a){this.finallyHandler=a}function g(a,b){return null!=a.cancelPromise?(arguments.length>1?a.cancelPromise._reject(b):a.cancelPromise._cancel(),a.cancelPromise=null,!0):!1}function h(){return j.call(this,this.promise._target()._settledValue())}function i(a){return g(this,a)?void 0:(m.e=a,m)}function j(a){var e=this.promise,j=this.handler;if(!this.called){this.called=!0;var k=this.isFinallyHandler()?j.call(e._boundValue()):j.call(e._boundValue(),a);if(k===d)return k;if(void 0!==k){e._setReturnedNonUndefined();var n=c(k,e);if(n instanceof b){if(null!=this.cancelPromise){if(n._isCancelled()){var o=new l("late cancellation observer");return e._attachExtraTrace(o),m.e=o,m}n.isPending()&&n._attachCancellationCallback(new f(this))}return n._then(h,i,void 0,this,void 0)}}}return e.isRejected()?(g(this),m.e=a,m):(g(this),a)}var k=a("./util"),l=b.CancellationError,m=k.errorObj,n=a("./catch_filter")(d);return e.prototype.isFinallyHandler=function(){return 0===this.type},f.prototype._resultCancelled=function(){g(this.finallyHandler)},b.prototype._passThrough=function(a,b,c,d){return"function"!=typeof a?this.then():this._then(c,d,void 0,new e(this,b,a),void 0)},b.prototype.lastly=b.prototype["finally"]=function(a){return this._passThrough(a,0,j,j)},b.prototype.tap=function(a){return this._passThrough(a,1,j)},b.prototype.tapCatch=function(a){var c=arguments.length;if(1===c)return this._passThrough(a,1,void 0,j);var d,e=new Array(c-1),f=0;for(d=0;c-1>d;++d){var g=arguments[d];if(!k.isObject(g))return b.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+k.classString(g)));e[f++]=g}e.length=f;var h=arguments[d];return this._passThrough(n(e,h,this),1,void 0,j)},e}},{"./catch_filter":7,"./util":36}],16:[function(a,b,c){b.exports=function(b,c,d,e,f,g){function h(a,c,d){for(var f=0;f<c.length;++f){d._pushContext();var g=n(c[f])(a);if(d._popContext(),g===m){d._pushContext();var h=b.reject(m.e);return d._popContext(),h}var i=e(g,d);if(i instanceof b)return i}return null}function i(a,c,e,f){if(g.cancellation()){var h=new b(d),i=this._finallyPromise=new b(d);this._promise=h.lastly(function(){return i}),h._captureStackTrace(),h._setOnCancel(this)}else{var j=this._promise=new b(d);j._captureStackTrace()}this._stack=f,this._generatorFunction=a,this._receiver=c,this._generator=void 0,this._yieldHandlers="function"==typeof e?[e].concat(o):o,this._yieldedPromise=null,this._cancellationPhase=!1}var j=a("./errors"),k=j.TypeError,l=a("./util"),m=l.errorObj,n=l.tryCatch,o=[];l.inherits(i,f),i.prototype._isResolved=function(){return null===this._promise},i.prototype._cleanup=function(){this._promise=this._generator=null,g.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},i.prototype._promiseCancelled=function(){if(!this._isResolved()){var a,c="undefined"!=typeof this._generator["return"];if(c)this._promise._pushContext(),a=n(this._generator["return"]).call(this._generator,void 0),this._promise._popContext();else{var d=new b.CancellationError("generator .return() sentinel");b.coroutine.returnSentinel=d,this._promise._attachExtraTrace(d),this._promise._pushContext(),a=n(this._generator["throw"]).call(this._generator,d),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(a)}},i.prototype._promiseFulfilled=function(a){this._yieldedPromise=null,this._promise._pushContext();var b=n(this._generator.next).call(this._generator,a);this._promise._popContext(),this._continue(b)},i.prototype._promiseRejected=function(a){this._yieldedPromise=null,this._promise._attachExtraTrace(a),this._promise._pushContext();var b=n(this._generator["throw"]).call(this._generator,a);this._promise._popContext(),this._continue(b)},i.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof b){var a=this._yieldedPromise;this._yieldedPromise=null,a.cancel()}},i.prototype.promise=function(){return this._promise},i.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},i.prototype._continue=function(a){var c=this._promise;if(a===m)return this._cleanup(),this._cancellationPhase?c.cancel():c._rejectCallback(a.e,!1);var d=a.value;if(a.done===!0)return this._cleanup(),this._cancellationPhase?c.cancel():c._resolveCallback(d);var f=e(d,this._promise);if(!(f instanceof b)&&(f=h(f,this._yieldHandlers,this._promise),null===f))return void this._promiseRejected(new k("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",String(d))+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));
f=f._target();var g=f._bitField;0===(50397184&g)?(this._yieldedPromise=f,f._proxy(this,null)):0!==(33554432&g)?b._async.invoke(this._promiseFulfilled,this,f._value()):0!==(16777216&g)?b._async.invoke(this._promiseRejected,this,f._reason()):this._promiseCancelled()},b.coroutine=function(a,b){if("function"!=typeof a)throw new k("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var c=Object(b).yieldHandler,d=i,e=(new Error).stack;return function(){var b=a.apply(this,arguments),f=new d(void 0,void 0,c,e),g=f.promise();return f._generator=b,f._promiseFulfilled(void 0),g}},b.coroutine.addYieldHandler=function(a){if("function"!=typeof a)throw new k("expecting a function but got "+l.classString(a));o.push(a)},b.spawn=function(a){if(g.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof a)return c("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var d=new i(a,this),e=d.promise();return d._run(b.spawn),e}}},{"./errors":12,"./util":36}],17:[function(a,b,c){b.exports=function(b,c,d,e,f,g){var h=a("./util");h.canEvaluate,h.tryCatch,h.errorObj;b.join=function(){var a,b=arguments.length-1;if(b>0&&"function"==typeof arguments[b]){a=arguments[b];var d}var e=[].slice.call(arguments);a&&e.pop();var d=new c(e).promise();return void 0!==a?d.spread(a):d}}},{"./util":36}],18:[function(a,b,c){b.exports=function(b,c,d,e,f,g){function h(a,b,c,d){this.constructor$(a),this._promise._captureStackTrace();var e=j();this._callback=null===e?b:k.domainBind(e,b),this._preservedValues=d===f?new Array(this.length()):null,this._limit=c,this._inFlight=0,this._queue=[],n.invoke(this._asyncInit,this,void 0)}function i(a,c,e,f){if("function"!=typeof c)return d("expecting a function but got "+k.classString(c));var g=0;if(void 0!==e){if("object"!=typeof e||null===e)return b.reject(new TypeError("options argument must be an object but it is "+k.classString(e)));if("number"!=typeof e.concurrency)return b.reject(new TypeError("'concurrency' must be a number but it is "+k.classString(e.concurrency)));g=e.concurrency}return g="number"==typeof g&&isFinite(g)&&g>=1?g:0,new h(a,c,g,f).promise()}var j=b._getDomain,k=a("./util"),l=k.tryCatch,m=k.errorObj,n=b._async;k.inherits(h,c),h.prototype._asyncInit=function(){this._init$(void 0,-2)},h.prototype._init=function(){},h.prototype._promiseFulfilled=function(a,c){var d=this._values,f=this.length(),h=this._preservedValues,i=this._limit;if(0>c){if(c=-1*c-1,d[c]=a,i>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(i>=1&&this._inFlight>=i)return d[c]=a,this._queue.push(c),!1;null!==h&&(h[c]=a);var j=this._promise,k=this._callback,n=j._boundValue();j._pushContext();var o=l(k).call(n,a,c,f),p=j._popContext();if(g.checkForgottenReturns(o,p,null!==h?"Promise.filter":"Promise.map",j),o===m)return this._reject(o.e),!0;var q=e(o,this._promise);if(q instanceof b){q=q._target();var r=q._bitField;if(0===(50397184&r))return i>=1&&this._inFlight++,d[c]=q,q._proxy(this,-1*(c+1)),!1;if(0===(33554432&r))return 0!==(16777216&r)?(this._reject(q._reason()),!0):(this._cancel(),!0);o=q._value()}d[c]=o}var s=++this._totalResolved;return s>=f?(null!==h?this._filter(d,h):this._resolve(d),!0):!1},h.prototype._drainQueue=function(){for(var a=this._queue,b=this._limit,c=this._values;a.length>0&&this._inFlight<b;){if(this._isResolved())return;var d=a.pop();this._promiseFulfilled(c[d],d)}},h.prototype._filter=function(a,b){for(var c=b.length,d=new Array(c),e=0,f=0;c>f;++f)a[f]&&(d[e++]=b[f]);d.length=e,this._resolve(d)},h.prototype.preservedValues=function(){return this._preservedValues},b.prototype.map=function(a,b){return i(this,a,b,null)},b.map=function(a,b,c,d){return i(a,b,c,d)}}},{"./util":36}],19:[function(a,b,c){b.exports=function(b,c,d,e,f){var g=a("./util"),h=g.tryCatch;b.method=function(a){if("function"!=typeof a)throw new b.TypeError("expecting a function but got "+g.classString(a));return function(){var d=new b(c);d._captureStackTrace(),d._pushContext();var e=h(a).apply(this,arguments),g=d._popContext();return f.checkForgottenReturns(e,g,"Promise.method",d),d._resolveFromSyncValue(e),d}},b.attempt=b["try"]=function(a){if("function"!=typeof a)return e("expecting a function but got "+g.classString(a));var d=new b(c);d._captureStackTrace(),d._pushContext();var i;if(arguments.length>1){f.deprecated("calling Promise.try with more than 1 argument");var j=arguments[1],k=arguments[2];i=g.isArray(j)?h(a).apply(k,j):h(a).call(k,j)}else i=h(a)();var l=d._popContext();return f.checkForgottenReturns(i,l,"Promise.try",d),d._resolveFromSyncValue(i),d},b.prototype._resolveFromSyncValue=function(a){a===g.errorObj?this._rejectCallback(a.e,!1):this._resolveCallback(a,!0)}}},{"./util":36}],20:[function(a,b,c){function d(a){return a instanceof Error&&k.getPrototypeOf(a)===Error.prototype}function e(a){var b;if(d(a)){b=new j(a),b.name=a.name,b.message=a.message,b.stack=a.stack;for(var c=k.keys(a),e=0;e<c.length;++e){var f=c[e];l.test(f)||(b[f]=a[f])}return b}return g.markAsOriginatingFromRejection(a),a}function f(a,b){return function(c,d){if(null!==a){if(c){var f=e(h(c));a._attachExtraTrace(f),a._reject(f)}else if(b){var g=[].slice.call(arguments,1);a._fulfill(g)}else a._fulfill(d);a=null}}}var g=a("./util"),h=g.maybeWrapAsError,i=a("./errors"),j=i.OperationalError,k=a("./es5"),l=/^(?:name|message|stack|cause)$/;b.exports=f},{"./errors":12,"./es5":13,"./util":36}],21:[function(a,b,c){b.exports=function(b){function c(a,b){var c=this;if(!f.isArray(a))return d.call(c,a,b);var e=h(b).apply(c._boundValue(),[null].concat(a));e===i&&g.throwLater(e.e)}function d(a,b){var c=this,d=c._boundValue(),e=void 0===a?h(b).call(d,null):h(b).call(d,null,a);e===i&&g.throwLater(e.e)}function e(a,b){var c=this;if(!a){var d=new Error(a+"");d.cause=a,a=d}var e=h(b).call(c._boundValue(),a);e===i&&g.throwLater(e.e)}var f=a("./util"),g=b._async,h=f.tryCatch,i=f.errorObj;b.prototype.asCallback=b.prototype.nodeify=function(a,b){if("function"==typeof a){var f=d;void 0!==b&&Object(b).spread&&(f=c),this._then(f,e,void 0,this,a)}return this}}},{"./util":36}],22:[function(a,b,c){b.exports=function(){function c(){}function d(a,b){if(null==a||a.constructor!==e)throw new s("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");if("function"!=typeof b)throw new s("expecting a function but got "+n.classString(b))}function e(a){a!==u&&d(this,a),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(a),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function f(a){this.promise._resolveCallback(a)}function g(a){this.promise._rejectCallback(a,!1)}function h(a){var b=new e(u);b._fulfillmentHandler0=a,b._rejectionHandler0=a,b._promise0=a,b._receiver0=a}var i,j=function(){return new s("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},k=function(){return new e.PromiseInspection(this._target())},l=function(a){return e.reject(new s(a))},m={},n=a("./util");i=n.isNode?function(){var a=process.domain;return void 0===a&&(a=null),a}:function(){return null},n.notEnumerableProp(e,"_getDomain",i);var o=a("./es5"),p=a("./async"),q=new p;o.defineProperty(e,"_async",{value:q});var r=a("./errors"),s=e.TypeError=r.TypeError;e.RangeError=r.RangeError;var t=e.CancellationError=r.CancellationError;e.TimeoutError=r.TimeoutError,e.OperationalError=r.OperationalError,e.RejectionError=r.OperationalError,e.AggregateError=r.AggregateError;var u=function(){},v={},w={},x=a("./thenables")(e,u),y=a("./promise_array")(e,u,x,l,c),z=a("./context")(e),A=z.create,B=a("./debuggability")(e,z),C=(B.CapturedTrace,a("./finally")(e,x,w)),D=a("./catch_filter")(w),E=a("./nodeback"),F=n.errorObj,G=n.tryCatch;return e.prototype.toString=function(){return"[object Promise]"},e.prototype.caught=e.prototype["catch"]=function(a){var b=arguments.length;if(b>1){var c,d=new Array(b-1),e=0;for(c=0;b-1>c;++c){var f=arguments[c];if(!n.isObject(f))return l("Catch statement predicate: expecting an object but got "+n.classString(f));d[e++]=f}return d.length=e,a=arguments[c],this.then(void 0,D(d,a,this))}return this.then(void 0,a)},e.prototype.reflect=function(){return this._then(k,k,void 0,this,void 0)},e.prototype.then=function(a,b){if(B.warnings()&&arguments.length>0&&"function"!=typeof a&&"function"!=typeof b){var c=".then() only accepts functions but was passed: "+n.classString(a);arguments.length>1&&(c+=", "+n.classString(b)),this._warn(c)}return this._then(a,b,void 0,void 0,void 0)},e.prototype.done=function(a,b){var c=this._then(a,b,void 0,void 0,void 0);c._setIsFinal()},e.prototype.spread=function(a){return"function"!=typeof a?l("expecting a function but got "+n.classString(a)):this.all()._then(a,void 0,void 0,v,void 0)},e.prototype.toJSON=function(){var a={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(a.fulfillmentValue=this.value(),a.isFulfilled=!0):this.isRejected()&&(a.rejectionReason=this.reason(),a.isRejected=!0),a},e.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new y(this).promise()},e.prototype.error=function(a){return this.caught(n.originatesFromRejection,a)},e.getNewLibraryCopy=b.exports,e.is=function(a){return a instanceof e},e.fromNode=e.fromCallback=function(a){var b=new e(u);b._captureStackTrace();var c=arguments.length>1?!!Object(arguments[1]).multiArgs:!1,d=G(a)(E(b,c));return d===F&&b._rejectCallback(d.e,!0),b._isFateSealed()||b._setAsyncGuaranteed(),b},e.all=function(a){return new y(a).promise()},e.cast=function(a){var b=x(a);return b instanceof e||(b=new e(u),b._captureStackTrace(),b._setFulfilled(),b._rejectionHandler0=a),b},e.resolve=e.fulfilled=e.cast,e.reject=e.rejected=function(a){var b=new e(u);return b._captureStackTrace(),b._rejectCallback(a,!0),b},e.setScheduler=function(a){if("function"!=typeof a)throw new s("expecting a function but got "+n.classString(a));return q.setScheduler(a)},e.prototype._then=function(a,b,c,d,f){var g=void 0!==f,h=g?f:new e(u),j=this._target(),k=j._bitField;g||(h._propagateFrom(this,3),h._captureStackTrace(),void 0===d&&0!==(2097152&this._bitField)&&(d=0!==(50397184&k)?this._boundValue():j===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,h));var l=i();if(0!==(50397184&k)){var m,o,p=j._settlePromiseCtx;0!==(33554432&k)?(o=j._rejectionHandler0,m=a):0!==(16777216&k)?(o=j._fulfillmentHandler0,m=b,j._unsetRejectionIsUnhandled()):(p=j._settlePromiseLateCancellationObserver,o=new t("late cancellation observer"),j._attachExtraTrace(o),m=b),q.invoke(p,j,{handler:null===l?m:"function"==typeof m&&n.domainBind(l,m),promise:h,receiver:d,value:o})}else j._addCallbacks(a,b,h,d,l);return h},e.prototype._length=function(){return 65535&this._bitField},e.prototype._isFateSealed=function(){return 0!==(117506048&this._bitField)},e.prototype._isFollowing=function(){return 67108864===(67108864&this._bitField)},e.prototype._setLength=function(a){this._bitField=-65536&this._bitField|65535&a},e.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},e.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},e.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},e.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},e.prototype._isFinal=function(){return(4194304&this._bitField)>0},e.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},e.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},e.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},e.prototype._setAsyncGuaranteed=function(){q.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},e.prototype._receiverAt=function(a){var b=0===a?this._receiver0:this[4*a-4+3];return b===m?void 0:void 0===b&&this._isBound()?this._boundValue():b},e.prototype._promiseAt=function(a){return this[4*a-4+2]},e.prototype._fulfillmentHandlerAt=function(a){return this[4*a-4+0]},e.prototype._rejectionHandlerAt=function(a){return this[4*a-4+1]},e.prototype._boundValue=function(){},e.prototype._migrateCallback0=function(a){var b=(a._bitField,a._fulfillmentHandler0),c=a._rejectionHandler0,d=a._promise0,e=a._receiverAt(0);void 0===e&&(e=m),this._addCallbacks(b,c,d,e,null)},e.prototype._migrateCallbackAt=function(a,b){var c=a._fulfillmentHandlerAt(b),d=a._rejectionHandlerAt(b),e=a._promiseAt(b),f=a._receiverAt(b);void 0===f&&(f=m),this._addCallbacks(c,d,e,f,null)},e.prototype._addCallbacks=function(a,b,c,d,e){var f=this._length();if(f>=65531&&(f=0,this._setLength(0)),0===f)this._promise0=c,this._receiver0=d,"function"==typeof a&&(this._fulfillmentHandler0=null===e?a:n.domainBind(e,a)),"function"==typeof b&&(this._rejectionHandler0=null===e?b:n.domainBind(e,b));else{var g=4*f-4;this[g+2]=c,this[g+3]=d,"function"==typeof a&&(this[g+0]=null===e?a:n.domainBind(e,a)),"function"==typeof b&&(this[g+1]=null===e?b:n.domainBind(e,b))}return this._setLength(f+1),f},e.prototype._proxy=function(a,b){this._addCallbacks(void 0,void 0,b,a,null)},e.prototype._resolveCallback=function(a,b){if(0===(117506048&this._bitField)){if(a===this)return this._rejectCallback(j(),!1);var c=x(a,this);if(!(c instanceof e))return this._fulfill(a);b&&this._propagateFrom(c,2);var d=c._target();if(d===this)return void this._reject(j());var f=d._bitField;if(0===(50397184&f)){var g=this._length();g>0&&d._migrateCallback0(this);for(var h=1;g>h;++h)d._migrateCallbackAt(this,h);this._setFollowing(),this._setLength(0),this._setFollowee(d)}else if(0!==(33554432&f))this._fulfill(d._value());else if(0!==(16777216&f))this._reject(d._reason());else{var i=new t("late cancellation observer");d._attachExtraTrace(i),this._reject(i)}}},e.prototype._rejectCallback=function(a,b,c){var d=n.ensureErrorObject(a),e=d===a;if(!e&&!c&&B.warnings()){var f="a promise was rejected with a non-error: "+n.classString(a);this._warn(f,!0)}this._attachExtraTrace(d,b?e:!1),this._reject(a)},e.prototype._resolveFromExecutor=function(a){if(a!==u){var b=this;this._captureStackTrace(),this._pushContext();var c=!0,d=this._execute(a,function(a){b._resolveCallback(a)},function(a){b._rejectCallback(a,c)});c=!1,this._popContext(),void 0!==d&&b._rejectCallback(d,!0)}},e.prototype._settlePromiseFromHandler=function(a,b,c,d){var e=d._bitField;if(0===(65536&e)){d._pushContext();var f;b===v?c&&"number"==typeof c.length?f=G(a).apply(this._boundValue(),c):(f=F,f.e=new s("cannot .spread() a non-array: "+n.classString(c))):f=G(a).call(b,c);var g=d._popContext();e=d._bitField,0===(65536&e)&&(f===w?d._reject(c):f===F?d._rejectCallback(f.e,!1):(B.checkForgottenReturns(f,g,"",d,this),d._resolveCallback(f)))}},e.prototype._target=function(){for(var a=this;a._isFollowing();)a=a._followee();return a},e.prototype._followee=function(){return this._rejectionHandler0},e.prototype._setFollowee=function(a){this._rejectionHandler0=a},e.prototype._settlePromise=function(a,b,d,f){var g=a instanceof e,h=this._bitField,i=0!==(134217728&h);0!==(65536&h)?(g&&a._invokeInternalOnCancel(),d instanceof C&&d.isFinallyHandler()?(d.cancelPromise=a,G(b).call(d,f)===F&&a._reject(F.e)):b===k?a._fulfill(k.call(d)):d instanceof c?d._promiseCancelled(a):g||a instanceof y?a._cancel():d.cancel()):"function"==typeof b?g?(i&&a._setAsyncGuaranteed(),this._settlePromiseFromHandler(b,d,f,a)):b.call(d,f,a):d instanceof c?d._isResolved()||(0!==(33554432&h)?d._promiseFulfilled(f,a):d._promiseRejected(f,a)):g&&(i&&a._setAsyncGuaranteed(),0!==(33554432&h)?a._fulfill(f):a._reject(f))},e.prototype._settlePromiseLateCancellationObserver=function(a){var b=a.handler,c=a.promise,d=a.receiver,f=a.value;"function"==typeof b?c instanceof e?this._settlePromiseFromHandler(b,d,f,c):b.call(d,f,c):c instanceof e&&c._reject(f)},e.prototype._settlePromiseCtx=function(a){this._settlePromise(a.promise,a.handler,a.receiver,a.value)},e.prototype._settlePromise0=function(a,b,c){var d=this._promise0,e=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(d,a,e,b)},e.prototype._clearCallbackDataAtIndex=function(a){var b=4*a-4;this[b+2]=this[b+3]=this[b+0]=this[b+1]=void 0},e.prototype._fulfill=function(a){var b=this._bitField;if(!((117506048&b)>>>16)){if(a===this){var c=j();return this._attachExtraTrace(c),this._reject(c)}this._setFulfilled(),this._rejectionHandler0=a,(65535&b)>0&&(0!==(134217728&b)?this._settlePromises():q.settlePromises(this),this._dereferenceTrace())}},e.prototype._reject=function(a){var b=this._bitField;if(!((117506048&b)>>>16))return this._setRejected(),this._fulfillmentHandler0=a,this._isFinal()?q.fatalError(a,n.isNode):void((65535&b)>0?q.settlePromises(this):this._ensurePossibleRejectionHandled())},e.prototype._fulfillPromises=function(a,b){for(var c=1;a>c;c++){var d=this._fulfillmentHandlerAt(c),e=this._promiseAt(c),f=this._receiverAt(c);this._clearCallbackDataAtIndex(c),this._settlePromise(e,d,f,b)}},e.prototype._rejectPromises=function(a,b){for(var c=1;a>c;c++){var d=this._rejectionHandlerAt(c),e=this._promiseAt(c),f=this._receiverAt(c);this._clearCallbackDataAtIndex(c),this._settlePromise(e,d,f,b)}},e.prototype._settlePromises=function(){var a=this._bitField,b=65535&a;if(b>0){if(0!==(16842752&a)){var c=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,c,a),this._rejectPromises(b,c)}else{var d=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,d,a),this._fulfillPromises(b,d)}this._setLength(0)}this._clearCancellationData()},e.prototype._settledValue=function(){var a=this._bitField;return 0!==(33554432&a)?this._rejectionHandler0:0!==(16777216&a)?this._fulfillmentHandler0:void 0},e.defer=e.pending=function(){B.deprecated("Promise.defer","new Promise");var a=new e(u);return{promise:a,resolve:f,reject:g}},n.notEnumerableProp(e,"_makeSelfResolutionError",j),a("./method")(e,u,x,l,B),a("./bind")(e,u,x,B),a("./cancel")(e,y,l,B),a("./direct_resolve")(e),a("./synchronous_inspection")(e),a("./join")(e,y,x,u,q,i),e.Promise=e,e.version="3.5.3",a("./map.js")(e,y,l,x,u,B),a("./call_get.js")(e),a("./using.js")(e,l,x,A,u,B),a("./timers.js")(e,u,B),a("./generators.js")(e,l,u,x,c,B),a("./nodeify.js")(e),a("./promisify.js")(e,u),a("./props.js")(e,y,x,l),a("./race.js")(e,u,x,l),a("./reduce.js")(e,y,l,x,u,B),a("./settle.js")(e,y,B),a("./some.js")(e,y,l),a("./filter.js")(e,u),a("./each.js")(e,u),a("./any.js")(e),n.toFastProperties(e),n.toFastProperties(e.prototype),h({a:1}),h({b:2}),h({c:3}),h(1),h(function(){}),h(void 0),h(!1),h(new e(u)),B.setBounds(p.firstLineError,n.lastLineError),e}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36}],23:[function(a,b,c){b.exports=function(b,c,d,e,f){function g(a){switch(a){case-2:return[];case-3:return{};case-6:return new Map}}function h(a){var d=this._promise=new b(c);a instanceof b&&d._propagateFrom(a,3),d._setOnCancel(this),this._values=a,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var i=a("./util");i.isArray;return i.inherits(h,f),h.prototype.length=function(){return this._length},h.prototype.promise=function(){return this._promise},h.prototype._init=function j(a,c){var f=d(this._values,this._promise);if(f instanceof b){f=f._target();var h=f._bitField;if(this._values=f,0===(50397184&h))return this._promise._setAsyncGuaranteed(),f._then(j,this._reject,void 0,this,c);if(0===(33554432&h))return 0!==(16777216&h)?this._reject(f._reason()):this._cancel();f=f._value()}if(f=i.asArray(f),null===f){var k=e("expecting an array or an iterable object but got "+i.classString(f)).reason();return void this._promise._rejectCallback(k,!1)}return 0===f.length?void(-5===c?this._resolveEmptyArray():this._resolve(g(c))):void this._iterate(f)},h.prototype._iterate=function(a){var c=this.getActualLength(a.length);this._length=c,this._values=this.shouldCopyValues()?new Array(c):this._values;for(var e=this._promise,f=!1,g=null,h=0;c>h;++h){var i=d(a[h],e);i instanceof b?(i=i._target(),g=i._bitField):g=null,f?null!==g&&i.suppressUnhandledRejections():null!==g?0===(50397184&g)?(i._proxy(this,h),this._values[h]=i):f=0!==(33554432&g)?this._promiseFulfilled(i._value(),h):0!==(16777216&g)?this._promiseRejected(i._reason(),h):this._promiseCancelled(h):f=this._promiseFulfilled(i,h)}f||e._setAsyncGuaranteed()},h.prototype._isResolved=function(){return null===this._values},h.prototype._resolve=function(a){this._values=null,this._promise._fulfill(a)},h.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},h.prototype._reject=function(a){this._values=null,this._promise._rejectCallback(a,!1)},h.prototype._promiseFulfilled=function(a,b){this._values[b]=a;var c=++this._totalResolved;return c>=this._length?(this._resolve(this._values),!0):!1},h.prototype._promiseCancelled=function(){return this._cancel(),!0},h.prototype._promiseRejected=function(a){return this._totalResolved++,this._reject(a),!0},h.prototype._resultCancelled=function(){if(!this._isResolved()){var a=this._values;if(this._cancel(),a instanceof b)a.cancel();else for(var c=0;c<a.length;++c)a[c]instanceof b&&a[c].cancel()}},h.prototype.shouldCopyValues=function(){return!0},h.prototype.getActualLength=function(a){return a},h}},{"./util":36}],24:[function(a,b,c){b.exports=function(b,c){function d(a){return!w.test(a)}function e(a){try{return a.__isPromisified__===!0}catch(b){return!1}}function f(a,b,c){var d=n.getDataPropertyOrDefault(a,b+c,u);return d?e(d):!1}function g(a,b,c){for(var d=0;d<a.length;d+=2){var e=a[d];if(c.test(e))for(var f=e.replace(c,""),g=0;g<a.length;g+=2)if(a[g]===f)throw new s("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",b))}}function h(a,b,c,d){for(var h=n.inheritedDataKeys(a),i=[],j=0;j<h.length;++j){var k=h[j],l=a[k],m=d===x?!0:x(k,l,a);"function"!=typeof l||e(l)||f(a,k,b)||!d(k,l,a,m)||i.push(k,l)}return g(i,b,c),i}function i(a,d,e,f,g,h){function i(){var e=d;d===m&&(e=this);var f=new b(c);f._captureStackTrace();var g="string"==typeof k&&this!==j?this[k]:a,i=o(f,h);try{g.apply(e,p(arguments,i))}catch(l){f._rejectCallback(q(l),!0,!0)}return f._isFateSealed()||f._setAsyncGuaranteed(),f}var j=function(){return this}(),k=a;return"string"==typeof k&&(a=f),n.notEnumerableProp(i,"__isPromisified__",!0),i}function j(a,b,c,d,e){for(var f=new RegExp(y(b)+"$"),g=h(a,b,f,c),i=0,j=g.length;j>i;i+=2){var k=g[i],l=g[i+1],o=k+b;if(d===z)a[o]=z(k,m,k,l,b,e);else{var p=d(l,function(){return z(k,m,k,l,b,e)});n.notEnumerableProp(p,"__isPromisified__",!0),a[o]=p}}return n.toFastProperties(a),a}function k(a,b,c){return z(a,b,void 0,a,null,c)}var l,m={},n=a("./util"),o=a("./nodeback"),p=n.withAppended,q=n.maybeWrapAsError,r=n.canEvaluate,s=a("./errors").TypeError,t="Async",u={__isPromisified__:!0},v=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"],w=new RegExp("^(?:"+v.join("|")+")$"),x=function(a){return n.isIdentifier(a)&&"_"!==a.charAt(0)&&"constructor"!==a},y=function(a){return a.replace(/([$])/,"\\$")},z=r?l:i;b.promisify=function(a,b){if("function"!=typeof a)throw new s("expecting a function but got "+n.classString(a));if(e(a))return a;b=Object(b);var c=void 0===b.context?m:b.context,f=!!b.multiArgs,g=k(a,c,f);return n.copyDescriptors(a,g,d),g},b.promisifyAll=function(a,b){if("function"!=typeof a&&"object"!=typeof a)throw new s("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");b=Object(b);var c=!!b.multiArgs,d=b.suffix;"string"!=typeof d&&(d=t);var e=b.filter;"function"!=typeof e&&(e=x);var f=b.promisifier;if("function"!=typeof f&&(f=z),!n.isIdentifier(d))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var g=n.inheritedDataKeys(a),h=0;h<g.length;++h){var i=a[g[h]];"constructor"!==g[h]&&n.isClass(i)&&(j(i.prototype,d,e,f,c),j(i,d,e,f,c))}return j(a,d,e,f,c)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(a,b,c){b.exports=function(b,c,d,e){function f(a){var b,c=!1;if(void 0!==h&&a instanceof h)b=l(a),c=!0;else{var d=k.keys(a),e=d.length;b=new Array(2*e);for(var f=0;e>f;++f){var g=d[f];b[f]=a[g],b[f+e]=g}}this.constructor$(b),this._isMap=c,this._init$(void 0,c?-6:-3)}function g(a){var c,g=d(a);return j(g)?(c=g instanceof b?g._then(b.props,void 0,void 0,void 0,void 0):new f(g).promise(),g instanceof b&&c._propagateFrom(g,2),c):e("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}var h,i=a("./util"),j=i.isObject,k=a("./es5");"function"==typeof Map&&(h=Map);var l=function(){function a(a,d){this[b]=a,this[b+c]=d,b++}var b=0,c=0;return function(d){c=d.size,b=0;var e=new Array(2*d.size);return d.forEach(a,e),e}}(),m=function(a){for(var b=new h,c=a.length/2|0,d=0;c>d;++d){var e=a[c+d],f=a[d];b.set(e,f)}return b};i.inherits(f,c),f.prototype._init=function(){},f.prototype._promiseFulfilled=function(a,b){this._values[b]=a;var c=++this._totalResolved;if(c>=this._length){var d;if(this._isMap)d=m(this._values);else{d={};for(var e=this.length(),f=0,g=this.length();g>f;++f)d[this._values[f+e]]=this._values[f]}return this._resolve(d),!0}return!1},f.prototype.shouldCopyValues=function(){return!1},f.prototype.getActualLength=function(a){return a>>1},b.prototype.props=function(){return g(this)},b.props=function(a){return g(a)}}},{"./es5":13,"./util":36}],26:[function(a,b,c){function d(a,b,c,d,e){for(var f=0;e>f;++f)c[f+d]=a[f+b],a[f+b]=void 0}function e(a){this._capacity=a,this._length=0,this._front=0}e.prototype._willBeOverCapacity=function(a){return this._capacity<a},e.prototype._pushOne=function(a){var b=this.length();this._checkCapacity(b+1);var c=this._front+b&this._capacity-1;this[c]=a,this._length=b+1},e.prototype.push=function(a,b,c){var d=this.length()+3;if(this._willBeOverCapacity(d))return this._pushOne(a),this._pushOne(b),void this._pushOne(c);var e=this._front+d-3;this._checkCapacity(d);var f=this._capacity-1;this[e+0&f]=a,this[e+1&f]=b,this[e+2&f]=c,this._length=d},e.prototype.shift=function(){var a=this._front,b=this[a];return this[a]=void 0,this._front=a+1&this._capacity-1,this._length--,b},e.prototype.length=function(){return this._length},e.prototype._checkCapacity=function(a){this._capacity<a&&this._resizeTo(this._capacity<<1)},e.prototype._resizeTo=function(a){var b=this._capacity;this._capacity=a;var c=this._front,e=this._length,f=c+e&b-1;d(this,0,this,b,f)},b.exports=e},{}],27:[function(a,b,c){b.exports=function(b,c,d,e){function f(a,f){var i=d(a);if(i instanceof b)return h(i);if(a=g.asArray(a),null===a)return e("expecting an array or an iterable object but got "+g.classString(a));var j=new b(c);void 0!==f&&j._propagateFrom(f,3);for(var k=j._fulfill,l=j._reject,m=0,n=a.length;n>m;++m){var o=a[m];(void 0!==o||m in a)&&b.cast(o)._then(k,l,void 0,j,null)}return j}var g=a("./util"),h=function(a){return a.then(function(b){return f(b,a)})};b.race=function(a){return f(a,void 0)},b.prototype.race=function(){return f(this,void 0)}}},{"./util":36}],28:[function(a,b,c){b.exports=function(b,c,d,e,f,g){function h(a,c,d,e){this.constructor$(a);var g=m();this._fn=null===g?c:n.domainBind(g,c),void 0!==d&&(d=b.resolve(d),d._attachCancellationCallback(this)),this._initialValue=d,this._currentCancellable=null,e===f?this._eachValues=Array(this._length):0===e?this._eachValues=null:this._eachValues=void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function i(a,b){this.isFulfilled()?b._resolve(a):b._reject(a)}function j(a,b,c,e){if("function"!=typeof b)return d("expecting a function but got "+n.classString(b));var f=new h(a,b,c,e);return f.promise()}function k(a){this.accum=a,this.array._gotAccum(a);var c=e(this.value,this.array._promise);return c instanceof b?(this.array._currentCancellable=c,c._then(l,void 0,void 0,this,void 0)):l.call(this,c)}function l(a){var c=this.array,d=c._promise,e=o(c._fn);d._pushContext();var f;f=void 0!==c._eachValues?e.call(d._boundValue(),a,this.index,this.length):e.call(d._boundValue(),this.accum,a,this.index,this.length),f instanceof b&&(c._currentCancellable=f);var h=d._popContext();return g.checkForgottenReturns(f,h,void 0!==c._eachValues?"Promise.each":"Promise.reduce",d),f}var m=b._getDomain,n=a("./util"),o=n.tryCatch;n.inherits(h,c),h.prototype._gotAccum=function(a){void 0!==this._eachValues&&null!==this._eachValues&&a!==f&&this._eachValues.push(a)},h.prototype._eachComplete=function(a){return null!==this._eachValues&&this._eachValues.push(a),this._eachValues},h.prototype._init=function(){},h.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},h.prototype.shouldCopyValues=function(){return!1},h.prototype._resolve=function(a){this._promise._resolveCallback(a),this._values=null},h.prototype._resultCancelled=function(a){return a===this._initialValue?this._cancel():void(this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof b&&this._currentCancellable.cancel(),this._initialValue instanceof b&&this._initialValue.cancel()))},h.prototype._iterate=function(a){this._values=a;var c,d,e=a.length;if(void 0!==this._initialValue?(c=this._initialValue,d=0):(c=b.resolve(a[0]),d=1),this._currentCancellable=c,!c.isRejected())for(;e>d;++d){var f={accum:null,value:a[d],index:d,length:e,array:this};c=c._then(k,void 0,void 0,f,void 0)}void 0!==this._eachValues&&(c=c._then(this._eachComplete,void 0,void 0,this,void 0)),c._then(i,i,void 0,c,this)},b.prototype.reduce=function(a,b){return j(this,a,b,null)},b.reduce=function(a,b,c,d){return j(a,b,c,d)}}},{"./util":36}],29:[function(a,b,c){var d,e=a("./util"),f=function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")},g=e.getNativePromise();if(e.isNode&&"undefined"==typeof MutationObserver){var h=global.setImmediate,i=process.nextTick;d=e.isRecentNode?function(a){h.call(global,a)}:function(a){i.call(process,a)}}else if("function"==typeof g&&"function"==typeof g.resolve){var j=g.resolve();d=function(a){j.then(a)}}else d="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)?"undefined"!=typeof setImmediate?function(a){setImmediate(a)}:"undefined"!=typeof setTimeout?function(a){setTimeout(a,0)}:f:function(){var a=document.createElement("div"),b={attributes:!0},c=!1,d=document.createElement("div"),e=new MutationObserver(function(){a.classList.toggle("foo"),c=!1});e.observe(d,b);var f=function(){c||(c=!0,d.classList.toggle("foo"))};return function(c){var d=new MutationObserver(function(){d.disconnect(),c()});d.observe(a,b),f()}}();b.exports=d},{"./util":36}],30:[function(a,b,c){b.exports=function(b,c,d){function e(a){this.constructor$(a)}var f=b.PromiseInspection,g=a("./util");g.inherits(e,c),e.prototype._promiseResolved=function(a,b){this._values[a]=b;var c=++this._totalResolved;return c>=this._length?(this._resolve(this._values),!0):!1},e.prototype._promiseFulfilled=function(a,b){var c=new f;return c._bitField=33554432,c._settledValueField=a,this._promiseResolved(b,c)},e.prototype._promiseRejected=function(a,b){var c=new f;return c._bitField=16777216,c._settledValueField=a,this._promiseResolved(b,c)},b.settle=function(a){return d.deprecated(".settle()",".reflect()"),new e(a).promise()},b.prototype.settle=function(){return b.settle(this);
}}},{"./util":36}],31:[function(a,b,c){b.exports=function(b,c,d){function e(a){this.constructor$(a),this._howMany=0,this._unwrap=!1,this._initialized=!1}function f(a,b){if((0|b)!==b||0>b)return d("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var c=new e(a),f=c.promise();return c.setHowMany(b),c.init(),f}var g=a("./util"),h=a("./errors").RangeError,i=a("./errors").AggregateError,j=g.isArray,k={};g.inherits(e,c),e.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var a=j(this._values);!this._isResolved()&&a&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},e.prototype.init=function(){this._initialized=!0,this._init()},e.prototype.setUnwrap=function(){this._unwrap=!0},e.prototype.howMany=function(){return this._howMany},e.prototype.setHowMany=function(a){this._howMany=a},e.prototype._promiseFulfilled=function(a){return this._addFulfilled(a),this._fulfilled()===this.howMany()?(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0):!1},e.prototype._promiseRejected=function(a){return this._addRejected(a),this._checkOutcome()},e.prototype._promiseCancelled=function(){return this._values instanceof b||null==this._values?this._cancel():(this._addRejected(k),this._checkOutcome())},e.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var a=new i,b=this.length();b<this._values.length;++b)this._values[b]!==k&&a.push(this._values[b]);return a.length>0?this._reject(a):this._cancel(),!0}return!1},e.prototype._fulfilled=function(){return this._totalResolved},e.prototype._rejected=function(){return this._values.length-this.length()},e.prototype._addRejected=function(a){this._values.push(a)},e.prototype._addFulfilled=function(a){this._values[this._totalResolved++]=a},e.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},e.prototype._getRangeError=function(a){var b="Input array must contain at least "+this._howMany+" items but contains only "+a+" items";return new h(b)},e.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},b.some=function(a,b){return f(a,b)},b.prototype.some=function(a){return f(this,a)},b._SomePromiseArray=e}},{"./errors":12,"./util":36}],32:[function(a,b,c){b.exports=function(a){function b(a){void 0!==a?(a=a._target(),this._bitField=a._bitField,this._settledValueField=a._isFateSealed()?a._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}b.prototype._settledValue=function(){return this._settledValueField};var c=b.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},d=b.prototype.error=b.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},e=b.prototype.isFulfilled=function(){return 0!==(33554432&this._bitField)},f=b.prototype.isRejected=function(){return 0!==(16777216&this._bitField)},g=b.prototype.isPending=function(){return 0===(50397184&this._bitField)},h=b.prototype.isResolved=function(){return 0!==(50331648&this._bitField)};b.prototype.isCancelled=function(){return 0!==(8454144&this._bitField)},a.prototype.__isCancelled=function(){return 65536===(65536&this._bitField)},a.prototype._isCancelled=function(){return this._target().__isCancelled()},a.prototype.isCancelled=function(){return 0!==(8454144&this._target()._bitField)},a.prototype.isPending=function(){return g.call(this._target())},a.prototype.isRejected=function(){return f.call(this._target())},a.prototype.isFulfilled=function(){return e.call(this._target())},a.prototype.isResolved=function(){return h.call(this._target())},a.prototype.value=function(){return c.call(this._target())},a.prototype.reason=function(){var a=this._target();return a._unsetRejectionIsUnhandled(),d.call(a)},a.prototype._value=function(){return this._settledValue()},a.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},a.PromiseInspection=b}},{}],33:[function(a,b,c){b.exports=function(b,c){function d(a,d){if(k(a)){if(a instanceof b)return a;var e=f(a);if(e===j){d&&d._pushContext();var i=b.reject(e.e);return d&&d._popContext(),i}if("function"==typeof e){if(g(a)){var i=new b(c);return a._then(i._fulfill,i._reject,void 0,i,null),i}return h(a,e,d)}}return a}function e(a){return a.then}function f(a){try{return e(a)}catch(b){return j.e=b,j}}function g(a){try{return l.call(a,"_promise0")}catch(b){return!1}}function h(a,d,e){function f(a){h&&(h._resolveCallback(a),h=null)}function g(a){h&&(h._rejectCallback(a,l,!0),h=null)}var h=new b(c),k=h;e&&e._pushContext(),h._captureStackTrace(),e&&e._popContext();var l=!0,m=i.tryCatch(d).call(a,f,g);return l=!1,h&&m===j&&(h._rejectCallback(m.e,!0,!0),h=null),k}var i=a("./util"),j=i.errorObj,k=i.isObject,l={}.hasOwnProperty;return d}},{"./util":36}],34:[function(a,b,c){b.exports=function(b,c,d){function e(a){this.handle=a}function f(a){return clearTimeout(this.handle),a}function g(a){throw clearTimeout(this.handle),a}var h=a("./util"),i=b.TimeoutError;e.prototype._resultCancelled=function(){clearTimeout(this.handle)};var j=function(a){return k(+this).thenReturn(a)},k=b.delay=function(a,f){var g,h;return void 0!==f?(g=b.resolve(f)._then(j,null,null,a,void 0),d.cancellation()&&f instanceof b&&g._setOnCancel(f)):(g=new b(c),h=setTimeout(function(){g._fulfill()},+a),d.cancellation()&&g._setOnCancel(new e(h)),g._captureStackTrace()),g._setAsyncGuaranteed(),g};b.prototype.delay=function(a){return k(a,this)};var l=function(a,b,c){var d;d="string"!=typeof b?b instanceof Error?b:new i("operation timed out"):new i(b),h.markAsOriginatingFromRejection(d),a._attachExtraTrace(d),a._reject(d),null!=c&&c.cancel()};b.prototype.timeout=function(a,b){a=+a;var c,h,i=new e(setTimeout(function(){c.isPending()&&l(c,b,h)},a));return d.cancellation()?(h=this.then(),c=h._then(f,g,void 0,i,void 0),c._setOnCancel(i)):c=this._then(f,g,void 0,i,void 0),c}}},{"./util":36}],35:[function(a,b,c){b.exports=function(b,c,d,e,f,g){function h(a){setTimeout(function(){throw a},0)}function i(a){var b=d(a);return b!==a&&"function"==typeof a._isDisposable&&"function"==typeof a._getDisposer&&a._isDisposable()&&b._setDisposable(a._getDisposer()),b}function j(a,c){function e(){if(g>=j)return k._fulfill();var f=i(a[g++]);if(f instanceof b&&f._isDisposable()){try{f=d(f._getDisposer().tryDispose(c),a.promise)}catch(l){return h(l)}if(f instanceof b)return f._then(e,h,null,null,null)}e()}var g=0,j=a.length,k=new b(f);return e(),k}function k(a,b,c){this._data=a,this._promise=b,this._context=c}function l(a,b,c){this.constructor$(a,b,c)}function m(a){return k.isDisposer(a)?(this.resources[this.index]._setDisposable(a),a.promise()):a}function n(a){this.length=a,this.promise=null,this[a-1]=null}var o=a("./util"),p=a("./errors").TypeError,q=a("./util").inherits,r=o.errorObj,s=o.tryCatch,t={};k.prototype.data=function(){return this._data},k.prototype.promise=function(){return this._promise},k.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():t},k.prototype.tryDispose=function(a){var b=this.resource(),c=this._context;void 0!==c&&c._pushContext();var d=b!==t?this.doDispose(b,a):null;return void 0!==c&&c._popContext(),this._promise._unsetDisposable(),this._data=null,d},k.isDisposer=function(a){return null!=a&&"function"==typeof a.resource&&"function"==typeof a.tryDispose},q(l,k),l.prototype.doDispose=function(a,b){var c=this.data();return c.call(a,a,b)},n.prototype._resultCancelled=function(){for(var a=this.length,c=0;a>c;++c){var d=this[c];d instanceof b&&d.cancel()}},b.using=function(){var a=arguments.length;if(2>a)return c("you must pass at least 2 arguments to Promise.using");var e=arguments[a-1];if("function"!=typeof e)return c("expecting a function but got "+o.classString(e));var f,h=!0;2===a&&Array.isArray(arguments[0])?(f=arguments[0],a=f.length,h=!1):(f=arguments,a--);for(var i=new n(a),l=0;a>l;++l){var p=f[l];if(k.isDisposer(p)){var q=p;p=p.promise(),p._setDisposable(q)}else{var t=d(p);t instanceof b&&(p=t._then(m,null,null,{resources:i,index:l},void 0))}i[l]=p}for(var u=new Array(i.length),l=0;l<u.length;++l)u[l]=b.resolve(i[l]).reflect();var v=b.all(u).then(function(a){for(var b=0;b<a.length;++b){var c=a[b];if(c.isRejected())return r.e=c.error(),r;if(!c.isFulfilled())return void v.cancel();a[b]=c.value()}w._pushContext(),e=s(e);var d=h?e.apply(void 0,a):e(a),f=w._popContext();return g.checkForgottenReturns(d,f,"Promise.using",w),d}),w=v.lastly(function(){var a=new b.PromiseInspection(v);return j(i,a)});return i.promise=w,w._setOnCancel(i),w},b.prototype._setDisposable=function(a){this._bitField=131072|this._bitField,this._disposer=a},b.prototype._isDisposable=function(){return(131072&this._bitField)>0},b.prototype._getDisposer=function(){return this._disposer},b.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},b.prototype.disposer=function(a){if("function"==typeof a)return new l(a,this,e());throw new p}}},{"./errors":12,"./util":36}],36:[function(a,b,c){function d(){try{var a=D;return D=null,a.apply(this,arguments)}catch(b){return C.e=b,C}}function e(a){return D=a,d}function f(a){return null==a||a===!0||a===!1||"string"==typeof a||"number"==typeof a}function g(a){return"function"==typeof a||"object"==typeof a&&null!==a}function h(a){return f(a)?new Error(q(a)):a}function i(a,b){var c,d=a.length,e=new Array(d+1);for(c=0;d>c;++c)e[c]=a[c];return e[c]=b,e}function j(a,b,c){if(!A.isES5)return{}.hasOwnProperty.call(a,b)?a[b]:void 0;var d=Object.getOwnPropertyDescriptor(a,b);return null!=d?null==d.get&&null==d.set?d.value:c:void 0}function k(a,b,c){if(f(a))return a;var d={value:c,configurable:!0,enumerable:!1,writable:!0};return A.defineProperty(a,b,d),a}function l(a){throw a}function m(a){try{if("function"==typeof a){var b=A.names(a.prototype),c=A.isES5&&b.length>1,d=b.length>0&&!(1===b.length&&"constructor"===b[0]),e=H.test(a+"")&&A.names(a).length>0;if(c||d||e)return!0}return!1}catch(f){return!1}}function n(a){function b(){}function c(){return typeof d.foo}b.prototype=a;var d=new b;return c(),c(),a}function o(a){return I.test(a)}function p(a,b,c){for(var d=new Array(a),e=0;a>e;++e)d[e]=b+e+c;return d}function q(a){try{return a+""}catch(b){return"[no string representation]"}}function r(a){return a instanceof Error||null!==a&&"object"==typeof a&&"string"==typeof a.message&&"string"==typeof a.name}function s(a){try{k(a,"isOperational",!0)}catch(b){}}function t(a){return null==a?!1:a instanceof Error.__BluebirdErrorTypes__.OperationalError||a.isOperational===!0}function u(a){return r(a)&&A.propertyIsWritable(a,"stack")}function v(a){return{}.toString.call(a)}function w(a,b,c){for(var d=A.names(a),e=0;e<d.length;++e){var f=d[e];if(c(f))try{A.defineProperty(b,f,A.getDescriptor(a,f))}catch(g){}}}function x(a){return N?process.env[a]:void 0}function y(){if("function"==typeof Promise)try{var a=new Promise(function(){});if("[object Promise]"==={}.toString.call(a))return Promise}catch(b){}}function z(a,b){return a.bind(b)}var A=a("./es5"),B="undefined"==typeof navigator,C={e:{}},D,E="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:void 0!==this?this:null,F=function(a,b){function c(){this.constructor=a,this.constructor$=b;for(var c in b.prototype)d.call(b.prototype,c)&&"$"!==c.charAt(c.length-1)&&(this[c+"$"]=b.prototype[c])}var d={}.hasOwnProperty;return c.prototype=b.prototype,a.prototype=new c,a.prototype},G=function(){var a=[Array.prototype,Object.prototype,Function.prototype],b=function(b){for(var c=0;c<a.length;++c)if(a[c]===b)return!0;return!1};if(A.isES5){var c=Object.getOwnPropertyNames;return function(a){for(var d=[],e=Object.create(null);null!=a&&!b(a);){var f;try{f=c(a)}catch(g){return d}for(var h=0;h<f.length;++h){var i=f[h];if(!e[i]){e[i]=!0;var j=Object.getOwnPropertyDescriptor(a,i);null!=j&&null==j.get&&null==j.set&&d.push(i)}}a=A.getPrototypeOf(a)}return d}}var d={}.hasOwnProperty;return function(c){if(b(c))return[];var e=[];a:for(var f in c)if(d.call(c,f))e.push(f);else{for(var g=0;g<a.length;++g)if(d.call(a[g],f))continue a;e.push(f)}return e}}(),H=/this\s*\.\s*\S+\s*=/,I=/^[a-z$_][a-z$_0-9]*$/i,J=function(){return"stack"in new Error?function(a){return u(a)?a:new Error(q(a))}:function(a){if(u(a))return a;try{throw new Error(q(a))}catch(b){return b}}}(),K=function(a){return A.isArray(a)?a:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var L="function"==typeof Array.from?function(a){return Array.from(a)}:function(a){for(var b,c=[],d=a[Symbol.iterator]();!(b=d.next()).done;)c.push(b.value);return c};K=function(a){return A.isArray(a)?a:null!=a&&"function"==typeof a[Symbol.iterator]?L(a):null}}var M="undefined"!=typeof process&&"[object process]"===v(process).toLowerCase(),N="undefined"!=typeof process&&"undefined"!=typeof process.env,O={isClass:m,isIdentifier:o,inheritedDataKeys:G,getDataPropertyOrDefault:j,thrower:l,isArray:A.isArray,asArray:K,notEnumerableProp:k,isPrimitive:f,isObject:g,isError:r,canEvaluate:B,errorObj:C,tryCatch:e,inherits:F,withAppended:i,maybeWrapAsError:h,toFastProperties:n,filledRange:p,toString:q,canAttachTrace:u,ensureErrorObject:J,originatesFromRejection:t,markAsOriginatingFromRejection:s,classString:v,copyDescriptors:w,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:M,hasEnvVariables:N,env:x,global:E,getNativePromise:y,domainBind:z};O.isRecentNode=O.isNode&&function(){var a=process.versions.node.split(".").map(Number);return 0===a[0]&&a[1]>10||a[0]>0}(),O.isNode&&O.toFastProperties(process);try{throw new Error}catch(P){O.lastLineError=P}b.exports=O},{"./es5":13}]},{},[4])(4)}),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise);var JSON;JSON||(JSON={}),function(){function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function f(a){return 10>a?"0"+a:a}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,!b||"function"==typeof b||"object"==typeof b&&"number"==typeof b.length)return str("",{"":a});throw new Error("JSON.stringify")}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),SockJS=function(){var a=document,b=window,c={},d=function(){};d.prototype.addEventListener=function(a,b){this._listeners||(this._listeners={}),a in this._listeners||(this._listeners[a]=[]);var d=this._listeners[a];-1===c.arrIndexOf(d,b)&&d.push(b)},d.prototype.removeEventListener=function(a,b){if(this._listeners&&a in this._listeners){var d=this._listeners[a],e=c.arrIndexOf(d,b);return-1!==e?void(d.length>1?this._listeners[a]=d.slice(0,e).concat(d.slice(e+1)):delete this._listeners[a]):void 0}},d.prototype.dispatchEvent=function(a){var b=a.type,c=Array.prototype.slice.call(arguments,0);if(this["on"+b]&&this["on"+b].apply(this,c),this._listeners&&b in this._listeners)for(var d=0;d<this._listeners[b].length;d++)this._listeners[b][d].apply(this,c)};var e=function(a,b){if(this.type=a,"undefined"!=typeof b)for(var c in b)b.hasOwnProperty(c)&&(this[c]=b[c])};e.prototype.toString=function(){var a=[];for(var b in this)if(this.hasOwnProperty(b)){var c=this[b];"function"==typeof c&&(c="[function]"),a.push(b+"="+c)}return"SimpleEvent("+a.join(", ")+")"};var f=function(a){var b=this;b._events=a||[],b._listeners={}};f.prototype.emit=function(a){var b=this;if(b._verifyType(a),!b._nuked){var c=Array.prototype.slice.call(arguments,1);if(b["on"+a]&&b["on"+a].apply(b,c),a in b._listeners)for(var d=0;d<b._listeners[a].length;d++)b._listeners[a][d].apply(b,c)}},f.prototype.on=function(a,b){var c=this;c._verifyType(a),c._nuked||(a in c._listeners||(c._listeners[a]=[]),c._listeners[a].push(b))},f.prototype._verifyType=function(a){var b=this;-1===c.arrIndexOf(b._events,a)&&c.log("Event "+JSON.stringify(a)+" not listed "+JSON.stringify(b._events)+" in "+b)},f.prototype.nuke=function(){var a=this;a._nuked=!0;for(var b=0;b<a._events.length;b++)delete a[a._events[b]];a._listeners={}};var g="abcdefghijklmnopqrstuvwxyz0123456789_";c.random_string=function(a,b){b=b||g.length;var c,d=[];for(c=0;a>c;c++)d.push(g.substr(Math.floor(Math.random()*b),1));return d.join("")},c.random_number=function(a){return Math.floor(Math.random()*a)},c.random_number_string=function(a){var b=(""+(a-1)).length,d=Array(b+1).join("0");return(d+c.random_number(a)).slice(-b)},c.getOrigin=function(a){a+="/";var b=a.split("/").slice(0,3);return b.join("/")},c.isSameOriginUrl=function(a,c){return c||(c=b.location.href),a.split("/").slice(0,3).join("/")===c.split("/").slice(0,3).join("/")},c.getParentDomain=function(a){if(/^[0-9.]*$/.test(a))return a;if(/^\[/.test(a))return a;if(!/[.]/.test(a))return a;var b=a.split(".").slice(1);return b.join(".")},c.objectExtend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a};var h="_jp";c.polluteGlobalNamespace=function(){h in b||(b[h]={})},c.closeFrame=function(a,b){return"c"+JSON.stringify([a,b])},c.userSetCode=function(a){return 1e3===a||a>=3e3&&4999>=a},c.countRTO=function(a){var b;return b=a>100?3*a:a+200},c.log=function(){b.console&&console.log&&console.log.apply&&void 0},c.bind=function(a,b){return a.bind?a.bind(b):function(){return a.apply(b,arguments)}},c.flatUrl=function(a){return-1===a.indexOf("?")&&-1===a.indexOf("#")},c.amendUrl=function(b){var d=a.location;if(!b)throw new Error("Wrong url for SockJS");if(!c.flatUrl(b))throw new Error("Only basic urls are supported in SockJS");return 0===b.indexOf("//")&&(b=d.protocol+b),0===b.indexOf("/")&&(b=d.protocol+"//"+d.host+b),b=b.replace(/[\/]+$/,"")},c.arrIndexOf=function(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return c;return-1},c.arrSkip=function(a,b){var d=c.arrIndexOf(a,b);if(-1===d)return a.slice();var e=a.slice(0,d);return e.concat(a.slice(d+1))},c.isArray=Array.isArray||function(a){return{}.toString.call(a).indexOf("Array")>=0},c.delay=function(a,b){return"function"==typeof a&&(b=a,a=0),setTimeout(b,a)};var i,j=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,k={"\x00":"\\u0000","":"\\u0001","":"\\u0002","":"\\u0003","":"\\u0004","":"\\u0005","":"\\u0006","":"\\u0007","\b":"\\b","	":"\\t","\n":"\\n","":"\\u000b","\f":"\\f","\r":"\\r","":"\\u000e","":"\\u000f","":"\\u0010","":"\\u0011","":"\\u0012","":"\\u0013","":"\\u0014","":"\\u0015","":"\\u0016","":"\\u0017","":"\\u0018","":"\\u0019","":"\\u001a","":"\\u001b","":"\\u001c","":"\\u001d","":"\\u001e","":"\\u001f",'"':'\\"',"\\":"\\\\","":"\\u007f","Â":"\\u0080","Â":"\\u0081","Â":"\\u0082","Â":"\\u0083","Â":"\\u0084","Â":"\\u0085","Â":"\\u0086","Â":"\\u0087","Â":"\\u0088","Â":"\\u0089","Â":"\\u008a","Â":"\\u008b","Â":"\\u008c","Â":"\\u008d","Â":"\\u008e","Â":"\\u008f","Â":"\\u0090","Â":"\\u0091","Â":"\\u0092","Â":"\\u0093","Â":"\\u0094","Â":"\\u0095","Â":"\\u0096","Â":"\\u0097","Â":"\\u0098","Â":"\\u0099","Â":"\\u009a","Â":"\\u009b","Â":"\\u009c","Â":"\\u009d","Â":"\\u009e","Â":"\\u009f","Â­":"\\u00ad","Ø":"\\u0600","Ø":"\\u0601","Ø":"\\u0602","Ø":"\\u0603","Ø":"\\u0604","Ü":"\\u070f","á´":"\\u17b4","áµ":"\\u17b5","â":"\\u200c","â":"\\u200d","â":"\\u200e","â":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","âª":"\\u202a","â«":"\\u202b","â¬":"\\u202c","â­":"\\u202d","â®":"\\u202e","â¯":"\\u202f","â ":"\\u2060","â¡":"\\u2061","â¢":"\\u2062","â£":"\\u2063","â¤":"\\u2064","â¥":"\\u2065","â¦":"\\u2066","â§":"\\u2067","â¨":"\\u2068","â©":"\\u2069","âª":"\\u206a","â«":"\\u206b","â¬":"\\u206c","â­":"\\u206d","â®":"\\u206e","â¯":"\\u206f","\ufeff":"\\ufeff","ï¿°":"\\ufff0","ï¿±":"\\ufff1","ï¿²":"\\ufff2","ï¿³":"\\ufff3","ï¿´":"\\ufff4","ï¿µ":"\\ufff5","ï¿¶":"\\ufff6","ï¿·":"\\ufff7","ï¿¸":"\\ufff8","ï¿¹":"\\ufff9","ï¿º":"\\ufffa","ï¿»":"\\ufffb","ï¿¼":"\\ufffc","ï¿½":"\\ufffd","ï¿¾":"\\ufffe","ï¿¿":"\\uffff"},l=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,m=JSON&&JSON.stringify||function(a){return j.lastIndex=0,j.test(a)&&(a=a.replace(j,function(a){return k[a]})),'"'+a+'"'},n=function(a){var b,c={},d=[];for(b=0;65536>b;b++)d.push(String.fromCharCode(b));return a.lastIndex=0,d.join("").replace(a,function(a){return c[a]="\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4),""}),a.lastIndex=0,c};c.quote=function(a){var b=m(a);return l.lastIndex=0,l.test(b)?(i||(i=n(l)),b.replace(l,function(a){return i[a]})):b};var o=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];c.probeProtocols=function(){for(var a={},b=0;b<o.length;b++){var c=o[b];a[c]=y[c]&&y[c].enabled()}return a},c.detectProtocols=function(a,b,c){var d={},e=[];b||(b=o);for(var f=0;f<b.length;f++){var g=b[f];d[g]=a[g]}var h=function(a){var b=a.shift();d[b]?e.push(b):a.length>0&&h(a)};return c.websocket!==!1&&h(["websocket"]),d["xhr-streaming"]&&!c.null_origin?e.push("xhr-streaming"):!d["xdr-streaming"]||c.cookie_needed||c.null_origin?h(["iframe-eventsource","iframe-htmlfile"]):e.push("xdr-streaming"),d["xhr-polling"]&&!c.null_origin?e.push("xhr-polling"):!d["xdr-polling"]||c.cookie_needed||c.null_origin?h(["iframe-xhr-polling","jsonp-polling"]):e.push("xdr-polling"),e};var p="_sockjs_global";c.createHook=function(){var a="a"+c.random_string(8);if(!(p in b)){var d={};b[p]=function(a){return a in d||(d[a]={id:a,del:function(){delete d[a]}}),d[a]}}return b[p](a)},c.attachMessage=function(a){c.attachEvent("message",a)},c.attachEvent=function(c,d){"undefined"!=typeof b.addEventListener?b.addEventListener(c,d,!1):(a.attachEvent("on"+c,d),b.attachEvent("on"+c,d))},c.detachMessage=function(a){c.detachEvent("message",a)},c.detachEvent=function(c,d){"undefined"!=typeof b.addEventListener?b.removeEventListener(c,d,!1):(a.detachEvent("on"+c,d),b.detachEvent("on"+c,d))};var q={},r=!1,s=function(){for(var a in q)q[a](),delete q[a]},t=function(){r||(r=!0,s())};c.attachEvent("unload",t),c.unload_add=function(a){var b=c.random_string(8);return q[b]=a,r&&c.delay(s),b},c.unload_del=function(a){a in q&&delete q[a]},c.createIframe=function(b,d){var e,f,g=a.createElement("iframe"),h=function(){clearTimeout(e);try{g.onload=null}catch(a){}g.onerror=null},i=function(){g&&(h(),setTimeout(function(){g&&g.parentNode.removeChild(g),g=null},0),c.unload_del(f))},j=function(a){g&&(i(),d(a))},k=function(a,b){try{g&&g.contentWindow&&g.contentWindow.postMessage(a,b)}catch(c){}};return g.src=b,g.style.display="none",g.style.position="absolute",g.onerror=function(){j("onerror")},g.onload=function(){clearTimeout(e),e=setTimeout(function(){j("onload timeout")},2e3)},a.body.appendChild(g),e=setTimeout(function(){j("timeout")},15e3),f=c.unload_add(i),{post:k,cleanup:i,loaded:h}},c.createHtmlfile=function(a,d){var e,f,g,i=new ActiveXObject("htmlfile"),j=function(){clearTimeout(e)},k=function(){i&&(j(),c.unload_del(f),g.parentNode.removeChild(g),g=i=null,CollectGarbage())},l=function(a){i&&(k(),d(a))},m=function(a,b){try{g&&g.contentWindow&&g.contentWindow.postMessage(a,b)}catch(c){}};i.open(),i.write('<html><script>document.domain="'+document.domain+'";</script></html>'),i.close(),i.parentWindow[h]=b[h];var n=i.createElement("div");return i.body.appendChild(n),g=i.createElement("iframe"),n.appendChild(g),g.src=a,e=setTimeout(function(){l("timeout")},15e3),f=c.unload_add(k),{post:m,cleanup:k,loaded:j}};var u=function(){};u.prototype=new f(["chunk","finish"]),u.prototype._start=function(a,d,e,f){var g=this;try{g.xhr=new XMLHttpRequest}catch(h){}if(!g.xhr)try{g.xhr=new b.ActiveXObject("Microsoft.XMLHTTP")}catch(h){}(b.ActiveXObject||b.XDomainRequest)&&(d+=(-1===d.indexOf("?")?"?":"&")+"t="+ +new Date),g.unload_ref=c.unload_add(function(){g._cleanup(!0)});try{g.xhr.open(a,d,!0)}catch(i){return g.emit("finish",0,""),void g._cleanup()}if(f&&f.no_credentials||(g.xhr.withCredentials="true"),f&&f.headers)for(var j in f.headers)g.xhr.setRequestHeader(j,f.headers[j]);g.xhr.onreadystatechange=function(){if(g.xhr){var a=g.xhr;switch(a.readyState){case 3:try{var b=a.status,c=a.responseText}catch(a){}1223===b&&(b=204),c&&c.length>0&&g.emit("chunk",b,c);break;case 4:var b=a.status;1223===b&&(b=204),g.emit("finish",b,a.responseText),g._cleanup(!1)}}},g.xhr.send(e)},u.prototype._cleanup=function(a){var b=this;if(b.xhr){if(c.unload_del(b.unload_ref),b.xhr.onreadystatechange=function(){},a)try{b.xhr.abort()}catch(d){}b.unload_ref=b.xhr=null}},u.prototype.close=function(){var a=this;a.nuke(),a._cleanup(!0)};var v=c.XHRCorsObject=function(){var a=this,b=arguments;c.delay(function(){a._start.apply(a,b)})};v.prototype=new u;var w=c.XHRLocalObject=function(a,b,d){var e=this;c.delay(function(){e._start(a,b,d,{no_credentials:!0})})};w.prototype=new u;var x=c.XDRObject=function(a,b,d){var e=this;c.delay(function(){e._start(a,b,d)})};x.prototype=new f(["chunk","finish"]),x.prototype._start=function(a,b,d){var e=this,f=new XDomainRequest;b+=(-1===b.indexOf("?")?"?":"&")+"t="+ +new Date;var g=f.ontimeout=f.onerror=function(){e.emit("finish",0,""),e._cleanup(!1)};f.onprogress=function(){e.emit("chunk",200,f.responseText)},f.onload=function(){e.emit("finish",200,f.responseText),e._cleanup(!1)},e.xdr=f,e.unload_ref=c.unload_add(function(){e._cleanup(!0)});try{e.xdr.open(a,b),e.xdr.send(d)}catch(h){g()}},x.prototype._cleanup=function(a){var b=this;if(b.xdr){if(c.unload_del(b.unload_ref),b.xdr.ontimeout=b.xdr.onerror=b.xdr.onprogress=b.xdr.onload=null,a)try{b.xdr.abort()}catch(d){}b.unload_ref=b.xdr=null}},x.prototype.close=function(){var a=this;a.nuke(),a._cleanup(!0)},c.isXHRCorsCapable=function(){return b.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:b.XDomainRequest&&a.domain?2:L.enabled()?3:4};var y=function(a,d,e){if(this===b)return new y(a,d,e);var f,g=this;g._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0},e&&c.objectExtend(g._options,e),g._base_url=c.amendUrl(a),g._server=g._options.server||c.random_number_string(1e3),g._options.protocols_whitelist&&g._options.protocols_whitelist.length?f=g._options.protocols_whitelist:(f="string"==typeof d&&d.length>0?[d]:c.isArray(d)?d:null,f&&g._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.')),g._protocols=[],g.protocol=null,g.readyState=y.CONNECTING,g._ir=S(g._base_url),g._ir.onfinish=function(a,b){g._ir=null,a?(g._options.info&&(a=c.objectExtend(a,g._options.info)),g._options.rtt&&(b=g._options.rtt),g._applyInfo(a,b,f),g._didClose()):g._didClose(1002,"Can't connect to server",!0)}};y.prototype=new d,y.version="0.3.4",y.CONNECTING=0,y.OPEN=1,y.CLOSING=2,y.CLOSED=3,y.prototype._debug=function(){this._options.debug&&c.log.apply(c,arguments)},y.prototype._dispatchOpen=function(){var a=this;a.readyState===y.CONNECTING?(a._transport_tref&&(clearTimeout(a._transport_tref),a._transport_tref=null),a.readyState=y.OPEN,a.dispatchEvent(new e("open"))):a._didClose(1006,"Server lost session")},y.prototype._dispatchMessage=function(a){var b=this;b.readyState===y.OPEN&&b.dispatchEvent(new e("message",{data:a}))},y.prototype._dispatchHeartbeat=function(a){var b=this;b.readyState===y.OPEN&&b.dispatchEvent(new e("heartbeat",{}))},y.prototype._didClose=function(a,b,d){var f=this;if(f.readyState!==y.CONNECTING&&f.readyState!==y.OPEN&&f.readyState!==y.CLOSING)throw new Error("INVALID_STATE_ERR");f._ir&&(f._ir.nuke(),f._ir=null),f._transport&&(f._transport.doCleanup(),f._transport=null);var g=new e("close",{code:a,reason:b,wasClean:c.userSetCode(a)});if(!c.userSetCode(a)&&f.readyState===y.CONNECTING&&!d){if(f._try_next_protocol(g))return;g=new e("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:g})}f.readyState=y.CLOSED,c.delay(function(){f.dispatchEvent(g)})},y.prototype._didMessage=function(a){var b=this,c=a.slice(0,1);switch(c){case"o":b._dispatchOpen();break;case"a":for(var d=JSON.parse(a.slice(1)||"[]"),e=0;e<d.length;e++)b._dispatchMessage(d[e]);break;case"m":var d=JSON.parse(a.slice(1)||"null");b._dispatchMessage(d);break;case"c":var d=JSON.parse(a.slice(1)||"[]");b._didClose(d[0],d[1]);break;case"h":b._dispatchHeartbeat()}},y.prototype._try_next_protocol=function(b){var d=this;for(d.protocol&&(d._debug("Closed transport:",d.protocol,""+b),d.protocol=null),d._transport_tref&&(clearTimeout(d._transport_tref),
d._transport_tref=null);;){var e=d.protocol=d._protocols.shift();if(!e)return!1;if(y[e]&&y[e].need_body===!0&&(!a.body||"undefined"!=typeof a.readyState&&"complete"!==a.readyState))return d._protocols.unshift(e),d.protocol="waiting-for-load",c.attachEvent("load",function(){d._try_next_protocol()}),!0;if(y[e]&&y[e].enabled(d._options)){var f=y[e].roundTrips||1,g=(d._options.rto||0)*f||5e3;d._transport_tref=c.delay(g,function(){d.readyState===y.CONNECTING&&d._didClose(2007,"Transport timeouted")});var h=c.random_string(8),i=d._base_url+"/"+d._server+"/"+h;return d._debug("Opening transport:",e," url:"+i," RTO:"+d._options.rto),d._transport=new y[e](d,i,d._base_url),!0}d._debug("Skipping transport:",e)}},y.prototype.close=function(a,b){var d=this;if(a&&!c.userSetCode(a))throw new Error("INVALID_ACCESS_ERR");return d.readyState!==y.CONNECTING&&d.readyState!==y.OPEN?!1:(d.readyState=y.CLOSING,d._didClose(a||1e3,b||"Normal closure"),!0)},y.prototype.send=function(a){var b=this;if(b.readyState===y.CONNECTING)throw new Error("INVALID_STATE_ERR");return b.readyState===y.OPEN&&b._transport.doSend(c.quote(""+a)),!0},y.prototype._applyInfo=function(b,d,e){var f=this;f._options.info=b,f._options.rtt=d,f._options.rto=c.countRTO(d),f._options.info.null_origin=!a.domain;var g=c.probeProtocols();f._protocols=c.detectProtocols(g,e,b)};var z=y.websocket=function(a,d){var e=this,f=d+"/websocket";f="https"===f.slice(0,5)?"wss"+f.slice(5):"ws"+f.slice(4),e.ri=a,e.url=f;var g=b.WebSocket||b.MozWebSocket;e.ws=new g(e.url),e.ws.onmessage=function(a){e.ri._didMessage(a.data)},e.unload_ref=c.unload_add(function(){e.ws.close()}),e.ws.onclose=function(){e.ri._didMessage(c.closeFrame(1006,"WebSocket connection broken"))}};z.prototype.doSend=function(a){this.ws.send("["+a+"]")},z.prototype.doCleanup=function(){var a=this,b=a.ws;b&&(b.onmessage=b.onclose=null,b.close(),c.unload_del(a.unload_ref),a.unload_ref=a.ri=a.ws=null)},z.enabled=function(){return!!b.WebSocket||!!b.MozWebSocket},z.roundTrips=2;var A=function(){};A.prototype.send_constructor=function(a){var b=this;b.send_buffer=[],b.sender=a},A.prototype.doSend=function(a){var b=this;b.send_buffer.push(a),b.send_stop||b.send_schedule()},A.prototype.send_schedule_wait=function(){var a,b=this;b.send_stop=function(){b.send_stop=null,clearTimeout(a)},a=c.delay(25,function(){b.send_stop=null,b.send_schedule()})},A.prototype.send_schedule=function(){var a=this;if(a.send_buffer.length>0){var b="["+a.send_buffer.join(",")+"]";a.send_stop=a.sender(a.trans_url,b,function(b,c){a.send_stop=null,b===!1?a.ri._didClose(1006,"Sending error "+c):a.send_schedule_wait()}),a.send_buffer=[]}},A.prototype.send_destructor=function(){var a=this;a._send_stop&&a._send_stop(),a._send_stop=null};var B=function(b,d,e){var f=this;if(!("_send_form"in f)){var g=f._send_form=a.createElement("form"),h=f._send_area=a.createElement("textarea");h.name="d",g.style.display="none",g.style.position="absolute",g.method="POST",g.enctype="application/x-www-form-urlencoded",g.acceptCharset="UTF-8",g.appendChild(h),a.body.appendChild(g)}var g=f._send_form,h=f._send_area,i="a"+c.random_string(8);g.target=i,g.action=b+"/jsonp_send?i="+i;var j;try{j=a.createElement('<iframe name="'+i+'">')}catch(k){j=a.createElement("iframe"),j.name=i}j.id=i,g.appendChild(j),j.style.display="none";try{h.value=d}catch(l){c.log("Your browser is seriously broken. Go home! "+l.message)}g.submit();var m=function(a){j.onerror&&(j.onreadystatechange=j.onerror=j.onload=null,c.delay(500,function(){j.parentNode.removeChild(j),j=null}),h.value="",e(!0))};return j.onerror=j.onload=m,j.onreadystatechange=function(a){"complete"==j.readyState&&m()},m},C=function(a){return function(b,c,d){var e=new a("POST",b+"/xhr_send",c);return e.onfinish=function(a,b){d(200===a||204===a,"http status "+a)},function(a){d(!1,a)}}},D=function(b,d){var e,f,g=a.createElement("script"),h=function(a){f&&(f.parentNode.removeChild(f),f=null),g&&(clearTimeout(e),g.parentNode.removeChild(g),g.onreadystatechange=g.onerror=g.onload=g.onclick=null,g=null,d(a),d=null)},i=!1,j=null;if(g.id="a"+c.random_string(8),g.src=b,g.type="text/javascript",g.charset="UTF-8",g.onerror=function(a){j||(j=setTimeout(function(){i||h(c.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3))},g.onload=function(a){h(c.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},g.onreadystatechange=function(a){if(/loaded|closed/.test(g.readyState)){if(g&&g.htmlFor&&g.onclick){i=!0;try{g.onclick()}catch(b){}}g&&h(c.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}},"undefined"==typeof g.async&&a.attachEvent)if(/opera/i.test(navigator.userAgent))f=a.createElement("script"),f.text="try{var a = document.getElementById('"+g.id+"'); if(a)a.onerror();}catch(x){};",g.async=f.async=!1;else{try{g.htmlFor=g.id,g.event="onclick"}catch(k){}g.async=!0}"undefined"!=typeof g.async&&(g.async=!0),e=setTimeout(function(){h(c.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var l=a.getElementsByTagName("head")[0];return l.insertBefore(g,l.firstChild),f&&l.insertBefore(f,l.firstChild),h},E=y["jsonp-polling"]=function(a,b){c.polluteGlobalNamespace();var d=this;d.ri=a,d.trans_url=b,d.send_constructor(B),d._schedule_recv()};E.prototype=new A,E.prototype._schedule_recv=function(){var a=this,b=function(b){a._recv_stop=null,b&&(a._is_closing||a.ri._didMessage(b)),a._is_closing||a._schedule_recv()};a._recv_stop=F(a.trans_url+"/jsonp",D,b)},E.enabled=function(){return!0},E.need_body=!0,E.prototype.doCleanup=function(){var a=this;a._is_closing=!0,a._recv_stop&&a._recv_stop(),a.ri=a._recv_stop=null,a.send_destructor()};var F=function(a,d,e){var f="a"+c.random_string(6),g=a+"?c="+escape(h+"."+f),i=0,j=function(a){switch(i){case 0:delete b[h][f],e(a);break;case 1:e(a),i=2;break;case 2:delete b[h][f]}},k=d(g,j);b[h][f]=k;var l=function(){b[h][f]&&(i=1,b[h][f](c.closeFrame(1e3,"JSONP user aborted read")))};return l},G=function(){};G.prototype=new A,G.prototype.run=function(a,b,c,d,e){var f=this;f.ri=a,f.trans_url=b,f.send_constructor(C(e)),f.poll=new $(a,d,b+c,e)},G.prototype.doCleanup=function(){var a=this;a.poll&&(a.poll.abort(),a.poll=null)};var H=y["xhr-streaming"]=function(a,b){this.run(a,b,"/xhr_streaming",da,c.XHRCorsObject)};H.prototype=new G,H.enabled=function(){return b.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},H.roundTrips=2,H.need_body=!0;var I=y["xdr-streaming"]=function(a,b){this.run(a,b,"/xhr_streaming",da,c.XDRObject)};I.prototype=new G,I.enabled=function(){return!!b.XDomainRequest},I.roundTrips=2;var J=y["xhr-polling"]=function(a,b){this.run(a,b,"/xhr",da,c.XHRCorsObject)};J.prototype=new G,J.enabled=H.enabled,J.roundTrips=2;var K=y["xdr-polling"]=function(a,b){this.run(a,b,"/xhr",da,c.XDRObject)};K.prototype=new G,K.enabled=I.enabled,K.roundTrips=2;var L=function(){};L.prototype.i_constructor=function(a,b,d){var e=this;e.ri=a,e.origin=c.getOrigin(d),e.base_url=d,e.trans_url=b;var f=d+"/iframe.html";e.ri._options.devel&&(f+="?t="+ +new Date),e.window_id=c.random_string(8),f+="#"+e.window_id,e.iframeObj=c.createIframe(f,function(a){e.ri._didClose(1006,"Unable to load an iframe ("+a+")")}),e.onmessage_cb=c.bind(e.onmessage,e),c.attachMessage(e.onmessage_cb)},L.prototype.doCleanup=function(){var a=this;if(a.iframeObj){c.detachMessage(a.onmessage_cb);try{a.iframeObj.iframe.contentWindow&&a.postMessage("c")}catch(b){}a.iframeObj.cleanup(),a.iframeObj=null,a.onmessage_cb=a.iframeObj=null}},L.prototype.onmessage=function(a){var b=this;if(a.origin===b.origin){var c=a.data.slice(0,8),d=a.data.slice(8,9),e=a.data.slice(9);if(c===b.window_id)switch(d){case"s":b.iframeObj.loaded(),b.postMessage("s",JSON.stringify([y.version,b.protocol,b.trans_url,b.base_url]));break;case"t":b.ri._didMessage(e)}}},L.prototype.postMessage=function(a,b){var c=this;c.iframeObj.post(c.window_id+a+(b||""),c.origin)},L.prototype.doSend=function(a){this.postMessage("m",a)},L.enabled=function(){var a=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof b.postMessage||"object"==typeof b.postMessage)&&!a};var M,N=function(a,d){parent!==b?parent.postMessage(M+a+(d||""),"*"):c.log("Can't postMessage, no parent window.",a,d)},O=function(){};O.prototype._didClose=function(a,b){N("t",c.closeFrame(a,b))},O.prototype._didMessage=function(a){N("t",a)},O.prototype._doSend=function(a){this._transport.doSend(a)},O.prototype._doCleanup=function(){this._transport.doCleanup()},c.parent_origin=void 0,y.bootstrap_iframe=function(){var d;M=a.location.hash.slice(1);var e=function(a){if(a.source===parent&&("undefined"==typeof c.parent_origin&&(c.parent_origin=a.origin),a.origin===c.parent_origin)){var e=a.data.slice(0,8),f=a.data.slice(8,9),g=a.data.slice(9);if(e===M)switch(f){case"s":var h=JSON.parse(g),i=h[0],j=h[1],k=h[2],l=h[3];if(i!==y.version&&c.log('Incompatibile SockJS! Main site uses: "'+i+'", the iframe: "'+y.version+'".'),!c.flatUrl(k)||!c.flatUrl(l))return void c.log("Only basic urls are supported in SockJS");if(!c.isSameOriginUrl(k)||!c.isSameOriginUrl(l))return void c.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([b.location.href,k,l])+")");d=new O,d._transport=new O[j](d,k,l);break;case"m":d._doSend(g);break;case"c":d&&d._doCleanup(),d=null}}};c.attachMessage(e),N("s")};var P=function(a,b){var d=this;c.delay(function(){d.doXhr(a,b)})};P.prototype=new f(["finish"]),P.prototype.doXhr=function(a,b){var d=this,e=(new Date).getTime(),f=new b("GET",a+"/info"),g=c.delay(8e3,function(){f.ontimeout()});f.onfinish=function(a,b){if(clearTimeout(g),g=null,200===a){var c=(new Date).getTime()-e,f=JSON.parse(b);"object"!=typeof f&&(f={}),d.emit("finish",f,c)}else d.emit("finish")},f.ontimeout=function(){f.close(),d.emit("finish")}};var Q=function(b){var d=this,e=function(){var a=new L;a.protocol="w-iframe-info-receiver";var c=function(b){if("string"==typeof b&&"m"===b.substr(0,1)){var c=JSON.parse(b.substr(1)),e=c[0],f=c[1];d.emit("finish",e,f)}else d.emit("finish");a.doCleanup(),a=null},e={_options:{},_didClose:c,_didMessage:c};a.i_constructor(e,b,b)};a.body?e():c.attachEvent("load",e)};Q.prototype=new f(["finish"]);var R=function(){var a=this;c.delay(function(){a.emit("finish",{},2e3)})};R.prototype=new f(["finish"]);var S=function(a){if(c.isSameOriginUrl(a))return new P(a,c.XHRLocalObject);switch(c.isXHRCorsCapable()){case 1:return new P(a,c.XHRLocalObject);case 2:return new P(a,c.XDRObject);case 3:return new Q(a);default:return new R}},T=O["w-iframe-info-receiver"]=function(a,b,d){var e=new P(d,c.XHRLocalObject);e.onfinish=function(b,c){a._didMessage("m"+JSON.stringify([b,c])),a._didClose()}};T.prototype.doCleanup=function(){};var U=y["iframe-eventsource"]=function(){var a=this;a.protocol="w-iframe-eventsource",a.i_constructor.apply(a,arguments)};U.prototype=new L,U.enabled=function(){return"EventSource"in b&&L.enabled()},U.need_body=!0,U.roundTrips=3;var V=O["w-iframe-eventsource"]=function(a,b){this.run(a,b,"/eventsource",_,c.XHRLocalObject)};V.prototype=new G;var W=y["iframe-xhr-polling"]=function(){var a=this;a.protocol="w-iframe-xhr-polling",a.i_constructor.apply(a,arguments)};W.prototype=new L,W.enabled=function(){return b.XMLHttpRequest&&L.enabled()},W.need_body=!0,W.roundTrips=3;var X=O["w-iframe-xhr-polling"]=function(a,b){this.run(a,b,"/xhr",da,c.XHRLocalObject)};X.prototype=new G;var Y=y["iframe-htmlfile"]=function(){var a=this;a.protocol="w-iframe-htmlfile",a.i_constructor.apply(a,arguments)};Y.prototype=new L,Y.enabled=function(){return L.enabled()},Y.need_body=!0,Y.roundTrips=3;var Z=O["w-iframe-htmlfile"]=function(a,b){this.run(a,b,"/htmlfile",ca,c.XHRLocalObject)};Z.prototype=new G;var $=function(a,b,c,d){var e=this;e.ri=a,e.Receiver=b,e.recv_url=c,e.AjaxObject=d,e._scheduleRecv()};$.prototype._scheduleRecv=function(){var a=this,b=a.poll=new a.Receiver(a.recv_url,a.AjaxObject),c=0;b.onmessage=function(b){c+=1,a.ri._didMessage(b.data)},b.onclose=function(c){a.poll=b=b.onmessage=b.onclose=null,a.poll_is_closing||("permanent"===c.reason?a.ri._didClose(1006,"Polling error ("+c.reason+")"):a._scheduleRecv())}},$.prototype.abort=function(){var a=this;a.poll_is_closing=!0,a.poll&&a.poll.abort()};var _=function(a){var b=this,d=new EventSource(a);d.onmessage=function(a){b.dispatchEvent(new e("message",{data:unescape(a.data)}))},b.es_close=d.onerror=function(a,f){var g=f?"user":2!==d.readyState?"network":"permanent";b.es_close=d.onmessage=d.onerror=null,d.close(),d=null,c.delay(200,function(){b.dispatchEvent(new e("close",{reason:g}))})}};_.prototype=new d,_.prototype.abort=function(){var a=this;a.es_close&&a.es_close({},!0)};var aa,ba=function(){if(void 0===aa)if("ActiveXObject"in b)try{aa=!!new ActiveXObject("htmlfile")}catch(a){}else aa=!1;return aa},ca=function(a){var d=this;c.polluteGlobalNamespace(),d.id="a"+c.random_string(6,26),a+=(-1===a.indexOf("?")?"?":"&")+"c="+escape(h+"."+d.id);var f,g=ba()?c.createHtmlfile:c.createIframe;b[h][d.id]={start:function(){f.loaded()},message:function(a){d.dispatchEvent(new e("message",{data:a}))},stop:function(){d.iframe_close({},"network")}},d.iframe_close=function(a,c){f.cleanup(),d.iframe_close=f=null,delete b[h][d.id],d.dispatchEvent(new e("close",{reason:c}))},f=g(a,function(a){d.iframe_close({},"permanent")})};ca.prototype=new d,ca.prototype.abort=function(){var a=this;a.iframe_close&&a.iframe_close({},"user")};var da=function(a,b){var c=this,d=0;c.xo=new b("POST",a,null),c.xo.onchunk=function(a,b){if(200===a)for(;;){var f=b.slice(d),g=f.indexOf("\n");if(-1===g)break;d+=g+1;var h=f.slice(0,g);c.dispatchEvent(new e("message",{data:h}))}},c.xo.onfinish=function(a,b){c.xo.onchunk(a,b),c.xo=null;var d=200===a?"network":"permanent";c.dispatchEvent(new e("close",{reason:d}))}};return da.prototype=new d,da.prototype.abort=function(){var a=this;a.xo&&(a.xo.close(),a.dispatchEvent(new e("close",{reason:"user"})),a.xo=null)},y.getUtils=function(){return c},y.getIframeTransport=function(){return L},y}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),"function"==typeof define&&define.amd&&define("sockjs",[],function(){return SockJS}),define("clientSDK/src/clients/WebSocketClient",["underscore","bluebird","sockjs","state-machine"],function(a,b,c,d){var e,f,g,h,i,j=d.transitions.transition,k=d.transitions.afterTransition,l=d.triggers.anyOf,m="meeting.register",n=[],i=null,o=function(b,c,d){return a.invoke(a.filter(b,function(a){return void 0!==a[c]}),c,d)},p=0,q={},r=["websocket","xdr-streaming","xhr-streaming","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"],s=function(a){return a===m},t=1e3,u=1e3,v=function(){},w=function(){i.close()},x=function(){h&&clearTimeout(h),setTimeout(function(){t>p&&setTimeout(function(){o(a.values(q),"onBeforeReconnect",p),F(f,!0),p++},u*(p>10?10:p))},100)},y=d.create({initial:"idle",events:{register:j({from:["idle"],to:"connecting"}),assignGuid:j({from:["connecting","reconnecting"],to:"connected"}),close:j({from:"connected",to:"disconnected"}),closedUnexpectedly:j({from:"connected",to:"reconnecting"}),reconnect:j({from:["connecting","reconnecting","disconnected"],to:"reconnecting"})},triggers:[{event:"close",activatedBy:l(["remoteClose","pairingError","kicked","crash","idleTimeout","clientClose"])},{event:"closedUnexpectedly",activatedBy:l(["networkIssue"])}],callbacks:[k({to:"closed"},w),k({to:"connected"},v),k({to:"reconnecting"},x)]}),z=function(){return"connected"===y.getState()},A=function(){return{guid_assigned:C,remoteclose:function(){y.trigger("remoteClose")},pairingError:function(){y.trigger("pairingError")},kicked:function(){y.trigger("kicked")}}},B=function(a,b){(s(a)||z())&&i.send(JSON.stringify([a,b||{}]))},C=function(b){g=b.seamGuid,y.assignGuid(),o(a.values(q),"onConnect",b)},D=function(){h&&clearTimeout(h),y.trigger("clientClose"),i.close("3077","client-closing on keep alive failure")},E=function(b){var c={access_token:b.oauthInfo.access_token,numeric_id:b.oauthInfo.scope.meeting.meetingNumericId,leader_id:b.oauthInfo.scope.meeting.leaderId,protocol:"2",events:b.events,user:{full_name:b.user.name,is_leader:b.user.leaderId}},d=a.extend.apply(null,a.union([{},c],a.map(n,function(b){return a.isFunction(b)?b():b})));y.register(),B(m,d);var e=setTimeout(function(){"connected"!==y.getState()?y.reconnect():clearTimeout(e)},5e3)},F=function(d,g){return new b(function(b,g){q.guidAssigned={onConnect:b},f=d,i=new c(f.websocketURL,{},{cookie:!0,protocols_whitelist:r}),h=setTimeout(function(){z()?clearTimeout(h):(y.close(),y.reconnect())},15e3),e=f.access_token,i.onopen=function(){E(f),o(a.values(q),"onopen",f)},i.onmessage=function(b){try{var c=JSON.parse(b.data);if(2==c.length&&"object"==typeof c[1]){var d=c[0];switch(d){case"keepalive":B("heartbeat");break;case"refresh":break;default:var e=c[1],f=d.match("([^.]*)$")[0];if(f in A())A()[f](e);else{var g=a.keys(q),h=a.find(g,function(a){return d.match("^"+a)});q[h]&&q[h].onMessage&&q[h].onMessage(d,e)}}}}catch(i){}},i.onclose=function(a){"connected"===y.getState()&&y.closedUnexpectedly()},i.onerror=function(b){o(a.values(q),"onError",b)}})};return{sendEvent:B,connect:F,close:D,registerHandler:function(a,b,c){q[b]=a,c&&n.push(c)}}}),define("clientSDK/src/clients/EventServiceClient",["config","clientSDK/src/models/ParticipantsCollection","clientSDK/src/Roster","clientSDK/src/clients/WebSocketClient"],function(a,b,c,d){var e={user:{name:"Client_SDK_Test"},events:["meeting","endpoint"]},f=a?a:e,g=new b,h=new c(g,{init:!0}),i=!1,j=function(a){},k=function(a){a.meetingGuid;a.props&&a.props.f&&(h=h?h:new c(new b),h.fullUpdate(a.props,{init:!0}),i&&a.props.f.forEach(function(a){})),a.props&&a.props.a&&(h.partialUpdate(a.props),i&&a.props.a.forEach(function(a){})),a.props&&a.props.m&&(h.partialUpdate(a.props),i&&a.props.m.forEach(function(a){})),a.props&&a.props.d&&(h.partialUpdate(a.props),i&&a.props.d.forEach(function(a){}))},l=function(a){},m=function(a){},n=function(a,b){var c={websocketURL:a.events.url,oauthInfo:a.oauthInfo,user:{name:f.user.name,leaderId:a.oauthInfo.scope.meeting.leaderId},events:f.events};d.registerHandler({onMessage:function(a,b){var c={};if(b.body&&b.body){try{c=JSON.parse(b.body)}catch(d){}c.timestamp=b.timestamp,c.event&&("statechange.endpoints"===c.event.substr(0,21)?k(c):"statechange.livemeeting"===c.event.substr(0,23)?l(c):"dialout.notification"===c.event&&m(c))}}},"meeting.notification.msg"),d.connect(c).then(function(a){var b={};b.E1=a.seamGuid,b.ch=a.guid?a.guid:"",b.m=a.meetingGuid?a.meetingGuid:"",h.assignedSelf(b),d.registerHandler({onMessage:function(a,b){j(b)}},"meeting.chat.msg"),d.onBeforeReconnect=function(a){},d.onError=function(a){}}).error(function(a){})},o=function(){d.close()},p=function(a){i=a};return{connect:n,close:o,roster:h,setLogging:p}}),define("clientSDK/src/clients/SchedulingClient",["clientSDK/src/clients/RestClient"],function(a){var b=function(a){var b=new Date,c=b.getTime(),d=b;d.setHours(d.getHours()+1),d=d.getTime();var e={description:"",addAttendeePasscode:!1,endPointVersion:"1.80",timezone:"US/Mountain",end:"",title:"Test Meeting",advancedMeetingOptions:{allowStream:!1,autoRecord:!1,muteParticipantsOnEntry:!1,encryptionType:"ENCRYPTED_ONLY",makeDefault:!1,moderatorLess:!0,videoBestFit:!1,disallowChat:!1,publishMeeting:!1,showAllAttendeesInMeetingInvite:!1},isLargeMeeting:!1,endPointType:"WEB_APP",start:"",recurrencePattern:{recurrenceCount:0,daysOfWeekMask:0,frequency:0,recurrenceType:"NONE",weekOfMonth:"NONE",monthOfYear:"NONE",endDate:null,dayOfMonth:0}};return e.start=c,e.end=d,e},c=function(c,d){var e="/seamapi/v1/user/"+c.leaderId+"/scheduled_meeting/?access_token="+encodeURIComponent(c.userToken),f={url:e,body:b()};a.post(f,d)};return{scheduleMeeting:c}}),define("WebRTC_SDK/RTCManager",["require","my.Class","underscore","backbone","q","WebRTC_SDK/RTCController","Logger","clientSDK/src/clients/SecurePerimeterClient","clientSDK/src/clients/EventServiceClient","clientSDK/src/clients/SchedulingClient","browserDetector"],function(a){var b=a("my.Class"),c=a("underscore"),d=a("backbone"),e=(a("q"),a("WebRTC_SDK/RTCController")),f=a("Logger"),g=a("clientSDK/src/clients/SecurePerimeterClient"),h=a("clientSDK/src/clients/EventServiceClient"),i=(a("clientSDK/src/clients/SchedulingClient"),a("browserDetector")),j=b.Class({constructor:function(a){return"chrome"!==i.browser&&"firefox"!==i.browser?void f.error("Browser not supported !!"):(c.bindAll(this),c.extend(this,d.Events),this.initialize(a),this.aggregateAPIResponse=null,this.meeting=null,this.reconnectInterval=1e3,this.bjnCloudTimeout=5e3,this.bjnSIPTimeout=3e3,this.bjnWebRTCReconnectTimeout=9e4,this.isVolumeMonitorStarted=!1,this.maxBandwidth=1200,void(this.config={environment:{hostname:"https://bluejeansdev.com"},meeting:{meetingNumericId:"",attendeePasscode:""},user:{name:"Testclient",leaderId:14659,userToken:"186731bd52f8478090444d7c5862f7bd"},events:["meeting","endpoint"]}))},initialize:function(a){this.rtcController=new e(a.webrtcParams),this.webrtcParams=a.webrtcParams,this.setupRTCControllerCB(),this.setupRTCControllerListeners(),a.bjnSIPTimeout&&(this.bjnSIPTimeout=a.bjnSIPTimeout),a.bjnWebRTCReconnectTimeout&&(this.bjnWebRTCReconnectTimeout=a.bjnWebRTCReconnectTimeout),a.bjnCloudTimeout&&(this.bjnCloudTimeout=a.bjnCloudTimeout),this.meetingInfo=null,this.localEndPointStateChange=null,this.remoteEndPointStateChange=null,this.remoteStreamChange=null,this.remoteMuteChange=null,this.localVideoStreamChange=null,this.localAudioStreamChange=null,this.error=null,this.fakeStream=null,this.contentStreamChange=null,"firefox"===i.browser&&this.createFakeStream()},setBandwidth:function(a){a>=100&&4096>=a&&(this.maxBandwidth=a)},setupRTCControllerCB:function(){this.getLocalMedia=this.rtcController.getLocalMedia,this.getLocalDevices=this.rtcController.getLocalDevices,this.setSpeaker=this.rtcController.setSpeaker,this.renderSelfView=this.rtcController.renderSelfView,this.renderStream=this.rtcController.renderStream,this.muteStreams=this.rtcController.muteStreams,this.makeCall=this.rtcController.makeCall},setupRTCControllerListeners:function(){this.rtcController.model.on("change:callState",this.onCallStateChange),this.rtcController.model.on("change:localAudioStream",this.onLocalAudioStreamChange),this.rtcController.model.on("change:localVideoStream",this.onLocalVideoStreamChange),this.rtcController.model.on("change:previewStream",this.onPreviewStreamChange),this.rtcController.model.on("change:remoteStream",this.onRemoteStreamChange),this.rtcController.model.on("change:isIceRestarted",this.onIceRestart),this.rtcController.model.on("change:presentationToken",this.onPresentationTokenUpdated.bind(this))},startMeeting:function(a){return a.numericMeetingId&&a.displayName?(this.getPairingCodeAndInitCall(a),void this.initBJNCloudConnectionTimer()):(this.error&&this.error("invalidMeetingParams"),void f.error("Meeting id or display name cannot be empty"))},WebRTCPairing:function(){var a=this;this.meeting.oauthInfo=this.aggregateAPIResponse.oauthInfo,g.webRTCPairing(a.meeting,function(b,c){b?f.error(b):(a.clearReconnectTimer(),a.clearBJNCloudConnectionTimer(),a.initWebRTCCall(JSON.parse(c)),a.connectEventService(a.aggregateAPIResponse))})},getPairingCodeAndInitCall:function(a){var b=this;this.meetingInfo=a,b.meeting={},b.meeting.meetingNumericId=a.numericMeetingId,a.attendeePasscode&&(b.meeting.meetingPasscode=a.attendeePasscode),g.aggregatePairing(b.meeting,function(a,c){a?f.debug("could not get response of aggregate Pairing ",a):(b.aggregateAPIResponse=JSON.parse(c),f.debug("main: aggregatePairing response = ",b.aggregateAPIResponse),b.WebRTCPairing())})},connectEventService:function(a){var b=this;h.roster.collection.bind("add",function(a,c,d){b.clearSipConnectionTimer(),b.remoteEndPointStateChange&&b.remoteEndPointStateChange("connected")}),h.roster.collection.bind("change:isSendingAudio",function(a,b,c){}),h.roster.collection.bind("change:isSendingVideo",function(a,b,c){}),h.roster.collection.bind("remove",function(a,c,d){b.remoteEndPointStateChange&&b.remoteEndPointStateChange("disconnected")}),h.connect(a,this.config,function(a,c){a&&(f.debug("Event Service: connect error"),b.error&&(f.error(a),b.error("bjnCloudUnreachable"),b.clearBJNCloudConnectionTimer(),b.endMeeting()))})},disconntEventService:function(){h.close()},initWebRTCCall:function(a){f.debug("RTCManager :: WebRTC Pairing response ",JSON.stringify(a));var b={sockUrl:a.uri,sessionId:a.pairingCode,endpointDetails:{displayName:this.meetingInfo.displayName,endpointType:"Browser",browserUserAgent:window.navigator.userAgent},maxBandwidth:this.maxBandwidth},c=this.webrtcParams.peerConfig;c.peerConnectionConfig.iceServers=a.turnservers;var d={peerConfig:c,localVideoStream:this.getMediaStream("localVideoStream"),localAudioStream:this.getMediaStream("localAudioStream")};"firefox"===i.browser&&(d.fakeStream=this.fakeStream),this.makeCall(d,b)},stopLocalStreams:function(){var a=this.getMediaStream("localVideoStream"),b=this.getMediaStream("localAudioStream");c.isNull(b)||c.isUndefined(b)||this.rtcController.stopLocalMedia(b),c.isNull(a)||c.isUndefined(a)||this.rtcController.stopLocalMedia(a)},getMediaStream:function(a){var b=this.rtcController.model.get(a);return b?b:null},getCurrentState:function(a){return"local"===a?this.rtcController.model.get("callState"):this.getRemoteCallState()},getCurrentMuteStates:function(a){return"local"===a?{audio:this.rtcController.model.get("audioMuted"),video:this.rtcController.model.get("videoMuted")}:void 0},onCallStateChange:function(a){var b=this,c=a.get("callState");switch(c){case"connected":this.clearWebrtcReconnectTimer();break;case"disconnected":var d=this.rtcController.model.get("disconnectCode");d/100!==2&&(b.initReconnectTimer(),b.initWebrtcReconnectTimer())}this.localEndPointStateChange&&this.localEndPointStateChange(c)},onRemoteStreamChange:function(a){var b=a.get("remoteStream");this.remoteStreamChange&&b&&this.remoteStreamChange(b)},onLocalVideoStreamChange:function(a){this.localVideoStreamChange&&this.localVideoStreamChange(a.get("localVideoStream"))},onLocalAudioStreamChange:function(a){this.localAudioStreamChange&&this.localAudioStreamChange(a.get("localAudioStream"))},onPresentationTokenUpdated:function(a){var b=a.get("presentationToken");if(b&&"contentindication"===b.type)if(this.isScreenShareOn&&"null"===b.callGuid)this.isScreenShareOn=!1,this.onContentStreamUpdated(null);else if(!this.isScreenShareOn&&b.callGuid&&"null"!==b.callGuid){this.isScreenShareOn=!0;var c=a.get("remoteContentStream");c&&this.onContentStreamUpdated(c)}else this.isScreenShareOn||b.callGuid||this.onContentStreamUpdated(null)},onContentStreamUpdated:function(a){this.contentStreamChange&&this.contentStreamChange(a)},initWebrtcReconnectTimer:function(){var a=this;a.webrtcReconnectTimer||(a.webrtcReconnectTimer=window.setTimeout(function(){"connected"!==a.getCurrentState("local")&&(a.error&&a.error("webrtcReconnectTimeout"),a.clearReconnectTimer(),a.endMeeting())},a.bjnWebRTCReconnectTimeout))},clearWebrtcReconnectTimer:function(){this.webrtcReconnectTimer&&window.clearTimeout(this.webrtcReconnectTimer),this.webrtcReconnectTimer=null},initSipConnectionTimer:function(){var a=this;a.sipConnectionTimer||(a.sipConnectionTimer=window.setTimeout(function(){a.error&&a.error("sipConnectionTimeout"),a.endMeeting()},a.bjnSIPTimeout))},clearSipConnectionTimer:function(){this.sipConnectionTimer&&window.clearTimeout(this.sipConnectionTimer),this.sipConnectionTimer=null},initBJNCloudConnectionTimer:function(){var a=this;this.bjnCloudConnectiontimer||(this.bjnCloudConnectiontimer=window.setTimeout(function(){a.onError&&a.onError("bjnCloudUnreachable"),a.endMeeting()},this.bjnCloudTimeout))},clearBJNCloudConnectionTimer:function(){this.bjnCloudConnectiontimer&&window.clearTimeout(this.bjnCloudConnectiontimer),this.bjnCloudConnectiontimer=null},initReconnectTimer:function(){this.reconnectInterval<32e3&&(this.reconnectInterval*=2),f.debug("reconnect interval"+this.reconnectInterval),this.WebRTCPairing(),this.reconnectTimer=window.setTimeout(this.initReconnectTimer,this.reconnectInterval)},getMicrophoneVolume:function(){return this.isVolumeMonitorStarted||(this.rtcController.startVolumeMonitoring(this.rtcController.model.get("localAudioStream"),params={}),this.isVolumeMonitorStarted=!0),this.rtcController.model.get("volumeLevel")},createFakeStream:function(a){var b=this;c.isNull(this.fakeStream)&&navigator.mediaDevices.getUserMedia({video:!0,audio:!1,fake:!0}).then(function(a){a.getVideoTracks().forEach(function(a){a&&a.stop()}),f.debug("RTCManager: Adding fake stream for firefox"),a.bjn_label="fake_stream",b.fakeStream=a})},clearReconnectTimer:function(){this.reconnectTimer&&window.clearTimeout(this.reconnectTimer),this.reconnectTimer=null,this.reconnectInterval=1e3},endMeeting:function(){f.debug("End the meeting"),self.fakeStream=null,this.rtcController.stopVolumeMonitoring(),this.isVolumeMonitorStarted=!1,this.rtcController.endCall(),this.disconntEventService()}});return j}),define("webrtc-sdk",function(){}),require(["webrtc-sdk"]);